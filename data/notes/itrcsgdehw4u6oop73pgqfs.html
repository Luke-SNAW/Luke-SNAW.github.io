<h1 id="conditional-commands-for-cypress">Conditional Commands For Cypress<a aria-hidden="true" class="anchor-heading icon-link" href="#conditional-commands-for-cypress"></a></h1>
<blockquote>
<p><a href="https://glebbahmutov.com/blog/cypress-if/">https://glebbahmutov.com/blog/cypress-if/</a></p>
</blockquote>
<h2 id="conditional-logic-using-cythen"><a href="https://glebbahmutov.com/blog/cypress-if/#conditional-logic-using-cythen">Conditional logic using cy.then</a><a aria-hidden="true" class="anchor-heading icon-link" href="#conditional-logic-using-cythen"></a></h2>
<p>One solution is to grab the input element and check ourselves using the <a href="https://on.cypress.io/then">cy.then</a> command.</p>
<pre class="language-js"><code class="language-js"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"submits the terms forms"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  cy<span class="token punctuation">.</span><span class="token method function property-access">visit</span><span class="token punctuation">(</span><span class="token string">"cypress/terms.html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cy<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"#agreed"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">$input</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>$input<span class="token punctuation">.</span><span class="token method function property-access">is</span><span class="token punctuation">(</span><span class="token string">":checked"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      cy<span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">"The user already agreed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
      cy<span class="token punctuation">.</span><span class="token method function property-access">wrap</span><span class="token punctuation">(</span>$input<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cy<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"button#submit"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="conditional-logic-using-cypress-if"><a href="https://glebbahmutov.com/blog/cypress-if/#conditional-logic-using-cypress-if">Conditional logic using cypress-if</a><a aria-hidden="true" class="anchor-heading icon-link" href="#conditional-logic-using-cypress-if"></a></h2>
<p>Instead of writing <code>.then</code> callbacks, you could use my <a href="https://github.com/bahmutov/cypress-if">cypress-if</a> plugin. This plugin lets you write <code>if / else</code> commands right inside a chain of commands without using <code>cy.then</code> and <code>cy.wrap</code>.</p>
<p>Let's install the plugin as a dev dependency and simplify our test</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> i -D cypress-if
<span class="token comment"># or install the plugin using Yarn</span>
$ <span class="token function">yarn</span> <span class="token function">add</span> -D cypress-if
</code></pre>
<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token string">"cypress-if"</span><span class="token punctuation">;</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"submits the terms forms"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  cy<span class="token punctuation">.</span><span class="token method function property-access">visit</span><span class="token punctuation">(</span><span class="token string">"cypress/terms.html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cy<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"#agreed"</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token keyword control-flow">if</span><span class="token punctuation">(</span><span class="token string">"not.checked"</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// IF path</span>
    <span class="token punctuation">.</span><span class="token keyword control-flow">else</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">"The user already agreed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ELSE path</span>
  cy<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"button#submit"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>The child commands <code>.if()</code> and <code>.else()</code> come from the <code>cypress-if</code> plugin. You can use any Cypress assertion as the <code>.if(assertion)</code> condition; by default it is element existence. If the input button is unchecked, the test takes the "IF" path and skips the "ELSE" portion of the command chain.</p>
<p>You can have multiple commands in the "IF" and "ELSE" portions, you can use <code>cy.then</code>, <code>cy.within</code> commands, etc. See the plugin's README for more examples of writing conditional command chains.</p>
<h2 id="warning-not-every-situation-requires-conditional-commands"><a href="https://glebbahmutov.com/blog/cypress-if/#warning-not-every-situation-requires-conditional-commands">Warning: not every situation requires conditional commands</a><a aria-hidden="true" class="anchor-heading icon-link" href="#warning-not-every-situation-requires-conditional-commands"></a></h2>
<p>In our situation the best solution is to use the <a href="https://on.cypress.io/check">cy.check</a> command. This command does nothing if the checkbox is already checked!</p>
<pre class="language-js"><code class="language-js"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"submits the terms forms"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  cy<span class="token punctuation">.</span><span class="token method function property-access">visit</span><span class="token punctuation">(</span><span class="token string">"cypress/terms.html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cy<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"#agreed"</span><span class="token punctuation">)</span>
    <span class="token comment">// check the input box</span>
    <span class="token comment">// if it is not checked already</span>
    <span class="token comment">// https://on.cypress.io/check</span>
    <span class="token punctuation">.</span><span class="token method function property-access">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cy<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"button#submit"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>For a similar lesson on using the built-in Cypress commands instead of conditional testing, see the free lesson "Lesson d4: How to avoid conditional test logic" in my course <a href="https://cypress.tips/courses/cypress-plugins">Cypress Plugins</a>. Deterministic tests are the best, use the conditional test commands only if you really cannot control the application in any other way.</p>