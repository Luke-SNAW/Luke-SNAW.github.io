<h1 id="pass-the-reference">Pass The Reference<a aria-hidden="true" class="anchor-heading icon-link" href="#pass-the-reference"></a></h1>
<p><a href="https://glebbahmutov.com/blog/pass-reference/">https://glebbahmutov.com/blog/pass-reference/</a></p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// cypress/integration/spec.js</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Alert</span></span> <span class="token keyword module">from</span> <span class="token string">'../../src/Alert'</span>
<span class="token comment">// if get the instance of alert from the application</span>
cy<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token spread operator">...</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token spread operator">...</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
 <span class="token comment">// NOPE, will fail!</span>
 <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">isAlert</span><span class="token punctuation">(</span>appAlert<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">to</span><span class="token punctuation">.</span><span class="token property-access">be</span><span class="token punctuation">.</span><span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>So how do we ensure the spec has <em>the same Alert</em> reference as the application? By avoiding importing it and instead getting it from the application. Following the approach outlined in the blog post <a href="https://glebbahmutov.com/blog/send-data-to-the-test/" title="Send Data From The Application To The Cypress Test">Send Data From The Application To The Cypress Test</a> we do the following in the application:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// application code in "src"</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Alert</span></span> <span class="token keyword module">from</span> <span class="token string">"./Alert"</span><span class="token punctuation">;</span>
<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Cypress</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Alert</span></span> <span class="token operator">=</span> <span class="token maybe-class-name">Alert</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">isAlert</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> a <span class="token keyword">instanceof</span> <span class="token class-name">Alert</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>So when the application loads, it "saves" its <code>Alert</code> reference on the <code>window</code> object. From the spec we can get to that reference using the <a href="https://on.cypress.io/window">cy.window</a> and <a href="https://on.cypress.io/its">cy.its</a> commands. Even if it takes a little for the application to load and set the <code>window.Alert</code> no problem, the <code>cy.its</code> command <a href="https://on.cypress.io/retry-ability">retries automatically</a> until that property is found.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// cypress/integration/spec.js</span>
<span class="token comment">// do not import Alert, instead</span>
cy<span class="token punctuation">.</span><span class="token method function property-access">window</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">its</span><span class="token punctuation">(</span><span class="token string">'Alert'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter"><span class="token maybe-class-name">Alert</span></span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
 <span class="token comment">// âœ… The Alert instance now comes from the application code</span>
 cy<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token spread operator">...</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token spread operator">...</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
 <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">isAlert</span><span class="token punctuation">(</span>appAlert<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">to</span><span class="token punctuation">.</span><span class="token property-access">be</span><span class="token punctuation">.</span><span class="token boolean">true</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>