<h1 id="iframe">Iframe<a aria-hidden="true" class="anchor-heading icon-link" href="#iframe"></a></h1>
<pre class="language-js"><code class="language-js"><span class="token comment">// https://bahr.dev/2019/09/02/testing-stripe-elements/</span>
<span class="token maybe-class-name">Cypress</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Commands</span></span><span class="token punctuation">.</span><span class="token method function property-access">add</span><span class="token punctuation">(</span><span class="token string">"iframeLoaded"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> prevSubject<span class="token operator">:</span> <span class="token string">"element"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">$iframe</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token maybe-class-name">Cypress</span><span class="token punctuation">.</span><span class="token method function property-access">config</span><span class="token punctuation">(</span><span class="token string">"chromeWebSecurity"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword control-flow">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>
      <span class="token string">"To get stripe element `chromeWebSecurity` must be disabled"</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// https://medium.com/swinginc/testing-stripe-integration-with-cypress-3f0d665cfef7</span>

  <span class="token keyword">const</span> contentWindow <span class="token operator">=</span> $iframe<span class="token punctuation">.</span><span class="token method function property-access">prop</span><span class="token punctuation">(</span><span class="token string">"contentWindow"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>contentWindow <span class="token operator">&#x26;&#x26;</span> contentWindow<span class="token punctuation">.</span><span class="token property-access">document</span><span class="token punctuation">.</span><span class="token property-access">readyState</span> <span class="token operator">===</span> <span class="token string">"complete"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>contentWindow<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
      $iframe<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">"load"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>contentWindow<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token maybe-class-name">Cypress</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Commands</span></span><span class="token punctuation">.</span><span class="token method function property-access">add</span><span class="token punctuation">(</span>
  <span class="token string">"getInDocument"</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> prevSubject<span class="token operator">:</span> <span class="token string">"document"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter"><span class="token dom variable">document</span><span class="token punctuation">,</span> selector</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token maybe-class-name">Cypress</span><span class="token punctuation">.</span><span class="token method function property-access">$</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token dom variable">document</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token maybe-class-name">Cypress</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Commands</span></span><span class="token punctuation">.</span><span class="token method function property-access">add</span><span class="token punctuation">(</span><span class="token string">"getWithinIframe"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">targetElement</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span>
  cy<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"iframe"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">iframeLoaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">its</span><span class="token punctuation">(</span><span class="token string">"document"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">getInDocument</span><span class="token punctuation">(</span>targetElement<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<pre class="language-js"><code class="language-js"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"Stripe 테스트 결제"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">cyStripe</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">selector</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span>
    cy
      <span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'iframe[name="stripe_checkout_app"]'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token method function property-access">iframeLoaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token method function property-access">its</span><span class="token punctuation">(</span><span class="token string">"document"</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token method function property-access">getInDocument</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">cyStripe</span><span class="token punctuation">(</span><span class="token string">"#email"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">type</span><span class="token punctuation">(</span><span class="token string">"luke@genoplan.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">cyStripe</span><span class="token punctuation">(</span><span class="token string">"#card_number"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">type</span><span class="token punctuation">(</span><span class="token string">"4000056655665556"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// debit</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<pre class="language-json"><code class="language-json"><span class="token comment">// cypress.config.js</span>
chromeWebSecurity<span class="token operator">:</span> <span class="token boolean">false</span>  <span class="token comment">//  for stripe test, accessing iframe on local</span>
</code></pre>