<h1 id="get-all-that-network-activity-under-control-with-priority-hints">Get All That Network Activity Under Control with Priority Hints<a aria-hidden="true" class="anchor-heading icon-link" href="#get-all-that-network-activity-under-control-with-priority-hints"></a></h1>
<blockquote>
<p><a href="https://www.macarthur.me/posts/priority-hints">https://www.macarthur.me/posts/priority-hints</a></p>
</blockquote>
<p>The browser is very good at prioritizing resources requests on its own. But it's not always great. Priority hints makes it easy to provide explicit instructions as to how and in what network activity occurs.</p>
<p>Open up the browser's network tab and you'll see a lot of activity. Assets are being downloaded, information's being submitted, events are being logged, and more.</p>
<p>With so much going on, effectively managing the priority of that traffic is pretty critical. Bandwidth contention is real, and some HTTP requests simply don't rank as highly as others when they're all firing at once. For example, if you <em>had</em> to choose, you'd probably prefer someone's payment request successfully complete vs. an analytics request simply indicating they tried. And having your hero image show up as quickly as possible is arguably more important than your logo rendering in the footer of your page.</p>
<p>Fortunately, the browser has a growing collection of tools to help prioritize all this network activity. These "<a href="https://github.com/WICG/priority-hints/blob/main/EXPLAINER.md?ref=alex-macarthur">priority hints</a>" help the browser make fewer assumptions and clearer decisions about which requests to favor over others when resources are limited.</p>
<p>It's a useful suite of tools, and they can make a tangible impact to page performance when leveraged well, including those increasingly important core web vitals. Let's explore a few of them, along with some scenarios in which they're most helpful.</p>
<h2 id="prioritizing-preloaded-assets"><a href="https://www.macarthur.me/posts/priority-hints#prioritizing-preloaded-assets">Prioritizing Preloaded Assets</a><a aria-hidden="true" class="anchor-heading icon-link" href="#prioritizing-preloaded-assets"></a></h2>
<p>Modern browsers have a well-supported means of being told about resources that'll <em>eventually</em> be needed on the current page: <code>&#x3C;link rel="preload" ... /></code>. When placed in the <code>&#x3C;head></code> of the document, the browser is instructed to begin downloading it as soon as possible with "high" priority.</p>
<p>To be fair, the preload scanner in the browser is already <em>really good</em> at this sort of thing (<a href="https://www.macarthur.me/posts/effective-preloading?ref=alex-macarthur">I've previously written</a> about it in a little more depth). For that reason, preloading is best used on <em>late-discovered</em> assets – anything not loaded directly by your HTML. Think: a font file loaded within some CSS, or a background image loaded via an inline <code>style</code> attribute.</p>
<p>Consider a font that's loaded exclusively through a CSS <code>@font-face</code> rule:</p>
<pre class="language-css"><code class="language-css"><span class="token atrule"><span class="token rule">@font-face</span></span> <span class="token punctuation">{</span>
  <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">"Inter Variable"</span><span class="token punctuation">;</span>
  <span class="token property">src</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">"./font.woff2"</span><span class="token punctuation">)</span></span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"woff2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>On load, that font gets the lowest download priority, despite it being pretty important for the visual experience of the page.</p>
<p><a href="https://picperf.dev/https://cms.macarthur.me/content/images/2023/09/image-12-highlighted.png">image showing low download priothe font file is given low download priority when loaded just through CSSrity of fonts</a></p>
<p>Now, let's preload that resource:</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>head</span><span class="token punctuation">></span></span>
  <span class="token comment">&#x3C;!-- Other stuff... --></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preload<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/font.woff2<span class="token punctuation">"</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>font<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>head</span><span class="token punctuation">></span></span>
</code></pre>
<p>It's now far more favored:</p>
<p><a href="https://picperf.dev/https://cms.macarthur.me/content/images/2023/09/image-12.png">the font is given higher download priority after being preloaded</a></p>
<p>But you can get <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLLinkElement/fetchPriority?ref=alex-macarthur">even more explicit</a> using the <code>fetchpriority</code> directly on the <code>link</code> tag. It'll let you signal relative priority when preloading multiple assets at once.</p>
<p>Here's a contrived scenario in which you'd like to preload two fonts, but give one priority over the other:</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preload<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./font-1.woff2<span class="token punctuation">"</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>font<span class="token punctuation">"</span></span> <span class="token attr-name">fetchpriority</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>low<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preload<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./font-2.woff2<span class="token punctuation">"</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>font<span class="token punctuation">"</span></span> <span class="token attr-name">fetchpriority</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>high<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
</code></pre>
<p>The resulting network activity reflects these instructions (I included a third, non-preloaded font in there too, just because).</p>
<p><img src="https://picperf.dev/https://cms.macarthur.me/content/images/2023/09/image-14.png"></p>
<h3 id="when-to-use-it"><a href="https://www.macarthur.me/posts/priority-hints#when-to-use-it">When to Use It</a><a aria-hidden="true" class="anchor-heading icon-link" href="#when-to-use-it"></a></h3>
<p>In general, use preloading when an asset isn't loaded by your HTML directly, but it's critical to the experience of the page (fonts, CSS background images, etc.). And include the <code>fetchpriority</code> attribute when preloading several resources of the same type and you're clear about which is most important.</p>
<h2 id="prioritizing-fetch-requests"><a href="https://www.macarthur.me/posts/priority-hints#prioritizing-fetch-requests">Prioritizing <code>fetch()</code> Requests</a><a aria-hidden="true" class="anchor-heading icon-link" href="#prioritizing-fetch-requests"></a></h2>
<p>In my opinion, the Fetch API is one of the most ergonomic offerings of the modern web. And it has some nice features that <code>XMLHttpRequest</code> lacked, like the ability to <a href="https://developer.mozilla.org/en-US/docs/Web/API/fetch?ref=alex-macarthur">signal priority</a> on an outgoing request.</p>
<p>The most top-of-mind use case is one I've already mentioned: analytics requests. When bandwidth is slim and multiple requests are in play, the browser will make its own priority decisions. But we as engineers (should) know that your typical analytics requests ought to take a back seat to others more critical to the page's purpose. Modern <code>fetch()</code> makes that easy.</p>
<p>Here's a simple setup with two requests being queued at (virtually) the same time:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"http://localhost:8000/pay"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  method<span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>
  body<span class="token operator">:</span> paymentBody<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"http://localhost:8000/log"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  method<span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>
  body<span class="token operator">:</span> loggingBody<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>By default, the browser will automatically consider them both "high" priority:</p>
<p><a href="https://picperf.dev/https://cms.macarthur.me/content/images/2023/09/image-16.png">both requests will have high priority by default</a></p>
<p>Now, we'll explicitly tell the browser how each request should be prioritized:</p>
<pre class="language-diff"><code class="language-diff">fetch("http://localhost:8000/pay", {
	method: "POST",
	body: paymentBody,
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">	priority: "high"
</span></span>});

fetch("http://localhost:8000/log", {
	method: "POST",
	body: loggingBody,
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">	priority: "low"
</span></span>});
</code></pre>
<p>This time around, the priorities are different:</p>
<p><a href="https://picperf.dev/https://cms.macarthur.me/content/images/2023/09/image-17.png">one request now has higher priority than the other</a></p>
<h4 id="useful-counterpart-keepalive-true"><a href="https://www.macarthur.me/posts/priority-hints#useful-counterpart-keepalive-true">Useful counterpart: <code>keepalive: true</code></a><a aria-hidden="true" class="anchor-heading icon-link" href="#useful-counterpart-keepalive-true"></a></h4>
<p>A possible concern here is that "low" priority requests may be lost to the void – cancelled if the user navigates away from the page too soon. That's a legitimate issue. Depending on a few factors, either closing the tab or moving onto the next page may cause an important, but <em>relatively</em> low-priority request to be aborted.</p>
<p>Fortunately, <code>fetch()</code> also accepts a <code>keepalive</code> option. When set to <code>true</code>, the browser will carry that request to completion even when the page is terminated. If you'd like to dig into it more, take a gander at <a href="https://css-tricks.com/send-an-http-request-on-page-exit/?ref=alex-macarthur">what I wrote for for CSS-Tricks</a> a while back.</p>
<h3 id="when-to-use-it-1"><a href="https://www.macarthur.me/posts/priority-hints#when-to-use-it-1">When to Use It</a><a aria-hidden="true" class="anchor-heading icon-link" href="#when-to-use-it-1"></a></h3>
<p>Indicate <code>fetch()</code>priority when you know multiple requests are executing concurrently, and it's clear to you which is most important (or which can safely be deprioritized).</p>
<h2 id="prioritizing-img--requests"><a href="https://www.macarthur.me/posts/priority-hints#prioritizing-img-requests">Prioritizing <code>&#x3C;img /></code> Requests</a><a aria-hidden="true" class="anchor-heading icon-link" href="#prioritizing-img--requests"></a></h2>
<p>Without us doing anything special, the browser attempts to do its best at determining the most important images on a page. To illustrate this, I loaded the following images, spaced a good distance apart, so only one would be "above the fold."</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./cat-1.jpeg<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">5000</span><span class="token unit">px</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./cat-2.jpeg<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">5000</span><span class="token unit">px</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./cat-3.jpeg<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
</code></pre>
<p>The browser picked up on which was most important, but it took a second. When downloading began, all three were "low" priority. But shortly after, the one above the fold switched to "high."</p>
<p><a href="https://picperf.dev/https://cms.macarthur.me/content/images/2023/09/loading-priority.gif">priority for images shifts when loading begins</a></p>
<p>Things became more predictable when I added a <code>fetchpriority</code> attribute to the first image:</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./cat-1.jpeg<span class="token punctuation">"</span></span> <span class="token attr-name">fetchpriority</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>high<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
</code></pre>
<p>After that, <code>cat-1.jpeg</code>loaded at the highest priority right out of the gate. While initially head-tilting, it makes sense. The browser is smart at determining resource criticality, but it benefits from clear instructions. If you know an image is important, be explicit about it.</p>
<p>This feature, by the way, pairs very nicely with native image lazy loading, a very well-supported feature these days.</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./cat-1.jpeg<span class="token punctuation">"</span></span> <span class="token attr-name">fetchpriority</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>high<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">5000</span><span class="token unit">px</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./cat-2.jpeg<span class="token punctuation">"</span></span> <span class="token attr-name">loading</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lazy<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">5000</span><span class="token unit">px</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./cat-3.jpeg<span class="token punctuation">"</span></span> <span class="token attr-name">loading</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lazy<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
</code></pre>
<p>With that in place, the browser knows exactly how (and if) to load images, only when appropriate. In my case, it won't even begin the request for off-screen images on initial load. Instead, it'll wait until they're closer to the viewport.</p>
<p><a href="https://picperf.dev/https://cms.macarthur.me/content/images/2023/09/image-18.png">priority for images shifts</a></p>
<h3 id="when-to-use-it-2"><a href="https://www.macarthur.me/posts/priority-hints#when-to-use-it-2">When to Use It</a><a aria-hidden="true" class="anchor-heading icon-link" href="#when-to-use-it-2"></a></h3>
<p>Use an explicit <code>fetchpriority</code> on images when you know they're very important to page experience. Hero images are a great place to start, and it can even have an impact on a page's core web vitals – <a href="https://addyosmani.com/blog/fetch-priority/?ref=alex-macarthur">specifically, LCP</a> (largest contentful paint).</p>
<h2 id="prioritizing-script--tags"><a href="https://www.macarthur.me/posts/priority-hints#prioritizing-script-tags">Prioritizing <code>&#x3C;script /></code> Tags</a><a aria-hidden="true" class="anchor-heading icon-link" href="#prioritizing-script--tags"></a></h2>
<p>Any plain <code>&#x3C;script /></code> with a <code>src</code> attribute on a page will get <code>high</code> priority as it's being fetched, but there's a trade-off: it blocks parsing of the rest of the page until it's loaded and executed. For that reason, the <code>async</code> attribute is helpful. It'll request the script in the background at <code>low</code> priority, and execute as soon as it's ready. Knowing this, the following setup behaves predictably:</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/script-async.js<span class="token punctuation">"</span></span> <span class="token attr-name">async</span> <span class="token special-attr"><span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'async'</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/script-sync.js<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'sync'</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">"inline"</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>script</span><span class="token punctuation">></span></span>
</code></pre>
<p>The asynchronous script is demoted in priority:</p>
<p><a href="https://picperf.dev/https://cms.macarthur.me/content/images/2023/09/image-22.png">asynchronous script is downloaded with "low" priority</a></p>
<p>And the console confirms that subsequent scripts were allowed to parse and execute as the <code>async</code> script was loading.</p>
<p><a href="https://picperf.dev/https://cms.macarthur.me/content/images/2023/09/async-1.gif">script loaded asynchronously</a></p>
<h3 id="non-blocking-but-high-priority-scripts"><a href="https://www.macarthur.me/posts/priority-hints#non-blocking-but-high-priority-scripts">Non-Blocking, but High-Priority Scripts</a><a aria-hidden="true" class="anchor-heading icon-link" href="#non-blocking-but-high-priority-scripts"></a></h3>
<p>Most of the time, that behavior's fine. But sometimes, you might want a script to load both asynchronously <em>and</em> with "high" priority.</p>
<p>A possible scenario is a small SPA mounted in the hero of a landing page. In order to preserve the page's core web vitals, specifically LCP and FID (first input delay, soon to be replaced by <a href="https://developers.google.com/search/blog/2023/05/introducing-inp?ref=alex-macarthur">interaction to next paint</a>), you'll need that script to be highly prioritized (after all, it's responsible for building and powering your application). But at the same time, you don't want it to block the rest of the page from parsing.</p>
<p>So, let's give it a <code>fetchpriority</code>:</p>
<pre class="language-diff"><code class="language-diff"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> &#x3C;script src="/script-async.js" async onload="console.log('async')" fetchpriority="high">&#x3C;/script>
</span></span><span class="token deleted-arrow deleted"><span class="token prefix deleted">&#x3C;</span><span class="token line">script src="/script-sync.js" onload="console.log('sync')">&#x3C;/script>
</span><span class="token prefix deleted">&#x3C;</span><span class="token line">script>console.log("inline");&#x3C;/script>
</span></span></code></pre>
<p>And now, it's downloaded with elevated priority, while still not blocking the rest of the page:</p>
<p><a href="https://picperf.dev/https://cms.macarthur.me/content/images/2023/09/image-23.png">asynchronous script downloaded with high priority</a></p>
<p>And the console verifies this. With that higher priority, the async script loads more quickly. In this case, even before the synchronous and inline ones.</p>
<p><a href="https://picperf.dev/https://cms.macarthur.me/content/images/2023/09/prioritized-async.gif">log asynchronous script downloaded</a></p>
<p>While I didn't toy with it specifically here, yes, <code>fetchpriority</code> works with deferred scripts as well.</p>
<h3 id="when-to-use-it-3"><a href="https://www.macarthur.me/posts/priority-hints#when-to-use-it-3">When to Use It</a><a aria-hidden="true" class="anchor-heading icon-link" href="#when-to-use-it-3"></a></h3>
<p>Place <code>fetchpriority</code> on your scripts when you know their priorities up front, and if you suspect the browser won't have enough information to determine on its own. As I mentioned, it's particularly helpful for prioritizing scripts that you'd also like to load in non-blocking, asynchronous way.</p>
<h2 id="to-be-used-intentionally"><a href="https://www.macarthur.me/posts/priority-hints#to-be-used-intentionally">To Be Used Intentionally</a><a aria-hidden="true" class="anchor-heading icon-link" href="#to-be-used-intentionally"></a></h2>
<p>It's easy to become a little overzealous about tools like this, leading to overuse. So, be careful – doing so may come at a cost. As the adage goes: "emphasizing everything = emphasizing nothing." In fact, overuse may actually make it <em>more difficult</em> for the browser to manage against network contention, <em>harming</em> a page's performance.</p>
<p>MDN even makes a point to call it out in some of their <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLLinkElement/fetchPriority?ref=alex-macarthur">priority hint documentation</a>:</p>
<blockquote>
<p>Use it sparingly for exceptional cases where the browser may not be able to infer the best way to load the resource automatically. Over use can result in degrading performance.</p>
</blockquote>
<p>So, don't feel obligated to reach for these tools just because they exist. Wield them with care.</p>
<h2 id="reviewing-when-to-hint"><a href="https://www.macarthur.me/posts/priority-hints#reviewing-when-to-hint">Reviewing: When to Hint</a><a aria-hidden="true" class="anchor-heading icon-link" href="#reviewing-when-to-hint"></a></h2>
<p>There's a lot here, so let's quickly review some times you might choose to leverage priority hints. They're not exhaustive. Just some good places to start.</p>
<ul>
<li>Hint <strong>preloaded assets</strong> when you want the browser to be aware of multiple late-discovered resources, some of which bring more critical to the page than others.</li>
<li>Hint <strong><code>fetch()</code> requests</strong> that you know are either a crucial part of a user's experience, or can safely be deprioritized to make way for more important ones.</li>
<li>Hint above-the-fold <strong>images</strong> you want to be loaded &#x26; visible as soon as possible.</li>
<li>Hint <strong>scripts</strong> that are key to the function of a page, but you don't want to block the rest of the page (including other assets) from being parsed and downloaded.</li>
</ul>
<h2 id="make-the-browser-guess-less"><a href="https://www.macarthur.me/posts/priority-hints#make-the-browser-guess-less">Make the Browser Guess Less</a><a aria-hidden="true" class="anchor-heading icon-link" href="#make-the-browser-guess-less"></a></h2>
<p>The browser is incredibly smart about figuring out how and when to download the stuff that makes our pages tick. But it's not always <em>great.</em> It doesn't know why a page exists or the intent behind its individual parts. And so occasionally, it could use some extra help.</p>
<p>That's why these priority hints exist: to make instructions clear, and to leave the browser very little chance to get those decisions wrong. Keep them in mind the next time you're digging through your own application's network activity, and when it makes sense, reach for them to help make your page performance just a little more intelligent.</p>