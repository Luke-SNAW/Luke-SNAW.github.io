{"pageProps":{"note":{"id":"p54hilx39w0qha68frckomu","title":"PIDs: Creating Stable Control in Games","desc":"","updated":1705478346027,"created":1705478235038,"custom":{},"fname":"dev.software-engineering.pids-creating-stable-control-in-games","type":"note","vault":{"fsPath":"vault"},"contentHash":"221d526c63c40a0c4dd24a6a44c627e1","links":[],"anchors":{"proportional-control":{"type":"header","text":"Proportional Control#","value":"proportional-control","line":30,"column":0,"depth":2},"integral-control":{"type":"header","text":"Integral Control#","value":"integral-control","line":49,"column":0,"depth":2},"derivative-control":{"type":"header","text":"Derivative Control#","value":"derivative-control","line":68,"column":0,"depth":2},"using-pids":{"type":"header","text":"Using PIDs#","value":"using-pids","line":81,"column":0,"depth":2},"pids":{"type":"header","text":"PIDs#","value":"pids","line":109,"column":0,"depth":2},"other-resources":{"type":"header","text":"Other Resources#","value":"other-resources","line":119,"column":0,"depth":2}},"children":[],"parent":"j0N1aVKxe96dktmyADG9U","data":{}},"body":"<h1 id=\"pids-creating-stable-control-in-games\">PIDs: Creating Stable Control in Games<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#pids-creating-stable-control-in-games\"></a></h1>\n<blockquote>\n<p><a href=\"https://azeemba.com/posts/pids-creating-stable-control-in-games.html\">https://azeemba.com/posts/pids-creating-stable-control-in-games.html</a><br>\nUsing a game use-case to motivate and explain PIDs<br>\nJanuary 15, 2024 · 7 min</p>\n</blockquote>\n<p>Your browser does not support HTML5 video.</p>\n<p>Experiments I did for implementing tag plays in <a href=\"https://theumpshow.com/\">The Ump Show</a>. For the tag play to work, the runner has to arrive at the plate at a very specific time.</p>\n<p>I am working on a <a href=\"https://theumpshow.com/\">baseball video game</a> with 3D characters. Sometimes the characters need to move and they need to get to specific locations at specific times. But that’s tricky to do.</p>\n<p>The problem is that the character runs via animation. Similar to how humans run, forward speed changes throughout the character’s running stride. Unlike how humans run though, animation is choppy. Each frame of the animation jumps from one position to the next. This choppiness can also be frame-rate dependent. Depending on the frame rate, animations can be interpolated differently, yielding slightly different forward speeds.</p>\n<p>Your browser does not support HTML5 video.</p>\n<p>Two characters using the same animation but the character with longer legs is faster.</p>\n<p>Additionally, the animation will also yield different forward speeds for different characters. Characters with longer legs will move faster for the same animation than characters with shorter legs.</p>\n<p>The forward speed controls when we arrive at our target. And we can control the forward speed by controlling the animation speed. But because of the non-uniform speed through a stride, the frame-dependent interpolation, and the character dependence, the animation speed is a noisy controller for the forward speed. Making a 10% change in the animation speed may not necessarily yield a 10% change in the forward speed.</p>\n<p>So how can we use our noisy control (animation speed) to finely control the arrival time of the character?</p>\n<h2 id=\"proportional-control\">Proportional Control<a href=\"https://azeemba.com/posts/pids-creating-stable-control-in-games.html#proportional-control\">#</a><a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#proportional-control\"></a></h2>\n<p>The first step we can take is to add a proportional control. We check our current trajectory and see if we will arrive early or late. If we are going to arrive early, we can slow down by some factor. If we are going to arrive late, then we can speed up by some factor. Let’s call the proportional factor <code>P</code>.</p>\n<pre class=\"language-sh\"><code class=\"language-sh\">current_error = target_value - current_value\nadjustment = P*current_error\n</code></pre>\n<p><a href=\"https://azeemba.com/posts/pids-creating-stable-control-in-games/PID-POnly.png\">PID-POnly</a></p>\n<p>Behavior of the proprotional control. The y-axis shows the expected error which we want to go to 0. In this example, the proportional factor was too large so we see the error swinging back and forth wildly as the runner speeds up and slows down repeatedly.</p>\n<p>One problem here is how should we pick the factor. If the factor is too small, then we will be too slow to adjust. If the factor is too big, then we will overshoot.</p>\n<p>Worse, the factor has to be different for different characters. As we established earlier, different characters are affected by the animation differently. And different adjustments to the animation speed will impact different characters differently as well.</p>\n<p>So ideally we want to pick a “close enough” factor and have something else clean up the edge cases for us. That’s where the <code>I</code> term comes in.</p>\n<h2 id=\"integral-control\">Integral Control<a href=\"https://azeemba.com/posts/pids-creating-stable-control-in-games.html#integral-control\">#</a><a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#integral-control\"></a></h2>\n<p>Suppose you picked a proportional factor that’s too low and the controls are not making adjustments fast enough. We can try to detect this situation and automatically push the adjustment in the needed direction.</p>\n<p>For example, we can track the historical error by accumulating the error at each measurement. We can use the accumulated error and adjust the speed by another factor. As the accumulated error grows, we make a more aggressive adjustment. Since the accumulated error can be seen as an integral, we can call this factor the integral factor (or <code>I</code>).</p>\n<pre class=\"language-sh\"><code class=\"language-sh\">historical_error += current_error\nadjustment = P*current_error + I*historical_error\n</code></pre>\n<p><a href=\"https://azeemba.com/posts/pids-creating-stable-control-in-games/PID-IOnly.png\">PID-IOnly</a></p>\n<p>To more clearly see the effects of the integral controller, this graph shows the behavior of a solo integral controller. While this shrinks the error faster, it still overshoots the target. This will result in the runner speeding up and slowing down a lot.</p>\n<p>When we add the proportional and the integral controls, what we will see is that the integral factor will help the controller make faster adjustments but it will <em>always</em> overshoot the target. Since the accumulated error will not clear out till you start accumulating error in the other direction, the integral factor will always push you to go past the target to accumulate more error.</p>\n<p>That’s where the D term can help us.</p>\n<h2 id=\"derivative-control\">Derivative Control<a href=\"https://azeemba.com/posts/pids-creating-stable-control-in-games.html#derivative-control\">#</a><a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#derivative-control\"></a></h2>\n<p>The only remaining problem is to deal with the overshoot. To prevent overshoot, we can start by predicting the overshoot. We can look at the current change in error and use that to predict what the next error term will be. We can do that just by looking at the difference between the previous and current error and assuming that the same change will happen again (this is kinda like approximating the derivative).</p>\n<p>If we see that we are going to overshoot, we can add yet one more scaling factor to resist the overshoot. We can call this factor the “derivative” factor (or <code>D</code>). We use the time between the current measurement and the previous measurement as <code>dt</code>.</p>\n<pre class=\"language-sh\"><code class=\"language-sh\">future_error = (current_error - prev_error)/dt\nadjustment = P*current_error\n         + I*historical_error\n         + D*future_error\n</code></pre>\n<h2 id=\"using-pids\">Using PIDs<a href=\"https://azeemba.com/posts/pids-creating-stable-control-in-games.html#using-pids\">#</a><a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#using-pids\"></a></h2>\n<p>At this point, we have fully derived PID controllers. PID controllers combine historical behavior, current error, and future prediction to adjust the controls of a system. PIDs help you figure out adjustments needed to push a system to a desired state.</p>\n<p>To use it though, we still have to decide how to actually use the adjustment value and have to pick the values for <code>P</code>, <code>I</code>, and <code>D</code>.</p>\n<p>Since the adjustment value will naturally be negative when the error is in one direction and positive in the other, it is useful to treat adjustment as a number that can be both. To simplify the handling of the adjustment, we can restrict the number to be between -1 and 1. Any scaling that needs to be done can be done by us.</p>\n<p>So we can use the adjustment this way:</p>\n<pre class=\"language-sh\"><code class=\"language-sh\">// normalized will be between 0 and 1\nnormalized = 0.5 + 0.5*adjustment\nnew_speed = max_speed*normalized\n</code></pre>\n<p>Since normalized will be between 0 and 1, <code>new_speed</code> will always be between 0 and <code>max_speed</code>.</p>\n<p>Now we are in a place where we can start testing to pick the correct values for our factors. For my use case, I found that the derivative term was very noisy. In real physical systems, the derivatives are smoother but here I was working with artificial animation that is not as smooth. So to keep the derivative term in check, I set <code>D</code> to be very small - on the order of <code>1/1,000</code>. So the <code>D</code> term would only come into play when there is severe overshoot.</p>\n<p>I didn’t want any adjustment to be very sudden so I set <code>P</code> to be around <code>1/20</code> to <code>1/10</code>. This basically meant that the proportional reaction was limited to 5% to 10%. To make sure that we did reach our target though, I set the <code>I</code> term to be around the same range of <code>1/10</code>. This meant that the animation made small adjustments and became more aggressive if the error accumulated.</p>\n<p><a href=\"https://azeemba.com/posts/pids-creating-stable-control-in-games/PID-All3.png\">PID-All3</a></p>\n<p>Final behavior of the tuned PID controller. The smaller P and I values reduce the overshoot a lot. We get to an error of less than a foot by the middle of the run and the error continues to get smaller after that.</p>\n<p>In the end, I was able to get the animation to have the same accuracy as the frequency of my adjustments. I decided to make adjustments every 100ms–I didn’t want to make adjustments any more frequently to avoid jarring changes in the animation.</p>\n<h2 id=\"pids\">PIDs<a href=\"https://azeemba.com/posts/pids-creating-stable-control-in-games.html#pids\">#</a><a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#pids\"></a></h2>\n<p>PIDs are very commonly used in systems that need to adapt. This can be cruise control in cars that need to adjust power when going uphill, robots that need to react to a push, or industrial systems that need to adapt to the changing behavior of different subsystems.</p>\n<p>Despite its apparent simplicity, PIDs weren’t <a href=\"https://en.wikipedia.org/wiki/Proportional%E2%80%93integral%E2%80%93derivative_controller#Origins\">formulated</a> in this form till the early 1900s. They were designed to capture the intuition of sailors steering a ship–the sailors would steer accounting for the current error but would also account for past and future errors to make adjustments. I love how well PIDs capture that intuition.</p>\n<p>When I faced my original problem, I vaguely knew that I wanted to make adjustments to the speed based on the current error but I could quickly come up with more and more edge cases that I would have to handle individually. This would have been a very brittle approach. PIDs allowed me to implement a much more flexible solution that is also simpler than what I would have done.</p>\n<p>No wonder they are used so frequently.</p>\n<h2 id=\"other-resources\">Other Resources<a href=\"https://azeemba.com/posts/pids-creating-stable-control-in-games.html#other-resources\">#</a><a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#other-resources\"></a></h2>\n<ul>\n<li><a href=\"https://vazgriz.com/621/pid-controllers/\">Vazgriz - PID Controllers in Unity3D</a> is a beautiful blog post with visualizations of PIDs in action.</li>\n<li><a href=\"https://en.wikipedia.org/wiki/Proportional%E2%80%93integral%E2%80%93derivative_controller\">Wikipedia</a> highlights the more general use cases in industrial systems.</li>\n</ul>","noteIndex":{"id":"Iy0MoL0KnL55Br3AfTS2C","title":"Luke","desc":"","updated":1761796791487,"created":1644449449778,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":"vault"},"contentHash":"4e745570ca97988a0362cb939b760952","links":[{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"life-tips","position":{"start":{"line":41,"column":5,"offset":2603},"end":{"line":41,"column":29,"offset":2627},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"life-tips","anchorHeader":"wodenokoto"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"journal.what-i-read-in.2025","alias":"What I read in 2025","position":{"start":{"line":70,"column":3,"offset":4333},"end":{"line":70,"column":54,"offset":4384},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"journal.what-i-read-in.2025"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"journal.what-i-read-in.2024","alias":"2024","position":{"start":{"line":71,"column":5,"offset":4389},"end":{"line":71,"column":41,"offset":4425},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"journal.what-i-read-in.2024"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"journal.what-i-read-in.2023","alias":"2023","position":{"start":{"line":72,"column":5,"offset":4430},"end":{"line":72,"column":41,"offset":4466},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"journal.what-i-read-in.2023"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"journal.what-i-read-in.2022","alias":"2022","position":{"start":{"line":73,"column":5,"offset":4471},"end":{"line":73,"column":41,"offset":4507},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"journal.what-i-read-in.2022"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"journal.what-i-struggled-brag-in","position":{"start":{"line":79,"column":3,"offset":4643},"end":{"line":79,"column":39,"offset":4679},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"journal.what-i-struggled-brag-in"}}],"anchors":{"what-i-read-in-past":{"type":"header","text":"What I read in past","value":"what-i-read-in-past","line":74,"column":0,"depth":2}},"children":["zd4mq442jike0pr0wba1u3m","6hzeqsofq67gdk88flxlkhp","778ijii93yu5uwnrwmn5zi4","g1fngdjl25nes6fs3lip602","ZbdkdApFqLdks4Moq92R9","uoc5hhki3o4py15cesddu8q","9qf7j06jtdkm6rnx9ymvwb0","5zn10cvj7ajy2gh2is5nqmg","4qo9ma0z0yu1czns6pxl7y5","ok0e729ho7o09xetujkxc0m","GR5x8HnNFEN6fU2UBSEIK","yirtnlj8q24yutcf3ss1xqy","eq0wc6t7wl2wv221yb68ro4","7x2fnv4j6gxts08qk0jguny","ettkt3iClONnxpbGwBVLl","7l4knev6v613tbuoskvmbdg","hvh5bud6yp7dc89tuh95tr9","4fvoqrplw0cweo554usbjos","f8qsfql0a9v8thpeo82udfa","1swsbrhqi9jk41v9eodyi5q","SQqYupi6EFddTerBA8RRD","hjNeNc1F2JUh0lTWanH4h","qf0l4wbrc9jgooyzexmbq5v","uur1lkol353z9vfeqb3n5bv","cd9n1czq3ursgkby985wkmm","k1sr43vwnfqztwc0s43pkcf","wfde75rhdvq2yfa2zy2q6rv","rjcmdv60jokmbw6zoq8u2ef","ujapvww8o6v3kpmlhtryq4k","pkwewou9d5e8ystswn1j2b4"],"parent":null,"data":{},"body":"\nHi there 👋. I'm a Front-end developer.\n\n---\n\n- 단순함과 꾸준함은 가장 쉬우면서도 지키기 어려운 원칙.\n\n- 🥱 -> 🤔💡🌱 - [On The Death of Daydreaming](https://www.afterbabel.com/p/on-the-death-of-daydreaming)\n  - boredom -> easy fun -> art -> profit?\n\n> I've often described my motivation for building software to others using imagery: I like to go find a secluded beach, build a large, magnificent sand castle, and then walk away. Will anyone notice? Probably not. Will the waves eventually destroy it? Yep. Did I still get immense satisfaction? Absolutely. - [aliasxneo](https://news.ycombinator.com/item?id=41497113)\n\n> We love to see the process, not just the result. The imperfections in your work can be beautiful if they show your struggle for perfection, not a lack of care. - [ralphammer](https://ralphammer.com/is-perfection-boring/)\n\n> Simplicity, even if it sacrifices some ideal functionality has better survival characteristics than the-right-thing. - [The Rise of Worse is Better](https://www.dreamsongs.com/RiseOfWorseIsBetter.html)\n\n> [Roberto Blake was talking about making 100 crappy videos](https://www.youtube.com/watch?v=OnUBaQ1Sp_E) to get better over time. Putting in the reps and improving a little bit each time.\n>\n> Putting in the work without expecting any external reward at first (eg views, followers, likes, etc) will pay off in the long run. - [100 Scrappy Things](https://www.florin-pop.com/blog/100-scrappy-things/)\n\n> Make the difficult habitual, the habitual easy, and the easy beautiful. - [Constantin S. Stanislavski](https://www.goodreads.com/quotes/7102271-make-the-difficult-habitual-the-habitual-easy-and-the-easy)\n\n> A good match is a **structured** dance, where players aim to **score** while they are following well-defined **rules**. This **freedom within a structure** is what makes it fun. - [ralphammer](https://ralphammer.com/how-to-get-started/)\n\n- [Pivot Points](https://longform.asmartbear.com/pivot-points/)\n\n  - non-judgmental aspects of personality that can be strengths in some contexts and weaknesses in others\n  - Pivot Points are fixed in the short term\n\n- [Hedged Bets](https://longform.asmartbear.com/predict-the-future/#hedged-bets)\n  - trading slightly less maximum upside for predictable, net-positive outcomes.\n\n> “Motivation often comes after starting, not before. Action produces momentum.”\n> [When you start a new habit, it should take less than two minutes to do.](https://jamesclear.com/how-to-stop-procrastinating)\n>\n> - James Clear\n\n> Focus is more about **not** keeping busy when you need to wait for something.  \n> Eat the boredom for a minute.\n>\n> - [[life-tips#wodenokoto]]\n\n> [4 minutes run hard enough to push heart rate to 90%, 3 minutes recover, repeat 4 times](https://news.ycombinator.com/item?id=34213181)\n>\n> - https://www.ntnu.edu/cerg/advice\n> - [Get running with Couch to 5K](https://www.nhs.uk/live-well/exercise/running-and-aerobic-exercises/get-running-with-couch-to-5k/)\n\n> [recommended routine - bodyweightfitness](https://www.reddit.com/r/bodyweightfitness/wiki/kb/recommended_routine/) - I Don't Have This Much Time!\n>\n> - Don't workout at all (saves anywhere from 20 to 60 minutes, but really, really, really, really, really, really, really, really, really not recommended)\n\n> 도무지 읽히지 않는 책 앞에서 내가 택한 방법은 펼쳐진 페이지 앞에서 멍때리기이다. 다르게 표현하면 이렇다. 펼쳐진 두 페이지 앞에서 오래 머물기.\n>\n> 책을 펼쳐놓는 것으로 충분하다. 읽지 못해도 좋다. 매일 정해진 진도를 나가야 하는 학교 수업이 아니니까. 하지만 읽지 않아도 괜찮다고 해서 펼쳐두지조차 않으면 곤란하다. 가능한 한 자주 책을 펼쳐두도록 하자. 전혀 읽지 않고 멍하니 바라보고 있다가 다시 덮게 되더라도\n>\n> - 막막한 독서. 시로군. P.10~13\n\n> I think it should be everyone's primary focus to sleep well, drink water, get outside, get active, and eat generally decently. I hate to say it, but if you're not eating a good amount of vegetables and fruit, decent protein, sleep, etc, no amount of XYZ will catch up to that detriment. - [CE02](https://news.ycombinator.com/item?id=35056071)\n\n> My real battle is doing good versus doing nothing. - [Deirdre Sullivan](https://www.npr.org/2005/08/08/4785079/always-go-to-the-funeral)\n\n[Kind Engineering](https://kind.engineering/) - How To Engineer Kindness\n\n> Sometimes magic is just someone spending more time on something than anyone else might reasonably expect. - [Teller](https://www.goodreads.com/quotes/6641527-sometimes-magic-is-just-someone-spending-more-time-on-something)\n\n---\n\n## What I read in past\n\n- [[What I read in 2025|journal.what-i-read-in.2025]]\n  - [[2024|journal.what-i-read-in.2024]]\n  - [[2023|journal.what-i-read-in.2023]]\n  - [[2022|journal.what-i-read-in.2022]]\n- 📝 [Gists](https://gist.github.com/Luke-SNAW)\n- 📜 [Journals](https://luke-snaw.github.io/Luke-SNAW__netlify-CMS.github.io/)\n\n---\n\n- [[journal.what-i-struggled-brag-in]]\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":true,"vaultSelectionModeOnCreate":"smart","leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2}},"randomNote":{},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":"vault"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link","taskCompleteStatus":["done","x"]},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"enableUserTags":false,"enableHashTags":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"enableEditorDecorations":true,"maxPreviewsCached":10,"maxNoteLength":204800,"dendronVersion":"0.115.0","enableFullHierarchyNoteTitle":false,"enablePersistentHistory":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false,"enableFrontmatterTags":true,"enableHashesForFMTags":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Luke SNAW","description":"Personal knowledge space"},"github":{"enableEditLink":false,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"searchMode":"lookup","siteUrl":"https://luke-snaw.github.io/","duplicateNoteBehavior":{"action":"useVault","payload":["vault"]},"siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true}