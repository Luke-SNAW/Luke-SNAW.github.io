<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" href="/favicon.ico"/><title>How to avoid layout shifts caused by web fonts</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Personal knowledge space"/><meta property="og:title" content="How to avoid layout shifts caused by web fonts"/><meta property="og:description" content="Personal knowledge space"/><meta property="og:url" content="https://luke-snaw.github.io//notes/jlvky3aqhg65gfidokmjqkj/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="6/7/2023"/><meta property="article:modified_time" content="6/7/2023"/><link rel="canonical" href="https://luke-snaw.github.io//notes/jlvky3aqhg65gfidokmjqkj/"/><meta name="next-head-count" content="14"/><link rel="preload" href="/_next/static/css/8e7b7e4bce421c0a.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8e7b7e4bce421c0a.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-3d209faeb64f2f97.js" defer=""></script><script src="/_next/static/chunks/framework-28c999baf2863c3d.js" defer=""></script><script src="/_next/static/chunks/main-104451f3d1a5c4bc.js" defer=""></script><script src="/_next/static/chunks/pages/_app-9d8e0603730b15a3.js" defer=""></script><script src="/_next/static/chunks/935-4dee79e80b8641c6.js" defer=""></script><script src="/_next/static/chunks/6-50972def09142ee2.js" defer=""></script><script src="/_next/static/chunks/pages/notes/%5Bid%5D-78d472fa3b924116.js" defer=""></script><script src="/_next/static/vOE8u-mg___OsOsz4tjEg/_buildManifest.js" defer=""></script><script src="/_next/static/vOE8u-mg___OsOsz4tjEg/_ssgManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div style="display:flex" class="ant-col ant-col-xs-20 ant-col-sm-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"><div class="ant-select ant-select-lg ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-show-search" style="width:100%"><div class="ant-select-selector"><span class="ant-select-selection-search"><input type="search" autoComplete="off" class="ant-select-selection-search-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span><span class="ant-select-selection-placeholder">For full text search please use the &#x27;?&#x27; prefix. e.g. ? Onboarding</span></div></div></div><div style="display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout" style="margin-top:64px;display:flex;flex-direction:row"><div class="site-layout-sidebar" style="flex:0 0 auto;width:calc(max((100% - 992px) / 2, 0px) + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);background-color:transparent;flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></div><main class="ant-layout-content side-layout-main" style="max-width:1200px;min-width:0;display:block"><div style="padding:0 24px"><div class="main-content" role="main"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h1 id="how-to-avoid-layout-shifts-caused-by-web-fonts">How to avoid layout shifts caused by web fonts<a aria-hidden="true" class="anchor-heading icon-link" href="#how-to-avoid-layout-shifts-caused-by-web-fonts"></a></h1>
<blockquote>
<p><a href="https://simonhearne.com/2021/layout-shifts-webfonts/">https://simonhearne.com/2021/layout-shifts-webfonts/</a></p>
</blockquote>
<p>One of the outcomes of the release of <a href="https://simonhearne.com/2020/core-web-vitals/">Core Web Vitals</a> (and subsequent <a href="https://developers.google.com/search/blog/2020/11/timing-for-page-experience">inclusion</a> in Google's page ranking algorithm) is that we have been paying more attention to unexpected layout shifts and the cumulative layout shift (CLS) score.</p>
<p>Some sources of layout shifts have been simple to resolve: pre-allocate the correct space for dynamic elements, use width and height attributes on images and prioritise visible elements in your HTML document. One common cause of layout shift is surprisingly difficult to resolve though: flashes of unstyled text (FOUT).</p>
<p>In this post we will explore the surprisingly complex world of text rendering on the web and some techniques to remove FOUT while not incurring a CLS penalty.</p>
<p>In summary we need to prevent the layout shift by letting the browser render in a fallback system font if it doesn't get the web font in time, then optimise our fonts to try to get them to the browser before it needs them:</p>
<ul>
<li>use <code>font-display: optional</code> to prevent layout shifts</li>
<li>subset fonts and serve as <code>woff2</code></li>
<li>use variable fonts or a limited set of weight variations</li>
<li>preload critical fonts</li>
<li>host your own fonts on your main domain</li>
</ul>
<h2 id="why-fonts-cause-layout-shifts-">Why fonts cause layout shifts <a href="https://simonhearne.com/2021/layout-shifts-webfonts/#why-fonts-cause-layout-shifts">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#why-fonts-cause-layout-shifts-"></a></h2>
<p>Unexpected layout shifts (page content moving around without user interaction) are bad for user experience. Fonts cause layout shifts when the size of the containing element (e.g. a <code>&#x3C;div></code> or paragraph) changes when the web font is downloaded. This occurs when the height of the font or the length of the paragraph is different with the web font compared to the system font. When laying out a page, browsers will use the dimensions and properties of the fallback font to determine the size of the containing elements, even if you have declared a web font to block the system font with <code>font-display: block</code>!</p>
<p><a title="Private" href="https://wiki.dendron.so/notes/hfyvYGJZQiUwQaaxQO27q.html" target="_blank" class="private">#demo-text-1 (Private)</a> { overflow: hidden; width: 80%; max-width: 500px; font-size: smaller; border: 1px solid grey; } .no-font { font-family: serif !important; border-color: red !important; } .fout-fig { height: 220px; position:relative; } @media only screen and (max-width: 600px) { .fout-fig { height: 350px; } }</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin aliquam metus eu lacus placerat feugiat. Suspendisse quis elit fringilla, luctus felis ut, ultricies leo. Morbi vel dui non risus aliquam rhoncus in ac justo. Mauris cursus diam id ipsum aliquet tempus. Praesent feugiat consequat risus, ut eleifend neque consequat quis. Maecenas rhoncus faucibus dui quis pretium. Nam ultrices rhoncus dui, at pretium erat rhoncus et. Vestibulum tempus diam vel ex venenatis placerat. Nam sed elementum odio. Suspendisse vel orci turpis. Fusce in maximus ante, non malesuada justo. Duis in tellus erat.</p>
<p>Flash of Unstyled Text</p>
<p>window.setInterval(() => { document.getElementById('demo-text-1').classList.toggle("no-font"); },2000);</p>
<h3 id="detecting-layout-shifts-">Detecting layout shifts <a href="https://simonhearne.com/2021/layout-shifts-webfonts/#detecting-layout-shifts">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#detecting-layout-shifts-"></a></h3>
<p>There are a number of methods to detect layout shifts due to web fonts, the most simple is to run your page through <a href="https://webpagetest.org/">WebPageTest</a> and use the filmstrip view. There is a toggle to show layout shifts, combine that with 'huge' screenshot images and a 0.1s interval to get a clear view of what is happening as your page renders (you can simply add this to the end of the URL: <code>&#x26;highlightCLS=1&#x26;thumbSize=600&#x26;ival=100&#x26;end=visual&#x26;text=000&#x26;bg=fff"</code>). The Washington Post has a couple of layout shifts due to web fonts, in the example below the headline text is one line shorter with the web font than without which results in a layout shift. Layout shifts are dependent on viewport size so make sure you test a few different devices.</p>
<p><a href="https://simonhearne.com/images/layout-shifts-webfonts/wapo-headline.png">wapo headline</a></p>
<p>Headline web font loading causes a layout shift. <a href="https://webpagetest.org/video/compare.php?tests=210120_Di3C_126898f84daca6ada62ee7736a29bddb-r%3A1-c%3A0&#x26;highlightCLS=1&#x26;thumbSize=600&#x26;ival=100&#x26;end=visual&#x26;text=000&#x26;bg=fff">View test on WPT</a></p>
<p>You can also find layout shifts in the Chrome Developer Tools Performance tab, look for layout shifts attributed to text elements.</p>
<p><a href="https://simonhearne.com/images/layout-shifts-webfonts/wapo-shift.jpg">wapo-shift</a></p>
<p>Chrome developer tools shows attribution of layout shifts</p>
<p>I've covered general layout shifts in more detail in a post on <a href="https://simonhearne.com/2020/core-web-vitals/">How to Improve Core Web Vitals</a>.</p>
<h2 id="prevent-layout-shifts-with-font-display-">Prevent layout shifts with font-display <a href="https://simonhearne.com/2021/layout-shifts-webfonts/#prevent-layout-shifts-with-font-display">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#prevent-layout-shifts-with-font-display-"></a></h2>
<p>The dirty little secret of this blog post is that you can resolve layout shifts due to fonts with a single line of CSS:</p>
<p><code>font-display: optional</code></p>
<p>This directive lives in your font-face declaration and tells the browser to use a fallback system font if the web font is not available at the time of rendering text (plus 100ms). This means that on uncached page loads there is a chance that the fallback font will be used, but all subsequent page loads should be rendered with the web font, as it will be downloaded and available in cache. There are other options, shown in the image below:</p>
<ul>
<li><strong>block</strong> - hide text for up to three seconds while waiting for the web font, and always swap in the web font when it loads</li>
<li><strong>swap</strong> - show text as soon as possible, and always swap in the web font when it loads</li>
<li><strong>fallback</strong> - hide text for up to 100ms, then only swap in the web font if it loads within three seconds</li>
<li><strong>optional</strong> - hide text for up to 100ms, then only use the web font if it is available - never swapping</li>
</ul>
<p><img src="/assets/images/css/font-display.webp" alt="font-display"></p>
<p>Optional is the only font-display value which guarantees no layout shift. <a href="https://speakerdeck.com/notwaldorf/fontastic-web-performance?slide=74">Image</a> by <a href="https://twitter.com/notwaldorf">@notwalforf</a>. <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face/font-display">Read more on MDN</a></p>
<p>If it's that simple, why this whole blog post? Unfortunately system fonts are not necessarily the nicest designs, and they are not consistent between operating systems. Most designers will cringe at the thought of showing users a fallback system font. The rest of this blog post details various optimisations to get the font files to the browser quicker, allowing the use of any font-display option but with minimal risk of showing a system font, or for options other than <code>optional</code>: without triggering a layout shift. We will also look at font-face descriptors / f-mods and progressive font enrichment for potential further optimisations in the future.</p>
<h2 id="load-fewer-font-files-">Load fewer font files <a href="https://simonhearne.com/2021/layout-shifts-webfonts/#load-fewer-font-files">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#load-fewer-font-files-"></a></h2>
<p>Downloading one or two font files to render text won't have a massive impact on speed, downloading five or ten font files will! Ensuring that you deliver the minimium viable number of font files is the best way to ensure that the browser has them available at layout, thus reducing the likelihood of FOUT layout shifts. Let's look at some tricks to load fewer font files while maintaining your design.</p>
<h3 id="use-faux-bold-and-italic-">Use faux bold and italic <a href="https://simonhearne.com/2021/layout-shifts-webfonts/#use-faux-bold-and-italic">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#use-faux-bold-and-italic-"></a></h3>
<blockquote>
<p>Designers hate this one weird trick!</p>
</blockquote>
<p>Font stacks generally include a bunch of different files, from extra-light italic through to extra-bold. Combining nine font weights with normal and italic variants produces 18 separate font files! Fonts that are not used on the page will not be downloaded, but for the odd occasion where only a single word is both bold and italic (for example) the whole font file will be downloaded to render the single word.</p>
<p>Browsers can make bold and italic versions of fonts themselves, this is called faux bold and faux italic. This could mean that a single regular weight font file is all you need! This should be tested and approved by any designers involved, I recommend a blind <a href="https://juiceboxinteractive.com/blog/how-pepsi-won-the-battle-but-lost-the-challenge/">Coke vs. Pepsi</a> style test to prevent any bias impacting the outcome.</p>
<p><a href="https://simonhearne.com/images/layout-shifts-webfonts/faux-bold.png">image showing faux bold of roboto font compared to real bold, there is little difference</a></p>
<p>Example of differences between faux and real bold. <a href="https://graphicdesign.stackexchange.com/questions/75965/distinguishing-real-and-faux-bold-and-italics">source</a></p>
<p>There may be subtle differences between the browser's version of a bold font and the font creator's version, as shown above. For some fonts the differences will be too great to consider, especially fancy ones! You can check yours by simply removing the @font-face declarations for all but the regular font version and comparing screenshots of rendered text.</p>
<h3 id="use-a-variable-font-">Use a variable font <a href="https://simonhearne.com/2021/layout-shifts-webfonts/#use-a-variable-font">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#use-a-variable-font-"></a></h3>
<p>All modern browsers support variable fonts (notable exceptions are <a href="https://caniuse.com/variable-fonts">IE11 and Opera Mini</a>), this allows a single font file to include multiple variable axes like font weight and slant. This results in a larger file than a single weight font, but it replaces multiple weight files and provides more flexibility for the variable axes (e.g. font-weight: 457).</p>
<p>Variable fonts can be found in multiple places, for example Google Fonts <a href="https://fonts.google.com/?vfonly=true">has a filter</a> to only show variable fonts. The majority of variable fonts have a single variable axis for weight, but there are a number of possible dimensions including slant, serif and optical size. <a href="https://fonts.google.com/specimen/Exo?vfonly=true">Exo</a> for example has both weight and a binary italic dimension. <a href="https://www.axis-praxis.org/specimens/__DEFAULT__">Axis Praxis</a> is a great place to explore the possibilities of variable fonts.</p>
<h3 id="death-to-icon-fonts-">Death to icon fonts <a href="https://simonhearne.com/2021/layout-shifts-webfonts/#death-to-icon-fonts">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#death-to-icon-fonts-"></a></h3>
<p>Icon font sets like <a href="https://fontawesome.com/">Font Awesome</a> and Bootsrap's <a href="https://getbootstrap.com/docs/3.3/components/">glyphicons</a> have popularised the use of web fonts for iconography. Unfortunately this means that your icons will not render until a (typically) large font file has downloaded, and sometimes results in an unsightly ⃞ symbol instead of your icons when the font file fails to download in time.</p>
<p>Icon fonts are bad practice for performance and accessibility, <a href="https://www.wouterbulten.nl/blog/tech/blog-optimization-replacing-font-awesome-with-svg/">replace them with SVG</a> as soon as possible.</p>
<p>N.B. this section is named after the great talk given by <a href="https://twitter.com/ninjanails">Seren Davies</a>: <a href="https://www.youtube.com/watch?v=9xXBYcWgCHA">Death to Iconfonts ☠️</a></p>
<h3 id="use-system-fonts-">Use system fonts <a href="https://simonhearne.com/2021/layout-shifts-webfonts/#use-system-fonts">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#use-system-fonts-"></a></h3>
<p>Web fonts are popular because they allow designers to maintain a consistent look and feel across browsers. Where this isn't necessary, system fonts will be the fastest method to render text. If your current web font is close to a system font, you can use <a href="https://meowni.ca/font-style-matcher/">Font Style Matcher</a> by <a href="https://twitter.com/notwaldorf">Monica</a> to tweak the font settings until you get a near-perfect match. I've worked with a client who surreptitiously replaced their web font stack with a tweaked system font for two weeks - neither designers nor customers apparently noticed the difference!</p>
<p>Using a system font means that text will render at the earliest possible time. We also now have methods to make the font match the operating system, which may be more attractive than previous fallback options like Arial and Helvetica. To do this you'll need to list the system fonts for all operating systems in a specific order:</p>
<pre class="language-css"><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">{</span>
  <span class="token property">font-family</span><span class="token punctuation">:</span> -apple-system<span class="token punctuation">,</span> BlinkMacSystemFont<span class="token punctuation">,</span> <span class="token string">"Segoe UI"</span><span class="token punctuation">,</span> <span class="token string">"Roboto"</span><span class="token punctuation">,</span>
    <span class="token string">"Oxygen"</span><span class="token punctuation">,</span> <span class="token string">"Ubuntu"</span><span class="token punctuation">,</span> <span class="token string">"Cantarell"</span><span class="token punctuation">,</span> <span class="token string">"Fira Sans"</span><span class="token punctuation">,</span> <span class="token string">"Droid Sans"</span><span class="token punctuation">,</span>
    <span class="token string">"Helvetica Neue"</span><span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>You can read more about this approach in a Smashing Magazine <a href="https://www.smashingmagazine.com/2015/11/using-system-ui-fonts-practical-guide/">article from 2015</a>. One drawback to this approach is that it cannot co-exist with the <a href="https://simonhearne.com/2021/layout-shifts-webfonts/#reduce-layout-shift-with-f-mods">f-mods</a> approach we describe below, this is to be used <em>instead</em> of web fonts. <a href="https://simonhearne.com/2021/layout-shifts-webfonts/#conversation">Let me know</a> if I'm wrong in this assumption!</p>
<h2 id="optimise-font-files-">Optimise font files <a href="https://simonhearne.com/2021/layout-shifts-webfonts/#optimise-font-files">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#optimise-font-files-"></a></h2>
<p>If we must download a font file, we should make it as small as possible to ensure it downloads quickly. There are two key methods to optimise web fonts: subsetting and formats.</p>
<h3 id="subset-fonts-">Subset fonts <a href="https://simonhearne.com/2021/layout-shifts-webfonts/#subset-fonts">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#subset-fonts-"></a></h3>
<p>Many fonts will have glyphs (glyphs are individual characters like <code>a</code> or <code>&#x26;</code>) from multiple alphabets. If your website is only delivered in the latin alphabet (a - Z) and does not use ligatures (like <code>é</code>) then these glyphs represent wasted bytes in your font file. Roboto, the most popular Google font, has 277 glyphs.</p>
<p><a href="https://simonhearne.com/images/layout-shifts-webfonts/roboto-glyphs.png">image of all glyphs in the roboto font from google, showing many non-latin characters</a></p>
<p>Glyphs in the popular Roboto font. <a href="https://fonts.google.com/specimen/Roboto?selection.family=Roboto&#x26;sidebar.open=true#glyphs">source</a></p>
<p>Removing non-latin characters from this font results in a <code>woff2</code> file that is one sixth the size!</p>
<p><a href="/img/dbjqRi3ibh-600.jpeg">screenshot of file system showing subset roboto font is 11KB, original is 66KB</a>(<a href="https://simonhearne.com/images/layout-shifts-webfonts/subset-roboto.png">https://simonhearne.com/images/layout-shifts-webfonts/subset-roboto.png</a>)</p>
<p>Subset font is 5x smaller</p>
<p>If you use Google fonts, you can <a href="https://developers.google.com/fonts/docs/getting_started#specifying_script_subsets">specify which subsets</a> you require in the CSS request. If you host your own fonts (which I would always recommend, where possible) you will need to check with the font provider if they have subset versions, or where your license permits you can create subsets yourself.</p>
<p>To create subsets you will ideally start with the <code>ttf</code> file and work out what glyphs you need to keep. Filament Group have created <a href="https://github.com/filamentgroup/glyphhanger">glyphhanger</a> to take out the hard work here, read their <a href="https://www.filamentgroup.com/lab/glyphhanger/">blog post</a> to see how easy it is to create a unique subset font just for your pages. Note that missing glyphs will be rendered in the fallback system font, so they won't just disappear!</p>
<p>It is possible to create multiple subset variations of your fonts if your website supports multiple languages. In this case, use the <code>unicode-range</code> declaration in your @font-face rule to let the browser know which characters are in which font file. Read more about this on <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face/unicode-range">MDN</a> or take a look at <a href="https://fonts.googleapis.com/css2?family=Open+Sans&#x26;display=swap">a response</a> from Google Fonts for inspiration.</p>
<h3 id="use-modern-formats-">Use modern formats <a href="https://simonhearne.com/2021/layout-shifts-webfonts/#use-modern-formats">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#use-modern-formats-"></a></h3>
<p>There are a set of different formats available to serve web fonts: <code>ttf</code>, <code>otf</code>, <code>eot</code>, <code>woff</code> and <code>woff2</code>. <code>ttf</code> and <code>otf</code> are the 'raw' font files, and probably shouldn't be sent to a browser. <code>eot</code> supports subsetting and is compressed using LZ compression, whereas <code>woff</code> uses gzip compression and <code>woff2</code> uses brotli compression.</p>
<p>Font stacks will often have many or all of these formats available, but you really only need <code>woff2</code>. The newer format is around 30% smaller than <code>woff</code> and is supported in all modern browsers. Supporting only <code>woff2</code> will make it more simple to apply some of the other optimisations recommended, such as subsetting.</p>
<p><a href="/img/zWJICqkLpV-600.jpeg">can i use dot com shows all browsers except opera and IE11 support woff2</a>(<a href="https://simonhearne.com/images/layout-shifts-webfonts/woff2-support.png">https://simonhearne.com/images/layout-shifts-webfonts/woff2-support.png</a>)</p>
<p><code>woff2</code> is supported on all the browsers you care about. <a href="https://caniuse.com/woff2">source</a></p>
<h2 id="deliver-your-fonts-fast-">Deliver your fonts fast <a href="https://simonhearne.com/2021/layout-shifts-webfonts/#deliver-your-fonts-fast">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#deliver-your-fonts-fast-"></a></h2>
<p>It may seem obvious, but we must make sure that the browser can download our font files as soon as possible! There are a few techniques we should follow to ensure this is always the case. Hosting fonts on your own domain (and ideally on a content delivery network (CDN)) will result in the best performance.</p>
<h3 id="host-your-own-fonts-">Host your own fonts <a href="https://simonhearne.com/2021/layout-shifts-webfonts/#host-your-own-fonts">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#host-your-own-fonts-"></a></h3>
<p>Font foundries such as Google Fonts are popular: the HTTP Archive shows that <a href="https://almanac.httparchive.org/en/2020/fonts#where-are-web-fonts-being-used">80% of sites</a> use web fonts, and <a href="https://almanac.httparchive.org/en/2020/third-parties#third-party-domains">7.5%</a> of all web fonts are served by Google. Using a third-party service can incur a performance penalty, though. The Google Fonts embed process uses either a CSS link or @import, with the CSS file returning a dynamic set of @font-face rules. The rules are distinct for the given font, user agent and any additional query parameters (like subsetting and font-display options).</p>
<p>Using a third-party service means that your fonts will be delayed. The best-case scenario is that you are requesting the font file directly from another hostname (e.g. <a href="http://fonts.gstatic.com/">fonts.gstatic.com</a>) which incurs a connection cost - DNS lookup, TCP connection and TLS negotiation. The worst case is multiple hops, like loading a CSS file from <a href="http://fonts.googleapis.com/">fonts.googleapis.com</a> which references files on <a href="http://fonts.gstatic.com/">fonts.gstatic.com</a>, incurring two connection penalties. This cost may be outweighed by the benefit in some cases for Google Fonts though, as the fonts they deliver are well optimised and subset by alphabet automatically.</p>
<p>In general you should serve the fonts from your domain to avoid the cost of connecting to third-party domains, this will be especially important on high latency connections.</p>
<h3 id="cache-your-fonts-">Cache your fonts <a href="https://simonhearne.com/2021/layout-shifts-webfonts/#cache-your-fonts">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#cache-your-fonts-"></a></h3>
<p>Fonts can be cached in two places: the client and the CDN. Caching on the client is important for mid-session navigations and should be done in such a way as to avoid revalidation requests. Revalidation requests (<code>if-not-modified</code> and <code>if-modified-since</code>) will block the browser from using the font file until it has verified that it has not changed on the server. Fonts rarely change, so we should implement a cache header as follows and update the filename if the font changes to break the cache:</p>
<p><code>cache-control: max-age=31536000,immutable</code></p>
<p>This tells browsers that they can keep the font for up to a year and that it does not need to be revalidated (<code>immutable</code> <a href="https://caniuse.com/mdn-http_headers_cache-control_immutable">is supported</a> in Firefox and Safari, Chrome should avoid revalidation requests automatically). Avoid adding ETags to these responses as they may force revalidation.</p>
<p>Check also that your Content Delivery Network configuration can store the font files in cache, older configurations may not include the <code>.woff2</code> extension resulting in origin hits and slowing down the response.</p>
<h3 id="use-preload-hints-">Use preload hints <a href="https://simonhearne.com/2021/layout-shifts-webfonts/#use-preload-hints">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#use-preload-hints-"></a></h3>
<p>Web browsers do not download fonts unnecessarily, they wait until the render tree has been constructed in order to know which fonts are required. This means that web fonts are only requested when the browser has downloaded and parsed the HTML and CSS, right before text is rendered. Note that inline CSS does not require a network request - meaning your fonts could be fetched earlier in the page load.</p>
<p><a href="https://simonhearne.com/images/layout-shifts-webfonts/font-crp.png">flow diagram shows that web font loading is blocked by render tree construction</a></p>
<p>Render tree construction delays web font request. <a href="https://web.dev/optimize-webfont-loading/">source</a></p>
<p>If we know that a web font is definitely going to be required to render text on a page, we can make a promise to the browser that it needs to be downloaded as soon as possible. This is a preload hint:</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>link</span>
  <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preload<span class="token punctuation">"</span></span>
  <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/my-font.woff2<span class="token punctuation">"</span></span>
  <span class="token attr-name">crossorigin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>anonymous<span class="token punctuation">"</span></span>
  <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>font<span class="token punctuation">"</span></span>
  <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>font/woff2<span class="token punctuation">"</span></span>
<span class="token punctuation">/></span></span>
</code></pre>
<p>When the browser parses this line of HTML it will immediately dispatch a high priority request for the font file. Doing this means that the web font is much more likely to be available when the browser renders text.</p>
<blockquote>
<p>preloaded requests will cannibalise bandwidth from other early requests, use with caution!</p>
</blockquote>
<p>Preloaded requests are high-priority. In the waterfall section below you can see that five font files are downloaded, one blocks the page CSS (possibly because the <code>&#x3C;link rel="preload"></code> was above the <code>&#x3C;link rel="stylesheet"></code>) and the others block the main JavaScript bundle for the page. Note that this page was served over HTTP/2 on Chrome, other browsers and protocols will vary!</p>
<p><a href="https://simonhearne.com/images/layout-shifts-webfonts/preload-slow-script.png">waterfall section showing fonts blocking main javascript bundle download</a></p>
<p>Preloaded fonts delay main JS bundle.</p>
<p>Ensure that your preload tags are below critical content in the head and limit to two or three font files to get the best benefit.</p>
<h2 id="reduce-layout-shift-with-f-mods-">Reduce layout shift with f-mods <a href="https://simonhearne.com/2021/layout-shifts-webfonts/#reduce-layout-shift-with-f-mods">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#reduce-layout-shift-with-f-mods-"></a></h2>
<p>If <code>font-display: optional</code> is not possible for your design, we need to attempt to match the fallback font layout to the web font as closely as possible. Enter font-display modifiers (f-mods), also known as font-face descriptors.</p>
<p>F-mods are in a <a href="https://docs.google.com/document/d/1PW-5ML5hOZw7GczOargelPo6_8Zkuk2DXtgfOtJ59Eo/edit">proposed update</a> to the font-face descriptors specification which includes four new descriptors:</p>
<ul>
<li><strong>ascent-override (%)</strong> - overrides the size allocated for ascenders</li>
<li><strong>descent-override (%)</strong> - overrides the line height allocated for descenders</li>
<li><strong>line-gap-override (%)</strong> - overrides the gap between lines</li>
<li><strong>advance-override (#)</strong> - sets an extra advance for each character, to help match line width and prevent word overflows</li>
</ul>
<p>The first three all impact the height of a line: line box height = ascent + descent + line gap. Baseline position = line box top + line gap / 2 + ascent. For example, if we have <code>ascent-override: 80%; descent-override: 20%; line-gap-override: 0%</code>, then each line box has height 1em (assuming 1em used font size), and the baseline is positioned at 0.8em below the line box top. The <code>advance-override</code> descriptor adds a fraction of the font-size as a gap before each character, for example <code>font-size:16px; advance-override: 0.1;</code> will add a 1.6px gap before each character.</p>
<p>The combination of these four descriptors allow us to override the layout of the fallback font to match the web font, by telling the browser how much space the characters will take up before the web font is downloaded. Read more in the <a href="https://docs.google.com/document/d/1PW-5ML5hOZw7GczOargelPo6_8Zkuk2DXtgfOtJ59Eo/edit">proposal</a>.</p>
<h3 id="implementing-f-mods-">Implementing f-mods <a href="https://simonhearne.com/2021/layout-shifts-webfonts/#implementing-f-mods">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#implementing-f-mods-"></a></h3>
<p>The trick to implementing f-mods is to manually define your fallback system fonts with <code>src: local()</code>. This allows us to override the display of the fallback font to match the web font:</p>
<pre class="language-css"><code class="language-css"><span class="token atrule"><span class="token rule">@font-face</span></span> <span class="token punctuation">{</span>
  <span class="token property">font-family</span><span class="token punctuation">:</span> custom-font<span class="token punctuation">;</span>
  <span class="token property">src</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">"https://example.com/font.woff2"</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token atrule"><span class="token rule">@font-face</span></span> <span class="token punctuation">{</span>
  <span class="token property">font-family</span><span class="token punctuation">:</span> fallback-font<span class="token punctuation">;</span>
  <span class="token property">src</span><span class="token punctuation">:</span> <span class="token function">local</span><span class="token punctuation">(</span>Arial<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* required! */</span>
  <span class="token property">advance-override</span><span class="token punctuation">:</span> xx<span class="token punctuation">;</span>
  <span class="token property">ascent-override</span><span class="token punctuation">:</span> xx<span class="token punctuation">;</span>
  <span class="token property">descent-override</span><span class="token punctuation">:</span> xx<span class="token punctuation">;</span>
  <span class="token property">line-gap-override</span><span class="token punctuation">:</span> xx<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">body</span> <span class="token punctuation">{</span>
  <span class="token property">font-family</span><span class="token punctuation">:</span> custom-font<span class="token punctuation">,</span> fallback-font<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Calculating the required values might seem complex, but the information we need is already in your web font file. First you'll need the TTF file for your font; if you use Google Fonts then you can check find the TTF in the <a href="https://github.com/google/fonts/tree/master/ofl/">GitHub repository</a>. If you have licensed a font from a foundry then the TTF should have been supplied already.</p>
<p>Once you have the TTF head on over to <a href="https://fontdrop.info/">FontDrop</a> and upload the file. Open the <strong>Data</strong> tab and scroll to the <code>hhea - Horizontal Header Table</code>. There you should find four key values: <code>ascender</code>, <code>descender</code> , <code>line-gap</code> and <code>advanceWidthMax</code>.</p>
<p><a href="https://simonhearne.com/images/fontdrop.jpg">screenshot of font drop showing font HHEA table</a></p>
<p>HHEA table data in FontDrop</p>
<p>These values are exactly what we need to set the font-face modifiers! In this case the web font has unitsPerEm = 1000 and ascender = 1027, so it's best to set <code>ascent-override: 102.7%</code> in the fallback font face. I recommend experimenting with values until you find the right balance, using the playground below.</p>
<h3 id="f-mods-playground-">F-mods Playground <a href="https://simonhearne.com/2021/layout-shifts-webfonts/#f-mods-playground">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#f-mods-playground-"></a></h3>
<p>Use <a href="https://codepen.io/simonjhearne/pen/rNMGJyr">this codepen</a> to load your custom and fallback fonts, then play with the overrides to get a perfect match! Note that this will be specific to the operating system you are using, it may be worth validating across multiple devices.</p>
<h3 id="f-mods-limitations-">F-mods limitations <a href="https://simonhearne.com/2021/layout-shifts-webfonts/#f-mods-limitations">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#f-mods-limitations-"></a></h3>
<p>F-mods only really modify vertical spacing and positioning. This means that character- and letter-spacing still need to be dealt with otherwise you could have words breaking lines at different points, leading to a change in element heights and thus layout shifts. Unfortunately the <code>letter-spacing</code> and <code>word-spacing</code> properties are not available in the @font-face declaration so they must be declared on the body or an element. This means we may still have some work to do in order to prevent layout shift.</p>
<p>If the character and letter spacing needs to be modified for the web font, will need to apply CSS rules to all elements with the web font applied for when the fallback font is shown. This style must then be removed when the web font is loaded. This is possible using the <a href="https://developer.mozilla.org/en-US/docs/Web/API/CSS_Font_Loading_API">font loading API</a>, but the whole process feels racy and fragile. Changing layout-critical CSS with JavaScript doesn't sit right with me.</p>
<p>Browser support for font-face descriptors is... well it's only in Chrome, in v87+. There are, however, positive signals from Safari. No matter the browser support, font-face descriptors are a progressive enhancement so there is no reason not to implement them now.</p>
<h2 id="guaranteeing-fonts-load-in-time-">Guaranteeing fonts load in time <a href="https://simonhearne.com/2021/layout-shifts-webfonts/#guaranteeing-fonts-load-in-time">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#guaranteeing-fonts-load-in-time-"></a></h2>
<p>It has been suggested that fonts can be embedded in CSS as Base64 strings, thus removing the need for additional font requests and ensuring that the font is available at the time of rendering text. I have seen this on production websites, and it does achieve these goals.</p>
<p>Embedding fonts as Base64 strings comes with a number of drawbacks, as such I would not recommend this approach:</p>
<ol>
<li>Font files are compressed binary objects, encoding as Base64 strings will inflate the size significantly. gzip or brotli compression of the CSS bundle will not totally make up for this inflation.</li>
<li>The fonts will be sent to every browser, even if they can't use them (e.g. Opera Mini and IE11 for woff2, users of <a href="https://chrome.google.com/webstore/detail/dyslexia-friendly/miepjgfkkommhllbbjaedffcpkncboeo?hl=en">Dyslexia Friendly</a>)</li>
<li>Fonts rarely change, but CSS changes often - this will reduce cache effectiveness for fonts as every CSS change will invalidate the whole bundle</li>
<li>Inflating CSS size will almost certainly delay page render</li>
<li>Embedding fonts prevents you from effectively using subsets and unicode-range for different alphabets</li>
</ol>
<p>In general, embedding fonts in CSS breaks the magic of web fonts: that browsers know what they need and will download it when they need it. There are two other options if you absolutely require the fonts to be available before the page renders:</p>
<ol>
<li>Hide the body until the font is ready, using <code>opacity: 0</code> and the <a href="https://developer.mozilla.org/en-US/docs/Web/API/CSS_Font_Loading_API">Font Loading API</a> to show content once the font loads (with a sensible timeout)</li>
<li>Use <code>display:block</code> and match the fallback font as closely as possible to your web font</li>
</ol>
<p>Option 1 would need a lot of testing to ensure that content is always shown eventually, I would avoid it entirely.</p>
<h2 id="the-future-of-font-performance-">The future of font performance <a href="https://simonhearne.com/2021/layout-shifts-webfonts/#the-future-of-font-performance">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#the-future-of-font-performance-"></a></h2>
<p>It is clear that font performance is not yet a solved problem. Thankfully, there a works afoot to improve this in the <a href="https://www.w3.org/Fonts/WG/">W3C Web Fonts Working Group</a>. One of the proposals is progressive font enrichment, this is an incremental font loading concept which allows browsers to request exactly the characters they need to render text, potentially drastically reducing initial font file size and thus improving render speed.</p>
<p>Google <a href="https://fonts.gstatic.com/experimental/incxfer_demo">has a demo</a> of this incremental transfer concept, and <a href="https://twitter.com/jpamental">Jason Pamental</a> has written up the concept in <a href="https://rwt.io/typography-tips/progressive-font-enrichment-reinventing-web-font-performance">much more detail</a> than I could here.</p>
<p>Whilst the incremental font loading concept is interesting, the main use case will be for very large font sets for non-latin languages. There are potential issues of cache dilution to resolve and the overall size of fonts delivered could exceed the optimal subset font file. Watch this space for more developments!</p>
<h2 id="in-conclusion-">In conclusion <a href="https://simonhearne.com/2021/layout-shifts-webfonts/#in-conclusion">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#in-conclusion-"></a></h2>
<p>Layout shifts are bad for user experience and tricky to resolve. Rendering text without layout shifts is much more complex than it should be! You can avoid layout shifts entirely if you can apply <code>font-display: optional</code> to your web fonts, otherwise it's a case of racing the browser - trying to get your fonts to the browser before it starts to render text.</p>
<p>Racing the browser is possible by optimising your font files:</p>
<ul>
<li>Use <code>woff2</code> to minimise file size</li>
<li>Serve fonts from your own domain</li>
<li>Preload critical fonts</li>
<li>Subset the font to required characters</li>
<li>Limit the number of weight variations used</li>
<li>Explore variable fonts</li>
<li>Experiment with system fonts</li>
<li>Use f-mods to reduce the impact of font swaps</li>
</ul>
<p>As always, test all changes with real users and only keep them if you see a positive change. On this site I have set the body text to <code>font-display: optional</code> but my heading font and the italic variant of the body font to <code>font-display: swap</code>. Swapping in the heading font and italic variant do not cause a layout shift in most cases (except multi-line headings) so this is a good compromise between design and performance, in my opinion.</p></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#why-fonts-cause-layout-shifts-" title="Why fonts cause layout shifts #">Why fonts cause layout shifts #</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#detecting-layout-shifts-" title="Detecting layout shifts #">Detecting layout shifts #</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#prevent-layout-shifts-with-font-display-" title="Prevent layout shifts with font-display #">Prevent layout shifts with font-display #</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#load-fewer-font-files-" title="Load fewer font files #">Load fewer font files #</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#use-faux-bold-and-italic-" title="Use faux bold and italic #">Use faux bold and italic #</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#use-a-variable-font-" title="Use a variable font #">Use a variable font #</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#death-to-icon-fonts-" title="Death to icon fonts #">Death to icon fonts #</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#use-system-fonts-" title="Use system fonts #">Use system fonts #</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#optimise-font-files-" title="Optimise font files #">Optimise font files #</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#subset-fonts-" title="Subset fonts #">Subset fonts #</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#use-modern-formats-" title="Use modern formats #">Use modern formats #</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#deliver-your-fonts-fast-" title="Deliver your fonts fast #">Deliver your fonts fast #</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#host-your-own-fonts-" title="Host your own fonts #">Host your own fonts #</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#cache-your-fonts-" title="Cache your fonts #">Cache your fonts #</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#use-preload-hints-" title="Use preload hints #">Use preload hints #</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#reduce-layout-shift-with-f-mods-" title="Reduce layout shift with f-mods #">Reduce layout shift with f-mods #</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#implementing-f-mods-" title="Implementing f-mods #">Implementing f-mods #</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#f-mods-playground-" title="F-mods Playground #">F-mods Playground #</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#f-mods-limitations-" title="F-mods limitations #">F-mods limitations #</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#guaranteeing-fonts-load-in-time-" title="Guaranteeing fonts load in time #">Guaranteeing fonts load in time #</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#the-future-of-font-performance-" title="The future of font performance #">The future of font performance #</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#in-conclusion-" title="In conclusion #">In conclusion #</a></div></div></div></div></div></div></div></div></div></div></div><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></main></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"jlvky3aqhg65gfidokmjqkj","title":"How to avoid layout shifts caused by web fonts","desc":"","updated":1686097785830,"created":1686097315267,"custom":{},"fname":"dev.CSS.font.layout-shifts-webfonts","type":"note","vault":{"fsPath":"vault"},"contentHash":"472983409270ec27fb70a72578f0c3bb","links":[{"type":"wiki","from":{"fname":"dev.CSS.font.layout-shifts-webfonts","id":"jlvky3aqhg65gfidokmjqkj","vaultName":"vault"},"value":"tags.demo-text-1","alias":"#demo-text-1","position":{"start":{"line":22,"column":1,"offset":2075},"end":{"line":22,"column":13,"offset":2087},"indent":[]},"xvault":false,"to":{"fname":"tags.demo-text-1"}}],"anchors":{"why-fonts-cause-layout-shifts-":{"type":"header","text":"Why fonts cause layout shifts #","value":"why-fonts-cause-layout-shifts-","line":24,"column":0,"depth":2},"detecting-layout-shifts-":{"type":"header","text":"Detecting layout shifts #","value":"detecting-layout-shifts-","line":36,"column":0,"depth":3},"prevent-layout-shifts-with-font-display-":{"type":"header","text":"Prevent layout shifts with font-display #","value":"prevent-layout-shifts-with-font-display-","line":52,"column":0,"depth":2},"load-fewer-font-files-":{"type":"header","text":"Load fewer font files #","value":"load-fewer-font-files-","line":71,"column":0,"depth":2},"use-faux-bold-and-italic-":{"type":"header","text":"Use faux bold and italic #","value":"use-faux-bold-and-italic-","line":75,"column":0,"depth":3},"use-a-variable-font-":{"type":"header","text":"Use a variable font #","value":"use-a-variable-font-","line":89,"column":0,"depth":3},"death-to-icon-fonts-":{"type":"header","text":"Death to icon fonts #","value":"death-to-icon-fonts-","line":95,"column":0,"depth":3},"use-system-fonts-":{"type":"header","text":"Use system fonts #","value":"use-system-fonts-","line":103,"column":0,"depth":3},"optimise-font-files-":{"type":"header","text":"Optimise font files #","value":"optimise-font-files-","line":119,"column":0,"depth":2},"subset-fonts-":{"type":"header","text":"Subset fonts #","value":"subset-fonts-","line":123,"column":0,"depth":3},"use-modern-formats-":{"type":"header","text":"Use modern formats #","value":"use-modern-formats-","line":143,"column":0,"depth":3},"deliver-your-fonts-fast-":{"type":"header","text":"Deliver your fonts fast #","value":"deliver-your-fonts-fast-","line":153,"column":0,"depth":2},"host-your-own-fonts-":{"type":"header","text":"Host your own fonts #","value":"host-your-own-fonts-","line":157,"column":0,"depth":3},"cache-your-fonts-":{"type":"header","text":"Cache your fonts #","value":"cache-your-fonts-","line":165,"column":0,"depth":3},"use-preload-hints-":{"type":"header","text":"Use preload hints #","value":"use-preload-hints-","line":175,"column":0,"depth":3},"reduce-layout-shift-with-f-mods-":{"type":"header","text":"Reduce layout shift with f-mods #","value":"reduce-layout-shift-with-f-mods-","line":207,"column":0,"depth":2},"implementing-f-mods-":{"type":"header","text":"Implementing f-mods #","value":"implementing-f-mods-","line":222,"column":0,"depth":3},"f-mods-playground-":{"type":"header","text":"F-mods Playground #","value":"f-mods-playground-","line":254,"column":0,"depth":3},"f-mods-limitations-":{"type":"header","text":"F-mods limitations #","value":"f-mods-limitations-","line":258,"column":0,"depth":3},"guaranteeing-fonts-load-in-time-":{"type":"header","text":"Guaranteeing fonts load in time #","value":"guaranteeing-fonts-load-in-time-","line":266,"column":0,"depth":2},"the-future-of-font-performance-":{"type":"header","text":"The future of font performance #","value":"the-future-of-font-performance-","line":285,"column":0,"depth":2},"in-conclusion-":{"type":"header","text":"In conclusion #","value":"in-conclusion-","line":293,"column":0,"depth":2}},"children":[],"parent":"ujxz1y7bdvpazo3rn5yyr1c","data":{}},"body":"\u003ch1 id=\"how-to-avoid-layout-shifts-caused-by-web-fonts\"\u003eHow to avoid layout shifts caused by web fonts\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#how-to-avoid-layout-shifts-caused-by-web-fonts\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://simonhearne.com/2021/layout-shifts-webfonts/\"\u003ehttps://simonhearne.com/2021/layout-shifts-webfonts/\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eOne of the outcomes of the release of \u003ca href=\"https://simonhearne.com/2020/core-web-vitals/\"\u003eCore Web Vitals\u003c/a\u003e (and subsequent \u003ca href=\"https://developers.google.com/search/blog/2020/11/timing-for-page-experience\"\u003einclusion\u003c/a\u003e in Google's page ranking algorithm) is that we have been paying more attention to unexpected layout shifts and the cumulative layout shift (CLS) score.\u003c/p\u003e\n\u003cp\u003eSome sources of layout shifts have been simple to resolve: pre-allocate the correct space for dynamic elements, use width and height attributes on images and prioritise visible elements in your HTML document. One common cause of layout shift is surprisingly difficult to resolve though: flashes of unstyled text (FOUT).\u003c/p\u003e\n\u003cp\u003eIn this post we will explore the surprisingly complex world of text rendering on the web and some techniques to remove FOUT while not incurring a CLS penalty.\u003c/p\u003e\n\u003cp\u003eIn summary we need to prevent the layout shift by letting the browser render in a fallback system font if it doesn't get the web font in time, then optimise our fonts to try to get them to the browser before it needs them:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003euse \u003ccode\u003efont-display: optional\u003c/code\u003e to prevent layout shifts\u003c/li\u003e\n\u003cli\u003esubset fonts and serve as \u003ccode\u003ewoff2\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003euse variable fonts or a limited set of weight variations\u003c/li\u003e\n\u003cli\u003epreload critical fonts\u003c/li\u003e\n\u003cli\u003ehost your own fonts on your main domain\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"why-fonts-cause-layout-shifts-\"\u003eWhy fonts cause layout shifts \u003ca href=\"https://simonhearne.com/2021/layout-shifts-webfonts/#why-fonts-cause-layout-shifts\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#why-fonts-cause-layout-shifts-\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eUnexpected layout shifts (page content moving around without user interaction) are bad for user experience. Fonts cause layout shifts when the size of the containing element (e.g. a \u003ccode\u003e\u0026#x3C;div\u003e\u003c/code\u003e or paragraph) changes when the web font is downloaded. This occurs when the height of the font or the length of the paragraph is different with the web font compared to the system font. When laying out a page, browsers will use the dimensions and properties of the fallback font to determine the size of the containing elements, even if you have declared a web font to block the system font with \u003ccode\u003efont-display: block\u003c/code\u003e!\u003c/p\u003e\n\u003cp\u003e\u003ca title=\"Private\" href=\"https://wiki.dendron.so/notes/hfyvYGJZQiUwQaaxQO27q.html\" target=\"_blank\" class=\"private\"\u003e#demo-text-1 (Private)\u003c/a\u003e { overflow: hidden; width: 80%; max-width: 500px; font-size: smaller; border: 1px solid grey; } .no-font { font-family: serif !important; border-color: red !important; } .fout-fig { height: 220px; position:relative; } @media only screen and (max-width: 600px) { .fout-fig { height: 350px; } }\u003c/p\u003e\n\u003cp\u003eLorem ipsum dolor sit amet, consectetur adipiscing elit. Proin aliquam metus eu lacus placerat feugiat. Suspendisse quis elit fringilla, luctus felis ut, ultricies leo. Morbi vel dui non risus aliquam rhoncus in ac justo. Mauris cursus diam id ipsum aliquet tempus. Praesent feugiat consequat risus, ut eleifend neque consequat quis. Maecenas rhoncus faucibus dui quis pretium. Nam ultrices rhoncus dui, at pretium erat rhoncus et. Vestibulum tempus diam vel ex venenatis placerat. Nam sed elementum odio. Suspendisse vel orci turpis. Fusce in maximus ante, non malesuada justo. Duis in tellus erat.\u003c/p\u003e\n\u003cp\u003eFlash of Unstyled Text\u003c/p\u003e\n\u003cp\u003ewindow.setInterval(() =\u003e { document.getElementById('demo-text-1').classList.toggle(\"no-font\"); },2000);\u003c/p\u003e\n\u003ch3 id=\"detecting-layout-shifts-\"\u003eDetecting layout shifts \u003ca href=\"https://simonhearne.com/2021/layout-shifts-webfonts/#detecting-layout-shifts\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#detecting-layout-shifts-\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eThere are a number of methods to detect layout shifts due to web fonts, the most simple is to run your page through \u003ca href=\"https://webpagetest.org/\"\u003eWebPageTest\u003c/a\u003e and use the filmstrip view. There is a toggle to show layout shifts, combine that with 'huge' screenshot images and a 0.1s interval to get a clear view of what is happening as your page renders (you can simply add this to the end of the URL: \u003ccode\u003e\u0026#x26;highlightCLS=1\u0026#x26;thumbSize=600\u0026#x26;ival=100\u0026#x26;end=visual\u0026#x26;text=000\u0026#x26;bg=fff\"\u003c/code\u003e). The Washington Post has a couple of layout shifts due to web fonts, in the example below the headline text is one line shorter with the web font than without which results in a layout shift. Layout shifts are dependent on viewport size so make sure you test a few different devices.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://simonhearne.com/images/layout-shifts-webfonts/wapo-headline.png\"\u003ewapo headline\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eHeadline web font loading causes a layout shift. \u003ca href=\"https://webpagetest.org/video/compare.php?tests=210120_Di3C_126898f84daca6ada62ee7736a29bddb-r%3A1-c%3A0\u0026#x26;highlightCLS=1\u0026#x26;thumbSize=600\u0026#x26;ival=100\u0026#x26;end=visual\u0026#x26;text=000\u0026#x26;bg=fff\"\u003eView test on WPT\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eYou can also find layout shifts in the Chrome Developer Tools Performance tab, look for layout shifts attributed to text elements.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://simonhearne.com/images/layout-shifts-webfonts/wapo-shift.jpg\"\u003ewapo-shift\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eChrome developer tools shows attribution of layout shifts\u003c/p\u003e\n\u003cp\u003eI've covered general layout shifts in more detail in a post on \u003ca href=\"https://simonhearne.com/2020/core-web-vitals/\"\u003eHow to Improve Core Web Vitals\u003c/a\u003e.\u003c/p\u003e\n\u003ch2 id=\"prevent-layout-shifts-with-font-display-\"\u003ePrevent layout shifts with font-display \u003ca href=\"https://simonhearne.com/2021/layout-shifts-webfonts/#prevent-layout-shifts-with-font-display\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#prevent-layout-shifts-with-font-display-\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eThe dirty little secret of this blog post is that you can resolve layout shifts due to fonts with a single line of CSS:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003efont-display: optional\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eThis directive lives in your font-face declaration and tells the browser to use a fallback system font if the web font is not available at the time of rendering text (plus 100ms). This means that on uncached page loads there is a chance that the fallback font will be used, but all subsequent page loads should be rendered with the web font, as it will be downloaded and available in cache. There are other options, shown in the image below:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eblock\u003c/strong\u003e - hide text for up to three seconds while waiting for the web font, and always swap in the web font when it loads\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eswap\u003c/strong\u003e - show text as soon as possible, and always swap in the web font when it loads\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003efallback\u003c/strong\u003e - hide text for up to 100ms, then only swap in the web font if it loads within three seconds\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eoptional\u003c/strong\u003e - hide text for up to 100ms, then only use the web font if it is available - never swapping\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"/assets/images/css/font-display.webp\" alt=\"font-display\"\u003e\u003c/p\u003e\n\u003cp\u003eOptional is the only font-display value which guarantees no layout shift. \u003ca href=\"https://speakerdeck.com/notwaldorf/fontastic-web-performance?slide=74\"\u003eImage\u003c/a\u003e by \u003ca href=\"https://twitter.com/notwaldorf\"\u003e@notwalforf\u003c/a\u003e. \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face/font-display\"\u003eRead more on MDN\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eIf it's that simple, why this whole blog post? Unfortunately system fonts are not necessarily the nicest designs, and they are not consistent between operating systems. Most designers will cringe at the thought of showing users a fallback system font. The rest of this blog post details various optimisations to get the font files to the browser quicker, allowing the use of any font-display option but with minimal risk of showing a system font, or for options other than \u003ccode\u003eoptional\u003c/code\u003e: without triggering a layout shift. We will also look at font-face descriptors / f-mods and progressive font enrichment for potential further optimisations in the future.\u003c/p\u003e\n\u003ch2 id=\"load-fewer-font-files-\"\u003eLoad fewer font files \u003ca href=\"https://simonhearne.com/2021/layout-shifts-webfonts/#load-fewer-font-files\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#load-fewer-font-files-\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eDownloading one or two font files to render text won't have a massive impact on speed, downloading five or ten font files will! Ensuring that you deliver the minimium viable number of font files is the best way to ensure that the browser has them available at layout, thus reducing the likelihood of FOUT layout shifts. Let's look at some tricks to load fewer font files while maintaining your design.\u003c/p\u003e\n\u003ch3 id=\"use-faux-bold-and-italic-\"\u003eUse faux bold and italic \u003ca href=\"https://simonhearne.com/2021/layout-shifts-webfonts/#use-faux-bold-and-italic\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#use-faux-bold-and-italic-\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003eDesigners hate this one weird trick!\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eFont stacks generally include a bunch of different files, from extra-light italic through to extra-bold. Combining nine font weights with normal and italic variants produces 18 separate font files! Fonts that are not used on the page will not be downloaded, but for the odd occasion where only a single word is both bold and italic (for example) the whole font file will be downloaded to render the single word.\u003c/p\u003e\n\u003cp\u003eBrowsers can make bold and italic versions of fonts themselves, this is called faux bold and faux italic. This could mean that a single regular weight font file is all you need! This should be tested and approved by any designers involved, I recommend a blind \u003ca href=\"https://juiceboxinteractive.com/blog/how-pepsi-won-the-battle-but-lost-the-challenge/\"\u003eCoke vs. Pepsi\u003c/a\u003e style test to prevent any bias impacting the outcome.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://simonhearne.com/images/layout-shifts-webfonts/faux-bold.png\"\u003eimage showing faux bold of roboto font compared to real bold, there is little difference\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eExample of differences between faux and real bold. \u003ca href=\"https://graphicdesign.stackexchange.com/questions/75965/distinguishing-real-and-faux-bold-and-italics\"\u003esource\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eThere may be subtle differences between the browser's version of a bold font and the font creator's version, as shown above. For some fonts the differences will be too great to consider, especially fancy ones! You can check yours by simply removing the @font-face declarations for all but the regular font version and comparing screenshots of rendered text.\u003c/p\u003e\n\u003ch3 id=\"use-a-variable-font-\"\u003eUse a variable font \u003ca href=\"https://simonhearne.com/2021/layout-shifts-webfonts/#use-a-variable-font\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#use-a-variable-font-\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eAll modern browsers support variable fonts (notable exceptions are \u003ca href=\"https://caniuse.com/variable-fonts\"\u003eIE11 and Opera Mini\u003c/a\u003e), this allows a single font file to include multiple variable axes like font weight and slant. This results in a larger file than a single weight font, but it replaces multiple weight files and provides more flexibility for the variable axes (e.g. font-weight: 457).\u003c/p\u003e\n\u003cp\u003eVariable fonts can be found in multiple places, for example Google Fonts \u003ca href=\"https://fonts.google.com/?vfonly=true\"\u003ehas a filter\u003c/a\u003e to only show variable fonts. The majority of variable fonts have a single variable axis for weight, but there are a number of possible dimensions including slant, serif and optical size. \u003ca href=\"https://fonts.google.com/specimen/Exo?vfonly=true\"\u003eExo\u003c/a\u003e for example has both weight and a binary italic dimension. \u003ca href=\"https://www.axis-praxis.org/specimens/__DEFAULT__\"\u003eAxis Praxis\u003c/a\u003e is a great place to explore the possibilities of variable fonts.\u003c/p\u003e\n\u003ch3 id=\"death-to-icon-fonts-\"\u003eDeath to icon fonts \u003ca href=\"https://simonhearne.com/2021/layout-shifts-webfonts/#death-to-icon-fonts\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#death-to-icon-fonts-\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eIcon font sets like \u003ca href=\"https://fontawesome.com/\"\u003eFont Awesome\u003c/a\u003e and Bootsrap's \u003ca href=\"https://getbootstrap.com/docs/3.3/components/\"\u003eglyphicons\u003c/a\u003e have popularised the use of web fonts for iconography. Unfortunately this means that your icons will not render until a (typically) large font file has downloaded, and sometimes results in an unsightly ⃞ symbol instead of your icons when the font file fails to download in time.\u003c/p\u003e\n\u003cp\u003eIcon fonts are bad practice for performance and accessibility, \u003ca href=\"https://www.wouterbulten.nl/blog/tech/blog-optimization-replacing-font-awesome-with-svg/\"\u003ereplace them with SVG\u003c/a\u003e as soon as possible.\u003c/p\u003e\n\u003cp\u003eN.B. this section is named after the great talk given by \u003ca href=\"https://twitter.com/ninjanails\"\u003eSeren Davies\u003c/a\u003e: \u003ca href=\"https://www.youtube.com/watch?v=9xXBYcWgCHA\"\u003eDeath to Iconfonts ☠️\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"use-system-fonts-\"\u003eUse system fonts \u003ca href=\"https://simonhearne.com/2021/layout-shifts-webfonts/#use-system-fonts\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#use-system-fonts-\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eWeb fonts are popular because they allow designers to maintain a consistent look and feel across browsers. Where this isn't necessary, system fonts will be the fastest method to render text. If your current web font is close to a system font, you can use \u003ca href=\"https://meowni.ca/font-style-matcher/\"\u003eFont Style Matcher\u003c/a\u003e by \u003ca href=\"https://twitter.com/notwaldorf\"\u003eMonica\u003c/a\u003e to tweak the font settings until you get a near-perfect match. I've worked with a client who surreptitiously replaced their web font stack with a tweaked system font for two weeks - neither designers nor customers apparently noticed the difference!\u003c/p\u003e\n\u003cp\u003eUsing a system font means that text will render at the earliest possible time. We also now have methods to make the font match the operating system, which may be more attractive than previous fallback options like Arial and Helvetica. To do this you'll need to list the system fonts for all operating systems in a specific order:\u003c/p\u003e\n\u003cpre class=\"language-css\"\u003e\u003ccode class=\"language-css\"\u003e\u003cspan class=\"token selector\"\u003ebody\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003efont-family\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e -apple-system\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e BlinkMacSystemFont\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Segoe UI\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Roboto\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"Oxygen\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Ubuntu\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Cantarell\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Fira Sans\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Droid Sans\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"Helvetica Neue\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e sans-serif\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eYou can read more about this approach in a Smashing Magazine \u003ca href=\"https://www.smashingmagazine.com/2015/11/using-system-ui-fonts-practical-guide/\"\u003earticle from 2015\u003c/a\u003e. One drawback to this approach is that it cannot co-exist with the \u003ca href=\"https://simonhearne.com/2021/layout-shifts-webfonts/#reduce-layout-shift-with-f-mods\"\u003ef-mods\u003c/a\u003e approach we describe below, this is to be used \u003cem\u003einstead\u003c/em\u003e of web fonts. \u003ca href=\"https://simonhearne.com/2021/layout-shifts-webfonts/#conversation\"\u003eLet me know\u003c/a\u003e if I'm wrong in this assumption!\u003c/p\u003e\n\u003ch2 id=\"optimise-font-files-\"\u003eOptimise font files \u003ca href=\"https://simonhearne.com/2021/layout-shifts-webfonts/#optimise-font-files\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#optimise-font-files-\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eIf we must download a font file, we should make it as small as possible to ensure it downloads quickly. There are two key methods to optimise web fonts: subsetting and formats.\u003c/p\u003e\n\u003ch3 id=\"subset-fonts-\"\u003eSubset fonts \u003ca href=\"https://simonhearne.com/2021/layout-shifts-webfonts/#subset-fonts\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#subset-fonts-\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eMany fonts will have glyphs (glyphs are individual characters like \u003ccode\u003ea\u003c/code\u003e or \u003ccode\u003e\u0026#x26;\u003c/code\u003e) from multiple alphabets. If your website is only delivered in the latin alphabet (a - Z) and does not use ligatures (like \u003ccode\u003eé\u003c/code\u003e) then these glyphs represent wasted bytes in your font file. Roboto, the most popular Google font, has 277 glyphs.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://simonhearne.com/images/layout-shifts-webfonts/roboto-glyphs.png\"\u003eimage of all glyphs in the roboto font from google, showing many non-latin characters\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eGlyphs in the popular Roboto font. \u003ca href=\"https://fonts.google.com/specimen/Roboto?selection.family=Roboto\u0026#x26;sidebar.open=true#glyphs\"\u003esource\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eRemoving non-latin characters from this font results in a \u003ccode\u003ewoff2\u003c/code\u003e file that is one sixth the size!\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"/img/dbjqRi3ibh-600.jpeg\"\u003escreenshot of file system showing subset roboto font is 11KB, original is 66KB\u003c/a\u003e(\u003ca href=\"https://simonhearne.com/images/layout-shifts-webfonts/subset-roboto.png\"\u003ehttps://simonhearne.com/images/layout-shifts-webfonts/subset-roboto.png\u003c/a\u003e)\u003c/p\u003e\n\u003cp\u003eSubset font is 5x smaller\u003c/p\u003e\n\u003cp\u003eIf you use Google fonts, you can \u003ca href=\"https://developers.google.com/fonts/docs/getting_started#specifying_script_subsets\"\u003especify which subsets\u003c/a\u003e you require in the CSS request. If you host your own fonts (which I would always recommend, where possible) you will need to check with the font provider if they have subset versions, or where your license permits you can create subsets yourself.\u003c/p\u003e\n\u003cp\u003eTo create subsets you will ideally start with the \u003ccode\u003ettf\u003c/code\u003e file and work out what glyphs you need to keep. Filament Group have created \u003ca href=\"https://github.com/filamentgroup/glyphhanger\"\u003eglyphhanger\u003c/a\u003e to take out the hard work here, read their \u003ca href=\"https://www.filamentgroup.com/lab/glyphhanger/\"\u003eblog post\u003c/a\u003e to see how easy it is to create a unique subset font just for your pages. Note that missing glyphs will be rendered in the fallback system font, so they won't just disappear!\u003c/p\u003e\n\u003cp\u003eIt is possible to create multiple subset variations of your fonts if your website supports multiple languages. In this case, use the \u003ccode\u003eunicode-range\u003c/code\u003e declaration in your @font-face rule to let the browser know which characters are in which font file. Read more about this on \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face/unicode-range\"\u003eMDN\u003c/a\u003e or take a look at \u003ca href=\"https://fonts.googleapis.com/css2?family=Open+Sans\u0026#x26;display=swap\"\u003ea response\u003c/a\u003e from Google Fonts for inspiration.\u003c/p\u003e\n\u003ch3 id=\"use-modern-formats-\"\u003eUse modern formats \u003ca href=\"https://simonhearne.com/2021/layout-shifts-webfonts/#use-modern-formats\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#use-modern-formats-\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eThere are a set of different formats available to serve web fonts: \u003ccode\u003ettf\u003c/code\u003e, \u003ccode\u003eotf\u003c/code\u003e, \u003ccode\u003eeot\u003c/code\u003e, \u003ccode\u003ewoff\u003c/code\u003e and \u003ccode\u003ewoff2\u003c/code\u003e. \u003ccode\u003ettf\u003c/code\u003e and \u003ccode\u003eotf\u003c/code\u003e are the 'raw' font files, and probably shouldn't be sent to a browser. \u003ccode\u003eeot\u003c/code\u003e supports subsetting and is compressed using LZ compression, whereas \u003ccode\u003ewoff\u003c/code\u003e uses gzip compression and \u003ccode\u003ewoff2\u003c/code\u003e uses brotli compression.\u003c/p\u003e\n\u003cp\u003eFont stacks will often have many or all of these formats available, but you really only need \u003ccode\u003ewoff2\u003c/code\u003e. The newer format is around 30% smaller than \u003ccode\u003ewoff\u003c/code\u003e and is supported in all modern browsers. Supporting only \u003ccode\u003ewoff2\u003c/code\u003e will make it more simple to apply some of the other optimisations recommended, such as subsetting.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"/img/zWJICqkLpV-600.jpeg\"\u003ecan i use dot com shows all browsers except opera and IE11 support woff2\u003c/a\u003e(\u003ca href=\"https://simonhearne.com/images/layout-shifts-webfonts/woff2-support.png\"\u003ehttps://simonhearne.com/images/layout-shifts-webfonts/woff2-support.png\u003c/a\u003e)\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ewoff2\u003c/code\u003e is supported on all the browsers you care about. \u003ca href=\"https://caniuse.com/woff2\"\u003esource\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"deliver-your-fonts-fast-\"\u003eDeliver your fonts fast \u003ca href=\"https://simonhearne.com/2021/layout-shifts-webfonts/#deliver-your-fonts-fast\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#deliver-your-fonts-fast-\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eIt may seem obvious, but we must make sure that the browser can download our font files as soon as possible! There are a few techniques we should follow to ensure this is always the case. Hosting fonts on your own domain (and ideally on a content delivery network (CDN)) will result in the best performance.\u003c/p\u003e\n\u003ch3 id=\"host-your-own-fonts-\"\u003eHost your own fonts \u003ca href=\"https://simonhearne.com/2021/layout-shifts-webfonts/#host-your-own-fonts\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#host-your-own-fonts-\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eFont foundries such as Google Fonts are popular: the HTTP Archive shows that \u003ca href=\"https://almanac.httparchive.org/en/2020/fonts#where-are-web-fonts-being-used\"\u003e80% of sites\u003c/a\u003e use web fonts, and \u003ca href=\"https://almanac.httparchive.org/en/2020/third-parties#third-party-domains\"\u003e7.5%\u003c/a\u003e of all web fonts are served by Google. Using a third-party service can incur a performance penalty, though. The Google Fonts embed process uses either a CSS link or @import, with the CSS file returning a dynamic set of @font-face rules. The rules are distinct for the given font, user agent and any additional query parameters (like subsetting and font-display options).\u003c/p\u003e\n\u003cp\u003eUsing a third-party service means that your fonts will be delayed. The best-case scenario is that you are requesting the font file directly from another hostname (e.g. \u003ca href=\"http://fonts.gstatic.com/\"\u003efonts.gstatic.com\u003c/a\u003e) which incurs a connection cost - DNS lookup, TCP connection and TLS negotiation. The worst case is multiple hops, like loading a CSS file from \u003ca href=\"http://fonts.googleapis.com/\"\u003efonts.googleapis.com\u003c/a\u003e which references files on \u003ca href=\"http://fonts.gstatic.com/\"\u003efonts.gstatic.com\u003c/a\u003e, incurring two connection penalties. This cost may be outweighed by the benefit in some cases for Google Fonts though, as the fonts they deliver are well optimised and subset by alphabet automatically.\u003c/p\u003e\n\u003cp\u003eIn general you should serve the fonts from your domain to avoid the cost of connecting to third-party domains, this will be especially important on high latency connections.\u003c/p\u003e\n\u003ch3 id=\"cache-your-fonts-\"\u003eCache your fonts \u003ca href=\"https://simonhearne.com/2021/layout-shifts-webfonts/#cache-your-fonts\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#cache-your-fonts-\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eFonts can be cached in two places: the client and the CDN. Caching on the client is important for mid-session navigations and should be done in such a way as to avoid revalidation requests. Revalidation requests (\u003ccode\u003eif-not-modified\u003c/code\u003e and \u003ccode\u003eif-modified-since\u003c/code\u003e) will block the browser from using the font file until it has verified that it has not changed on the server. Fonts rarely change, so we should implement a cache header as follows and update the filename if the font changes to break the cache:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ecache-control: max-age=31536000,immutable\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eThis tells browsers that they can keep the font for up to a year and that it does not need to be revalidated (\u003ccode\u003eimmutable\u003c/code\u003e \u003ca href=\"https://caniuse.com/mdn-http_headers_cache-control_immutable\"\u003eis supported\u003c/a\u003e in Firefox and Safari, Chrome should avoid revalidation requests automatically). Avoid adding ETags to these responses as they may force revalidation.\u003c/p\u003e\n\u003cp\u003eCheck also that your Content Delivery Network configuration can store the font files in cache, older configurations may not include the \u003ccode\u003e.woff2\u003c/code\u003e extension resulting in origin hits and slowing down the response.\u003c/p\u003e\n\u003ch3 id=\"use-preload-hints-\"\u003eUse preload hints \u003ca href=\"https://simonhearne.com/2021/layout-shifts-webfonts/#use-preload-hints\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#use-preload-hints-\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eWeb browsers do not download fonts unnecessarily, they wait until the render tree has been constructed in order to know which fonts are required. This means that web fonts are only requested when the browser has downloaded and parsed the HTML and CSS, right before text is rendered. Note that inline CSS does not require a network request - meaning your fonts could be fetched earlier in the page load.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://simonhearne.com/images/layout-shifts-webfonts/font-crp.png\"\u003eflow diagram shows that web font loading is blocked by render tree construction\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eRender tree construction delays web font request. \u003ca href=\"https://web.dev/optimize-webfont-loading/\"\u003esource\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eIf we know that a web font is definitely going to be required to render text on a page, we can make a promise to the browser that it needs to be downloaded as soon as possible. This is a preload hint:\u003c/p\u003e\n\u003cpre class=\"language-html\"\u003e\u003ccode class=\"language-html\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003elink\u003c/span\u003e\n  \u003cspan class=\"token attr-name\"\u003erel\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003epreload\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token attr-name\"\u003ehref\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e/my-font.woff2\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token attr-name\"\u003ecrossorigin\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eanonymous\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token attr-name\"\u003eas\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003efont\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token attr-name\"\u003etype\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003efont/woff2\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWhen the browser parses this line of HTML it will immediately dispatch a high priority request for the font file. Doing this means that the web font is much more likely to be available when the browser renders text.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003epreloaded requests will cannibalise bandwidth from other early requests, use with caution!\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003ePreloaded requests are high-priority. In the waterfall section below you can see that five font files are downloaded, one blocks the page CSS (possibly because the \u003ccode\u003e\u0026#x3C;link rel=\"preload\"\u003e\u003c/code\u003e was above the \u003ccode\u003e\u0026#x3C;link rel=\"stylesheet\"\u003e\u003c/code\u003e) and the others block the main JavaScript bundle for the page. Note that this page was served over HTTP/2 on Chrome, other browsers and protocols will vary!\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://simonhearne.com/images/layout-shifts-webfonts/preload-slow-script.png\"\u003ewaterfall section showing fonts blocking main javascript bundle download\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003ePreloaded fonts delay main JS bundle.\u003c/p\u003e\n\u003cp\u003eEnsure that your preload tags are below critical content in the head and limit to two or three font files to get the best benefit.\u003c/p\u003e\n\u003ch2 id=\"reduce-layout-shift-with-f-mods-\"\u003eReduce layout shift with f-mods \u003ca href=\"https://simonhearne.com/2021/layout-shifts-webfonts/#reduce-layout-shift-with-f-mods\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#reduce-layout-shift-with-f-mods-\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eIf \u003ccode\u003efont-display: optional\u003c/code\u003e is not possible for your design, we need to attempt to match the fallback font layout to the web font as closely as possible. Enter font-display modifiers (f-mods), also known as font-face descriptors.\u003c/p\u003e\n\u003cp\u003eF-mods are in a \u003ca href=\"https://docs.google.com/document/d/1PW-5ML5hOZw7GczOargelPo6_8Zkuk2DXtgfOtJ59Eo/edit\"\u003eproposed update\u003c/a\u003e to the font-face descriptors specification which includes four new descriptors:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eascent-override (%)\u003c/strong\u003e - overrides the size allocated for ascenders\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003edescent-override (%)\u003c/strong\u003e - overrides the line height allocated for descenders\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eline-gap-override (%)\u003c/strong\u003e - overrides the gap between lines\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eadvance-override (#)\u003c/strong\u003e - sets an extra advance for each character, to help match line width and prevent word overflows\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThe first three all impact the height of a line: line box height = ascent + descent + line gap. Baseline position = line box top + line gap / 2 + ascent. For example, if we have \u003ccode\u003eascent-override: 80%; descent-override: 20%; line-gap-override: 0%\u003c/code\u003e, then each line box has height 1em (assuming 1em used font size), and the baseline is positioned at 0.8em below the line box top. The \u003ccode\u003eadvance-override\u003c/code\u003e descriptor adds a fraction of the font-size as a gap before each character, for example \u003ccode\u003efont-size:16px; advance-override: 0.1;\u003c/code\u003e will add a 1.6px gap before each character.\u003c/p\u003e\n\u003cp\u003eThe combination of these four descriptors allow us to override the layout of the fallback font to match the web font, by telling the browser how much space the characters will take up before the web font is downloaded. Read more in the \u003ca href=\"https://docs.google.com/document/d/1PW-5ML5hOZw7GczOargelPo6_8Zkuk2DXtgfOtJ59Eo/edit\"\u003eproposal\u003c/a\u003e.\u003c/p\u003e\n\u003ch3 id=\"implementing-f-mods-\"\u003eImplementing f-mods \u003ca href=\"https://simonhearne.com/2021/layout-shifts-webfonts/#implementing-f-mods\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#implementing-f-mods-\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eThe trick to implementing f-mods is to manually define your fallback system fonts with \u003ccode\u003esrc: local()\u003c/code\u003e. This allows us to override the display of the fallback font to match the web font:\u003c/p\u003e\n\u003cpre class=\"language-css\"\u003e\u003ccode class=\"language-css\"\u003e\u003cspan class=\"token atrule\"\u003e\u003cspan class=\"token rule\"\u003e@font-face\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003efont-family\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e custom-font\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003esrc\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token url\"\u003e\u003cspan class=\"token function\"\u003eurl\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string url\"\u003e\"https://example.com/font.woff2\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token atrule\"\u003e\u003cspan class=\"token rule\"\u003e@font-face\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003efont-family\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e fallback-font\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003esrc\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token function\"\u003elocal\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eArial\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e/* required! */\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003eadvance-override\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e xx\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003eascent-override\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e xx\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003edescent-override\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e xx\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003eline-gap-override\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e xx\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token selector\"\u003ebody\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003efont-family\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e custom-font\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e fallback-font\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eCalculating the required values might seem complex, but the information we need is already in your web font file. First you'll need the TTF file for your font; if you use Google Fonts then you can check find the TTF in the \u003ca href=\"https://github.com/google/fonts/tree/master/ofl/\"\u003eGitHub repository\u003c/a\u003e. If you have licensed a font from a foundry then the TTF should have been supplied already.\u003c/p\u003e\n\u003cp\u003eOnce you have the TTF head on over to \u003ca href=\"https://fontdrop.info/\"\u003eFontDrop\u003c/a\u003e and upload the file. Open the \u003cstrong\u003eData\u003c/strong\u003e tab and scroll to the \u003ccode\u003ehhea - Horizontal Header Table\u003c/code\u003e. There you should find four key values: \u003ccode\u003eascender\u003c/code\u003e, \u003ccode\u003edescender\u003c/code\u003e , \u003ccode\u003eline-gap\u003c/code\u003e and \u003ccode\u003eadvanceWidthMax\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://simonhearne.com/images/fontdrop.jpg\"\u003escreenshot of font drop showing font HHEA table\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eHHEA table data in FontDrop\u003c/p\u003e\n\u003cp\u003eThese values are exactly what we need to set the font-face modifiers! In this case the web font has unitsPerEm = 1000 and ascender = 1027, so it's best to set \u003ccode\u003eascent-override: 102.7%\u003c/code\u003e in the fallback font face. I recommend experimenting with values until you find the right balance, using the playground below.\u003c/p\u003e\n\u003ch3 id=\"f-mods-playground-\"\u003eF-mods Playground \u003ca href=\"https://simonhearne.com/2021/layout-shifts-webfonts/#f-mods-playground\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#f-mods-playground-\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eUse \u003ca href=\"https://codepen.io/simonjhearne/pen/rNMGJyr\"\u003ethis codepen\u003c/a\u003e to load your custom and fallback fonts, then play with the overrides to get a perfect match! Note that this will be specific to the operating system you are using, it may be worth validating across multiple devices.\u003c/p\u003e\n\u003ch3 id=\"f-mods-limitations-\"\u003eF-mods limitations \u003ca href=\"https://simonhearne.com/2021/layout-shifts-webfonts/#f-mods-limitations\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#f-mods-limitations-\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eF-mods only really modify vertical spacing and positioning. This means that character- and letter-spacing still need to be dealt with otherwise you could have words breaking lines at different points, leading to a change in element heights and thus layout shifts. Unfortunately the \u003ccode\u003eletter-spacing\u003c/code\u003e and \u003ccode\u003eword-spacing\u003c/code\u003e properties are not available in the @font-face declaration so they must be declared on the body or an element. This means we may still have some work to do in order to prevent layout shift.\u003c/p\u003e\n\u003cp\u003eIf the character and letter spacing needs to be modified for the web font, will need to apply CSS rules to all elements with the web font applied for when the fallback font is shown. This style must then be removed when the web font is loaded. This is possible using the \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/CSS_Font_Loading_API\"\u003efont loading API\u003c/a\u003e, but the whole process feels racy and fragile. Changing layout-critical CSS with JavaScript doesn't sit right with me.\u003c/p\u003e\n\u003cp\u003eBrowser support for font-face descriptors is... well it's only in Chrome, in v87+. There are, however, positive signals from Safari. No matter the browser support, font-face descriptors are a progressive enhancement so there is no reason not to implement them now.\u003c/p\u003e\n\u003ch2 id=\"guaranteeing-fonts-load-in-time-\"\u003eGuaranteeing fonts load in time \u003ca href=\"https://simonhearne.com/2021/layout-shifts-webfonts/#guaranteeing-fonts-load-in-time\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#guaranteeing-fonts-load-in-time-\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eIt has been suggested that fonts can be embedded in CSS as Base64 strings, thus removing the need for additional font requests and ensuring that the font is available at the time of rendering text. I have seen this on production websites, and it does achieve these goals.\u003c/p\u003e\n\u003cp\u003eEmbedding fonts as Base64 strings comes with a number of drawbacks, as such I would not recommend this approach:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eFont files are compressed binary objects, encoding as Base64 strings will inflate the size significantly. gzip or brotli compression of the CSS bundle will not totally make up for this inflation.\u003c/li\u003e\n\u003cli\u003eThe fonts will be sent to every browser, even if they can't use them (e.g. Opera Mini and IE11 for woff2, users of \u003ca href=\"https://chrome.google.com/webstore/detail/dyslexia-friendly/miepjgfkkommhllbbjaedffcpkncboeo?hl=en\"\u003eDyslexia Friendly\u003c/a\u003e)\u003c/li\u003e\n\u003cli\u003eFonts rarely change, but CSS changes often - this will reduce cache effectiveness for fonts as every CSS change will invalidate the whole bundle\u003c/li\u003e\n\u003cli\u003eInflating CSS size will almost certainly delay page render\u003c/li\u003e\n\u003cli\u003eEmbedding fonts prevents you from effectively using subsets and unicode-range for different alphabets\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eIn general, embedding fonts in CSS breaks the magic of web fonts: that browsers know what they need and will download it when they need it. There are two other options if you absolutely require the fonts to be available before the page renders:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eHide the body until the font is ready, using \u003ccode\u003eopacity: 0\u003c/code\u003e and the \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/CSS_Font_Loading_API\"\u003eFont Loading API\u003c/a\u003e to show content once the font loads (with a sensible timeout)\u003c/li\u003e\n\u003cli\u003eUse \u003ccode\u003edisplay:block\u003c/code\u003e and match the fallback font as closely as possible to your web font\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eOption 1 would need a lot of testing to ensure that content is always shown eventually, I would avoid it entirely.\u003c/p\u003e\n\u003ch2 id=\"the-future-of-font-performance-\"\u003eThe future of font performance \u003ca href=\"https://simonhearne.com/2021/layout-shifts-webfonts/#the-future-of-font-performance\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#the-future-of-font-performance-\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eIt is clear that font performance is not yet a solved problem. Thankfully, there a works afoot to improve this in the \u003ca href=\"https://www.w3.org/Fonts/WG/\"\u003eW3C Web Fonts Working Group\u003c/a\u003e. One of the proposals is progressive font enrichment, this is an incremental font loading concept which allows browsers to request exactly the characters they need to render text, potentially drastically reducing initial font file size and thus improving render speed.\u003c/p\u003e\n\u003cp\u003eGoogle \u003ca href=\"https://fonts.gstatic.com/experimental/incxfer_demo\"\u003ehas a demo\u003c/a\u003e of this incremental transfer concept, and \u003ca href=\"https://twitter.com/jpamental\"\u003eJason Pamental\u003c/a\u003e has written up the concept in \u003ca href=\"https://rwt.io/typography-tips/progressive-font-enrichment-reinventing-web-font-performance\"\u003emuch more detail\u003c/a\u003e than I could here.\u003c/p\u003e\n\u003cp\u003eWhilst the incremental font loading concept is interesting, the main use case will be for very large font sets for non-latin languages. There are potential issues of cache dilution to resolve and the overall size of fonts delivered could exceed the optimal subset font file. Watch this space for more developments!\u003c/p\u003e\n\u003ch2 id=\"in-conclusion-\"\u003eIn conclusion \u003ca href=\"https://simonhearne.com/2021/layout-shifts-webfonts/#in-conclusion\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#in-conclusion-\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eLayout shifts are bad for user experience and tricky to resolve. Rendering text without layout shifts is much more complex than it should be! You can avoid layout shifts entirely if you can apply \u003ccode\u003efont-display: optional\u003c/code\u003e to your web fonts, otherwise it's a case of racing the browser - trying to get your fonts to the browser before it starts to render text.\u003c/p\u003e\n\u003cp\u003eRacing the browser is possible by optimising your font files:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eUse \u003ccode\u003ewoff2\u003c/code\u003e to minimise file size\u003c/li\u003e\n\u003cli\u003eServe fonts from your own domain\u003c/li\u003e\n\u003cli\u003ePreload critical fonts\u003c/li\u003e\n\u003cli\u003eSubset the font to required characters\u003c/li\u003e\n\u003cli\u003eLimit the number of weight variations used\u003c/li\u003e\n\u003cli\u003eExplore variable fonts\u003c/li\u003e\n\u003cli\u003eExperiment with system fonts\u003c/li\u003e\n\u003cli\u003eUse f-mods to reduce the impact of font swaps\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eAs always, test all changes with real users and only keep them if you see a positive change. On this site I have set the body text to \u003ccode\u003efont-display: optional\u003c/code\u003e but my heading font and the italic variant of the body font to \u003ccode\u003efont-display: swap\u003c/code\u003e. Swapping in the heading font and italic variant do not cause a layout shift in most cases (except multi-line headings) so this is a good compromise between design and performance, in my opinion.\u003c/p\u003e","noteIndex":{"id":"Iy0MoL0KnL55Br3AfTS2C","title":"Luke","desc":"","updated":1761796791487,"created":1644449449778,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":"vault"},"contentHash":"4e745570ca97988a0362cb939b760952","links":[{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"life-tips","position":{"start":{"line":41,"column":5,"offset":2603},"end":{"line":41,"column":29,"offset":2627},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"life-tips","anchorHeader":"wodenokoto"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"journal.what-i-read-in.2025","alias":"What I read in 2025","position":{"start":{"line":70,"column":3,"offset":4333},"end":{"line":70,"column":54,"offset":4384},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"journal.what-i-read-in.2025"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"journal.what-i-read-in.2024","alias":"2024","position":{"start":{"line":71,"column":5,"offset":4389},"end":{"line":71,"column":41,"offset":4425},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"journal.what-i-read-in.2024"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"journal.what-i-read-in.2023","alias":"2023","position":{"start":{"line":72,"column":5,"offset":4430},"end":{"line":72,"column":41,"offset":4466},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"journal.what-i-read-in.2023"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"journal.what-i-read-in.2022","alias":"2022","position":{"start":{"line":73,"column":5,"offset":4471},"end":{"line":73,"column":41,"offset":4507},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"journal.what-i-read-in.2022"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"journal.what-i-struggled-brag-in","position":{"start":{"line":79,"column":3,"offset":4643},"end":{"line":79,"column":39,"offset":4679},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"journal.what-i-struggled-brag-in"}}],"anchors":{"what-i-read-in-past":{"type":"header","text":"What I read in past","value":"what-i-read-in-past","line":74,"column":0,"depth":2}},"children":["zd4mq442jike0pr0wba1u3m","6hzeqsofq67gdk88flxlkhp","778ijii93yu5uwnrwmn5zi4","g1fngdjl25nes6fs3lip602","ZbdkdApFqLdks4Moq92R9","uoc5hhki3o4py15cesddu8q","9qf7j06jtdkm6rnx9ymvwb0","5zn10cvj7ajy2gh2is5nqmg","4qo9ma0z0yu1czns6pxl7y5","ok0e729ho7o09xetujkxc0m","GR5x8HnNFEN6fU2UBSEIK","yirtnlj8q24yutcf3ss1xqy","eq0wc6t7wl2wv221yb68ro4","7x2fnv4j6gxts08qk0jguny","ettkt3iClONnxpbGwBVLl","7l4knev6v613tbuoskvmbdg","hvh5bud6yp7dc89tuh95tr9","4fvoqrplw0cweo554usbjos","f8qsfql0a9v8thpeo82udfa","1swsbrhqi9jk41v9eodyi5q","SQqYupi6EFddTerBA8RRD","hjNeNc1F2JUh0lTWanH4h","qf0l4wbrc9jgooyzexmbq5v","uur1lkol353z9vfeqb3n5bv","cd9n1czq3ursgkby985wkmm","k1sr43vwnfqztwc0s43pkcf","wfde75rhdvq2yfa2zy2q6rv","rjcmdv60jokmbw6zoq8u2ef","ujapvww8o6v3kpmlhtryq4k","pkwewou9d5e8ystswn1j2b4"],"parent":null,"data":{},"body":"\nHi there 👋. I'm a Front-end developer.\n\n---\n\n- 단순함과 꾸준함은 가장 쉬우면서도 지키기 어려운 원칙.\n\n- 🥱 -\u003e 🤔💡🌱 - [On The Death of Daydreaming](https://www.afterbabel.com/p/on-the-death-of-daydreaming)\n  - boredom -\u003e easy fun -\u003e art -\u003e profit?\n\n\u003e I've often described my motivation for building software to others using imagery: I like to go find a secluded beach, build a large, magnificent sand castle, and then walk away. Will anyone notice? Probably not. Will the waves eventually destroy it? Yep. Did I still get immense satisfaction? Absolutely. - [aliasxneo](https://news.ycombinator.com/item?id=41497113)\n\n\u003e We love to see the process, not just the result. The imperfections in your work can be beautiful if they show your struggle for perfection, not a lack of care. - [ralphammer](https://ralphammer.com/is-perfection-boring/)\n\n\u003e Simplicity, even if it sacrifices some ideal functionality has better survival characteristics than the-right-thing. - [The Rise of Worse is Better](https://www.dreamsongs.com/RiseOfWorseIsBetter.html)\n\n\u003e [Roberto Blake was talking about making 100 crappy videos](https://www.youtube.com/watch?v=OnUBaQ1Sp_E) to get better over time. Putting in the reps and improving a little bit each time.\n\u003e\n\u003e Putting in the work without expecting any external reward at first (eg views, followers, likes, etc) will pay off in the long run. - [100 Scrappy Things](https://www.florin-pop.com/blog/100-scrappy-things/)\n\n\u003e Make the difficult habitual, the habitual easy, and the easy beautiful. - [Constantin S. Stanislavski](https://www.goodreads.com/quotes/7102271-make-the-difficult-habitual-the-habitual-easy-and-the-easy)\n\n\u003e A good match is a **structured** dance, where players aim to **score** while they are following well-defined **rules**. This **freedom within a structure** is what makes it fun. - [ralphammer](https://ralphammer.com/how-to-get-started/)\n\n- [Pivot Points](https://longform.asmartbear.com/pivot-points/)\n\n  - non-judgmental aspects of personality that can be strengths in some contexts and weaknesses in others\n  - Pivot Points are fixed in the short term\n\n- [Hedged Bets](https://longform.asmartbear.com/predict-the-future/#hedged-bets)\n  - trading slightly less maximum upside for predictable, net-positive outcomes.\n\n\u003e “Motivation often comes after starting, not before. Action produces momentum.”\n\u003e [When you start a new habit, it should take less than two minutes to do.](https://jamesclear.com/how-to-stop-procrastinating)\n\u003e\n\u003e - James Clear\n\n\u003e Focus is more about **not** keeping busy when you need to wait for something.  \n\u003e Eat the boredom for a minute.\n\u003e\n\u003e - [[life-tips#wodenokoto]]\n\n\u003e [4 minutes run hard enough to push heart rate to 90%, 3 minutes recover, repeat 4 times](https://news.ycombinator.com/item?id=34213181)\n\u003e\n\u003e - https://www.ntnu.edu/cerg/advice\n\u003e - [Get running with Couch to 5K](https://www.nhs.uk/live-well/exercise/running-and-aerobic-exercises/get-running-with-couch-to-5k/)\n\n\u003e [recommended routine - bodyweightfitness](https://www.reddit.com/r/bodyweightfitness/wiki/kb/recommended_routine/) - I Don't Have This Much Time!\n\u003e\n\u003e - Don't workout at all (saves anywhere from 20 to 60 minutes, but really, really, really, really, really, really, really, really, really not recommended)\n\n\u003e 도무지 읽히지 않는 책 앞에서 내가 택한 방법은 펼쳐진 페이지 앞에서 멍때리기이다. 다르게 표현하면 이렇다. 펼쳐진 두 페이지 앞에서 오래 머물기.\n\u003e\n\u003e 책을 펼쳐놓는 것으로 충분하다. 읽지 못해도 좋다. 매일 정해진 진도를 나가야 하는 학교 수업이 아니니까. 하지만 읽지 않아도 괜찮다고 해서 펼쳐두지조차 않으면 곤란하다. 가능한 한 자주 책을 펼쳐두도록 하자. 전혀 읽지 않고 멍하니 바라보고 있다가 다시 덮게 되더라도\n\u003e\n\u003e - 막막한 독서. 시로군. P.10~13\n\n\u003e I think it should be everyone's primary focus to sleep well, drink water, get outside, get active, and eat generally decently. I hate to say it, but if you're not eating a good amount of vegetables and fruit, decent protein, sleep, etc, no amount of XYZ will catch up to that detriment. - [CE02](https://news.ycombinator.com/item?id=35056071)\n\n\u003e My real battle is doing good versus doing nothing. - [Deirdre Sullivan](https://www.npr.org/2005/08/08/4785079/always-go-to-the-funeral)\n\n[Kind Engineering](https://kind.engineering/) - How To Engineer Kindness\n\n\u003e Sometimes magic is just someone spending more time on something than anyone else might reasonably expect. - [Teller](https://www.goodreads.com/quotes/6641527-sometimes-magic-is-just-someone-spending-more-time-on-something)\n\n---\n\n## What I read in past\n\n- [[What I read in 2025|journal.what-i-read-in.2025]]\n  - [[2024|journal.what-i-read-in.2024]]\n  - [[2023|journal.what-i-read-in.2023]]\n  - [[2022|journal.what-i-read-in.2022]]\n- 📝 [Gists](https://gist.github.com/Luke-SNAW)\n- 📜 [Journals](https://luke-snaw.github.io/Luke-SNAW__netlify-CMS.github.io/)\n\n---\n\n- [[journal.what-i-struggled-brag-in]]\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":true,"vaultSelectionModeOnCreate":"smart","leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2}},"randomNote":{},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":"vault"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link","taskCompleteStatus":["done","x"]},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"enableUserTags":false,"enableHashTags":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"enableEditorDecorations":true,"maxPreviewsCached":10,"maxNoteLength":204800,"dendronVersion":"0.115.0","enableFullHierarchyNoteTitle":false,"enablePersistentHistory":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false,"enableFrontmatterTags":true,"enableHashesForFMTags":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Luke SNAW","description":"Personal knowledge space"},"github":{"enableEditLink":false,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"searchMode":"lookup","siteUrl":"https://luke-snaw.github.io/","duplicateNoteBehavior":{"action":"useVault","payload":["vault"]},"siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"jlvky3aqhg65gfidokmjqkj"},"buildId":"vOE8u-mg___OsOsz4tjEg","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>