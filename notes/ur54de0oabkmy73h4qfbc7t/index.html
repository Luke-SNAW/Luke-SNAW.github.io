<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" href="/favicon.ico"/><title>Five Tips For a Healthier Postgres Database in the New Year</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Personal knowledge space"/><meta property="og:title" content="Five Tips For a Healthier Postgres Database in the New Year"/><meta property="og:description" content="Personal knowledge space"/><meta property="og:url" content="https://luke-snaw.github.io//notes/ur54de0oabkmy73h4qfbc7t/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2/13/2023"/><meta property="article:modified_time" content="2/13/2023"/><link rel="canonical" href="https://luke-snaw.github.io//notes/ur54de0oabkmy73h4qfbc7t/"/><meta name="next-head-count" content="14"/><link rel="preload" href="/_next/static/css/8e7b7e4bce421c0a.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8e7b7e4bce421c0a.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-3d209faeb64f2f97.js" defer=""></script><script src="/_next/static/chunks/framework-28c999baf2863c3d.js" defer=""></script><script src="/_next/static/chunks/main-104451f3d1a5c4bc.js" defer=""></script><script src="/_next/static/chunks/pages/_app-9d8e0603730b15a3.js" defer=""></script><script src="/_next/static/chunks/935-4dee79e80b8641c6.js" defer=""></script><script src="/_next/static/chunks/6-50972def09142ee2.js" defer=""></script><script src="/_next/static/chunks/pages/notes/%5Bid%5D-78d472fa3b924116.js" defer=""></script><script src="/_next/static/vOE8u-mg___OsOsz4tjEg/_buildManifest.js" defer=""></script><script src="/_next/static/vOE8u-mg___OsOsz4tjEg/_ssgManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div style="display:flex" class="ant-col ant-col-xs-20 ant-col-sm-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"><div class="ant-select ant-select-lg ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-show-search" style="width:100%"><div class="ant-select-selector"><span class="ant-select-selection-search"><input type="search" autoComplete="off" class="ant-select-selection-search-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span><span class="ant-select-selection-placeholder">For full text search please use the &#x27;?&#x27; prefix. e.g. ? Onboarding</span></div></div></div><div style="display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout" style="margin-top:64px;display:flex;flex-direction:row"><div class="site-layout-sidebar" style="flex:0 0 auto;width:calc(max((100% - 992px) / 2, 0px) + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);background-color:transparent;flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></div><main class="ant-layout-content side-layout-main" style="max-width:1200px;min-width:0;display:block"><div style="padding:0 24px"><div class="main-content" role="main"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h1 id="five-tips-for-a-healthier-postgres-database-in-the-new-year">Five Tips For a Healthier Postgres Database in the New Year<a aria-hidden="true" class="anchor-heading icon-link" href="#five-tips-for-a-healthier-postgres-database-in-the-new-year"></a></h1>
<blockquote>
<p><a href="https://www.crunchydata.com/blog/five-tips-for-a-healthier-postgres-database-in-the-new-year">https://www.crunchydata.com/blog/five-tips-for-a-healthier-postgres-database-in-the-new-year</a></p>
</blockquote>
<h2 id="set-a-statement-timeout">Set a statement timeout<a aria-hidden="true" class="anchor-heading icon-link" href="#set-a-statement-timeout"></a></h2>
<p>Long running (usually unintentionally so) queries can wreck havoc on a database. They can hold up other queries, replication, or other database processes. Most applications are designed for typical queries to run in a few milliseconds. You may have long running queries for reporting, but these are best offloaded to a read replica for reporting and analytics. To prevent those long running queries you can set a <code>statement_timeout</code>:</p>
<pre class="language-sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">DATABASE</span> mydatabase <span class="token keyword">SET</span> statement_timeout <span class="token operator">=</span> <span class="token string">'60s'</span><span class="token punctuation">;</span>
</code></pre>
<p><em>For good measure you may also want to set your <code>idle_in_transaction</code> timeout as well, which will cancel long running transaction that are no longer performing work.</em></p>
<h2 id="ensure-you-have-query-tracking">Ensure you have query tracking<a aria-hidden="true" class="anchor-heading icon-link" href="#ensure-you-have-query-tracking"></a></h2>
<p>Understanding what is going on inside your database is always a good idea. Which queries are slow? Which queries are run too many times? Enter the most useful Postgres extension that exists: <code>pg_stat_statements</code>.</p>
<p>Pg_stat_statements records every query that runs against your database, parameterizes it, and then records a variety of metrics about it. That makes it easy to answer the above questions. If you don't have it installed already do it today by running:</p>
<pre class="language-sql"><code class="language-sql"><span class="token keyword">CREATE</span> EXTENSION pg_stat_statements<span class="token punctuation">;</span>
</code></pre>
<p>Once it's in place you can take a look at our <a href="https://www.crunchydata.com/blog/tentative-smarter-query-optimization-in-postgres-starts-with-pg_stat_statements">deep dive</a> on all the insights it can show you.</p>
<h2 id="log-slow-running-queries">Log slow running queries<a aria-hidden="true" class="anchor-heading icon-link" href="#log-slow-running-queries"></a></h2>
<p>While <code>pg_stat_statements</code> is useful for looking at frequently run queries or queries that may always be slow, sometimes you have extreme outlier queries. With <code>pg_stat_statements</code> you may review your queries every few months. Meanwhile your Postgres logs likely <a href="https://docs.crunchybridge.com/how-to/logging/?CrunchyAnonId=caesivkkyecnldlsqpittjuniiyazdbraadbozbw">feed into</a> some other central system that you are monitoring daily and have alerting on. Catching these slow outlier queries early can be a great canary for things you should quickly move off to a read-replica for scaling or that you should rewrite to be more efficient. You can <a href="https://www.crunchydata.com/blog/logging-tips-for-postgres-featuring-your-slow-queries">log all slow queries</a> that take over a certain time with <code>log_min_duration_statement</code>.</p>
<p>For many SaaS applications setting your <code>log_min_duration_statement</code> to something like 1 second: <code>1s</code> or even as low as 100 milliseconds: <code>100ms</code> can be a big asset.</p>
<h2 id="improve-your-connection-management">Improve your connection management<a aria-hidden="true" class="anchor-heading icon-link" href="#improve-your-connection-management"></a></h2>
<p>If you're using Rails, Django, Hibernate or any other framework/ORM you've likely set a connection pool in your application settings for your database. That connection pool is likely reducing latency in new connections to your database, but is also limiting the performance available for your database. On versions prior to Postgres 14, connections consumed extra overhead leaving <code>idle</code> connections as wasted space. The solution to this is not to replace your in app connection pooling, but rather add a server side connection pooler such as PgBouncer. With PgBouncer you're able to scale to 10s of thousands of connections with no problem. You can take a quick look at your existing database to see if PgBouncer would help:</p>
<pre class="language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
       state
<span class="token keyword">FROM</span> pg_stat_activity
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">2</span><span class="token punctuation">;</span>
</code></pre>
<p>If you see <code>idle</code> is above 20 it's recommended to explore using PgBouncer. Adding PgBouncer is often a no brainer to get better performance without any heavy refactoring required. And to make it easy if you're on <a href="https://docs.crunchybridge.com/how-to/pgbouncer/?CrunchyAnonId=caesivkkyecnldlsqpittjuniiyazdbraadbozbw">Crunchy Bridge</a> it's already available to you.</p>
<h2 id="find-your-goldilocks-range-for-indexes">Find your goldilocks range for indexes<a aria-hidden="true" class="anchor-heading icon-link" href="#find-your-goldilocks-range-for-indexes"></a></h2>
<p>There seems to be a common lifecycle of indexes within applications. First you start off with almost none, maybe a few on primary keys. Then you start adding them, one by one, two by two, until you've got quite a few indexes for most any query you can run. Something is slow? Throw an index at it. What you end up with is some contention on overall throughput of your database, and well a lot of indexes that became a tangled ball of yarn over time.</p>
<p>We've got a slew of write-ups and guides on indexes and unfortunately there isn't a "this is your one thing to read and your done". But a few key things and you can be in a better place:</p>
<ul>
<li><a href="https://www.crunchydata.com/blog/three-easy-things-to-remember-about-postgres-indexes">A primer on indexes</a></li>
<li><a href="https://www.crunchydata.com/blog/cleaning-up-your-postgres-database">Check for unused indexes</a></li>
<li><a href="https://learn.crunchydata.com/postgresql-devel/courses/basics/indextypes">Index types in Postgres</a></li>
<li><a href="https://learn.crunchydata.com/postgresql-devel/courses/basics/introindex">A starter lesson on indexes</a></li>
</ul>
<h2 id="heres-to-less-database-problems-in-2022">Here's to less database problems in 2022<a aria-hidden="true" class="anchor-heading icon-link" href="#heres-to-less-database-problems-in-2022"></a></h2>
<p>Our goal at Crunchy is to make Postgres great. One part of that is helping our customers understand their database and providing them with support and guidance for all their Postgres needs.</p>
<p>With <a href="https://www.crunchydata.com/products/crunchy-bridge/">Crunchy Bridge</a> we're working towards making all of the above easier, so it's one less thing you have to worry about. We've already had customers migrate and see <a href="https://www.crunchydata.com/case-studies/rival-iq/">3-5x performance improvement</a> over their existing cloud providers. We know if you're here you're already a fan of Postgres. In this coming year we look forward to making the developer experience of Postgres better than it's ever been.</p>
<hr>
<h2 id="pg_stat_statements-is-not-free"><a href="https://news.ycombinator.com/item?id=34754445">pg_stat_statements is not free</a><a aria-hidden="true" class="anchor-heading icon-link" href="#pg_stat_statements-is-not-free"></a></h2>
<p>pg_stat_statements is useful, but it isn't completely free, e.g. <a href="https://www.alibabacloud.com/blog/postgresql-v12-how-pg-stat-statements-causes-high-concurrency-performance-issues_597790">https://www.alibabacloud.com/blog/postgresql-v12-how-pg-stat-statements-causes-high-concurrency-performance-issues_597790</a> (admittedly from pg12, which is three major versions ago).</p>
<p>Most people should probably leave it enabled, but if you have a database with a very defined and understood query pattern, then it might be worth running <em>perf</em> and checking if it is costing you.</p></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#set-a-statement-timeout" title="Set a statement timeout">Set a statement timeout</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#ensure-you-have-query-tracking" title="Ensure you have query tracking">Ensure you have query tracking</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#log-slow-running-queries" title="Log slow running queries">Log slow running queries</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#improve-your-connection-management" title="Improve your connection management">Improve your connection management</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#find-your-goldilocks-range-for-indexes" title="Find your goldilocks range for indexes">Find your goldilocks range for indexes</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#heres-to-less-database-problems-in-2022" title="Here&#x27;s to less database problems in 2022">Here&#x27;s to less database problems in 2022</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#pg_stat_statements-is-not-free" title="pg_stat_statements is not free">pg_stat_statements is not free</a></div></div></div></div></div></div></div></div></div></div></div><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></main></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"ur54de0oabkmy73h4qfbc7t","title":"Five Tips For a Healthier Postgres Database in the New Year","desc":"","updated":1676252268292,"created":1676252126029,"custom":{},"fname":"dev.DB.postgres.five-tips-for-a-healthier-postgres-database-in-the-new-year","type":"note","vault":{"fsPath":"vault"},"contentHash":"6210eb162cd5fdf82bbf915e89e8b0d6","links":[],"anchors":{"set-a-statement-timeout":{"type":"header","text":"Set a statement timeout","value":"set-a-statement-timeout","line":10,"column":0,"depth":2},"ensure-you-have-query-tracking":{"type":"header","text":"Ensure you have query tracking","value":"ensure-you-have-query-tracking","line":20,"column":0,"depth":2},"log-slow-running-queries":{"type":"header","text":"Log slow running queries","value":"log-slow-running-queries","line":32,"column":0,"depth":2},"improve-your-connection-management":{"type":"header","text":"Improve your connection management","value":"improve-your-connection-management","line":38,"column":0,"depth":2},"find-your-goldilocks-range-for-indexes":{"type":"header","text":"Find your goldilocks range for indexes","value":"find-your-goldilocks-range-for-indexes","line":51,"column":0,"depth":2},"heres-to-less-database-problems-in-2022":{"type":"header","text":"Here's to less database problems in 2022","value":"heres-to-less-database-problems-in-2022","line":62,"column":0,"depth":2},"pg_stat_statements-is-not-free":{"type":"header","text":"pg_stat_statements is not free","value":"pg_stat_statements-is-not-free","line":70,"column":0,"depth":2}},"children":[],"parent":"xyg5ao6vugkef44ahxssq60","data":{}},"body":"\u003ch1 id=\"five-tips-for-a-healthier-postgres-database-in-the-new-year\"\u003eFive Tips For a Healthier Postgres Database in the New Year\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#five-tips-for-a-healthier-postgres-database-in-the-new-year\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://www.crunchydata.com/blog/five-tips-for-a-healthier-postgres-database-in-the-new-year\"\u003ehttps://www.crunchydata.com/blog/five-tips-for-a-healthier-postgres-database-in-the-new-year\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"set-a-statement-timeout\"\u003eSet a statement timeout\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#set-a-statement-timeout\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eLong running (usually unintentionally so) queries can wreck havoc on a database. They can hold up other queries, replication, or other database processes. Most applications are designed for typical queries to run in a few milliseconds. You may have long running queries for reporting, but these are best offloaded to a read replica for reporting and analytics. To prevent those long running queries you can set a \u003ccode\u003estatement_timeout\u003c/code\u003e:\u003c/p\u003e\n\u003cpre class=\"language-sql\"\u003e\u003ccode class=\"language-sql\"\u003e\u003cspan class=\"token keyword\"\u003eALTER\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eDATABASE\u003c/span\u003e mydatabase \u003cspan class=\"token keyword\"\u003eSET\u003c/span\u003e statement_timeout \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'60s'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cem\u003eFor good measure you may also want to set your \u003ccode\u003eidle_in_transaction\u003c/code\u003e timeout as well, which will cancel long running transaction that are no longer performing work.\u003c/em\u003e\u003c/p\u003e\n\u003ch2 id=\"ensure-you-have-query-tracking\"\u003eEnsure you have query tracking\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#ensure-you-have-query-tracking\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eUnderstanding what is going on inside your database is always a good idea. Which queries are slow? Which queries are run too many times? Enter the most useful Postgres extension that exists: \u003ccode\u003epg_stat_statements\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003ePg_stat_statements records every query that runs against your database, parameterizes it, and then records a variety of metrics about it. That makes it easy to answer the above questions. If you don't have it installed already do it today by running:\u003c/p\u003e\n\u003cpre class=\"language-sql\"\u003e\u003ccode class=\"language-sql\"\u003e\u003cspan class=\"token keyword\"\u003eCREATE\u003c/span\u003e EXTENSION pg_stat_statements\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOnce it's in place you can take a look at our \u003ca href=\"https://www.crunchydata.com/blog/tentative-smarter-query-optimization-in-postgres-starts-with-pg_stat_statements\"\u003edeep dive\u003c/a\u003e on all the insights it can show you.\u003c/p\u003e\n\u003ch2 id=\"log-slow-running-queries\"\u003eLog slow running queries\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#log-slow-running-queries\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eWhile \u003ccode\u003epg_stat_statements\u003c/code\u003e is useful for looking at frequently run queries or queries that may always be slow, sometimes you have extreme outlier queries. With \u003ccode\u003epg_stat_statements\u003c/code\u003e you may review your queries every few months. Meanwhile your Postgres logs likely \u003ca href=\"https://docs.crunchybridge.com/how-to/logging/?CrunchyAnonId=caesivkkyecnldlsqpittjuniiyazdbraadbozbw\"\u003efeed into\u003c/a\u003e some other central system that you are monitoring daily and have alerting on. Catching these slow outlier queries early can be a great canary for things you should quickly move off to a read-replica for scaling or that you should rewrite to be more efficient. You can \u003ca href=\"https://www.crunchydata.com/blog/logging-tips-for-postgres-featuring-your-slow-queries\"\u003elog all slow queries\u003c/a\u003e that take over a certain time with \u003ccode\u003elog_min_duration_statement\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eFor many SaaS applications setting your \u003ccode\u003elog_min_duration_statement\u003c/code\u003e to something like 1 second: \u003ccode\u003e1s\u003c/code\u003e or even as low as 100 milliseconds: \u003ccode\u003e100ms\u003c/code\u003e can be a big asset.\u003c/p\u003e\n\u003ch2 id=\"improve-your-connection-management\"\u003eImprove your connection management\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#improve-your-connection-management\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eIf you're using Rails, Django, Hibernate or any other framework/ORM you've likely set a connection pool in your application settings for your database. That connection pool is likely reducing latency in new connections to your database, but is also limiting the performance available for your database. On versions prior to Postgres 14, connections consumed extra overhead leaving \u003ccode\u003eidle\u003c/code\u003e connections as wasted space. The solution to this is not to replace your in app connection pooling, but rather add a server side connection pooler such as PgBouncer. With PgBouncer you're able to scale to 10s of thousands of connections with no problem. You can take a quick look at your existing database to see if PgBouncer would help:\u003c/p\u003e\n\u003cpre class=\"language-sql\"\u003e\u003ccode class=\"language-sql\"\u003e\u003cspan class=\"token keyword\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"token function\"\u003ecount\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n       state\n\u003cspan class=\"token keyword\"\u003eFROM\u003c/span\u003e pg_stat_activity\n\u003cspan class=\"token keyword\"\u003eGROUP\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eBY\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIf you see \u003ccode\u003eidle\u003c/code\u003e is above 20 it's recommended to explore using PgBouncer. Adding PgBouncer is often a no brainer to get better performance without any heavy refactoring required. And to make it easy if you're on \u003ca href=\"https://docs.crunchybridge.com/how-to/pgbouncer/?CrunchyAnonId=caesivkkyecnldlsqpittjuniiyazdbraadbozbw\"\u003eCrunchy Bridge\u003c/a\u003e it's already available to you.\u003c/p\u003e\n\u003ch2 id=\"find-your-goldilocks-range-for-indexes\"\u003eFind your goldilocks range for indexes\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#find-your-goldilocks-range-for-indexes\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eThere seems to be a common lifecycle of indexes within applications. First you start off with almost none, maybe a few on primary keys. Then you start adding them, one by one, two by two, until you've got quite a few indexes for most any query you can run. Something is slow? Throw an index at it. What you end up with is some contention on overall throughput of your database, and well a lot of indexes that became a tangled ball of yarn over time.\u003c/p\u003e\n\u003cp\u003eWe've got a slew of write-ups and guides on indexes and unfortunately there isn't a \"this is your one thing to read and your done\". But a few key things and you can be in a better place:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.crunchydata.com/blog/three-easy-things-to-remember-about-postgres-indexes\"\u003eA primer on indexes\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.crunchydata.com/blog/cleaning-up-your-postgres-database\"\u003eCheck for unused indexes\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://learn.crunchydata.com/postgresql-devel/courses/basics/indextypes\"\u003eIndex types in Postgres\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://learn.crunchydata.com/postgresql-devel/courses/basics/introindex\"\u003eA starter lesson on indexes\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"heres-to-less-database-problems-in-2022\"\u003eHere's to less database problems in 2022\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#heres-to-less-database-problems-in-2022\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eOur goal at Crunchy is to make Postgres great. One part of that is helping our customers understand their database and providing them with support and guidance for all their Postgres needs.\u003c/p\u003e\n\u003cp\u003eWith \u003ca href=\"https://www.crunchydata.com/products/crunchy-bridge/\"\u003eCrunchy Bridge\u003c/a\u003e we're working towards making all of the above easier, so it's one less thing you have to worry about. We've already had customers migrate and see \u003ca href=\"https://www.crunchydata.com/case-studies/rival-iq/\"\u003e3-5x performance improvement\u003c/a\u003e over their existing cloud providers. We know if you're here you're already a fan of Postgres. In this coming year we look forward to making the developer experience of Postgres better than it's ever been.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"pg_stat_statements-is-not-free\"\u003e\u003ca href=\"https://news.ycombinator.com/item?id=34754445\"\u003epg_stat_statements is not free\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#pg_stat_statements-is-not-free\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003epg_stat_statements is useful, but it isn't completely free, e.g. \u003ca href=\"https://www.alibabacloud.com/blog/postgresql-v12-how-pg-stat-statements-causes-high-concurrency-performance-issues_597790\"\u003ehttps://www.alibabacloud.com/blog/postgresql-v12-how-pg-stat-statements-causes-high-concurrency-performance-issues_597790\u003c/a\u003e (admittedly from pg12, which is three major versions ago).\u003c/p\u003e\n\u003cp\u003eMost people should probably leave it enabled, but if you have a database with a very defined and understood query pattern, then it might be worth running \u003cem\u003eperf\u003c/em\u003e and checking if it is costing you.\u003c/p\u003e","noteIndex":{"id":"Iy0MoL0KnL55Br3AfTS2C","title":"Luke","desc":"","updated":1761796791487,"created":1644449449778,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":"vault"},"contentHash":"4e745570ca97988a0362cb939b760952","links":[{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"life-tips","position":{"start":{"line":41,"column":5,"offset":2603},"end":{"line":41,"column":29,"offset":2627},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"life-tips","anchorHeader":"wodenokoto"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"journal.what-i-read-in.2025","alias":"What I read in 2025","position":{"start":{"line":70,"column":3,"offset":4333},"end":{"line":70,"column":54,"offset":4384},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"journal.what-i-read-in.2025"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"journal.what-i-read-in.2024","alias":"2024","position":{"start":{"line":71,"column":5,"offset":4389},"end":{"line":71,"column":41,"offset":4425},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"journal.what-i-read-in.2024"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"journal.what-i-read-in.2023","alias":"2023","position":{"start":{"line":72,"column":5,"offset":4430},"end":{"line":72,"column":41,"offset":4466},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"journal.what-i-read-in.2023"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"journal.what-i-read-in.2022","alias":"2022","position":{"start":{"line":73,"column":5,"offset":4471},"end":{"line":73,"column":41,"offset":4507},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"journal.what-i-read-in.2022"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"journal.what-i-struggled-brag-in","position":{"start":{"line":79,"column":3,"offset":4643},"end":{"line":79,"column":39,"offset":4679},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"journal.what-i-struggled-brag-in"}}],"anchors":{"what-i-read-in-past":{"type":"header","text":"What I read in past","value":"what-i-read-in-past","line":74,"column":0,"depth":2}},"children":["zd4mq442jike0pr0wba1u3m","6hzeqsofq67gdk88flxlkhp","778ijii93yu5uwnrwmn5zi4","g1fngdjl25nes6fs3lip602","ZbdkdApFqLdks4Moq92R9","uoc5hhki3o4py15cesddu8q","9qf7j06jtdkm6rnx9ymvwb0","5zn10cvj7ajy2gh2is5nqmg","4qo9ma0z0yu1czns6pxl7y5","ok0e729ho7o09xetujkxc0m","GR5x8HnNFEN6fU2UBSEIK","yirtnlj8q24yutcf3ss1xqy","eq0wc6t7wl2wv221yb68ro4","7x2fnv4j6gxts08qk0jguny","ettkt3iClONnxpbGwBVLl","7l4knev6v613tbuoskvmbdg","hvh5bud6yp7dc89tuh95tr9","4fvoqrplw0cweo554usbjos","f8qsfql0a9v8thpeo82udfa","1swsbrhqi9jk41v9eodyi5q","SQqYupi6EFddTerBA8RRD","hjNeNc1F2JUh0lTWanH4h","qf0l4wbrc9jgooyzexmbq5v","uur1lkol353z9vfeqb3n5bv","cd9n1czq3ursgkby985wkmm","k1sr43vwnfqztwc0s43pkcf","wfde75rhdvq2yfa2zy2q6rv","rjcmdv60jokmbw6zoq8u2ef","ujapvww8o6v3kpmlhtryq4k","pkwewou9d5e8ystswn1j2b4"],"parent":null,"data":{},"body":"\nHi there 👋. I'm a Front-end developer.\n\n---\n\n- 단순함과 꾸준함은 가장 쉬우면서도 지키기 어려운 원칙.\n\n- 🥱 -\u003e 🤔💡🌱 - [On The Death of Daydreaming](https://www.afterbabel.com/p/on-the-death-of-daydreaming)\n  - boredom -\u003e easy fun -\u003e art -\u003e profit?\n\n\u003e I've often described my motivation for building software to others using imagery: I like to go find a secluded beach, build a large, magnificent sand castle, and then walk away. Will anyone notice? Probably not. Will the waves eventually destroy it? Yep. Did I still get immense satisfaction? Absolutely. - [aliasxneo](https://news.ycombinator.com/item?id=41497113)\n\n\u003e We love to see the process, not just the result. The imperfections in your work can be beautiful if they show your struggle for perfection, not a lack of care. - [ralphammer](https://ralphammer.com/is-perfection-boring/)\n\n\u003e Simplicity, even if it sacrifices some ideal functionality has better survival characteristics than the-right-thing. - [The Rise of Worse is Better](https://www.dreamsongs.com/RiseOfWorseIsBetter.html)\n\n\u003e [Roberto Blake was talking about making 100 crappy videos](https://www.youtube.com/watch?v=OnUBaQ1Sp_E) to get better over time. Putting in the reps and improving a little bit each time.\n\u003e\n\u003e Putting in the work without expecting any external reward at first (eg views, followers, likes, etc) will pay off in the long run. - [100 Scrappy Things](https://www.florin-pop.com/blog/100-scrappy-things/)\n\n\u003e Make the difficult habitual, the habitual easy, and the easy beautiful. - [Constantin S. Stanislavski](https://www.goodreads.com/quotes/7102271-make-the-difficult-habitual-the-habitual-easy-and-the-easy)\n\n\u003e A good match is a **structured** dance, where players aim to **score** while they are following well-defined **rules**. This **freedom within a structure** is what makes it fun. - [ralphammer](https://ralphammer.com/how-to-get-started/)\n\n- [Pivot Points](https://longform.asmartbear.com/pivot-points/)\n\n  - non-judgmental aspects of personality that can be strengths in some contexts and weaknesses in others\n  - Pivot Points are fixed in the short term\n\n- [Hedged Bets](https://longform.asmartbear.com/predict-the-future/#hedged-bets)\n  - trading slightly less maximum upside for predictable, net-positive outcomes.\n\n\u003e “Motivation often comes after starting, not before. Action produces momentum.”\n\u003e [When you start a new habit, it should take less than two minutes to do.](https://jamesclear.com/how-to-stop-procrastinating)\n\u003e\n\u003e - James Clear\n\n\u003e Focus is more about **not** keeping busy when you need to wait for something.  \n\u003e Eat the boredom for a minute.\n\u003e\n\u003e - [[life-tips#wodenokoto]]\n\n\u003e [4 minutes run hard enough to push heart rate to 90%, 3 minutes recover, repeat 4 times](https://news.ycombinator.com/item?id=34213181)\n\u003e\n\u003e - https://www.ntnu.edu/cerg/advice\n\u003e - [Get running with Couch to 5K](https://www.nhs.uk/live-well/exercise/running-and-aerobic-exercises/get-running-with-couch-to-5k/)\n\n\u003e [recommended routine - bodyweightfitness](https://www.reddit.com/r/bodyweightfitness/wiki/kb/recommended_routine/) - I Don't Have This Much Time!\n\u003e\n\u003e - Don't workout at all (saves anywhere from 20 to 60 minutes, but really, really, really, really, really, really, really, really, really not recommended)\n\n\u003e 도무지 읽히지 않는 책 앞에서 내가 택한 방법은 펼쳐진 페이지 앞에서 멍때리기이다. 다르게 표현하면 이렇다. 펼쳐진 두 페이지 앞에서 오래 머물기.\n\u003e\n\u003e 책을 펼쳐놓는 것으로 충분하다. 읽지 못해도 좋다. 매일 정해진 진도를 나가야 하는 학교 수업이 아니니까. 하지만 읽지 않아도 괜찮다고 해서 펼쳐두지조차 않으면 곤란하다. 가능한 한 자주 책을 펼쳐두도록 하자. 전혀 읽지 않고 멍하니 바라보고 있다가 다시 덮게 되더라도\n\u003e\n\u003e - 막막한 독서. 시로군. P.10~13\n\n\u003e I think it should be everyone's primary focus to sleep well, drink water, get outside, get active, and eat generally decently. I hate to say it, but if you're not eating a good amount of vegetables and fruit, decent protein, sleep, etc, no amount of XYZ will catch up to that detriment. - [CE02](https://news.ycombinator.com/item?id=35056071)\n\n\u003e My real battle is doing good versus doing nothing. - [Deirdre Sullivan](https://www.npr.org/2005/08/08/4785079/always-go-to-the-funeral)\n\n[Kind Engineering](https://kind.engineering/) - How To Engineer Kindness\n\n\u003e Sometimes magic is just someone spending more time on something than anyone else might reasonably expect. - [Teller](https://www.goodreads.com/quotes/6641527-sometimes-magic-is-just-someone-spending-more-time-on-something)\n\n---\n\n## What I read in past\n\n- [[What I read in 2025|journal.what-i-read-in.2025]]\n  - [[2024|journal.what-i-read-in.2024]]\n  - [[2023|journal.what-i-read-in.2023]]\n  - [[2022|journal.what-i-read-in.2022]]\n- 📝 [Gists](https://gist.github.com/Luke-SNAW)\n- 📜 [Journals](https://luke-snaw.github.io/Luke-SNAW__netlify-CMS.github.io/)\n\n---\n\n- [[journal.what-i-struggled-brag-in]]\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":true,"vaultSelectionModeOnCreate":"smart","leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2}},"randomNote":{},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":"vault"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link","taskCompleteStatus":["done","x"]},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"enableUserTags":false,"enableHashTags":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"enableEditorDecorations":true,"maxPreviewsCached":10,"maxNoteLength":204800,"dendronVersion":"0.115.0","enableFullHierarchyNoteTitle":false,"enablePersistentHistory":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false,"enableFrontmatterTags":true,"enableHashesForFMTags":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Luke SNAW","description":"Personal knowledge space"},"github":{"enableEditLink":false,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"searchMode":"lookup","siteUrl":"https://luke-snaw.github.io/","duplicateNoteBehavior":{"action":"useVault","payload":["vault"]},"siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"ur54de0oabkmy73h4qfbc7t"},"buildId":"vOE8u-mg___OsOsz4tjEg","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>