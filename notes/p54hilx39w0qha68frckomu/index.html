<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" href="/favicon.ico"/><title>PIDs: Creating Stable Control in Games</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Personal knowledge space"/><meta property="og:title" content="PIDs: Creating Stable Control in Games"/><meta property="og:description" content="Personal knowledge space"/><meta property="og:url" content="https://luke-snaw.github.io//notes/p54hilx39w0qha68frckomu/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="1/17/2024"/><meta property="article:modified_time" content="1/17/2024"/><link rel="canonical" href="https://luke-snaw.github.io//notes/p54hilx39w0qha68frckomu/"/><meta name="next-head-count" content="14"/><link rel="preload" href="/_next/static/css/8e7b7e4bce421c0a.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8e7b7e4bce421c0a.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-3d209faeb64f2f97.js" defer=""></script><script src="/_next/static/chunks/framework-28c999baf2863c3d.js" defer=""></script><script src="/_next/static/chunks/main-104451f3d1a5c4bc.js" defer=""></script><script src="/_next/static/chunks/pages/_app-9d8e0603730b15a3.js" defer=""></script><script src="/_next/static/chunks/935-4dee79e80b8641c6.js" defer=""></script><script src="/_next/static/chunks/6-50972def09142ee2.js" defer=""></script><script src="/_next/static/chunks/pages/notes/%5Bid%5D-78d472fa3b924116.js" defer=""></script><script src="/_next/static/wirstT2ztC8OQsbzKjhvw/_buildManifest.js" defer=""></script><script src="/_next/static/wirstT2ztC8OQsbzKjhvw/_ssgManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div style="display:flex" class="ant-col ant-col-xs-20 ant-col-sm-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"><div class="ant-select ant-select-lg ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-show-search" style="width:100%"><div class="ant-select-selector"><span class="ant-select-selection-search"><input type="search" autoComplete="off" class="ant-select-selection-search-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span><span class="ant-select-selection-placeholder">For full text search please use the &#x27;?&#x27; prefix. e.g. ? Onboarding</span></div></div></div><div style="display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout" style="margin-top:64px;display:flex;flex-direction:row"><div class="site-layout-sidebar" style="flex:0 0 auto;width:calc(max((100% - 992px) / 2, 0px) + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);background-color:transparent;flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></div><main class="ant-layout-content side-layout-main" style="max-width:1200px;min-width:0;display:block"><div style="padding:0 24px"><div class="main-content" role="main"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h1 id="pids-creating-stable-control-in-games">PIDs: Creating Stable Control in Games<a aria-hidden="true" class="anchor-heading icon-link" href="#pids-creating-stable-control-in-games"></a></h1>
<blockquote>
<p><a href="https://azeemba.com/posts/pids-creating-stable-control-in-games.html">https://azeemba.com/posts/pids-creating-stable-control-in-games.html</a><br>
Using a game use-case to motivate and explain PIDs<br>
January 15, 2024Â Â·Â 7 min</p>
</blockquote>
<p>Your browser does not support HTML5 video.</p>
<p>Experiments I did for implementing tag plays in <a href="https://theumpshow.com/">The Ump Show</a>. For the tag play to work, the runner has to arrive at the plate at a very specific time.</p>
<p>I am working on a <a href="https://theumpshow.com/">baseball video game</a> with 3D characters. Sometimes the characters need to move and they need to get to specific locations at specific times. But thatâ€™s tricky to do.</p>
<p>The problem is that the character runs via animation. Similar to how humans run, forward speed changes throughout the characterâ€™s running stride. Unlike how humans run though, animation is choppy. Each frame of the animation jumps from one position to the next. This choppiness can also be frame-rate dependent. Depending on the frame rate, animations can be interpolated differently, yielding slightly different forward speeds.</p>
<p>Your browser does not support HTML5 video.</p>
<p>Two characters using the same animation but the character with longer legs is faster.</p>
<p>Additionally, the animation will also yield different forward speeds for different characters. Characters with longer legs will move faster for the same animation than characters with shorter legs.</p>
<p>The forward speed controls when we arrive at our target. And we can control the forward speed by controlling the animation speed. But because of the non-uniform speed through a stride, the frame-dependent interpolation, and the character dependence, the animation speed is a noisy controller for the forward speed. Making a 10% change in the animation speed may not necessarily yield a 10% change in the forward speed.</p>
<p>So how can we use our noisy control (animation speed) to finely control the arrival time of the character?</p>
<h2 id="proportional-control">Proportional Control<a href="https://azeemba.com/posts/pids-creating-stable-control-in-games.html#proportional-control">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#proportional-control"></a></h2>
<p>The first step we can take is to add a proportional control. We check our current trajectory and see if we will arrive early or late. If we are going to arrive early, we can slow down by some factor. If we are going to arrive late, then we can speed up by some factor. Letâ€™s call the proportional factor <code>P</code>.</p>
<pre class="language-sh"><code class="language-sh">current_error = target_value - current_value
adjustment = P*current_error
</code></pre>
<p><a href="https://azeemba.com/posts/pids-creating-stable-control-in-games/PID-POnly.png">PID-POnly</a></p>
<p>Behavior of the proprotional control. The y-axis shows the expected error which we want to go to 0. In this example, the proportional factor was too large so we see the error swinging back and forth wildly as the runner speeds up and slows down repeatedly.</p>
<p>One problem here is how should we pick the factor. If the factor is too small, then we will be too slow to adjust. If the factor is too big, then we will overshoot.</p>
<p>Worse, the factor has to be different for different characters. As we established earlier, different characters are affected by the animation differently. And different adjustments to the animation speed will impact different characters differently as well.</p>
<p>So ideally we want to pick a â€œclose enoughâ€ factor and have something else clean up the edge cases for us. Thatâ€™s where the <code>I</code> term comes in.</p>
<h2 id="integral-control">Integral Control<a href="https://azeemba.com/posts/pids-creating-stable-control-in-games.html#integral-control">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#integral-control"></a></h2>
<p>Suppose you picked a proportional factor thatâ€™s too low and the controls are not making adjustments fast enough. We can try to detect this situation and automatically push the adjustment in the needed direction.</p>
<p>For example, we can track the historical error by accumulating the error at each measurement. We can use the accumulated error and adjust the speed by another factor. As the accumulated error grows, we make a more aggressive adjustment. Since the accumulated error can be seen as an integral, we can call this factor the integral factor (or <code>I</code>).</p>
<pre class="language-sh"><code class="language-sh">historical_error += current_error
adjustment = P*current_error + I*historical_error
</code></pre>
<p><a href="https://azeemba.com/posts/pids-creating-stable-control-in-games/PID-IOnly.png">PID-IOnly</a></p>
<p>To more clearly see the effects of the integral controller, this graph shows the behavior of a solo integral controller. While this shrinks the error faster, it still overshoots the target. This will result in the runner speeding up and slowing down a lot.</p>
<p>When we add the proportional and the integral controls, what we will see is that the integral factor will help the controller make faster adjustments but it will <em>always</em> overshoot the target. Since the accumulated error will not clear out till you start accumulating error in the other direction, the integral factor will always push you to go past the target to accumulate more error.</p>
<p>Thatâ€™s where the D term can help us.</p>
<h2 id="derivative-control">Derivative Control<a href="https://azeemba.com/posts/pids-creating-stable-control-in-games.html#derivative-control">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#derivative-control"></a></h2>
<p>The only remaining problem is to deal with the overshoot. To prevent overshoot, we can start by predicting the overshoot. We can look at the current change in error and use that to predict what the next error term will be. We can do that just by looking at the difference between the previous and current error and assuming that the same change will happen again (this is kinda like approximating the derivative).</p>
<p>If we see that we are going to overshoot, we can add yet one more scaling factor to resist the overshoot. We can call this factor the â€œderivativeâ€ factor (or <code>D</code>). We use the time between the current measurement and the previous measurement as <code>dt</code>.</p>
<pre class="language-sh"><code class="language-sh">future_error = (current_error - prev_error)/dt
adjustment = P*current_error
         + I*historical_error
         + D*future_error
</code></pre>
<h2 id="using-pids">Using PIDs<a href="https://azeemba.com/posts/pids-creating-stable-control-in-games.html#using-pids">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#using-pids"></a></h2>
<p>At this point, we have fully derived PID controllers. PID controllers combine historical behavior, current error, and future prediction to adjust the controls of a system. PIDs help you figure out adjustments needed to push a system to a desired state.</p>
<p>To use it though, we still have to decide how to actually use the adjustment value and have to pick the values for <code>P</code>, <code>I</code>, and <code>D</code>.</p>
<p>Since the adjustment value will naturally be negative when the error is in one direction and positive in the other, it is useful to treat adjustment as a number that can be both. To simplify the handling of the adjustment, we can restrict the number to be between -1 and 1. Any scaling that needs to be done can be done by us.</p>
<p>So we can use the adjustment this way:</p>
<pre class="language-sh"><code class="language-sh">// normalized will be between 0 and 1
normalized = 0.5 + 0.5*adjustment
new_speed = max_speed*normalized
</code></pre>
<p>Since normalized will be between 0 and 1, <code>new_speed</code> will always be between 0 and <code>max_speed</code>.</p>
<p>Now we are in a place where we can start testing to pick the correct values for our factors. For my use case, I found that the derivative term was very noisy. In real physical systems, the derivatives are smoother but here I was working with artificial animation that is not as smooth. So to keep the derivative term in check, I set <code>D</code> to be very small - on the order of <code>1/1,000</code>. So the <code>D</code> term would only come into play when there is severe overshoot.</p>
<p>I didnâ€™t want any adjustment to be very sudden so I set <code>P</code> to be around <code>1/20</code> to <code>1/10</code>. This basically meant that the proportional reaction was limited to 5% to 10%. To make sure that we did reach our target though, I set the <code>I</code> term to be around the same range of <code>1/10</code>. This meant that the animation made small adjustments and became more aggressive if the error accumulated.</p>
<p><a href="https://azeemba.com/posts/pids-creating-stable-control-in-games/PID-All3.png">PID-All3</a></p>
<p>Final behavior of the tuned PID controller. The smaller P and I values reduce the overshoot a lot. We get to an error of less than a foot by the middle of the run and the error continues to get smaller after that.</p>
<p>In the end, I was able to get the animation to have the same accuracy as the frequency of my adjustments. I decided to make adjustments every 100msâ€“I didnâ€™t want to make adjustments any more frequently to avoid jarring changes in the animation.</p>
<h2 id="pids">PIDs<a href="https://azeemba.com/posts/pids-creating-stable-control-in-games.html#pids">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#pids"></a></h2>
<p>PIDs are very commonly used in systems that need to adapt. This can be cruise control in cars that need to adjust power when going uphill, robots that need to react to a push, or industrial systems that need to adapt to the changing behavior of different subsystems.</p>
<p>Despite its apparent simplicity, PIDs werenâ€™t <a href="https://en.wikipedia.org/wiki/Proportional%E2%80%93integral%E2%80%93derivative_controller#Origins">formulated</a> in this form till the early 1900s. They were designed to capture the intuition of sailors steering a shipâ€“the sailors would steer accounting for the current error but would also account for past and future errors to make adjustments. I love how well PIDs capture that intuition.</p>
<p>When I faced my original problem, I vaguely knew that I wanted to make adjustments to the speed based on the current error but I could quickly come up with more and more edge cases that I would have to handle individually. This would have been a very brittle approach. PIDs allowed me to implement a much more flexible solution that is also simpler than what I would have done.</p>
<p>No wonder they are used so frequently.</p>
<h2 id="other-resources">Other Resources<a href="https://azeemba.com/posts/pids-creating-stable-control-in-games.html#other-resources">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#other-resources"></a></h2>
<ul>
<li><a href="https://vazgriz.com/621/pid-controllers/">Vazgriz - PID Controllers in Unity3D</a> is a beautiful blog post with visualizations of PIDs in action.</li>
<li><a href="https://en.wikipedia.org/wiki/Proportional%E2%80%93integral%E2%80%93derivative_controller">Wikipedia</a> highlights the more general use cases in industrial systems.</li>
</ul></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#proportional-control" title="Proportional Control#">Proportional Control#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#integral-control" title="Integral Control#">Integral Control#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#derivative-control" title="Derivative Control#">Derivative Control#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#using-pids" title="Using PIDs#">Using PIDs#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#pids" title="PIDs#">PIDs#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#other-resources" title="Other Resources#">Other Resources#</a></div></div></div></div></div></div></div></div></div></div></div><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></main></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"p54hilx39w0qha68frckomu","title":"PIDs: Creating Stable Control in Games","desc":"","updated":1705478346027,"created":1705478235038,"custom":{},"fname":"dev.software-engineering.pids-creating-stable-control-in-games","type":"note","vault":{"fsPath":"vault"},"contentHash":"221d526c63c40a0c4dd24a6a44c627e1","links":[],"anchors":{"proportional-control":{"type":"header","text":"Proportional Control#","value":"proportional-control","line":30,"column":0,"depth":2},"integral-control":{"type":"header","text":"Integral Control#","value":"integral-control","line":49,"column":0,"depth":2},"derivative-control":{"type":"header","text":"Derivative Control#","value":"derivative-control","line":68,"column":0,"depth":2},"using-pids":{"type":"header","text":"Using PIDs#","value":"using-pids","line":81,"column":0,"depth":2},"pids":{"type":"header","text":"PIDs#","value":"pids","line":109,"column":0,"depth":2},"other-resources":{"type":"header","text":"Other Resources#","value":"other-resources","line":119,"column":0,"depth":2}},"children":[],"parent":"j0N1aVKxe96dktmyADG9U","data":{}},"body":"\u003ch1 id=\"pids-creating-stable-control-in-games\"\u003ePIDs: Creating Stable Control in Games\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#pids-creating-stable-control-in-games\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://azeemba.com/posts/pids-creating-stable-control-in-games.html\"\u003ehttps://azeemba.com/posts/pids-creating-stable-control-in-games.html\u003c/a\u003e\u003cbr\u003e\nUsing a game use-case to motivate and explain PIDs\u003cbr\u003e\nJanuary 15, 2024Â Â·Â 7 min\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eYour browser does not support HTML5 video.\u003c/p\u003e\n\u003cp\u003eExperiments I did for implementing tag plays in \u003ca href=\"https://theumpshow.com/\"\u003eThe Ump Show\u003c/a\u003e. For the tag play to work, the runner has to arrive at the plate at a very specific time.\u003c/p\u003e\n\u003cp\u003eI am working on a \u003ca href=\"https://theumpshow.com/\"\u003ebaseball video game\u003c/a\u003e with 3D characters. Sometimes the characters need to move and they need to get to specific locations at specific times. But thatâ€™s tricky to do.\u003c/p\u003e\n\u003cp\u003eThe problem is that the character runs via animation. Similar to how humans run, forward speed changes throughout the characterâ€™s running stride. Unlike how humans run though, animation is choppy. Each frame of the animation jumps from one position to the next. This choppiness can also be frame-rate dependent. Depending on the frame rate, animations can be interpolated differently, yielding slightly different forward speeds.\u003c/p\u003e\n\u003cp\u003eYour browser does not support HTML5 video.\u003c/p\u003e\n\u003cp\u003eTwo characters using the same animation but the character with longer legs is faster.\u003c/p\u003e\n\u003cp\u003eAdditionally, the animation will also yield different forward speeds for different characters. Characters with longer legs will move faster for the same animation than characters with shorter legs.\u003c/p\u003e\n\u003cp\u003eThe forward speed controls when we arrive at our target. And we can control the forward speed by controlling the animation speed. But because of the non-uniform speed through a stride, the frame-dependent interpolation, and the character dependence, the animation speed is a noisy controller for the forward speed. Making a 10% change in the animation speed may not necessarily yield a 10% change in the forward speed.\u003c/p\u003e\n\u003cp\u003eSo how can we use our noisy control (animation speed) to finely control the arrival time of the character?\u003c/p\u003e\n\u003ch2 id=\"proportional-control\"\u003eProportional Control\u003ca href=\"https://azeemba.com/posts/pids-creating-stable-control-in-games.html#proportional-control\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#proportional-control\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eThe first step we can take is to add a proportional control. We check our current trajectory and see if we will arrive early or late. If we are going to arrive early, we can slow down by some factor. If we are going to arrive late, then we can speed up by some factor. Letâ€™s call the proportional factor \u003ccode\u003eP\u003c/code\u003e.\u003c/p\u003e\n\u003cpre class=\"language-sh\"\u003e\u003ccode class=\"language-sh\"\u003ecurrent_error = target_value - current_value\nadjustment = P*current_error\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ca href=\"https://azeemba.com/posts/pids-creating-stable-control-in-games/PID-POnly.png\"\u003ePID-POnly\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eBehavior of the proprotional control. The y-axis shows the expected error which we want to go to 0. In this example, the proportional factor was too large so we see the error swinging back and forth wildly as the runner speeds up and slows down repeatedly.\u003c/p\u003e\n\u003cp\u003eOne problem here is how should we pick the factor. If the factor is too small, then we will be too slow to adjust. If the factor is too big, then we will overshoot.\u003c/p\u003e\n\u003cp\u003eWorse, the factor has to be different for different characters. As we established earlier, different characters are affected by the animation differently. And different adjustments to the animation speed will impact different characters differently as well.\u003c/p\u003e\n\u003cp\u003eSo ideally we want to pick a â€œclose enoughâ€ factor and have something else clean up the edge cases for us. Thatâ€™s where the \u003ccode\u003eI\u003c/code\u003e term comes in.\u003c/p\u003e\n\u003ch2 id=\"integral-control\"\u003eIntegral Control\u003ca href=\"https://azeemba.com/posts/pids-creating-stable-control-in-games.html#integral-control\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#integral-control\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eSuppose you picked a proportional factor thatâ€™s too low and the controls are not making adjustments fast enough. We can try to detect this situation and automatically push the adjustment in the needed direction.\u003c/p\u003e\n\u003cp\u003eFor example, we can track the historical error by accumulating the error at each measurement. We can use the accumulated error and adjust the speed by another factor. As the accumulated error grows, we make a more aggressive adjustment. Since the accumulated error can be seen as an integral, we can call this factor the integral factor (or \u003ccode\u003eI\u003c/code\u003e).\u003c/p\u003e\n\u003cpre class=\"language-sh\"\u003e\u003ccode class=\"language-sh\"\u003ehistorical_error += current_error\nadjustment = P*current_error + I*historical_error\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ca href=\"https://azeemba.com/posts/pids-creating-stable-control-in-games/PID-IOnly.png\"\u003ePID-IOnly\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eTo more clearly see the effects of the integral controller, this graph shows the behavior of a solo integral controller. While this shrinks the error faster, it still overshoots the target. This will result in the runner speeding up and slowing down a lot.\u003c/p\u003e\n\u003cp\u003eWhen we add the proportional and the integral controls, what we will see is that the integral factor will help the controller make faster adjustments but it will \u003cem\u003ealways\u003c/em\u003e overshoot the target. Since the accumulated error will not clear out till you start accumulating error in the other direction, the integral factor will always push you to go past the target to accumulate more error.\u003c/p\u003e\n\u003cp\u003eThatâ€™s where the D term can help us.\u003c/p\u003e\n\u003ch2 id=\"derivative-control\"\u003eDerivative Control\u003ca href=\"https://azeemba.com/posts/pids-creating-stable-control-in-games.html#derivative-control\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#derivative-control\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eThe only remaining problem is to deal with the overshoot. To prevent overshoot, we can start by predicting the overshoot. We can look at the current change in error and use that to predict what the next error term will be. We can do that just by looking at the difference between the previous and current error and assuming that the same change will happen again (this is kinda like approximating the derivative).\u003c/p\u003e\n\u003cp\u003eIf we see that we are going to overshoot, we can add yet one more scaling factor to resist the overshoot. We can call this factor the â€œderivativeâ€ factor (or \u003ccode\u003eD\u003c/code\u003e). We use the time between the current measurement and the previous measurement as \u003ccode\u003edt\u003c/code\u003e.\u003c/p\u003e\n\u003cpre class=\"language-sh\"\u003e\u003ccode class=\"language-sh\"\u003efuture_error = (current_error - prev_error)/dt\nadjustment = P*current_error\n         + I*historical_error\n         + D*future_error\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"using-pids\"\u003eUsing PIDs\u003ca href=\"https://azeemba.com/posts/pids-creating-stable-control-in-games.html#using-pids\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#using-pids\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eAt this point, we have fully derived PID controllers. PID controllers combine historical behavior, current error, and future prediction to adjust the controls of a system. PIDs help you figure out adjustments needed to push a system to a desired state.\u003c/p\u003e\n\u003cp\u003eTo use it though, we still have to decide how to actually use the adjustment value and have to pick the values for \u003ccode\u003eP\u003c/code\u003e, \u003ccode\u003eI\u003c/code\u003e, and \u003ccode\u003eD\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eSince the adjustment value will naturally be negative when the error is in one direction and positive in the other, it is useful to treat adjustment as a number that can be both. To simplify the handling of the adjustment, we can restrict the number to be between -1 and 1. Any scaling that needs to be done can be done by us.\u003c/p\u003e\n\u003cp\u003eSo we can use the adjustment this way:\u003c/p\u003e\n\u003cpre class=\"language-sh\"\u003e\u003ccode class=\"language-sh\"\u003e// normalized will be between 0 and 1\nnormalized = 0.5 + 0.5*adjustment\nnew_speed = max_speed*normalized\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eSince normalized will be between 0 and 1, \u003ccode\u003enew_speed\u003c/code\u003e will always be between 0 and \u003ccode\u003emax_speed\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eNow we are in a place where we can start testing to pick the correct values for our factors. For my use case, I found that the derivative term was very noisy. In real physical systems, the derivatives are smoother but here I was working with artificial animation that is not as smooth. So to keep the derivative term in check, I set \u003ccode\u003eD\u003c/code\u003e to be very small - on the order of \u003ccode\u003e1/1,000\u003c/code\u003e. So the \u003ccode\u003eD\u003c/code\u003e term would only come into play when there is severe overshoot.\u003c/p\u003e\n\u003cp\u003eI didnâ€™t want any adjustment to be very sudden so I set \u003ccode\u003eP\u003c/code\u003e to be around \u003ccode\u003e1/20\u003c/code\u003e to \u003ccode\u003e1/10\u003c/code\u003e. This basically meant that the proportional reaction was limited to 5% to 10%. To make sure that we did reach our target though, I set the \u003ccode\u003eI\u003c/code\u003e term to be around the same range of \u003ccode\u003e1/10\u003c/code\u003e. This meant that the animation made small adjustments and became more aggressive if the error accumulated.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://azeemba.com/posts/pids-creating-stable-control-in-games/PID-All3.png\"\u003ePID-All3\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eFinal behavior of the tuned PID controller. The smaller P and I values reduce the overshoot a lot. We get to an error of less than a foot by the middle of the run and the error continues to get smaller after that.\u003c/p\u003e\n\u003cp\u003eIn the end, I was able to get the animation to have the same accuracy as the frequency of my adjustments. I decided to make adjustments every 100msâ€“I didnâ€™t want to make adjustments any more frequently to avoid jarring changes in the animation.\u003c/p\u003e\n\u003ch2 id=\"pids\"\u003ePIDs\u003ca href=\"https://azeemba.com/posts/pids-creating-stable-control-in-games.html#pids\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#pids\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003ePIDs are very commonly used in systems that need to adapt. This can be cruise control in cars that need to adjust power when going uphill, robots that need to react to a push, or industrial systems that need to adapt to the changing behavior of different subsystems.\u003c/p\u003e\n\u003cp\u003eDespite its apparent simplicity, PIDs werenâ€™t \u003ca href=\"https://en.wikipedia.org/wiki/Proportional%E2%80%93integral%E2%80%93derivative_controller#Origins\"\u003eformulated\u003c/a\u003e in this form till the early 1900s. They were designed to capture the intuition of sailors steering a shipâ€“the sailors would steer accounting for the current error but would also account for past and future errors to make adjustments. I love how well PIDs capture that intuition.\u003c/p\u003e\n\u003cp\u003eWhen I faced my original problem, I vaguely knew that I wanted to make adjustments to the speed based on the current error but I could quickly come up with more and more edge cases that I would have to handle individually. This would have been a very brittle approach. PIDs allowed me to implement a much more flexible solution that is also simpler than what I would have done.\u003c/p\u003e\n\u003cp\u003eNo wonder they are used so frequently.\u003c/p\u003e\n\u003ch2 id=\"other-resources\"\u003eOther Resources\u003ca href=\"https://azeemba.com/posts/pids-creating-stable-control-in-games.html#other-resources\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#other-resources\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://vazgriz.com/621/pid-controllers/\"\u003eVazgriz - PID Controllers in Unity3D\u003c/a\u003e is a beautiful blog post with visualizations of PIDs in action.\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://en.wikipedia.org/wiki/Proportional%E2%80%93integral%E2%80%93derivative_controller\"\u003eWikipedia\u003c/a\u003e highlights the more general use cases in industrial systems.\u003c/li\u003e\n\u003c/ul\u003e","noteIndex":{"id":"Iy0MoL0KnL55Br3AfTS2C","title":"Luke","desc":"","updated":1766965759366,"created":1644449449778,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":"vault"},"contentHash":"a724de3efd251cf89fe82a5860d9008b","links":[{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"life-tips","position":{"start":{"line":43,"column":5,"offset":2710},"end":{"line":43,"column":29,"offset":2734},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"life-tips","anchorHeader":"wodenokoto"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"read.2026.articles","alias":"What I read in 2026","position":{"start":{"line":72,"column":3,"offset":4440},"end":{"line":72,"column":45,"offset":4482},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"read.2026.articles"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"read.2025.articles","alias":"2025","position":{"start":{"line":73,"column":5,"offset":4487},"end":{"line":73,"column":32,"offset":4514},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"read.2025.articles"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"read.2024.articles","alias":"2024","position":{"start":{"line":74,"column":5,"offset":4519},"end":{"line":74,"column":32,"offset":4546},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"read.2024.articles"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"read.2023.articles","alias":"2023","position":{"start":{"line":75,"column":5,"offset":4551},"end":{"line":75,"column":32,"offset":4578},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"read.2023.articles"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"read.2022.articles","alias":"2022","position":{"start":{"line":76,"column":5,"offset":4583},"end":{"line":76,"column":32,"offset":4610},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"read.2022.articles"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"journal.what-i-struggled-brag-in","position":{"start":{"line":82,"column":3,"offset":4746},"end":{"line":82,"column":39,"offset":4782},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"journal.what-i-struggled-brag-in"}}],"anchors":{"what-i-read-in-past":{"type":"header","text":"What I read in past","value":"what-i-read-in-past","line":76,"column":0,"depth":2}},"children":["zd4mq442jike0pr0wba1u3m","6hzeqsofq67gdk88flxlkhp","778ijii93yu5uwnrwmn5zi4","g1fngdjl25nes6fs3lip602","ZbdkdApFqLdks4Moq92R9","uoc5hhki3o4py15cesddu8q","9qf7j06jtdkm6rnx9ymvwb0","5zn10cvj7ajy2gh2is5nqmg","4qo9ma0z0yu1czns6pxl7y5","ok0e729ho7o09xetujkxc0m","GR5x8HnNFEN6fU2UBSEIK","yirtnlj8q24yutcf3ss1xqy","eq0wc6t7wl2wv221yb68ro4","7x2fnv4j6gxts08qk0jguny","ettkt3iClONnxpbGwBVLl","7l4knev6v613tbuoskvmbdg","hvh5bud6yp7dc89tuh95tr9","4fvoqrplw0cweo554usbjos","f8qsfql0a9v8thpeo82udfa","1swsbrhqi9jk41v9eodyi5q","SQqYupi6EFddTerBA8RRD","hjNeNc1F2JUh0lTWanH4h","qf0l4wbrc9jgooyzexmbq5v","o7xruzrah5wzqetottecss7","z1zo2mp6ddji5p317i4x9xw","v06c2tjelh341x4resa50fh","0yqesk4rcffwgyuab5x8rfa","sy2vkbtyu671chkvgn1yt8j","ufixpmxoydiccoh59kphrib","alswadkx4wb05y1z9iwfzfv","1daut9dpw70xd0zh5a7j5p4"],"parent":null,"data":{},"body":"\nHi there ğŸ‘‹. I'm a Front-end developer.\n\n---\n\n- í˜„ì‹¤ì€ ì¸ê°„ì˜ ì—°ì‚°ìœ¼ë¡œ ì™„ì „íˆ íŒŒì•…í•  ìˆ˜ ì—†ëŠ” ë³µì¡ê³„. ì£¼ì–´ì§„ ìƒí™©ê³¼ ëŠ¥ë ¥ìœ¼ë¡œ í•  ìˆ˜ ìˆëŠ” ìµœì„ ì˜ ì ì‘ì€ ë‹¨ìˆœí•¨ê³¼ ê¾¸ì¤€í•¨.\n\n  - íŒŒì‚°ì„ ë©´í•˜ëŠ” ì„ ì—ì„œ ì—¬ëŸ¬ê°€ì§€ë¥¼ í•´ë³´ê³  ìì‹ ì—ê²Œ ë§ëŠ” ê±¸ ìœ„ì£¼ë¡œ ê¾¸ì¤€íˆ. ê·¸ë¥¼ ìœ„í•´ ë‹¨ìˆœ, í¸ì•ˆ, ì¾Œì í•¨ì´ í•„ìš”.\n\n- ğŸ¥± -\u003e ğŸ¤”ğŸ’¡ğŸŒ± - [On The Death of Daydreaming](https://www.afterbabel.com/p/on-the-death-of-daydreaming)\n  - boredom -\u003e easy fun -\u003e art -\u003e profit?\n\n\u003e I've often described my motivation for building software to others using imagery: I like to go find a secluded beach, build a large, magnificent sand castle, and then walk away. Will anyone notice? Probably not. Will the waves eventually destroy it? Yep. Did I still get immense satisfaction? Absolutely. - [aliasxneo](https://news.ycombinator.com/item?id=41497113)\n\n\u003e We love to see the process, not just the result. The imperfections in your work can be beautiful if they show your struggle for perfection, not a lack of care. - [ralphammer](https://ralphammer.com/is-perfection-boring/)\n\n\u003e Simplicity, even if it sacrifices some ideal functionality has better survival characteristics than the-right-thing. - [The Rise of Worse is Better](https://www.dreamsongs.com/RiseOfWorseIsBetter.html)\n\n\u003e [Roberto Blake was talking about making 100 crappy videos](https://www.youtube.com/watch?v=OnUBaQ1Sp_E) to get better over time. Putting in the reps and improving a little bit each time.\n\u003e\n\u003e Putting in the work without expecting any external reward at first (eg views, followers, likes, etc) will pay off in the long run. - [100 Scrappy Things](https://www.florin-pop.com/blog/100-scrappy-things/)\n\n\u003e Make the difficult habitual, the habitual easy, and the easy beautiful. - [Constantin S. Stanislavski](https://www.goodreads.com/quotes/7102271-make-the-difficult-habitual-the-habitual-easy-and-the-easy)\n\n\u003e A good match is a **structured** dance, where players aim to **score** while they are following well-defined **rules**. This **freedom within a structure** is what makes it fun. - [ralphammer](https://ralphammer.com/how-to-get-started/)\n\n- [Pivot Points](https://longform.asmartbear.com/pivot-points/)\n\n  - non-judgmental aspects of personality that can be strengths in some contexts and weaknesses in others\n  - Pivot Points are fixed in the short term\n\n- [Hedged Bets](https://longform.asmartbear.com/predict-the-future/#hedged-bets)\n  - trading slightly less maximum upside for predictable, net-positive outcomes.\n\n\u003e â€œMotivation often comes after starting, not before. Action produces momentum.â€\n\u003e [When you start a new habit, it should take less than two minutes to do.](https://jamesclear.com/how-to-stop-procrastinating)\n\u003e\n\u003e - James Clear\n\n\u003e Focus is more about **not** keeping busy when you need to wait for something.  \n\u003e Eat the boredom for a minute.\n\u003e\n\u003e - [[life-tips#wodenokoto]]\n\n\u003e [4 minutes run hard enough to push heart rate to 90%, 3 minutes recover, repeat 4 times](https://news.ycombinator.com/item?id=34213181)\n\u003e\n\u003e - https://www.ntnu.edu/cerg/advice\n\u003e - [Get running with Couch to 5K](https://www.nhs.uk/live-well/exercise/running-and-aerobic-exercises/get-running-with-couch-to-5k/)\n\n\u003e [recommended routine - bodyweightfitness](https://www.reddit.com/r/bodyweightfitness/wiki/kb/recommended_routine/) - I Don't Have This Much Time!\n\u003e\n\u003e - Don't workout at all (saves anywhere from 20 to 60 minutes, but really, really, really, really, really, really, really, really, really not recommended)\n\n\u003e ë„ë¬´ì§€ ì½íˆì§€ ì•ŠëŠ” ì±… ì•ì—ì„œ ë‚´ê°€ íƒí•œ ë°©ë²•ì€ í¼ì³ì§„ í˜ì´ì§€ ì•ì—ì„œ ë©ë•Œë¦¬ê¸°ì´ë‹¤. ë‹¤ë¥´ê²Œ í‘œí˜„í•˜ë©´ ì´ë ‡ë‹¤. í¼ì³ì§„ ë‘ í˜ì´ì§€ ì•ì—ì„œ ì˜¤ë˜ ë¨¸ë¬¼ê¸°.\n\u003e\n\u003e ì±…ì„ í¼ì³ë†“ëŠ” ê²ƒìœ¼ë¡œ ì¶©ë¶„í•˜ë‹¤. ì½ì§€ ëª»í•´ë„ ì¢‹ë‹¤. ë§¤ì¼ ì •í•´ì§„ ì§„ë„ë¥¼ ë‚˜ê°€ì•¼ í•˜ëŠ” í•™êµ ìˆ˜ì—…ì´ ì•„ë‹ˆë‹ˆê¹Œ. í•˜ì§€ë§Œ ì½ì§€ ì•Šì•„ë„ ê´œì°®ë‹¤ê³  í•´ì„œ í¼ì³ë‘ì§€ì¡°ì°¨ ì•Šìœ¼ë©´ ê³¤ë€í•˜ë‹¤. ê°€ëŠ¥í•œ í•œ ìì£¼ ì±…ì„ í¼ì³ë‘ë„ë¡ í•˜ì. ì „í˜€ ì½ì§€ ì•Šê³  ë©í•˜ë‹ˆ ë°”ë¼ë³´ê³  ìˆë‹¤ê°€ ë‹¤ì‹œ ë®ê²Œ ë˜ë”ë¼ë„\n\u003e\n\u003e - ë§‰ë§‰í•œ ë…ì„œ. ì‹œë¡œêµ°. P.10~13\n\n\u003e I think it should be everyone's primary focus to sleep well, drink water, get outside, get active, and eat generally decently. I hate to say it, but if you're not eating a good amount of vegetables and fruit, decent protein, sleep, etc, no amount of XYZ will catch up to that detriment. - [CE02](https://news.ycombinator.com/item?id=35056071)\n\n\u003e My real battle is doing good versus doing nothing. - [Deirdre Sullivan](https://www.npr.org/2005/08/08/4785079/always-go-to-the-funeral)\n\n[Kind Engineering](https://kind.engineering/) - How To Engineer Kindness\n\n\u003e Sometimes magic is just someone spending more time on something than anyone else might reasonably expect. - [Teller](https://www.goodreads.com/quotes/6641527-sometimes-magic-is-just-someone-spending-more-time-on-something)\n\n---\n\n## What I read in past\n\n- [[What I read in 2026|read.2026.articles]]\n  - [[2025|read.2025.articles]]\n  - [[2024|read.2024.articles]]\n  - [[2023|read.2023.articles]]\n  - [[2022|read.2022.articles]]\n- ğŸ“ [Gists](https://gist.github.com/Luke-SNAW)\n- ğŸ“œ [Journals](https://luke-snaw.github.io/Luke-SNAW__netlify-CMS.github.io/)\n\n---\n\n- [[journal.what-i-struggled-brag-in]]\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":true,"vaultSelectionModeOnCreate":"smart","leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2}},"randomNote":{},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":"vault"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link","taskCompleteStatus":["done","x"]},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"enableUserTags":false,"enableHashTags":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"enableEditorDecorations":true,"maxPreviewsCached":10,"maxNoteLength":204800,"dendronVersion":"0.115.0","enableFullHierarchyNoteTitle":false,"enablePersistentHistory":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false,"enableFrontmatterTags":true,"enableHashesForFMTags":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Luke SNAW","description":"Personal knowledge space"},"github":{"enableEditLink":false,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"searchMode":"lookup","siteUrl":"https://luke-snaw.github.io/","duplicateNoteBehavior":{"action":"useVault","payload":["vault"]},"siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"p54hilx39w0qha68frckomu"},"buildId":"wirstT2ztC8OQsbzKjhvw","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>