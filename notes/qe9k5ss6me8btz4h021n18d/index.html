<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" href="/favicon.ico"/><title>Cache your CORS, for performance &amp; profit</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Personal knowledge space"/><meta property="og:title" content="Cache your CORS, for performance &amp; profit"/><meta property="og:description" content="Personal knowledge space"/><meta property="og:url" content="https://luke-snaw.github.io//notes/qe9k5ss6me8btz4h021n18d/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="9/20/2022"/><meta property="article:modified_time" content="9/20/2022"/><link rel="canonical" href="https://luke-snaw.github.io//notes/qe9k5ss6me8btz4h021n18d/"/><meta name="next-head-count" content="14"/><link rel="preload" href="/_next/static/css/8e7b7e4bce421c0a.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8e7b7e4bce421c0a.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-3d209faeb64f2f97.js" defer=""></script><script src="/_next/static/chunks/framework-28c999baf2863c3d.js" defer=""></script><script src="/_next/static/chunks/main-104451f3d1a5c4bc.js" defer=""></script><script src="/_next/static/chunks/pages/_app-9d8e0603730b15a3.js" defer=""></script><script src="/_next/static/chunks/935-4dee79e80b8641c6.js" defer=""></script><script src="/_next/static/chunks/6-50972def09142ee2.js" defer=""></script><script src="/_next/static/chunks/pages/notes/%5Bid%5D-78d472fa3b924116.js" defer=""></script><script src="/_next/static/wirstT2ztC8OQsbzKjhvw/_buildManifest.js" defer=""></script><script src="/_next/static/wirstT2ztC8OQsbzKjhvw/_ssgManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div style="display:flex" class="ant-col ant-col-xs-20 ant-col-sm-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"><div class="ant-select ant-select-lg ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-show-search" style="width:100%"><div class="ant-select-selector"><span class="ant-select-selection-search"><input type="search" autoComplete="off" class="ant-select-selection-search-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span><span class="ant-select-selection-placeholder">For full text search please use the &#x27;?&#x27; prefix. e.g. ? Onboarding</span></div></div></div><div style="display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout" style="margin-top:64px;display:flex;flex-direction:row"><div class="site-layout-sidebar" style="flex:0 0 auto;width:calc(max((100% - 992px) / 2, 0px) + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);background-color:transparent;flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></div><main class="ant-layout-content side-layout-main" style="max-width:1200px;min-width:0;display:block"><div style="padding:0 24px"><div class="main-content" role="main"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h1 id="cache-your-cors-for-performance--profit">Cache your CORS, for performance &#x26; profit<a aria-hidden="true" class="anchor-heading icon-link" href="#cache-your-cors-for-performance--profit"></a></h1>
<blockquote>
<p><a href="https://httptoolkit.tech/blog/cache-your-cors/">https://httptoolkit.tech/blog/cache-your-cors/</a></p>
</blockquote>
<p>CORS is a necessity for many APIs, but basic configurations can create a huge number of extra requests, slowing down every browser API client, and sending unnecessary traffic to your backend.</p>
<p>This can be a problem with a traditional API, but becomes a much larger issue with serverless platforms, where your billing is often directly tied to the number of requests received, so this can easily double your API costs.</p>
<p>All of this is unnecessary: it's happening because you don't know how caching works for CORS requests. Let's fix that.</p>
<h2 id="what-are-cors-preflight-requests"><a href="https://httptoolkit.tech/blog/cache-your-cors/#what-are-cors-preflight-requests">What are CORS preflight requests?</a><a aria-hidden="true" class="anchor-heading icon-link" href="#what-are-cors-preflight-requests"></a></h2>
<p>Before your browser makes any request that crosses origins (e.g. example.com to api.example.com) if it's not a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#simple_requests">simple request</a> then the browser sends a preflight request first, and waits for a successful response before it sends the real request.</p>
<p>This preflight request is an OPTIONS request to the server, describing the request the browser wants to send, and asking permission first. It looks something like:</p>
<pre class="language-text"><code class="language-text">OPTIONS /v1/documents
Host: https://api.example.com
Origin: https://example.com
Access-Control-Request-Method: PUT
Access-Control-Request-Headers: origin, x-requested-with
</code></pre>
<p>The server has to respond with headers that confirm it's happy to accept the request, and the browser will wait to send the real request until this happens.</p>
<p>If you want to check exactly how these CORS rules work, and how you should respond, play around with <a href="https://httptoolkit.tech/will-it-cors/">Will it CORS?</a> to test out the possibilities.</p>
<p>In practice, almost all cross-origin API requests will require these preflight requests, notably including:</p>
<ul>
<li>Any request with a JSON or XML body</li>
<li>Any request including credentials</li>
<li>Any request that isn't GET, POST or HEAD</li>
<li>Any exchange that streams the request or response body</li>
<li>Use of any headers other than <code>Accept</code>, <code>Accept-Language</code>, <code>Content-Language</code> and <code>Content-Type</code></li>
</ul>
<h2 id="why-is-this-bad"><a href="https://httptoolkit.tech/blog/cache-your-cors/#why-is-this-bad">Why is this bad?</a><a aria-hidden="true" class="anchor-heading icon-link" href="#why-is-this-bad"></a></h2>
<p>Each of these requests blocks your real request for at least the round-trip time to your server. OPTIONS requests aren't cacheable by default, so your CDN won't usually handle them, and this will have to hit your server every time.</p>
<p>They are cached in clients, but only for 5 seconds by default. If a web page polls your API, making a request every 10 seconds, it'll repeat the preflight check every 10 seconds too.</p>
<p>In many cases this effectively doubles the latency of your API for all browser clients. From the end user's point of view, your performance is halved! And as I'm sure you've heard a hundred times, a few hundred milliseconds of delay translates to big differences in conversion rates &#x26; user satisfaction. This is pretty bad.</p>
<p>In addition, it can add meaningful extra load &#x26; cost to your API servers.</p>
<p>This applies especially with serverless billing models. Platforms including AWS Lambda, Netlify Functions, Cloudflare Workers and Google Cloud Functions all bill based on the number of function invocations, and these preflight requests count towards that like any other. Serverless can be free when you're small, but becomes more expensive once large production systems are in play, and potentially doubling your costs is a huge hit!</p>
<p>Even without serverless, this can still catch you out badly. If you expect a large percentage of your APIs requests to be handled by your CDN, it can be a major surprise when adding a custom header to browser requests creates an extra request right through to your backend servers for every single client request.</p>
<h2 id="how-can-you-cache-preflight-responses"><a href="https://httptoolkit.tech/blog/cache-your-cors/#how-can-you-cache-preflight-responses">How can you cache preflight responses?</a><a aria-hidden="true" class="anchor-heading icon-link" href="#how-can-you-cache-preflight-responses"></a></h2>
<p>There two steps of caching you should put in place for these:</p>
<ul>
<li>Caching in the browser, so individual clients don't repeat the same preflight request unnecessarily.</li>
<li>Caching in your CDN layer, where possible, to treat these as constant responses so your backend servers/functions don't have to handle them.</li>
</ul>
<h3 id="cors-caching-for-browsers"><a href="https://httptoolkit.tech/blog/cache-your-cors/#cors-caching-for-browsers">CORS caching for browsers</a><a aria-hidden="true" class="anchor-heading icon-link" href="#cors-caching-for-browsers"></a></h3>
<p>To cache CORS responses in browsers, just add this header to your preflight responses:</p>
<pre class="language-text"><code class="language-text">Access-Control-Max-Age: 86400
</code></pre>
<p>This is a cache time in seconds.</p>
<p>Browser limit this: Firefox caps the value at 86400 (24 hours) while all Chromium-based browsers cap it at 7200 (2 hours). Making this request once every 2 hours instead of before every API request can be a big improvement in user experience though, and setting the value higher to ensure that even longer lifetimes apply where possible is an easy win.</p>
<h3 id="caching-for-cdnscors"><a href="https://httptoolkit.tech/blog/cache-your-cors/#cors-caching-for-cdns">caching for CDNs</a>CORS<a aria-hidden="true" class="anchor-heading icon-link" href="#caching-for-cdnscors"></a></h3>
<p>To cache CORS responses in CDNs and other proxies between the browser and your API server, add:</p>
<pre class="language-text"><code class="language-text">Cache-Control: public, max-age=86400
Vary: origin
</code></pre>
<p>This caches the response in public caches (e.g. CDNs) for 24 hours, which should be enough for most cases without risking cache invalidation becoming a problem. For initial testing, you might want to set the cache time shorter, and increase it once you're happy that everything is set up correctly.</p>
<p>It's important to note that this <em>isn't</em> standard (OPTIONS is defined as not cacheable by default) but it does appear to be widely supported by most CDNs, who will happily cache OPTIONS responses that explicitly opt-in like this. Some may require this to be manually enabled, so do test this in your configuration.</p>
<p>In the worst case, if this is not supported by your CDN it will just be ignored, so there's no real downside.</p>
<p>The <code>Vary</code> header here is important: this tells the cache to use this response only for other requests with the same <code>Origin</code> header (requests from the same cross-origin source), in addition to using the same URL.</p>
<p>If you don't set a <code>Vary</code> header, you can have big problems. Preflight responses often include an <code>Access-Control-Allow-Origin</code> header that matches the incoming <code>Origin</code> value. If you cache the response without setting <code>Vary</code> then the response with one origin might be used for a request with a different origin, which will fail the CORS checks and block the request completely.</p>
<p>If you're using other CORS response headers that depend on the request, you should include them here too, e.g:</p>
<pre class="language-text"><code class="language-text">Access-Control-Allow-Headers: my-custom-header
Access-Control-Allow-Methods: GET, POST, PUT, DELETE
Vary: Access-Control-Request-Headers, Access-Control-Request-Method
</code></pre>
<p>If you want to test any of this this out right now, install <strong><a href="https://httptoolkit.tech/">HTTP Toolkit</a></strong>, add a rule that matches your requests, launch an intercepted browser, and you can try manually injecting these headers into API responses to see exactly how browsers handle them.</p>
<h2 id="configuration-examples"><a href="https://httptoolkit.tech/blog/cache-your-cors/#configuration-examples">Configuration examples</a><a aria-hidden="true" class="anchor-heading icon-link" href="#configuration-examples"></a></h2>
<p>How do you configure this in your case? There's some some helpful ready-to-go examples below. In each case, I'm assuming you already have preflight CORS handling set up, so we're just thinking about how to add caching on top of this.</p>
<h3 id="caching-cors-with-aws-lambda"><a href="https://httptoolkit.tech/blog/cache-your-cors/#caching-cors-with-aws-lambda">Caching CORS with AWS Lambda</a><a aria-hidden="true" class="anchor-heading icon-link" href="#caching-cors-with-aws-lambda"></a></h3>
<p>To enable CORS with AWS Lambda, you can either manually return the headers above in your HTTP response, or you can <a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/http-api-cors.html">configure API Gateway</a> to handle CORS for you.</p>
<p>If you use API Gateway's configuration, this allows you to configure the <code>Access-Control-Max-Age</code> header, but will not set <code>Cache-Control</code> by default, so if you're using CloudFront or another CDN, you should manually configure that and <code>Vary</code> too.</p>
<p>Alternatively, you can control this all yourself in a preflight lambda handler, like so:</p>
<pre class="language-javascript"><code class="language-javascript">exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">handler</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token punctuation">{</span>
    statusCode<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    headers<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// Keep your existing CORS headers:</span>
      <span class="token string">"Access-Control-Allow-Origin"</span><span class="token operator">:</span> event<span class="token punctuation">.</span><span class="token property-access">headers</span><span class="token punctuation">[</span><span class="token string">"origin"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token comment">// ...</span>

      <span class="token comment">// And add these:</span>
      <span class="token string">"Access-Control-Max-Age"</span><span class="token operator">:</span> <span class="token number">86400</span><span class="token punctuation">,</span>
      <span class="token string">"Cache-Control"</span><span class="token operator">:</span> <span class="token string">"public, max-age=86400"</span><span class="token punctuation">,</span>
      <span class="token maybe-class-name">Vary</span><span class="token operator">:</span> <span class="token string">"origin"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> response<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>CloudFront specifically includes <a href="https://docs.aws.amazon.com/cloudfront/latest/APIReference/API_CachedMethods.html">separate configuration</a> that enables caching for OPTIONS responses, so you should ensure this is enabled if you're using <code>Cache-Control</code> here.</p>
<p>If you're using the <a href="https://www.serverless.com/">Serverless framework</a>, you can do this automatically in your <code>serverless.yml</code> instead, for example:</p>
<pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">functions</span><span class="token punctuation">:</span>
  <span class="token key atrule">hello</span><span class="token punctuation">:</span>
    <span class="token key atrule">handler</span><span class="token punctuation">:</span> handler.hello
    <span class="token key atrule">events</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">http</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> hello
          <span class="token key atrule">method</span><span class="token punctuation">:</span> get
          <span class="token key atrule">cors</span><span class="token punctuation">:</span>
            <span class="token key atrule">origin</span><span class="token punctuation">:</span> <span class="token string">"*"</span>
            <span class="token key atrule">maxAge</span><span class="token punctuation">:</span> <span class="token number">86400</span>
            <span class="token key atrule">cacheControl</span><span class="token punctuation">:</span> <span class="token string">"public, max-age=86400"</span>
</code></pre>
<h3 id="caching-cors-in-nodejs"><a href="https://httptoolkit.tech/blog/cache-your-cors/#caching-cors-in-nodejs">Caching CORS in Node.js</a><a aria-hidden="true" class="anchor-heading icon-link" href="#caching-cors-in-nodejs"></a></h3>
<p>If you're using Express, Connect, or a framework based on them, then you're probably using the <a href="https://www.npmjs.com/package/cors">cors</a> module to handle CORS.</p>
<p>By default this doesn't enable any kind of caching at all, but you can configure <code>Access-Control-Max-Age</code> by passing a <code>maxAge</code> value.</p>
<p>You can't easily configure <code>Cache-Control</code>, so if you're using a CDN you probably want to do something slightly more complicated:</p>
<pre class="language-javascript"><code class="language-javascript">app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>
  <span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// Set the browser cache time for preflight responses</span>
    maxAge<span class="token operator">:</span> <span class="token number">86400</span><span class="token punctuation">,</span>
    preflightContinue<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// Allow us to manually add to preflights</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Add cache-control to preflight responses in a separate middleware:</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">method</span> <span class="token operator">===</span> <span class="token string">"OPTIONS"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">setHeader</span><span class="token punctuation">(</span><span class="token string">"Cache-Control"</span><span class="token punctuation">,</span> <span class="token string">"public, max-age=86400"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// No Vary required: cors sets it already set automatically</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="caching-cors-in-python"><a href="https://httptoolkit.tech/blog/cache-your-cors/#caching-cors-in-python">Caching CORS in Python</a><a aria-hidden="true" class="anchor-heading icon-link" href="#caching-cors-in-python"></a></h3>
<p>Django's <a href="https://pypi.org/project/django-cors-headers/">django-cors-headers</a> module includes a reasonable default of 86400 as its <code>Access-Control-Max-Age</code> value.</p>
<p>Meanwhile Flask's <a href="https://pypi.org/project/Flask-Cors/">Flask-Cors</a> module enables no caching at all by default, but it can be enabled by passing <code>max_age=86400</code> as an option in your existing configuration</p>
<p>With that, you can ensure that browser properly cache these responses. If you want CDN caching too then you'll need to manually configure <code>Cache-Control</code>. Unfortunately, as far as I can tell, neither module supports custom configuration or an easy workaround for this, so if CDN caching is important to you then you'll probably need to manually handle preflight requests, or wrap these modules yourself.</p>
<h3 id="caching-cors-with-java-spring"><a href="https://httptoolkit.tech/blog/cache-your-cors/#caching-cors-with-java-spring">Caching CORS with Java Spring</a><a aria-hidden="true" class="anchor-heading icon-link" href="#caching-cors-with-java-spring"></a></h3>
<p>With Spring, you're probably already using the <code>@CrossOrigin</code> annotation to handle CORS requests.</p>
<p>By default Spring will set a 30 minutes <code>Access-Control-Max-Age</code> header with this, adding relatively short caching in each individual browser, but won't set a <code>Cache-Control</code> header.</p>
<p>I'd suggest you increase the max age to 24 hours (86400 seconds, the maximum used by any browser) by setting the <code>maxAge</code> option, and also add the <code>Cache-Control</code> header if you're using a CDN. Spring's built-in CORS configuration doesn't have support for doing the latter automatically, but you can easily add the header yourself using a response filter:</p>
<pre class="language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AddPreflightCacheControlWebFilter</span> <span class="token keyword">implements</span> <span class="token class-name">WebFilter</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&#x3C;</span><span class="token class-name">Void</span><span class="token punctuation">></span></span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">,</span> <span class="token class-name">WebFilterChain</span> chain<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">CorsUtils</span><span class="token punctuation">.</span><span class="token function">isPreFlightRequest</span><span class="token punctuation">(</span>exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"Cache-Control"</span><span class="token punctuation">,</span> <span class="token string">"public, max-age=86400"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<hr>
<p>I hope this helps improve your CORS performance and reduce your API traffic! Have thoughts or questions? Feel free to in touch on <a href="https://twitter.com/pimterry">Twitter</a> or <a href="https://httptoolkit.tech/contact">directly</a>.</p>
<p><strong>Debugging APIs and want to inspect, rewrite &#x26; mock live traffic? Try out <a href="https://httptoolkit.tech/javascript/">HTTP Toolkit</a> right now. Open-source one-click HTTP(S) interception &#x26; debugging for web, Android, servers &#x26; more.</strong></p>
<hr>
<h1 id="hacker-news"><a href="https://news.ycombinator.com/item?id=32907234">Hacker News</a><a aria-hidden="true" class="anchor-heading icon-link" href="#hacker-news"></a></h1>
<p>Unfortunately this caching is still per-path. For example:</p>
<pre><code>    GET /v1/document/{document-id}/comments/{comment-id}
</code></pre>
<p>For every new document-id or comment-id, there will be a new pre-flight request.</p>
<p>Alternative hacks: Offer a variant of your API format that either</p>
<ol>
<li>
<p>Moves the resource path to the request body (or to a header that is included in "Vary"). Mke sure the rest of your stack (load balancing, observability, redaction) is ok with this, e.g. do your WAF rules support matching on the request body? You also will no longer get automatic path-based caching for GET requests.</p>
</li>
<li>
<p>Conforms to the rules of a CORS "simple" request <sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup>, which doesn't trigger a pre-flight request. This is what we did on the Dropbox API <sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup>. You'll need to move the auth information from the Authorization header to a query parameter or the body, which can be dangerous wrt redaction, e.g. many tools automatically redact the Authorization header but not query parameters.</p>
</li>
</ol>
<p><sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#simple_requests">https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#simple_requests</a><br>
<sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup> <a href="https://www.dropbox.com/developers/documentation/http/documentation">https://www.dropbox.com/developers/documentation/http/documentation</a> (see "Browser-based JavaScript and CORS pre-flight requests")</p></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#what-are-cors-preflight-requests" title="What are CORS preflight requests?">What are CORS preflight requests?</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#why-is-this-bad" title="Why is this bad?">Why is this bad?</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#how-can-you-cache-preflight-responses" title="How can you cache preflight responses?">How can you cache preflight responses?</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#cors-caching-for-browsers" title="CORS caching for browsers">CORS caching for browsers</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#caching-for-cdnscors" title="caching for CDNsCORS">caching for CDNsCORS</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#configuration-examples" title="Configuration examples">Configuration examples</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#caching-cors-with-aws-lambda" title="Caching CORS with AWS Lambda">Caching CORS with AWS Lambda</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#caching-cors-in-nodejs" title="Caching CORS in Node.js">Caching CORS in Node.js</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#caching-cors-in-python" title="Caching CORS in Python">Caching CORS in Python</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#caching-cors-with-java-spring" title="Caching CORS with Java Spring">Caching CORS with Java Spring</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#hacker-news" title="Hacker News">Hacker News</a></div></div></div></div></div></div></div></div></div></div></div><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></main></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"qe9k5ss6me8btz4h021n18d","title":"Cache your CORS, for performance \u0026 profit","desc":"","updated":1663655438497,"created":1663655222365,"custom":{},"fname":"dev.web.performance.cache-your-cors","type":"note","vault":{"fsPath":"vault"},"contentHash":"c3137f2cda075e41080f71adee666f47","links":[],"anchors":{"what-are-cors-preflight-requests":{"type":"header","text":"What are CORS preflight requests?","value":"what-are-cors-preflight-requests","line":16,"column":0,"depth":2},"why-is-this-bad":{"type":"header","text":"Why is this bad?","value":"why-is-this-bad","line":42,"column":0,"depth":2},"how-can-you-cache-preflight-responses":{"type":"header","text":"How can you cache preflight responses?","value":"how-can-you-cache-preflight-responses","line":56,"column":0,"depth":2},"cors-caching-for-browsers":{"type":"header","text":"CORS caching for browsers","value":"cors-caching-for-browsers","line":63,"column":0,"depth":3},"caching-for-cdnscors":{"type":"header","text":"caching for CDNsCORS","value":"caching-for-cdnscors","line":75,"column":0,"depth":3},"configuration-examples":{"type":"header","text":"Configuration examples","value":"configuration-examples","line":104,"column":0,"depth":2},"caching-cors-with-aws-lambda":{"type":"header","text":"Caching CORS with AWS Lambda","value":"caching-cors-with-aws-lambda","line":108,"column":0,"depth":3},"caching-cors-in-nodejs":{"type":"header","text":"Caching CORS in Node.js","value":"caching-cors-in-nodejs","line":154,"column":0,"depth":3},"caching-cors-in-python":{"type":"header","text":"Caching CORS in Python","value":"caching-cors-in-python","line":183,"column":0,"depth":3},"caching-cors-with-java-spring":{"type":"header","text":"Caching CORS with Java Spring","value":"caching-cors-with-java-spring","line":191,"column":0,"depth":3},"hacker-news":{"type":"header","text":"Hacker News","value":"hacker-news","line":222,"column":0,"depth":1}},"children":[],"parent":"pa1bstln0xt54o30z6taebc","data":{}},"body":"\u003ch1 id=\"cache-your-cors-for-performance--profit\"\u003eCache your CORS, for performance \u0026#x26; profit\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#cache-your-cors-for-performance--profit\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://httptoolkit.tech/blog/cache-your-cors/\"\u003ehttps://httptoolkit.tech/blog/cache-your-cors/\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eCORS is a necessity for many APIs, but basic configurations can create a huge number of extra requests, slowing down every browser API client, and sending unnecessary traffic to your backend.\u003c/p\u003e\n\u003cp\u003eThis can be a problem with a traditional API, but becomes a much larger issue with serverless platforms, where your billing is often directly tied to the number of requests received, so this can easily double your API costs.\u003c/p\u003e\n\u003cp\u003eAll of this is unnecessary: it's happening because you don't know how caching works for CORS requests. Let's fix that.\u003c/p\u003e\n\u003ch2 id=\"what-are-cors-preflight-requests\"\u003e\u003ca href=\"https://httptoolkit.tech/blog/cache-your-cors/#what-are-cors-preflight-requests\"\u003eWhat are CORS preflight requests?\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#what-are-cors-preflight-requests\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eBefore your browser makes any request that crosses origins (e.g. example.com to api.example.com) if it's not a \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#simple_requests\"\u003esimple request\u003c/a\u003e then the browser sends a preflight request first, and waits for a successful response before it sends the real request.\u003c/p\u003e\n\u003cp\u003eThis preflight request is an OPTIONS request to the server, describing the request the browser wants to send, and asking permission first. It looks something like:\u003c/p\u003e\n\u003cpre class=\"language-text\"\u003e\u003ccode class=\"language-text\"\u003eOPTIONS /v1/documents\nHost: https://api.example.com\nOrigin: https://example.com\nAccess-Control-Request-Method: PUT\nAccess-Control-Request-Headers: origin, x-requested-with\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe server has to respond with headers that confirm it's happy to accept the request, and the browser will wait to send the real request until this happens.\u003c/p\u003e\n\u003cp\u003eIf you want to check exactly how these CORS rules work, and how you should respond, play around with \u003ca href=\"https://httptoolkit.tech/will-it-cors/\"\u003eWill it CORS?\u003c/a\u003e to test out the possibilities.\u003c/p\u003e\n\u003cp\u003eIn practice, almost all cross-origin API requests will require these preflight requests, notably including:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAny request with a JSON or XML body\u003c/li\u003e\n\u003cli\u003eAny request including credentials\u003c/li\u003e\n\u003cli\u003eAny request that isn't GET, POST or HEAD\u003c/li\u003e\n\u003cli\u003eAny exchange that streams the request or response body\u003c/li\u003e\n\u003cli\u003eUse of any headers other than \u003ccode\u003eAccept\u003c/code\u003e, \u003ccode\u003eAccept-Language\u003c/code\u003e, \u003ccode\u003eContent-Language\u003c/code\u003e and \u003ccode\u003eContent-Type\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"why-is-this-bad\"\u003e\u003ca href=\"https://httptoolkit.tech/blog/cache-your-cors/#why-is-this-bad\"\u003eWhy is this bad?\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#why-is-this-bad\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eEach of these requests blocks your real request for at least the round-trip time to your server. OPTIONS requests aren't cacheable by default, so your CDN won't usually handle them, and this will have to hit your server every time.\u003c/p\u003e\n\u003cp\u003eThey are cached in clients, but only for 5 seconds by default. If a web page polls your API, making a request every 10 seconds, it'll repeat the preflight check every 10 seconds too.\u003c/p\u003e\n\u003cp\u003eIn many cases this effectively doubles the latency of your API for all browser clients. From the end user's point of view, your performance is halved! And as I'm sure you've heard a hundred times, a few hundred milliseconds of delay translates to big differences in conversion rates \u0026#x26; user satisfaction. This is pretty bad.\u003c/p\u003e\n\u003cp\u003eIn addition, it can add meaningful extra load \u0026#x26; cost to your API servers.\u003c/p\u003e\n\u003cp\u003eThis applies especially with serverless billing models. Platforms including AWS Lambda, Netlify Functions, Cloudflare Workers and Google Cloud Functions all bill based on the number of function invocations, and these preflight requests count towards that like any other. Serverless can be free when you're small, but becomes more expensive once large production systems are in play, and potentially doubling your costs is a huge hit!\u003c/p\u003e\n\u003cp\u003eEven without serverless, this can still catch you out badly. If you expect a large percentage of your APIs requests to be handled by your CDN, it can be a major surprise when adding a custom header to browser requests creates an extra request right through to your backend servers for every single client request.\u003c/p\u003e\n\u003ch2 id=\"how-can-you-cache-preflight-responses\"\u003e\u003ca href=\"https://httptoolkit.tech/blog/cache-your-cors/#how-can-you-cache-preflight-responses\"\u003eHow can you cache preflight responses?\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#how-can-you-cache-preflight-responses\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eThere two steps of caching you should put in place for these:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eCaching in the browser, so individual clients don't repeat the same preflight request unnecessarily.\u003c/li\u003e\n\u003cli\u003eCaching in your CDN layer, where possible, to treat these as constant responses so your backend servers/functions don't have to handle them.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"cors-caching-for-browsers\"\u003e\u003ca href=\"https://httptoolkit.tech/blog/cache-your-cors/#cors-caching-for-browsers\"\u003eCORS caching for browsers\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#cors-caching-for-browsers\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eTo cache CORS responses in browsers, just add this header to your preflight responses:\u003c/p\u003e\n\u003cpre class=\"language-text\"\u003e\u003ccode class=\"language-text\"\u003eAccess-Control-Max-Age: 86400\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis is a cache time in seconds.\u003c/p\u003e\n\u003cp\u003eBrowser limit this: Firefox caps the value at 86400 (24 hours) while all Chromium-based browsers cap it at 7200 (2 hours). Making this request once every 2 hours instead of before every API request can be a big improvement in user experience though, and setting the value higher to ensure that even longer lifetimes apply where possible is an easy win.\u003c/p\u003e\n\u003ch3 id=\"caching-for-cdnscors\"\u003e\u003ca href=\"https://httptoolkit.tech/blog/cache-your-cors/#cors-caching-for-cdns\"\u003ecaching for CDNs\u003c/a\u003eCORS\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#caching-for-cdnscors\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eTo cache CORS responses in CDNs and other proxies between the browser and your API server, add:\u003c/p\u003e\n\u003cpre class=\"language-text\"\u003e\u003ccode class=\"language-text\"\u003eCache-Control: public, max-age=86400\nVary: origin\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis caches the response in public caches (e.g. CDNs) for 24 hours, which should be enough for most cases without risking cache invalidation becoming a problem. For initial testing, you might want to set the cache time shorter, and increase it once you're happy that everything is set up correctly.\u003c/p\u003e\n\u003cp\u003eIt's important to note that this \u003cem\u003eisn't\u003c/em\u003e standard (OPTIONS is defined as not cacheable by default) but it does appear to be widely supported by most CDNs, who will happily cache OPTIONS responses that explicitly opt-in like this. Some may require this to be manually enabled, so do test this in your configuration.\u003c/p\u003e\n\u003cp\u003eIn the worst case, if this is not supported by your CDN it will just be ignored, so there's no real downside.\u003c/p\u003e\n\u003cp\u003eThe \u003ccode\u003eVary\u003c/code\u003e header here is important: this tells the cache to use this response only for other requests with the same \u003ccode\u003eOrigin\u003c/code\u003e header (requests from the same cross-origin source), in addition to using the same URL.\u003c/p\u003e\n\u003cp\u003eIf you don't set a \u003ccode\u003eVary\u003c/code\u003e header, you can have big problems. Preflight responses often include an \u003ccode\u003eAccess-Control-Allow-Origin\u003c/code\u003e header that matches the incoming \u003ccode\u003eOrigin\u003c/code\u003e value. If you cache the response without setting \u003ccode\u003eVary\u003c/code\u003e then the response with one origin might be used for a request with a different origin, which will fail the CORS checks and block the request completely.\u003c/p\u003e\n\u003cp\u003eIf you're using other CORS response headers that depend on the request, you should include them here too, e.g:\u003c/p\u003e\n\u003cpre class=\"language-text\"\u003e\u003ccode class=\"language-text\"\u003eAccess-Control-Allow-Headers: my-custom-header\nAccess-Control-Allow-Methods: GET, POST, PUT, DELETE\nVary: Access-Control-Request-Headers, Access-Control-Request-Method\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIf you want to test any of this this out right now, install \u003cstrong\u003e\u003ca href=\"https://httptoolkit.tech/\"\u003eHTTP Toolkit\u003c/a\u003e\u003c/strong\u003e, add a rule that matches your requests, launch an intercepted browser, and you can try manually injecting these headers into API responses to see exactly how browsers handle them.\u003c/p\u003e\n\u003ch2 id=\"configuration-examples\"\u003e\u003ca href=\"https://httptoolkit.tech/blog/cache-your-cors/#configuration-examples\"\u003eConfiguration examples\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#configuration-examples\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eHow do you configure this in your case? There's some some helpful ready-to-go examples below. In each case, I'm assuming you already have preflight CORS handling set up, so we're just thinking about how to add caching on top of this.\u003c/p\u003e\n\u003ch3 id=\"caching-cors-with-aws-lambda\"\u003e\u003ca href=\"https://httptoolkit.tech/blog/cache-your-cors/#caching-cors-with-aws-lambda\"\u003eCaching CORS with AWS Lambda\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#caching-cors-with-aws-lambda\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eTo enable CORS with AWS Lambda, you can either manually return the headers above in your HTTP response, or you can \u003ca href=\"https://docs.aws.amazon.com/apigateway/latest/developerguide/http-api-cors.html\"\u003econfigure API Gateway\u003c/a\u003e to handle CORS for you.\u003c/p\u003e\n\u003cp\u003eIf you use API Gateway's configuration, this allows you to configure the \u003ccode\u003eAccess-Control-Max-Age\u003c/code\u003e header, but will not set \u003ccode\u003eCache-Control\u003c/code\u003e by default, so if you're using CloudFront or another CDN, you should manually configure that and \u003ccode\u003eVary\u003c/code\u003e too.\u003c/p\u003e\n\u003cp\u003eAlternatively, you can control this all yourself in a preflight lambda handler, like so:\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003eexports\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method-variable function-variable method function property-access\"\u003ehandler\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003eevent\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e response \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    statusCode\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e200\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    headers\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token comment\"\u003e// Keep your existing CORS headers:\u003c/span\u003e\n      \u003cspan class=\"token string\"\u003e\"Access-Control-Allow-Origin\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e event\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eheaders\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"origin\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"token comment\"\u003e// ...\u003c/span\u003e\n\n      \u003cspan class=\"token comment\"\u003e// And add these:\u003c/span\u003e\n      \u003cspan class=\"token string\"\u003e\"Access-Control-Max-Age\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e86400\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"token string\"\u003e\"Cache-Control\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"public, max-age=86400\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"token maybe-class-name\"\u003eVary\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"origin\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e response\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eCloudFront specifically includes \u003ca href=\"https://docs.aws.amazon.com/cloudfront/latest/APIReference/API_CachedMethods.html\"\u003eseparate configuration\u003c/a\u003e that enables caching for OPTIONS responses, so you should ensure this is enabled if you're using \u003ccode\u003eCache-Control\u003c/code\u003e here.\u003c/p\u003e\n\u003cp\u003eIf you're using the \u003ca href=\"https://www.serverless.com/\"\u003eServerless framework\u003c/a\u003e, you can do this automatically in your \u003ccode\u003eserverless.yml\u003c/code\u003e instead, for example:\u003c/p\u003e\n\u003cpre class=\"language-yaml\"\u003e\u003ccode class=\"language-yaml\"\u003e\u003cspan class=\"token key atrule\"\u003efunctions\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"token key atrule\"\u003ehello\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token key atrule\"\u003ehandler\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e handler.hello\n    \u003cspan class=\"token key atrule\"\u003eevents\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003e \u003cspan class=\"token key atrule\"\u003ehttp\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"token key atrule\"\u003epath\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e hello\n          \u003cspan class=\"token key atrule\"\u003emethod\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e get\n          \u003cspan class=\"token key atrule\"\u003ecors\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"token key atrule\"\u003eorigin\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"*\"\u003c/span\u003e\n            \u003cspan class=\"token key atrule\"\u003emaxAge\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e86400\u003c/span\u003e\n            \u003cspan class=\"token key atrule\"\u003ecacheControl\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"public, max-age=86400\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"caching-cors-in-nodejs\"\u003e\u003ca href=\"https://httptoolkit.tech/blog/cache-your-cors/#caching-cors-in-nodejs\"\u003eCaching CORS in Node.js\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#caching-cors-in-nodejs\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eIf you're using Express, Connect, or a framework based on them, then you're probably using the \u003ca href=\"https://www.npmjs.com/package/cors\"\u003ecors\u003c/a\u003e module to handle CORS.\u003c/p\u003e\n\u003cp\u003eBy default this doesn't enable any kind of caching at all, but you can configure \u003ccode\u003eAccess-Control-Max-Age\u003c/code\u003e by passing a \u003ccode\u003emaxAge\u003c/code\u003e value.\u003c/p\u003e\n\u003cp\u003eYou can't easily configure \u003ccode\u003eCache-Control\u003c/code\u003e, so if you're using a CDN you probably want to do something slightly more complicated:\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003eapp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003euse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003ecors\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// Set the browser cache time for preflight responses\u003c/span\u003e\n    maxAge\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e86400\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    preflightContinue\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// Allow us to manually add to preflights\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Add cache-control to preflight responses in a separate middleware:\u003c/span\u003e\napp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003euse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ereq\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e res\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e next\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ereq\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003emethod\u003c/span\u003e \u003cspan class=\"token operator\"\u003e===\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"OPTIONS\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    res\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003esetHeader\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Cache-Control\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"public, max-age=86400\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// No Vary required: cors sets it already set automatically\u003c/span\u003e\n    res\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eend\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003eelse\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003enext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"caching-cors-in-python\"\u003e\u003ca href=\"https://httptoolkit.tech/blog/cache-your-cors/#caching-cors-in-python\"\u003eCaching CORS in Python\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#caching-cors-in-python\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eDjango's \u003ca href=\"https://pypi.org/project/django-cors-headers/\"\u003edjango-cors-headers\u003c/a\u003e module includes a reasonable default of 86400 as its \u003ccode\u003eAccess-Control-Max-Age\u003c/code\u003e value.\u003c/p\u003e\n\u003cp\u003eMeanwhile Flask's \u003ca href=\"https://pypi.org/project/Flask-Cors/\"\u003eFlask-Cors\u003c/a\u003e module enables no caching at all by default, but it can be enabled by passing \u003ccode\u003emax_age=86400\u003c/code\u003e as an option in your existing configuration\u003c/p\u003e\n\u003cp\u003eWith that, you can ensure that browser properly cache these responses. If you want CDN caching too then you'll need to manually configure \u003ccode\u003eCache-Control\u003c/code\u003e. Unfortunately, as far as I can tell, neither module supports custom configuration or an easy workaround for this, so if CDN caching is important to you then you'll probably need to manually handle preflight requests, or wrap these modules yourself.\u003c/p\u003e\n\u003ch3 id=\"caching-cors-with-java-spring\"\u003e\u003ca href=\"https://httptoolkit.tech/blog/cache-your-cors/#caching-cors-with-java-spring\"\u003eCaching CORS with Java Spring\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#caching-cors-with-java-spring\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eWith Spring, you're probably already using the \u003ccode\u003e@CrossOrigin\u003c/code\u003e annotation to handle CORS requests.\u003c/p\u003e\n\u003cp\u003eBy default Spring will set a 30 minutes \u003ccode\u003eAccess-Control-Max-Age\u003c/code\u003e header with this, adding relatively short caching in each individual browser, but won't set a \u003ccode\u003eCache-Control\u003c/code\u003e header.\u003c/p\u003e\n\u003cp\u003eI'd suggest you increase the max age to 24 hours (86400 seconds, the maximum used by any browser) by setting the \u003ccode\u003emaxAge\u003c/code\u003e option, and also add the \u003ccode\u003eCache-Control\u003c/code\u003e header if you're using a CDN. Spring's built-in CORS configuration doesn't have support for doing the latter automatically, but you can easily add the header yourself using a response filter:\u003c/p\u003e\n\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e\u003cspan class=\"token annotation punctuation\"\u003e@Component\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eAddPreflightCacheControlWebFilter\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eimplements\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eWebFilter\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token annotation punctuation\"\u003e@Override\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eMono\u003c/span\u003e\u003cspan class=\"token generics\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eVoid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003efilter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eServerWebExchange\u003c/span\u003e exchange\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eWebFilterChain\u003c/span\u003e chain\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eCorsUtils\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eisPreFlightRequest\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eexchange\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetRequest\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            exchange\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetResponse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetHeaders\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eadd\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Cache-Control\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"public, max-age=86400\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e chain\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003efilter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eexchange\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003cp\u003eI hope this helps improve your CORS performance and reduce your API traffic! Have thoughts or questions? Feel free to in touch on \u003ca href=\"https://twitter.com/pimterry\"\u003eTwitter\u003c/a\u003e or \u003ca href=\"https://httptoolkit.tech/contact\"\u003edirectly\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eDebugging APIs and want to inspect, rewrite \u0026#x26; mock live traffic? Try out \u003ca href=\"https://httptoolkit.tech/javascript/\"\u003eHTTP Toolkit\u003c/a\u003e right now. Open-source one-click HTTP(S) interception \u0026#x26; debugging for web, Android, servers \u0026#x26; more.\u003c/strong\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003ch1 id=\"hacker-news\"\u003e\u003ca href=\"https://news.ycombinator.com/item?id=32907234\"\u003eHacker News\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#hacker-news\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cp\u003eUnfortunately this caching is still per-path. For example:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e    GET /v1/document/{document-id}/comments/{comment-id}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eFor every new document-id or comment-id, there will be a new pre-flight request.\u003c/p\u003e\n\u003cp\u003eAlternative hacks: Offer a variant of your API format that either\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eMoves the resource path to the request body (or to a header that is included in \"Vary\"). Mke sure the rest of your stack (load balancing, observability, redaction) is ok with this, e.g. do your WAF rules support matching on the request body? You also will no longer get automatic path-based caching for GET requests.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eConforms to the rules of a CORS \"simple\" request \u003csup id=\"fnref-1\"\u003e\u003ca href=\"#fn-1\" class=\"footnote-ref\"\u003e1\u003c/a\u003e\u003c/sup\u003e, which doesn't trigger a pre-flight request. This is what we did on the Dropbox API \u003csup id=\"fnref-2\"\u003e\u003ca href=\"#fn-2\" class=\"footnote-ref\"\u003e2\u003c/a\u003e\u003c/sup\u003e. You'll need to move the auth information from the Authorization header to a query parameter or the body, which can be dangerous wrt redaction, e.g. many tools automatically redact the Authorization header but not query parameters.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003csup id=\"fnref-1\"\u003e\u003ca href=\"#fn-1\" class=\"footnote-ref\"\u003e1\u003c/a\u003e\u003c/sup\u003e \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#simple_requests\"\u003ehttps://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#simple_requests\u003c/a\u003e\u003cbr\u003e\n\u003csup id=\"fnref-2\"\u003e\u003ca href=\"#fn-2\" class=\"footnote-ref\"\u003e2\u003c/a\u003e\u003c/sup\u003e \u003ca href=\"https://www.dropbox.com/developers/documentation/http/documentation\"\u003ehttps://www.dropbox.com/developers/documentation/http/documentation\u003c/a\u003e (see \"Browser-based JavaScript and CORS pre-flight requests\")\u003c/p\u003e","noteIndex":{"id":"Iy0MoL0KnL55Br3AfTS2C","title":"Luke","desc":"","updated":1766965759366,"created":1644449449778,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":"vault"},"contentHash":"a724de3efd251cf89fe82a5860d9008b","links":[{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"life-tips","position":{"start":{"line":43,"column":5,"offset":2710},"end":{"line":43,"column":29,"offset":2734},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"life-tips","anchorHeader":"wodenokoto"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"read.2026.articles","alias":"What I read in 2026","position":{"start":{"line":72,"column":3,"offset":4440},"end":{"line":72,"column":45,"offset":4482},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"read.2026.articles"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"read.2025.articles","alias":"2025","position":{"start":{"line":73,"column":5,"offset":4487},"end":{"line":73,"column":32,"offset":4514},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"read.2025.articles"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"read.2024.articles","alias":"2024","position":{"start":{"line":74,"column":5,"offset":4519},"end":{"line":74,"column":32,"offset":4546},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"read.2024.articles"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"read.2023.articles","alias":"2023","position":{"start":{"line":75,"column":5,"offset":4551},"end":{"line":75,"column":32,"offset":4578},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"read.2023.articles"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"read.2022.articles","alias":"2022","position":{"start":{"line":76,"column":5,"offset":4583},"end":{"line":76,"column":32,"offset":4610},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"read.2022.articles"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"journal.what-i-struggled-brag-in","position":{"start":{"line":82,"column":3,"offset":4746},"end":{"line":82,"column":39,"offset":4782},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"journal.what-i-struggled-brag-in"}}],"anchors":{"what-i-read-in-past":{"type":"header","text":"What I read in past","value":"what-i-read-in-past","line":76,"column":0,"depth":2}},"children":["zd4mq442jike0pr0wba1u3m","6hzeqsofq67gdk88flxlkhp","778ijii93yu5uwnrwmn5zi4","g1fngdjl25nes6fs3lip602","ZbdkdApFqLdks4Moq92R9","uoc5hhki3o4py15cesddu8q","9qf7j06jtdkm6rnx9ymvwb0","5zn10cvj7ajy2gh2is5nqmg","4qo9ma0z0yu1czns6pxl7y5","ok0e729ho7o09xetujkxc0m","GR5x8HnNFEN6fU2UBSEIK","yirtnlj8q24yutcf3ss1xqy","eq0wc6t7wl2wv221yb68ro4","7x2fnv4j6gxts08qk0jguny","ettkt3iClONnxpbGwBVLl","7l4knev6v613tbuoskvmbdg","hvh5bud6yp7dc89tuh95tr9","4fvoqrplw0cweo554usbjos","f8qsfql0a9v8thpeo82udfa","1swsbrhqi9jk41v9eodyi5q","SQqYupi6EFddTerBA8RRD","hjNeNc1F2JUh0lTWanH4h","qf0l4wbrc9jgooyzexmbq5v","o7xruzrah5wzqetottecss7","z1zo2mp6ddji5p317i4x9xw","v06c2tjelh341x4resa50fh","0yqesk4rcffwgyuab5x8rfa","sy2vkbtyu671chkvgn1yt8j","ufixpmxoydiccoh59kphrib","alswadkx4wb05y1z9iwfzfv","1daut9dpw70xd0zh5a7j5p4"],"parent":null,"data":{},"body":"\nHi there . I'm a Front-end developer.\n\n---\n\n-        .          .\n\n  -          .   , ,  .\n\n-  -\u003e  - [On The Death of Daydreaming](https://www.afterbabel.com/p/on-the-death-of-daydreaming)\n  - boredom -\u003e easy fun -\u003e art -\u003e profit?\n\n\u003e I've often described my motivation for building software to others using imagery: I like to go find a secluded beach, build a large, magnificent sand castle, and then walk away. Will anyone notice? Probably not. Will the waves eventually destroy it? Yep. Did I still get immense satisfaction? Absolutely. - [aliasxneo](https://news.ycombinator.com/item?id=41497113)\n\n\u003e We love to see the process, not just the result. The imperfections in your work can be beautiful if they show your struggle for perfection, not a lack of care. - [ralphammer](https://ralphammer.com/is-perfection-boring/)\n\n\u003e Simplicity, even if it sacrifices some ideal functionality has better survival characteristics than the-right-thing. - [The Rise of Worse is Better](https://www.dreamsongs.com/RiseOfWorseIsBetter.html)\n\n\u003e [Roberto Blake was talking about making 100 crappy videos](https://www.youtube.com/watch?v=OnUBaQ1Sp_E) to get better over time. Putting in the reps and improving a little bit each time.\n\u003e\n\u003e Putting in the work without expecting any external reward at first (eg views, followers, likes, etc) will pay off in the long run. - [100 Scrappy Things](https://www.florin-pop.com/blog/100-scrappy-things/)\n\n\u003e Make the difficult habitual, the habitual easy, and the easy beautiful. - [Constantin S. Stanislavski](https://www.goodreads.com/quotes/7102271-make-the-difficult-habitual-the-habitual-easy-and-the-easy)\n\n\u003e A good match is a **structured** dance, where players aim to **score** while they are following well-defined **rules**. This **freedom within a structure** is what makes it fun. - [ralphammer](https://ralphammer.com/how-to-get-started/)\n\n- [Pivot Points](https://longform.asmartbear.com/pivot-points/)\n\n  - non-judgmental aspects of personality that can be strengths in some contexts and weaknesses in others\n  - Pivot Points are fixed in the short term\n\n- [Hedged Bets](https://longform.asmartbear.com/predict-the-future/#hedged-bets)\n  - trading slightly less maximum upside for predictable, net-positive outcomes.\n\n\u003e Motivation often comes after starting, not before. Action produces momentum.\n\u003e [When you start a new habit, it should take less than two minutes to do.](https://jamesclear.com/how-to-stop-procrastinating)\n\u003e\n\u003e - James Clear\n\n\u003e Focus is more about **not** keeping busy when you need to wait for something.  \n\u003e Eat the boredom for a minute.\n\u003e\n\u003e - [[life-tips#wodenokoto]]\n\n\u003e [4 minutes run hard enough to push heart rate to 90%, 3 minutes recover, repeat 4 times](https://news.ycombinator.com/item?id=34213181)\n\u003e\n\u003e - https://www.ntnu.edu/cerg/advice\n\u003e - [Get running with Couch to 5K](https://www.nhs.uk/live-well/exercise/running-and-aerobic-exercises/get-running-with-couch-to-5k/)\n\n\u003e [recommended routine - bodyweightfitness](https://www.reddit.com/r/bodyweightfitness/wiki/kb/recommended_routine/) - I Don't Have This Much Time!\n\u003e\n\u003e - Don't workout at all (saves anywhere from 20 to 60 minutes, but really, really, really, really, really, really, really, really, really not recommended)\n\n\u003e            .   .      .\n\u003e\n\u003e    .   .        .        .      .         \n\u003e\n\u003e -  . . P.10~13\n\n\u003e I think it should be everyone's primary focus to sleep well, drink water, get outside, get active, and eat generally decently. I hate to say it, but if you're not eating a good amount of vegetables and fruit, decent protein, sleep, etc, no amount of XYZ will catch up to that detriment. - [CE02](https://news.ycombinator.com/item?id=35056071)\n\n\u003e My real battle is doing good versus doing nothing. - [Deirdre Sullivan](https://www.npr.org/2005/08/08/4785079/always-go-to-the-funeral)\n\n[Kind Engineering](https://kind.engineering/) - How To Engineer Kindness\n\n\u003e Sometimes magic is just someone spending more time on something than anyone else might reasonably expect. - [Teller](https://www.goodreads.com/quotes/6641527-sometimes-magic-is-just-someone-spending-more-time-on-something)\n\n---\n\n## What I read in past\n\n- [[What I read in 2026|read.2026.articles]]\n  - [[2025|read.2025.articles]]\n  - [[2024|read.2024.articles]]\n  - [[2023|read.2023.articles]]\n  - [[2022|read.2022.articles]]\n-  [Gists](https://gist.github.com/Luke-SNAW)\n-  [Journals](https://luke-snaw.github.io/Luke-SNAW__netlify-CMS.github.io/)\n\n---\n\n- [[journal.what-i-struggled-brag-in]]\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":true,"vaultSelectionModeOnCreate":"smart","leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2}},"randomNote":{},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":"vault"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link","taskCompleteStatus":["done","x"]},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"enableUserTags":false,"enableHashTags":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"enableEditorDecorations":true,"maxPreviewsCached":10,"maxNoteLength":204800,"dendronVersion":"0.115.0","enableFullHierarchyNoteTitle":false,"enablePersistentHistory":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false,"enableFrontmatterTags":true,"enableHashesForFMTags":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Luke SNAW","description":"Personal knowledge space"},"github":{"enableEditLink":false,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"searchMode":"lookup","siteUrl":"https://luke-snaw.github.io/","duplicateNoteBehavior":{"action":"useVault","payload":["vault"]},"siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"qe9k5ss6me8btz4h021n18d"},"buildId":"wirstT2ztC8OQsbzKjhvw","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>