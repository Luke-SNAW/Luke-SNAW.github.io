<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" href="/favicon.ico"/><title>A practical guide to using shadow DOM</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Personal knowledge space"/><meta property="og:title" content="A practical guide to using shadow DOM"/><meta property="og:description" content="Personal knowledge space"/><meta property="og:url" content="https://luke-snaw.github.io//notes/b6u18z9o90yxv9ww6d2jd54/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="3/6/2024"/><meta property="article:modified_time" content="3/6/2024"/><link rel="canonical" href="https://luke-snaw.github.io//notes/b6u18z9o90yxv9ww6d2jd54/"/><meta name="next-head-count" content="14"/><link rel="preload" href="/_next/static/css/8e7b7e4bce421c0a.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8e7b7e4bce421c0a.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-3d209faeb64f2f97.js" defer=""></script><script src="/_next/static/chunks/framework-28c999baf2863c3d.js" defer=""></script><script src="/_next/static/chunks/main-104451f3d1a5c4bc.js" defer=""></script><script src="/_next/static/chunks/pages/_app-9d8e0603730b15a3.js" defer=""></script><script src="/_next/static/chunks/935-4dee79e80b8641c6.js" defer=""></script><script src="/_next/static/chunks/6-50972def09142ee2.js" defer=""></script><script src="/_next/static/chunks/pages/notes/%5Bid%5D-78d472fa3b924116.js" defer=""></script><script src="/_next/static/vOE8u-mg___OsOsz4tjEg/_buildManifest.js" defer=""></script><script src="/_next/static/vOE8u-mg___OsOsz4tjEg/_ssgManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div style="display:flex" class="ant-col ant-col-xs-20 ant-col-sm-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"><div class="ant-select ant-select-lg ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-show-search" style="width:100%"><div class="ant-select-selector"><span class="ant-select-selection-search"><input type="search" autoComplete="off" class="ant-select-selection-search-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span><span class="ant-select-selection-placeholder">For full text search please use the &#x27;?&#x27; prefix. e.g. ? Onboarding</span></div></div></div><div style="display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout" style="margin-top:64px;display:flex;flex-direction:row"><div class="site-layout-sidebar" style="flex:0 0 auto;width:calc(max((100% - 992px) / 2, 0px) + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);background-color:transparent;flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></div><main class="ant-layout-content side-layout-main" style="max-width:1200px;min-width:0;display:block"><div style="padding:0 24px"><div class="main-content" role="main"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h1 id="a-practical-guide-to-using-shadow-dom">A practical guide to using shadow DOM<a aria-hidden="true" class="anchor-heading icon-link" href="#a-practical-guide-to-using-shadow-dom"></a></h1>
<blockquote>
<p><a href="https://www.mayank.co/blog/declarative-shadow-dom-guide/">https://www.mayank.co/blog/declarative-shadow-dom-guide/</a></p>
</blockquote>
<h2 id="what-the-heck-is-shadow-dom"><a href="https://www.mayank.co/blog/declarative-shadow-dom-guide/#what-the-heck-is-shadow-dom">What the heck is “shadow DOM”?</a><a aria-hidden="true" class="anchor-heading icon-link" href="#what-the-heck-is-shadow-dom"></a></h2>
<p>There have been hundreds of attempts at explaining shadow DOM, and it still remains confusing for many developers. I find that the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_components/Using_shadow_DOM">MDN page for shadow DOM</a> does a pretty decent job of explaining it, so I’d recommend reading it if you haven’t already. (Fun fact: When I started writing this post, MDN didn’t even document the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_components/Using_shadow_DOM#declaratively_with_html">declarative syntax</a>)</p>
<blockquote>
<p>Shadow DOM enables you to attach a DOM tree to an element, and have the internals of this tree hidden from JavaScript and CSS running in the page.</p>
</blockquote>
<p>There is one frequently-misunderstood bit that I’d like to clear up though. Regular DOM content (commonly known as “light DOM”) can be <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/slot"><em>slotted</em></a> inside shadow DOM. The shadow trees can be thought of as donuts, where the holes may be filled by light DOM content. This light DOM content continues to stay in the light DOM (rather than being somehow “transported” into the shadow DOM). The content from shadow DOM and light DOM is then interleaved to create the final DOM tree.</p>
<p>Visualization showing how light DOM and shadow DOM can be interleaved to create a combined final tree. Show separate trees</p>
<p>To really drive this point home, I recommend enabling “user-agent shadow DOM” in devtools. This will allow you to peek inside the shadow DOM of built-in DOM elements (such as <code>&#x3C;details></code>). The content that you pass into these elements stays in the light DOM, and only gets “revealed” by the user-agent shadow DOM.</p>
<p><a href="https://www.mayank.co/_astro/details-shadow-dom.5qr6msYq_Z1kyELs.webp">Screenshot of Chrome devtools showing the internal shadow DOM of the details element, containing two slots, one for the summary and another for the details content, both of which are revealed in the light DOM</a></p>
<h2 id="imperative-vs-declarative"><a href="https://www.mayank.co/blog/declarative-shadow-dom-guide/#imperative-vs-declarative">“Imperative” vs “declarative”</a><a aria-hidden="true" class="anchor-heading icon-link" href="#imperative-vs-declarative"></a></h2>
<p>Previously, we had to rely on client-side JavaScript to <em>imperatively</em> attach a shadow root to an element.</p>
<pre class="language-js"><code class="language-js">element<span class="token punctuation">.</span><span class="token method function property-access">attachShadow</span><span class="token punctuation">(</span><span class="token punctuation">{</span> mode<span class="token operator">:</span> <span class="token string">"open"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
element<span class="token punctuation">.</span><span class="token property-access">shadowRoot</span><span class="token punctuation">.</span><span class="token property-access">innerHTML</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>p</span><span class="token punctuation">></span></span>Hello from the shadows!<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>p</span><span class="token punctuation">></span></span></span><span class="token template-punctuation string">`</span></span>
</code></pre>
<p>This JavaScript requirement made shadow DOM a non-starter for the vast majority of use cases. I used it almost exclusively for optional enhancements that are not critical to the initial page load. Even then, the developer ergonomics of imperatively attaching a shadow root and populating its content felt awkward at best. And of course, it simply does not work when JavaScript isn’t available.</p>
<p>With <em>declarative</em> shadow DOM, we can now express our shadow trees right in our HTML! The browser will attach the shadow root as soon as it encounters it, before any JavaScript even loads.</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>template</span> <span class="token attr-name">shadowrootmode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>open<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>p</span><span class="token punctuation">></span></span>This is "hidden" inside shadow DOM<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>p</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>slot</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>p</span><span class="token punctuation">></span></span>This is the regular ol' content<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>p</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
</code></pre>
<p>The <code>&#x3C;template></code> will also be automatically removed from the DOM, so when you the inspect the element in dev tools, it feels as if the shadow root came pre-attached with the element.</p>
<p>(And yes, shadow DOM can be used with <code>&#x3C;div></code>, as well as some <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/attachShadow#elements_you_can_attach_a_shadow_to">other built-in elements</a>, including <code>&#x3C;body></code>, <code>&#x3C;p></code>, and <code>&#x3C;span></code>.)</p>
<p><a href="https://www.mayank.co//_astro/shadowroot-devtools.ydyS5wmq_u5ffD.webp">Screenshot of Chrome devtools showing an expanded shadow-root, with a slot revealing the light DOM content</a></p>
<p>A couple more important things to note:</p>
<ul>
<li>Declarative shadow DOM is an <a href="https://developer.chrome.com/docs/css-ui/declarative-shadow-dom#parser-only">HTML parser feature</a>. It will not work if you try to set it inside <code>innerHTML</code>, for example. To create shadow trees from within JavaScript, the imperative <code>attachShadow</code> method should be used instead (at least until we get new DOM APIs like <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/setHTML"><code>setHTML</code></a>).</li>
<li>Be careful about newlines. Writing <code>&#x3C;template></code> in its own line makes sense for readability, but you might inadvertently end up slotting whitespace into the default <code>&#x3C;slot></code> (and thereby overriding the fallback slot content) if you have nothing else in the light DOM.</li>
</ul>
<h2 id="use-cases"><a href="https://www.mayank.co/blog/declarative-shadow-dom-guide/#use-cases">Use cases</a><a aria-hidden="true" class="anchor-heading icon-link" href="#use-cases"></a></h2>
<p>I often get asked “Why should I care about shadow DOM?” Well, here’s a non-exhaustive list of ways in which shadow DOM can come in handy today:</p>
<ul>
<li>invisible <a href="https://www.mayank.co/blog/hover-triangles">hover triangles</a></li>
<li>invisible rectangles for increasing <a href="https://ishadeed.com/article/target-size">tap target size</a></li>
<li>”handles” for resizing and dragging dialogs/panels/columns</li>
<li>wrapper elements for <a href="https://github.com/bvaughn/react-window">virtual scrolling/windowing</a></li>
<li>sibling elements for <a href="https://react-spectrum.adobe.com/react-aria/FocusScope.html">focus trapping</a></li>
<li>”overlapping”/duplicated elements (such as <a href="https://github.blog/2023-06-21-crafting-a-better-faster-code-view/#how-the-pieces-fit-together">GitHub’s code view</a>)</li>
<li>decorative hover effects and animations for landing pages</li>
<li><a href="https://www.tpgi.com/the-anatomy-of-visually-hidden/">visually-hidden</a> text for improved accessibility</li>
<li>visual hints for drag-and-drop interfaces</li>
<li>3D objects and complex SVGs</li>
<li><a href="https://lamplightdev.com/blog/2024/01/10/streaming-html-out-of-order-without-javascript/">out-of-order HTML streaming</a></li>
<li>changing or enforcing source order of slotted content</li>
<li>”passthrough”/noop shadow roots to access shadowDOM-specific features (such as <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLSlotElement/slotchange_event"><code>slotchange</code></a>)</li>
</ul>
<p>In almost all of the above cases, most of the critical content stays in the light DOM, and shadow DOM is only used for enhancing the baseline experience and/or hiding unimportant implementation details. Even if some of these things could be achieved using light DOM only, I find it valuable to hide the messy bits inside shadow DOM. It greatly improves the debugging experience, by reducing the amount of <a href="https://css-tricks.com/twitters-div-soup-and-uglyfied-css-explained/">div soup</a> generated in the light DOM tree. It also allows me to opaquely make changes within shadow DOM without affecting any of the “outside” DOM selectors and such.</p>
<p>There are also some scenarios where complete encapsulation may be desired, in which case the content can be fully rendered (rather than slotted) inside shadow DOM:</p>
<ul>
<li>isolated iframe-like views (e.g. interactive demos, like the one above)</li>
<li>third-party widgets and ads</li>
<li><a href="https://microfrontend.dev/">microfrontends</a></li>
</ul>
<h2 id="style-scoping-and-cascading"><a href="https://www.mayank.co/blog/declarative-shadow-dom-guide/#style-scoping-and-cascading">Style scoping and cascading</a><a aria-hidden="true" class="anchor-heading icon-link" href="#style-scoping-and-cascading"></a></h2>
<p>It is very important to understand how styles work in shadow DOM.</p>
<p>Perhaps the easiest thing to understand is that styles inside a shadow tree do not affect anything outside it, and styles outside the shadow tree do not affect anything inside it. This is a stronger form of scoped styling (more accurately called “style encapsulation”), in that it allows you to write very weak selectors, at the expense of giving up the ability to use external styles.</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">
    <span class="token selector">p</span> <span class="token punctuation">{</span>
      <span class="token property">color</span><span class="token punctuation">:</span> <span class="token color">blue</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>style</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>body</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>template</span> <span class="token attr-name">shadowrootmode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>open<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">
        <span class="token selector">p</span> <span class="token punctuation">{</span>
          <span class="token property">color</span><span class="token punctuation">:</span> <span class="token color">red</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>style</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>p</span><span class="token punctuation">></span></span>This is red.<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>p</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>slot</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>template</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>p</span><span class="token punctuation">></span></span>This is blue.<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>p</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>body</span><span class="token punctuation">></span></span>
</code></pre>
<p>What may not be obvious is that <a href="https://knowler.dev/blog/a-mental-model-for-styling-the-shadow-dom">shadow DOM styles are cascaded <em>before</em> document styles</a>. This means that <code>:host</code> styles will always lose to any “outside” styles, regardless of specificity (unless you use <code>!important</code>).</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">
    <span class="token selector"><span class="token pseudo-class">:where</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
      <span class="token property">color</span><span class="token punctuation">:</span> <span class="token color">blue</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>style</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>body</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>template</span> <span class="token attr-name">shadowrootmode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>open<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">
        <span class="token selector"><span class="token pseudo-class">:host</span></span> <span class="token punctuation">{</span>
          <span class="token property">color</span><span class="token punctuation">:</span> <span class="token color">red</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>style</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>p</span><span class="token punctuation">></span></span>This is also blue!<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>p</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>slot</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>template</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>p</span><span class="token punctuation">></span></span>This is blue.<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>p</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>body</span><span class="token punctuation">></span></span>
</code></pre>
<p>Lastly, <a href="https://css-tricks.com/styling-in-the-shadow-dom-with-css-shadow-parts/">CSS shadow parts</a> can be used to selectively allow external styles into shadow DOM. I won’t bother explaining it, because there are many existing guides on the topic, and frankly, I’ve never needed to use it. Custom properties and slots can go pretty far already.</p>
<h2 id="shadow-dom-is-still-problematic"><a href="https://www.mayank.co/blog/declarative-shadow-dom-guide/#shadow-dom-is-still-problematic">Shadow DOM is still problematic</a><a aria-hidden="true" class="anchor-heading icon-link" href="#shadow-dom-is-still-problematic"></a></h2>
<p>I find it very strange that we didn’t have a declarative syntax for using shadow DOM until just now. Better late than never, I suppose. Still, it’s just a <em>syntax</em>. It does not really fix any of the larger <a href="https://www.matuzo.at/blog/2023/pros-and-cons-of-shadow-dom/">problems with shadow DOM</a>, most importantly around <a href="https://github.com/WICG/webcomponents/issues/909">styling</a>, <a href="https://alice.pages.igalia.com/blog/how-shadow-dom-and-accessibility-are-in-conflict/">accessibility</a>, and <a href="https://kinsta.com/blog/web-components/#ignored-inputs">form participation</a>. In fact, declarative shadow DOM introduces another problem of having to repeat the <code>&#x3C;template></code> for every single instance.</p>
<p>I’ve been able to work around the main styling issues by manually injecting my global stylesheets into all shadow trees. However, this is not a proper solution and only works for my own components (unless I rely on JavaScript, which… no thanks).</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>template</span> <span class="token attr-name">shadowrootmode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>open<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utilities.css<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>visually-hidden<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Utility classes work!<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>span</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>slot</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>template</span><span class="token punctuation">></span></span>
</code></pre>
<p>To get around the other issues, here’s my rule of thumb: do <em>not</em> put any interactive form controls or semantically-important elements inside shadow DOM. As long as these stay in the light DOM and are slotted into shadow DOM, we can avoid most of the shadow nonsense. As a bonus, common patterns like <code>document.activeElement</code> and <code>:has(:focus-visible)</code> will work correctly, and the debugging experience will also be improved.</p>
<pre><code>// ❌&#x3C;my-input>&#x3C;/my-input>
// ✅&#x3C;my-input> &#x3C;input />&#x3C;/my-input>
</code></pre>
<pre><code>// ❌&#x3C;my-button>&#x3C;/my-button>
// ✅&#x3C;my-button> &#x3C;button>…&#x3C;/button>&#x3C;/my-button>
</code></pre>
<h2 id="usage-within-frameworks"><a href="https://www.mayank.co/blog/declarative-shadow-dom-guide/#usage-within-frameworks">Usage within frameworks</a><a aria-hidden="true" class="anchor-heading icon-link" href="#usage-within-frameworks"></a></h2>
<p>Most of us are probably building websites using some kind of framework, or at least a templating engine. I think frameworks play a crucial role in using shadow DOM at scale, particularly because <a href="https://www.mayank.co/blog/web-components-are-not-components">web components are not components</a>. These frameworks can effectively serve as a polyfill for some of the missing web component APIs.</p>
<p>Broadly speaking, there are two kinds of web frameworks, and declarative shadow DOM interacts differently with them.</p>
<ol>
<li><strong>Server-first frameworks</strong> (e.g. Astro, WebC, Enhance): Since these frameworks are primarily concerned with producing HTML on the server, declarative shadow DOM generally works fine here (as long as you manage to produce the correct HTML).</li>
<li><strong>Client-first frameworks</strong> (e.g. (P)react, Vue, Svelte): These frameworks support server-side rendering, but they tend to “hydrate” (recreate) the server-generated markup on the client, which does not play well with declarative shadow DOM. It’s possible to work around though, by using imperative code on the client.</li>
</ol>
<p>I’ll have a more detailed follow-up post demonstrating how declarative shadow DOM can be used within various frameworks, so stay tuned. 👀</p>
<p>You may have noticed I didn’t mention custom elements anywhere in this article. That’s not an accident. Custom elements and shadow DOM are independent web component APIs that do not always need to be used together. Custom elements may be completely unnecessary when using a client-side JavaScript framework which already knows how to manage its own rendering lifecycle. In such cases, it totally makes sense to use shadow DOM without custom elements.</p></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#what-the-heck-is-shadow-dom" title="What the heck is “shadow DOM”?">What the heck is “shadow DOM”?</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#imperative-vs-declarative" title="“Imperative” vs “declarative”">“Imperative” vs “declarative”</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#use-cases" title="Use cases">Use cases</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#style-scoping-and-cascading" title="Style scoping and cascading">Style scoping and cascading</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#shadow-dom-is-still-problematic" title="Shadow DOM is still problematic">Shadow DOM is still problematic</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#usage-within-frameworks" title="Usage within frameworks">Usage within frameworks</a></div></div></div></div></div></div></div></div></div></div></div><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></main></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"b6u18z9o90yxv9ww6d2jd54","title":"A practical guide to using shadow DOM","desc":"","updated":1709705872688,"created":1709705567431,"custom":{},"fname":"dev.html.declarative-shadow-dom-guide","type":"note","vault":{"fsPath":"vault"},"contentHash":"5394532025004069b30164d6af23ab7b","links":[],"anchors":{"what-the-heck-is-shadow-dom":{"type":"header","text":"What the heck is “shadow DOM”?","value":"what-the-heck-is-shadow-dom","line":10,"column":0,"depth":2},"imperative-vs-declarative":{"type":"header","text":"“Imperative” vs “declarative”","value":"imperative-vs-declarative","line":24,"column":0,"depth":2},"use-cases":{"type":"header","text":"Use cases","value":"use-cases","line":58,"column":0,"depth":2},"style-scoping-and-cascading":{"type":"header","text":"Style scoping and cascading","value":"style-scoping-and-cascading","line":84,"column":0,"depth":2},"shadow-dom-is-still-problematic":{"type":"header","text":"Shadow DOM is still problematic","value":"shadow-dom-is-still-problematic","line":142,"column":0,"depth":2},"usage-within-frameworks":{"type":"header","text":"Usage within frameworks","value":"usage-within-frameworks","line":168,"column":0,"depth":2}},"children":[],"parent":"J5O6LCmOghKhFwQFKeoow","data":{}},"body":"\u003ch1 id=\"a-practical-guide-to-using-shadow-dom\"\u003eA practical guide to using shadow DOM\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#a-practical-guide-to-using-shadow-dom\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://www.mayank.co/blog/declarative-shadow-dom-guide/\"\u003ehttps://www.mayank.co/blog/declarative-shadow-dom-guide/\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"what-the-heck-is-shadow-dom\"\u003e\u003ca href=\"https://www.mayank.co/blog/declarative-shadow-dom-guide/#what-the-heck-is-shadow-dom\"\u003eWhat the heck is “shadow DOM”?\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#what-the-heck-is-shadow-dom\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eThere have been hundreds of attempts at explaining shadow DOM, and it still remains confusing for many developers. I find that the \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/Web_components/Using_shadow_DOM\"\u003eMDN page for shadow DOM\u003c/a\u003e does a pretty decent job of explaining it, so I’d recommend reading it if you haven’t already. (Fun fact: When I started writing this post, MDN didn’t even document the \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/Web_components/Using_shadow_DOM#declaratively_with_html\"\u003edeclarative syntax\u003c/a\u003e)\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eShadow DOM enables you to attach a DOM tree to an element, and have the internals of this tree hidden from JavaScript and CSS running in the page.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eThere is one frequently-misunderstood bit that I’d like to clear up though. Regular DOM content (commonly known as “light DOM”) can be \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/Element/slot\"\u003e\u003cem\u003eslotted\u003c/em\u003e\u003c/a\u003e inside shadow DOM. The shadow trees can be thought of as donuts, where the holes may be filled by light DOM content. This light DOM content continues to stay in the light DOM (rather than being somehow “transported” into the shadow DOM). The content from shadow DOM and light DOM is then interleaved to create the final DOM tree.\u003c/p\u003e\n\u003cp\u003eVisualization showing how light DOM and shadow DOM can be interleaved to create a combined final tree. Show separate trees\u003c/p\u003e\n\u003cp\u003eTo really drive this point home, I recommend enabling “user-agent shadow DOM” in devtools. This will allow you to peek inside the shadow DOM of built-in DOM elements (such as \u003ccode\u003e\u0026#x3C;details\u003e\u003c/code\u003e). The content that you pass into these elements stays in the light DOM, and only gets “revealed” by the user-agent shadow DOM.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://www.mayank.co/_astro/details-shadow-dom.5qr6msYq_Z1kyELs.webp\"\u003eScreenshot of Chrome devtools showing the internal shadow DOM of the details element, containing two slots, one for the summary and another for the details content, both of which are revealed in the light DOM\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"imperative-vs-declarative\"\u003e\u003ca href=\"https://www.mayank.co/blog/declarative-shadow-dom-guide/#imperative-vs-declarative\"\u003e“Imperative” vs “declarative”\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#imperative-vs-declarative\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003ePreviously, we had to rely on client-side JavaScript to \u003cem\u003eimperatively\u003c/em\u003e attach a shadow root to an element.\u003c/p\u003e\n\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003eelement\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eattachShadow\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e mode\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"open\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nelement\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eshadowRoot\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003einnerHTML\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token html language-html\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ep\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003eHello from the shadows!\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003ep\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis JavaScript requirement made shadow DOM a non-starter for the vast majority of use cases. I used it almost exclusively for optional enhancements that are not critical to the initial page load. Even then, the developer ergonomics of imperatively attaching a shadow root and populating its content felt awkward at best. And of course, it simply does not work when JavaScript isn’t available.\u003c/p\u003e\n\u003cp\u003eWith \u003cem\u003edeclarative\u003c/em\u003e shadow DOM, we can now express our shadow trees right in our HTML! The browser will attach the shadow root as soon as it encounters it, before any JavaScript even loads.\u003c/p\u003e\n\u003cpre class=\"language-html\"\u003e\u003ccode class=\"language-html\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ediv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003etemplate\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eshadowrootmode\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eopen\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ep\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003eThis is \"hidden\" inside shadow DOM\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003ep\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eslot\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eslot\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003etemplate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ep\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003eThis is the regular ol' content\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003ep\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003ediv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe \u003ccode\u003e\u0026#x3C;template\u003e\u003c/code\u003e will also be automatically removed from the DOM, so when you the inspect the element in dev tools, it feels as if the shadow root came pre-attached with the element.\u003c/p\u003e\n\u003cp\u003e(And yes, shadow DOM can be used with \u003ccode\u003e\u0026#x3C;div\u003e\u003c/code\u003e, as well as some \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/Element/attachShadow#elements_you_can_attach_a_shadow_to\"\u003eother built-in elements\u003c/a\u003e, including \u003ccode\u003e\u0026#x3C;body\u003e\u003c/code\u003e, \u003ccode\u003e\u0026#x3C;p\u003e\u003c/code\u003e, and \u003ccode\u003e\u0026#x3C;span\u003e\u003c/code\u003e.)\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://www.mayank.co//_astro/shadowroot-devtools.ydyS5wmq_u5ffD.webp\"\u003eScreenshot of Chrome devtools showing an expanded shadow-root, with a slot revealing the light DOM content\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eA couple more important things to note:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eDeclarative shadow DOM is an \u003ca href=\"https://developer.chrome.com/docs/css-ui/declarative-shadow-dom#parser-only\"\u003eHTML parser feature\u003c/a\u003e. It will not work if you try to set it inside \u003ccode\u003einnerHTML\u003c/code\u003e, for example. To create shadow trees from within JavaScript, the imperative \u003ccode\u003eattachShadow\u003c/code\u003e method should be used instead (at least until we get new DOM APIs like \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/Element/setHTML\"\u003e\u003ccode\u003esetHTML\u003c/code\u003e\u003c/a\u003e).\u003c/li\u003e\n\u003cli\u003eBe careful about newlines. Writing \u003ccode\u003e\u0026#x3C;template\u003e\u003c/code\u003e in its own line makes sense for readability, but you might inadvertently end up slotting whitespace into the default \u003ccode\u003e\u0026#x3C;slot\u003e\u003c/code\u003e (and thereby overriding the fallback slot content) if you have nothing else in the light DOM.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"use-cases\"\u003e\u003ca href=\"https://www.mayank.co/blog/declarative-shadow-dom-guide/#use-cases\"\u003eUse cases\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#use-cases\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eI often get asked “Why should I care about shadow DOM?” Well, here’s a non-exhaustive list of ways in which shadow DOM can come in handy today:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003einvisible \u003ca href=\"https://www.mayank.co/blog/hover-triangles\"\u003ehover triangles\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003einvisible rectangles for increasing \u003ca href=\"https://ishadeed.com/article/target-size\"\u003etap target size\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e”handles” for resizing and dragging dialogs/panels/columns\u003c/li\u003e\n\u003cli\u003ewrapper elements for \u003ca href=\"https://github.com/bvaughn/react-window\"\u003evirtual scrolling/windowing\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003esibling elements for \u003ca href=\"https://react-spectrum.adobe.com/react-aria/FocusScope.html\"\u003efocus trapping\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e”overlapping”/duplicated elements (such as \u003ca href=\"https://github.blog/2023-06-21-crafting-a-better-faster-code-view/#how-the-pieces-fit-together\"\u003eGitHub’s code view\u003c/a\u003e)\u003c/li\u003e\n\u003cli\u003edecorative hover effects and animations for landing pages\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.tpgi.com/the-anatomy-of-visually-hidden/\"\u003evisually-hidden\u003c/a\u003e text for improved accessibility\u003c/li\u003e\n\u003cli\u003evisual hints for drag-and-drop interfaces\u003c/li\u003e\n\u003cli\u003e3D objects and complex SVGs\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://lamplightdev.com/blog/2024/01/10/streaming-html-out-of-order-without-javascript/\"\u003eout-of-order HTML streaming\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003echanging or enforcing source order of slotted content\u003c/li\u003e\n\u003cli\u003e”passthrough”/noop shadow roots to access shadowDOM-specific features (such as \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/HTMLSlotElement/slotchange_event\"\u003e\u003ccode\u003eslotchange\u003c/code\u003e\u003c/a\u003e)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eIn almost all of the above cases, most of the critical content stays in the light DOM, and shadow DOM is only used for enhancing the baseline experience and/or hiding unimportant implementation details. Even if some of these things could be achieved using light DOM only, I find it valuable to hide the messy bits inside shadow DOM. It greatly improves the debugging experience, by reducing the amount of \u003ca href=\"https://css-tricks.com/twitters-div-soup-and-uglyfied-css-explained/\"\u003ediv soup\u003c/a\u003e generated in the light DOM tree. It also allows me to opaquely make changes within shadow DOM without affecting any of the “outside” DOM selectors and such.\u003c/p\u003e\n\u003cp\u003eThere are also some scenarios where complete encapsulation may be desired, in which case the content can be fully rendered (rather than slotted) inside shadow DOM:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eisolated iframe-like views (e.g. interactive demos, like the one above)\u003c/li\u003e\n\u003cli\u003ethird-party widgets and ads\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://microfrontend.dev/\"\u003emicrofrontends\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"style-scoping-and-cascading\"\u003e\u003ca href=\"https://www.mayank.co/blog/declarative-shadow-dom-guide/#style-scoping-and-cascading\"\u003eStyle scoping and cascading\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#style-scoping-and-cascading\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eIt is very important to understand how styles work in shadow DOM.\u003c/p\u003e\n\u003cp\u003ePerhaps the easiest thing to understand is that styles inside a shadow tree do not affect anything outside it, and styles outside the shadow tree do not affect anything inside it. This is a stronger form of scoped styling (more accurately called “style encapsulation”), in that it allows you to write very weak selectors, at the expense of giving up the ability to use external styles.\u003c/p\u003e\n\u003cpre class=\"language-html\"\u003e\u003ccode class=\"language-html\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ehead\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003estyle\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token style\"\u003e\u003cspan class=\"token language-css\"\u003e\n    \u003cspan class=\"token selector\"\u003ep\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003ecolor\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token color\"\u003eblue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003estyle\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003ehead\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ebody\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ediv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003etemplate\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eshadowrootmode\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eopen\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n      \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003estyle\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token style\"\u003e\u003cspan class=\"token language-css\"\u003e\n        \u003cspan class=\"token selector\"\u003ep\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n          \u003cspan class=\"token property\"\u003ecolor\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token color\"\u003ered\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n      \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003estyle\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n      \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ep\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003eThis is red.\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003ep\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n      \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eslot\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eslot\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003etemplate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ep\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003eThis is blue.\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003ep\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003ediv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003ebody\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWhat may not be obvious is that \u003ca href=\"https://knowler.dev/blog/a-mental-model-for-styling-the-shadow-dom\"\u003eshadow DOM styles are cascaded \u003cem\u003ebefore\u003c/em\u003e document styles\u003c/a\u003e. This means that \u003ccode\u003e:host\u003c/code\u003e styles will always lose to any “outside” styles, regardless of specificity (unless you use \u003ccode\u003e!important\u003c/code\u003e).\u003c/p\u003e\n\u003cpre class=\"language-html\"\u003e\u003ccode class=\"language-html\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ehead\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003estyle\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token style\"\u003e\u003cspan class=\"token language-css\"\u003e\n    \u003cspan class=\"token selector\"\u003e\u003cspan class=\"token pseudo-class\"\u003e:where\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ediv\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003ecolor\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token color\"\u003eblue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003estyle\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003ehead\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ebody\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ediv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003etemplate\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eshadowrootmode\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eopen\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n      \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003estyle\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token style\"\u003e\u003cspan class=\"token language-css\"\u003e\n        \u003cspan class=\"token selector\"\u003e\u003cspan class=\"token pseudo-class\"\u003e:host\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n          \u003cspan class=\"token property\"\u003ecolor\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token color\"\u003ered\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n      \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003estyle\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n      \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ep\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003eThis is also blue!\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003ep\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n      \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eslot\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eslot\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003etemplate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ep\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003eThis is blue.\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003ep\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003ediv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003ebody\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eLastly, \u003ca href=\"https://css-tricks.com/styling-in-the-shadow-dom-with-css-shadow-parts/\"\u003eCSS shadow parts\u003c/a\u003e can be used to selectively allow external styles into shadow DOM. I won’t bother explaining it, because there are many existing guides on the topic, and frankly, I’ve never needed to use it. Custom properties and slots can go pretty far already.\u003c/p\u003e\n\u003ch2 id=\"shadow-dom-is-still-problematic\"\u003e\u003ca href=\"https://www.mayank.co/blog/declarative-shadow-dom-guide/#shadow-dom-is-still-problematic\"\u003eShadow DOM is still problematic\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#shadow-dom-is-still-problematic\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eI find it very strange that we didn’t have a declarative syntax for using shadow DOM until just now. Better late than never, I suppose. Still, it’s just a \u003cem\u003esyntax\u003c/em\u003e. It does not really fix any of the larger \u003ca href=\"https://www.matuzo.at/blog/2023/pros-and-cons-of-shadow-dom/\"\u003eproblems with shadow DOM\u003c/a\u003e, most importantly around \u003ca href=\"https://github.com/WICG/webcomponents/issues/909\"\u003estyling\u003c/a\u003e, \u003ca href=\"https://alice.pages.igalia.com/blog/how-shadow-dom-and-accessibility-are-in-conflict/\"\u003eaccessibility\u003c/a\u003e, and \u003ca href=\"https://kinsta.com/blog/web-components/#ignored-inputs\"\u003eform participation\u003c/a\u003e. In fact, declarative shadow DOM introduces another problem of having to repeat the \u003ccode\u003e\u0026#x3C;template\u003e\u003c/code\u003e for every single instance.\u003c/p\u003e\n\u003cp\u003eI’ve been able to work around the main styling issues by manually injecting my global stylesheets into all shadow trees. However, this is not a proper solution and only works for my own components (unless I rely on JavaScript, which… no thanks).\u003c/p\u003e\n\u003cpre class=\"language-html\"\u003e\u003ccode class=\"language-html\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003etemplate\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eshadowrootmode\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eopen\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003elink\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003erel\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003estylesheet\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ehref\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eutilities.css\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003espan\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eclass\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003evisually-hidden\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003eUtility classes work!\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003espan\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eslot\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eslot\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003etemplate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eTo get around the other issues, here’s my rule of thumb: do \u003cem\u003enot\u003c/em\u003e put any interactive form controls or semantically-important elements inside shadow DOM. As long as these stay in the light DOM and are slotted into shadow DOM, we can avoid most of the shadow nonsense. As a bonus, common patterns like \u003ccode\u003edocument.activeElement\u003c/code\u003e and \u003ccode\u003e:has(:focus-visible)\u003c/code\u003e will work correctly, and the debugging experience will also be improved.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e// ❌\u0026#x3C;my-input\u003e\u0026#x3C;/my-input\u003e\n// ✅\u0026#x3C;my-input\u003e \u0026#x3C;input /\u003e\u0026#x3C;/my-input\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode\u003e// ❌\u0026#x3C;my-button\u003e\u0026#x3C;/my-button\u003e\n// ✅\u0026#x3C;my-button\u003e \u0026#x3C;button\u003e…\u0026#x3C;/button\u003e\u0026#x3C;/my-button\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"usage-within-frameworks\"\u003e\u003ca href=\"https://www.mayank.co/blog/declarative-shadow-dom-guide/#usage-within-frameworks\"\u003eUsage within frameworks\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#usage-within-frameworks\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eMost of us are probably building websites using some kind of framework, or at least a templating engine. I think frameworks play a crucial role in using shadow DOM at scale, particularly because \u003ca href=\"https://www.mayank.co/blog/web-components-are-not-components\"\u003eweb components are not components\u003c/a\u003e. These frameworks can effectively serve as a polyfill for some of the missing web component APIs.\u003c/p\u003e\n\u003cp\u003eBroadly speaking, there are two kinds of web frameworks, and declarative shadow DOM interacts differently with them.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003eServer-first frameworks\u003c/strong\u003e (e.g. Astro, WebC, Enhance): Since these frameworks are primarily concerned with producing HTML on the server, declarative shadow DOM generally works fine here (as long as you manage to produce the correct HTML).\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eClient-first frameworks\u003c/strong\u003e (e.g. (P)react, Vue, Svelte): These frameworks support server-side rendering, but they tend to “hydrate” (recreate) the server-generated markup on the client, which does not play well with declarative shadow DOM. It’s possible to work around though, by using imperative code on the client.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eI’ll have a more detailed follow-up post demonstrating how declarative shadow DOM can be used within various frameworks, so stay tuned. 👀\u003c/p\u003e\n\u003cp\u003eYou may have noticed I didn’t mention custom elements anywhere in this article. That’s not an accident. Custom elements and shadow DOM are independent web component APIs that do not always need to be used together. Custom elements may be completely unnecessary when using a client-side JavaScript framework which already knows how to manage its own rendering lifecycle. In such cases, it totally makes sense to use shadow DOM without custom elements.\u003c/p\u003e","noteIndex":{"id":"Iy0MoL0KnL55Br3AfTS2C","title":"Luke","desc":"","updated":1761796791487,"created":1644449449778,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":"vault"},"contentHash":"4e745570ca97988a0362cb939b760952","links":[{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"life-tips","position":{"start":{"line":41,"column":5,"offset":2603},"end":{"line":41,"column":29,"offset":2627},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"life-tips","anchorHeader":"wodenokoto"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"journal.what-i-read-in.2025","alias":"What I read in 2025","position":{"start":{"line":70,"column":3,"offset":4333},"end":{"line":70,"column":54,"offset":4384},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"journal.what-i-read-in.2025"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"journal.what-i-read-in.2024","alias":"2024","position":{"start":{"line":71,"column":5,"offset":4389},"end":{"line":71,"column":41,"offset":4425},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"journal.what-i-read-in.2024"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"journal.what-i-read-in.2023","alias":"2023","position":{"start":{"line":72,"column":5,"offset":4430},"end":{"line":72,"column":41,"offset":4466},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"journal.what-i-read-in.2023"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"journal.what-i-read-in.2022","alias":"2022","position":{"start":{"line":73,"column":5,"offset":4471},"end":{"line":73,"column":41,"offset":4507},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"journal.what-i-read-in.2022"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"journal.what-i-struggled-brag-in","position":{"start":{"line":79,"column":3,"offset":4643},"end":{"line":79,"column":39,"offset":4679},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"journal.what-i-struggled-brag-in"}}],"anchors":{"what-i-read-in-past":{"type":"header","text":"What I read in past","value":"what-i-read-in-past","line":74,"column":0,"depth":2}},"children":["zd4mq442jike0pr0wba1u3m","6hzeqsofq67gdk88flxlkhp","778ijii93yu5uwnrwmn5zi4","g1fngdjl25nes6fs3lip602","ZbdkdApFqLdks4Moq92R9","uoc5hhki3o4py15cesddu8q","9qf7j06jtdkm6rnx9ymvwb0","5zn10cvj7ajy2gh2is5nqmg","4qo9ma0z0yu1czns6pxl7y5","ok0e729ho7o09xetujkxc0m","GR5x8HnNFEN6fU2UBSEIK","yirtnlj8q24yutcf3ss1xqy","eq0wc6t7wl2wv221yb68ro4","7x2fnv4j6gxts08qk0jguny","ettkt3iClONnxpbGwBVLl","7l4knev6v613tbuoskvmbdg","hvh5bud6yp7dc89tuh95tr9","4fvoqrplw0cweo554usbjos","f8qsfql0a9v8thpeo82udfa","1swsbrhqi9jk41v9eodyi5q","SQqYupi6EFddTerBA8RRD","hjNeNc1F2JUh0lTWanH4h","qf0l4wbrc9jgooyzexmbq5v","uur1lkol353z9vfeqb3n5bv","cd9n1czq3ursgkby985wkmm","k1sr43vwnfqztwc0s43pkcf","wfde75rhdvq2yfa2zy2q6rv","rjcmdv60jokmbw6zoq8u2ef","ujapvww8o6v3kpmlhtryq4k","pkwewou9d5e8ystswn1j2b4"],"parent":null,"data":{},"body":"\nHi there 👋. I'm a Front-end developer.\n\n---\n\n- 단순함과 꾸준함은 가장 쉬우면서도 지키기 어려운 원칙.\n\n- 🥱 -\u003e 🤔💡🌱 - [On The Death of Daydreaming](https://www.afterbabel.com/p/on-the-death-of-daydreaming)\n  - boredom -\u003e easy fun -\u003e art -\u003e profit?\n\n\u003e I've often described my motivation for building software to others using imagery: I like to go find a secluded beach, build a large, magnificent sand castle, and then walk away. Will anyone notice? Probably not. Will the waves eventually destroy it? Yep. Did I still get immense satisfaction? Absolutely. - [aliasxneo](https://news.ycombinator.com/item?id=41497113)\n\n\u003e We love to see the process, not just the result. The imperfections in your work can be beautiful if they show your struggle for perfection, not a lack of care. - [ralphammer](https://ralphammer.com/is-perfection-boring/)\n\n\u003e Simplicity, even if it sacrifices some ideal functionality has better survival characteristics than the-right-thing. - [The Rise of Worse is Better](https://www.dreamsongs.com/RiseOfWorseIsBetter.html)\n\n\u003e [Roberto Blake was talking about making 100 crappy videos](https://www.youtube.com/watch?v=OnUBaQ1Sp_E) to get better over time. Putting in the reps and improving a little bit each time.\n\u003e\n\u003e Putting in the work without expecting any external reward at first (eg views, followers, likes, etc) will pay off in the long run. - [100 Scrappy Things](https://www.florin-pop.com/blog/100-scrappy-things/)\n\n\u003e Make the difficult habitual, the habitual easy, and the easy beautiful. - [Constantin S. Stanislavski](https://www.goodreads.com/quotes/7102271-make-the-difficult-habitual-the-habitual-easy-and-the-easy)\n\n\u003e A good match is a **structured** dance, where players aim to **score** while they are following well-defined **rules**. This **freedom within a structure** is what makes it fun. - [ralphammer](https://ralphammer.com/how-to-get-started/)\n\n- [Pivot Points](https://longform.asmartbear.com/pivot-points/)\n\n  - non-judgmental aspects of personality that can be strengths in some contexts and weaknesses in others\n  - Pivot Points are fixed in the short term\n\n- [Hedged Bets](https://longform.asmartbear.com/predict-the-future/#hedged-bets)\n  - trading slightly less maximum upside for predictable, net-positive outcomes.\n\n\u003e “Motivation often comes after starting, not before. Action produces momentum.”\n\u003e [When you start a new habit, it should take less than two minutes to do.](https://jamesclear.com/how-to-stop-procrastinating)\n\u003e\n\u003e - James Clear\n\n\u003e Focus is more about **not** keeping busy when you need to wait for something.  \n\u003e Eat the boredom for a minute.\n\u003e\n\u003e - [[life-tips#wodenokoto]]\n\n\u003e [4 minutes run hard enough to push heart rate to 90%, 3 minutes recover, repeat 4 times](https://news.ycombinator.com/item?id=34213181)\n\u003e\n\u003e - https://www.ntnu.edu/cerg/advice\n\u003e - [Get running with Couch to 5K](https://www.nhs.uk/live-well/exercise/running-and-aerobic-exercises/get-running-with-couch-to-5k/)\n\n\u003e [recommended routine - bodyweightfitness](https://www.reddit.com/r/bodyweightfitness/wiki/kb/recommended_routine/) - I Don't Have This Much Time!\n\u003e\n\u003e - Don't workout at all (saves anywhere from 20 to 60 minutes, but really, really, really, really, really, really, really, really, really not recommended)\n\n\u003e 도무지 읽히지 않는 책 앞에서 내가 택한 방법은 펼쳐진 페이지 앞에서 멍때리기이다. 다르게 표현하면 이렇다. 펼쳐진 두 페이지 앞에서 오래 머물기.\n\u003e\n\u003e 책을 펼쳐놓는 것으로 충분하다. 읽지 못해도 좋다. 매일 정해진 진도를 나가야 하는 학교 수업이 아니니까. 하지만 읽지 않아도 괜찮다고 해서 펼쳐두지조차 않으면 곤란하다. 가능한 한 자주 책을 펼쳐두도록 하자. 전혀 읽지 않고 멍하니 바라보고 있다가 다시 덮게 되더라도\n\u003e\n\u003e - 막막한 독서. 시로군. P.10~13\n\n\u003e I think it should be everyone's primary focus to sleep well, drink water, get outside, get active, and eat generally decently. I hate to say it, but if you're not eating a good amount of vegetables and fruit, decent protein, sleep, etc, no amount of XYZ will catch up to that detriment. - [CE02](https://news.ycombinator.com/item?id=35056071)\n\n\u003e My real battle is doing good versus doing nothing. - [Deirdre Sullivan](https://www.npr.org/2005/08/08/4785079/always-go-to-the-funeral)\n\n[Kind Engineering](https://kind.engineering/) - How To Engineer Kindness\n\n\u003e Sometimes magic is just someone spending more time on something than anyone else might reasonably expect. - [Teller](https://www.goodreads.com/quotes/6641527-sometimes-magic-is-just-someone-spending-more-time-on-something)\n\n---\n\n## What I read in past\n\n- [[What I read in 2025|journal.what-i-read-in.2025]]\n  - [[2024|journal.what-i-read-in.2024]]\n  - [[2023|journal.what-i-read-in.2023]]\n  - [[2022|journal.what-i-read-in.2022]]\n- 📝 [Gists](https://gist.github.com/Luke-SNAW)\n- 📜 [Journals](https://luke-snaw.github.io/Luke-SNAW__netlify-CMS.github.io/)\n\n---\n\n- [[journal.what-i-struggled-brag-in]]\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":true,"vaultSelectionModeOnCreate":"smart","leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2}},"randomNote":{},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":"vault"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link","taskCompleteStatus":["done","x"]},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"enableUserTags":false,"enableHashTags":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"enableEditorDecorations":true,"maxPreviewsCached":10,"maxNoteLength":204800,"dendronVersion":"0.115.0","enableFullHierarchyNoteTitle":false,"enablePersistentHistory":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false,"enableFrontmatterTags":true,"enableHashesForFMTags":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Luke SNAW","description":"Personal knowledge space"},"github":{"enableEditLink":false,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"searchMode":"lookup","siteUrl":"https://luke-snaw.github.io/","duplicateNoteBehavior":{"action":"useVault","payload":["vault"]},"siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"b6u18z9o90yxv9ww6d2jd54"},"buildId":"vOE8u-mg___OsOsz4tjEg","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>