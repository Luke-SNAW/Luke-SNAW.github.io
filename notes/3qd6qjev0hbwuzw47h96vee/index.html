<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" href="/favicon.ico"/><title>Clean Architecture on Frontend</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Personal knowledge space"/><meta property="og:title" content="Clean Architecture on Frontend"/><meta property="og:description" content="Personal knowledge space"/><meta property="og:url" content="https://luke-snaw.github.io//notes/3qd6qjev0hbwuzw47h96vee/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="11/7/2022"/><meta property="article:modified_time" content="11/7/2022"/><meta property="article:tag" content="architecture"/><link rel="canonical" href="https://luke-snaw.github.io//notes/3qd6qjev0hbwuzw47h96vee/"/><meta name="next-head-count" content="15"/><link rel="preload" href="/_next/static/css/8e7b7e4bce421c0a.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8e7b7e4bce421c0a.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-3d209faeb64f2f97.js" defer=""></script><script src="/_next/static/chunks/framework-28c999baf2863c3d.js" defer=""></script><script src="/_next/static/chunks/main-104451f3d1a5c4bc.js" defer=""></script><script src="/_next/static/chunks/pages/_app-9d8e0603730b15a3.js" defer=""></script><script src="/_next/static/chunks/935-4dee79e80b8641c6.js" defer=""></script><script src="/_next/static/chunks/6-50972def09142ee2.js" defer=""></script><script src="/_next/static/chunks/pages/notes/%5Bid%5D-78d472fa3b924116.js" defer=""></script><script src="/_next/static/vOE8u-mg___OsOsz4tjEg/_buildManifest.js" defer=""></script><script src="/_next/static/vOE8u-mg___OsOsz4tjEg/_ssgManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div style="display:flex" class="ant-col ant-col-xs-20 ant-col-sm-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"><div class="ant-select ant-select-lg ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-show-search" style="width:100%"><div class="ant-select-selector"><span class="ant-select-selection-search"><input type="search" autoComplete="off" class="ant-select-selection-search-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span><span class="ant-select-selection-placeholder">For full text search please use the &#x27;?&#x27; prefix. e.g. ? Onboarding</span></div></div></div><div style="display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout" style="margin-top:64px;display:flex;flex-direction:row"><div class="site-layout-sidebar" style="flex:0 0 auto;width:calc(max((100% - 992px) / 2, 0px) + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);background-color:transparent;flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></div><main class="ant-layout-content side-layout-main" style="max-width:1200px;min-width:0;display:block"><div style="padding:0 24px"><div class="main-content" role="main"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h1 id="clean-architecture-on-frontend">Clean Architecture on Frontend<a aria-hidden="true" class="anchor-heading icon-link" href="#clean-architecture-on-frontend"></a></h1>
<blockquote>
<p><a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/">https://bespoyasov.me/blog/clean-architecture-on-frontend/</a></p>
</blockquote>
<p>Not very long ago I gave a talk about the clean architecture on frontend. In this post, I'm summarizing that talk and expanding it a bit with details and concepts I didn't have time to explain.</p>
<p>I'll put links here to all sorts of useful stuff that will come in handy as you read:</p>
<ul>
<li><a href="https://youtu.be/ThgqBecaq_w">The Public Talk</a></li>
<li><a href="https://bespoyasov.ru/talks/podlodka-conf-clean-architecture/en.html">Slides for the Talk</a></li>
<li><a href="https://github.com/bespoyasov/frontend-clean-architecture">The source code for the application we're going to design</a></li>
<li><a href="https://bespoyasov.me/showcase/frontend-clean-architecture/">Sample of a working application</a></li>
</ul>
<h2 id="whats-the-plan">What's the Plan<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#whats-the-plan">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#whats-the-plan"></a></h2>
<p>First, we'll talk about what the clean architecture is in general and get familiar with such concepts as domain, use case and application layers. Then we'll discuss how this applies to the frontend and whether it's worth it at all.</p>
<p>Next, we'll design the frontend for a cookie store following the rules of the clean architecture. And finally, we'll implement one of the use cases from scratch to see if it's usable.</p>
<p>The store will use React as its UI framework just to show that this approach can be used with it as well. (And because the talk this post is based on was addressed to developers who already use React 😄) Although React is not necessary, you can use everything I show in this post with other UI libs or frameworks too.</p>
<p>There will be a little TypeScript in the code, but only to show how to use types and interfaces to describe entities. Everything we'll look at today can be used without TypeScript, except the code won't be as expressive.</p>
<p>We will hardly talk about OOP today, so this post should not cause any severe allergies. We will only mention OOP once at the end, but it won't stop us from designing an application.</p>
<p>Also, we'll skip tests today because they are not the main topic of this post. I will keep in mind testability though and mention how to improve it along the way.</p>
<p>And finally, this post is mostly about you grasping the concept of clean architecture. The examples in the post are simplified, so it isn't literal instruction on how to write the code. Understand the idea and think about how you can apply these principles in your projects.</p>
<p>At the end of the post, you can find a list of methodologies that are related to clean architecture and used on the frontend more widely. So you can find a best fit depending on the size of your project.</p>
<p>And now, let's dig in!</p>
<h2 id="architecture-and-design">Architecture and Design<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#architecture-and-design">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#architecture-and-design"></a></h2>
<blockquote>
<p>Designing is fundamentally about taking things apart... in such a way that they can be put back together. ...Separating things into things that can be composed that's what design is.<br>
— Rich Hickey. <a href="https://www.infoq.com/presentations/Design-Composition-Performance/">Design Composition and Performance</a></p>
</blockquote>
<p>System design, says the quote in the epigraph, is the system separation so that it can be reassembled later. And most importantly, be assembled <em>easily, without too much work</em>.</p>
<p>I agree. But I consider another goal of an architecture to be the extensibility of the system. The demands on the program are constantly changing. We want the program to be easy to update and modify to meet new requirements. The clean architecture can help achieve this goal.</p>
<h2 id="the-clean-architecture">The Clean Architecture<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#the-clean-architecture">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#the-clean-architecture"></a></h2>
<p><a href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html">The clean architecture</a> is a way of separating responsibilities and parts of functionality according to their proximity to the application domain.</p>
<p>By <a href="https://en.wikipedia.org/wiki/Domain_knowledge">the domain</a>, we mean the part of the real world that we model with a program. This is the data transformations that reflect transformations in the real world. For example, if we updated the name of a product, replacing the old name with the new one is a domain transformation.</p>
<p>The Clean Architecture is often referred to as a three-layer architecture, because the functionality in it is divided into layers. The original post about <a href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html">The Clean Architecture</a> provides a diagram with the layers highlighted:</p>
<p><a href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html"><img src="/images/content/clean-architecture-on-frontend/clean-architecture-diagram.jpg" alt="Layer diagram: the domain is in the center, the application layer around it, and the adapters layer on the outside"></a></p>
<p>Layer diagram: the domain is in the center, the application layer around it, and the adapters layer on the outside</p>
<h3 id="domain-layer">Domain Layer<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#domain-layer">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#domain-layer"></a></h3>
<p>At the center is <a href="https://herbertograca.com/2017/11/16/explicit-architecture-01-ddd-hexagonal-onion-clean-cqrs-how-i-put-it-all-together/#domain-layer">the domain layer</a>. It is the entities and data that describe the subject area of the application, as well as the code to transform that data. The domain is the core that distinguishes one application from another.</p>
<p>You can think of the domain as something that won't change if we move from React to Angular, or if we change some use case. In the case of the store, these are products, orders, users, cart, and functions to update their data.</p>
<p>The data structure of domain entities and the essence of their transformations are independent from the outer world. External events <em>trigger domain transformations</em>, but <em>do not determine</em> how they will occur.</p>
<p>The function of adding an item to cart doesn't care how exactly the item was added: by the user himself through the “Buy” button or automatically with a promo code. It will in both cases accept the item and return an updated cart with the added item.</p>
<h3 id="application-layer">Application Layer<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#application-layer">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#application-layer"></a></h3>
<p>Around the domain is <a href="https://herbertograca.com/2017/11/16/explicit-architecture-01-ddd-hexagonal-onion-clean-cqrs-how-i-put-it-all-together/#application-layer">the application layer</a>. This layer describes <a href="https://en.wikipedia.org/wiki/Use_case">use cases</a>, i.e. user scenarios. They are responsible for what happens after some event occurs.</p>
<p>For example, the “Add to cart” scenario is a use case. It describes the actions that are should be taken after the button is clicked. It's the kind of “orchestrator” that says:</p>
<ul>
<li>go to the server, send a request;</li>
<li>now perform this a domain transformation;</li>
<li>now redraw the UI using the response data.</li>
</ul>
<p>Also, in the application layer theree are <a href="https://herbertograca.com/2017/11/16/explicit-architecture-01-ddd-hexagonal-onion-clean-cqrs-how-i-put-it-all-together/#ports">ports</a>—the specifications of how <em>our application wants</em> the outside world to communicate with it. Usually a port is an <a href="https://en.wikipedia.org/wiki/Interface_(computing)#Software_interfaces">interface</a>, a behavior contract.</p>
<p>Ports serve as a “buffer zone” between our application's wishes and the reality. Input Ports tell us how the application <em>wants</em> to be contacted by the outside world. Output Ports say how the application <em>is going to</em> communicate with the outside world to make it ready.</p>
<p>We will look at ports in more detail later.</p>
<h3 id="adapters-layer">Adapters Layer<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#adapters-layer">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#adapters-layer"></a></h3>
<p>The outermost layer contains the <a href="https://herbertograca.com/2017/09/14/ports-adapters-architecture/">adapters</a> to external services. Adapters are needed to turn incompatible APIs of external services into those compatible with our application's wishes.</p>
<p>Adapters are a great way to lower the <a href="https://en.wikipedia.org/wiki/Coupling_(computer_programming)">coupling</a> between our code and the code of third-party services. Low coupling reduces needs to change one module when others are changed.</p>
<p>Adapters are often divided into:</p>
<ul>
<li>driving—which <em>send signals to</em> our application;</li>
<li>driven—which <em>receive the signals from</em> our application.</li>
</ul>
<p><em>The user</em> interacts most often with driving adapters. For example, the UI framework's handling of a button click is the work of a driving adapter. It works with the browser API (basically a third-party service) and converts the event into a signal that our application can understand.</p>
<p>Driven adapters interact with the <em>infrastructure</em>. In the frontend, most of the infrastructure is the backend server, but sometimes we may interact with some other services directly, such as a search engine.</p>
<p>Note that the farther we are from the center, the more “service-oriented” the code functionality is, the <em>farther it is from the domain knowledge</em> of our application. This will be important later on, when we decide which layer any module should belong to.</p>
<h3 id="dependency-rule">Dependency Rule<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#dependency-rule">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#dependency-rule"></a></h3>
<p>The three-layer architecture has a dependency rule: <em>only the outer layers can depend on the inner layers</em>. This means that:</p>
<ul>
<li>the domain must be independent;</li>
<li>the application layer can depend on the domain;</li>
<li>the outer layers can depend on anything.</li>
</ul>
<p><a href="https://herbertograca.com/2017/11/16/explicit-architecture-01-ddd-hexagonal-onion-clean-cqrs-how-i-put-it-all-together/"><img src="/images/content/clean-architecture-on-frontend/hex-pie.png" alt="Only the outer layers can depend on the inner layers"></a></p>
<p>Only the outer layers can depend on the inner layers</p>
<p>Sometimes this rule can be violated, although it is better not to abuse it. For example, it is sometimes convenient to use some “library-like” code in a domain, even though there should be no dependencies. We'll look at an example of this when we get to the source code.</p>
<p>An uncontrolled direction of dependencies can lead to complicated and confusing code. For example, breaking a dependency rule can lead to:</p>
<ul>
<li>Cyclic dependencies, where module A depends on B, B depends on C, and C depends on A.</li>
<li>Poor testability, where you have to simulate the whole system to test a small part.</li>
<li>Too high coupling, and as a consequence, brittle interaction between modules.</li>
</ul>
<h2 id="advantages-of-clean-architecture">Advantages of Clean Architecture<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#advantages-of-clean-architecture">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#advantages-of-clean-architecture"></a></h2>
<p>Now let's talk about what this separation of code gives us. It has several advantages.</p>
<h3 id="separate-domain">Separate domain<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#separate-domain">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#separate-domain"></a></h3>
<p>All the main application functionality is <em>isolated and collected</em> in one place—in the domain.</p>
<p>Functionality in the domain is independent, which means that it is easier to test. The less dependencies the module has, the less infrastructure is needed for testing, the less mocks and stubs are needed.</p>
<p>A stand-alone domain is also easier to test against business expectations. This helps new developers to grasp on what the application should do. In addition, a stand-alone domain helps look for errors and inaccuracies in the “translation” from the business language to the programming language more quickly.</p>
<h3 id="independent-use-cases">Independent Use Cases<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#independent-use-cases">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#independent-use-cases"></a></h3>
<p>Application scenarios, use cases are described separately. They dictate what third-party services we will need. We <em>adapt the outside world</em> to our needs, not the other way around. This gives us more freedom to choose third-party services. For example, we can quickly change the payment system if the current one starts charging too much.</p>
<p>The use case code also becomes flat, testable and extensible. We will see this in an example later on.</p>
<h3 id="replaceable-third-party-services">Replaceable Third-Party Services<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#replaceable-third-party-services">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#replaceable-third-party-services"></a></h3>
<p>External services become replaceable because of adapters. As long as we don't change the interface, it doesn't matter which external service implements the interface.</p>
<p>This way, we create a barrier to change propagation: changes in someone else's code do not directly affect our own. Adapters also <a href="https://bespoyasov.me/blog/patterns-for-fault-tolerant-software/">limit the propagation of bugs</a> in the application runtime.</p>
<h2 id="costs-of-clean-architecture">Costs of Clean Architecture<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#costs-of-clean-architecture">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#costs-of-clean-architecture"></a></h2>
<p>Architecture is first of all a tool. Like any tool, the clean architecture has its costs besides its benefits.</p>
<h3 id="takes-time">Takes Time<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#takes-time">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#takes-time"></a></h3>
<p>The main cost is time. It is required not only for design, but also for implementation, because it is always easier to call a third-party service directly than to write adapters.</p>
<p>It is also difficult to think through the interaction of all the modules of the system in advance, because we may not know all the requirements and constraints beforehand. When designing, we need to keep in mind how the system can change, and leave room for expansion.</p>
<h3 id="sometimes-overly-verbose">Sometimes Overly Verbose<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#sometimes-overly-verbose">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#sometimes-overly-verbose"></a></h3>
<p>In general, a canonical implementation of the clean architecture is not always convenient, and sometimes even harmful. If the project is small, a full implementation will be an overkill that will increase the entry threshold for newcomers.</p>
<p>You may need to make design tradeoffs to stay within budget or deadline. I'll show you by example exactly what I mean by such tradeoffs.</p>
<h2 id="can-make-onboarding-more-difficult">Can Make Onboarding More Difficult<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#can-make-onboarding-more-difficult">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#can-make-onboarding-more-difficult"></a></h2>
<p>Full implementation of the clean architecture can make the onboarding more difficult because any tool requires the knowledge on how to use it.</p>
<p>If you over-engineer at the beginning of a project, it will be harder to onboard new developers later. You have to keep this in mind and keep your code simple.</p>
<h2 id="can-increase-the-amount-of-code">Can Increase the Amount of Code<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#can-increase-the-amount-of-code">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#can-increase-the-amount-of-code"></a></h2>
<p>A problem specific for frontend is that the clean architecture can increase the amount of code in the final bundle. The more code we give to the browser, the more it has to download, parse and interpret.</p>
<p>The amount of code will have to be watched and decisions will have to be made about where to cut corners:</p>
<ul>
<li>maybe describe the use case a little simpler;</li>
<li>maybe access the domain functionality directly from the adapter, bypassing the use case;</li>
<li>maybe we'll have to tweak the code splitting, etc.</li>
</ul>
<h2 id="how-to-reduce-costs">How to Reduce Costs<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#how-to-reduce-costs">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#how-to-reduce-costs"></a></h2>
<p>You can reduce the amount of time and code by cutting corners and sacrificing the “cleanliness” of the architecture. I'm generally not a fan of radical approaches: if it's more pragmatic (e.g. benefits will be higher than potential costs) to break a rule, I'll break it.</p>
<p>So, you can balk at some aspects of the clean architecture for a while with no problem at all. The <em>minimum required</em> amount of resources, however, that are definitely worth devoting to are two things.</p>
<h3 id="extract-domain">Extract Domain<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#extract-domain">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#extract-domain"></a></h3>
<p>The extracted domain helps to understand <em>what</em> we are designing in general and how it should work. The extracted domain makes it easier for new developers to understand the application, its entities and relationships between them.</p>
<p>Even if we skip the other layers, it still will be easier to work and refactor with the extracted domain which is not spread over the code base. Other layers can be added as needed.</p>
<h3 id="obey-dependency-rule">Obey Dependency Rule<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#obey-dependency-rule">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#obey-dependency-rule"></a></h3>
<p>The second rule not to be discarded is the rule of dependencies, or rather their <em>direction</em>. External services must adapt to our need and never otherwise.</p>
<p>If you feel that you are "fine-tuning" your code so that it can call the search API, something is wrong. Better write an adapter before the problem spreads.</p>
<h2 id="designing-the-application">Designing the Application<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#designing-the-application">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#designing-the-application"></a></h2>
<p>Now that we've talked about theory, we can get down to practice. Let's design the architecture of a <a href="https://bespoyasov.me/showcase/frontend-clean-architecture/">cookie store</a>.</p>
<p>The store will sell different kinds of cookies, which may have different ingredients. Users will choose cookies and order them, and pay for the orders in a third-party payment service.</p>
<p>There will be a showcase of cookies that we can buy on the home page. We will only be able to buy cookies if we are authenticated. The login button will take us to a login page where we can log in.</p>
<p><img src="/images/content/clean-architecture-on-frontend/en/app.png" alt="Store main page"></p>
<p>Store main page</p>
<p>(Don't mind how it looks, I'm no web-designer 😄)</p>
<p>After a successful login we will be able to put some cookies in the cart.</p>
<p><img src="/images/content/clean-architecture-on-frontend/en/app-cart.png" alt="Cart with selected cookies"></p>
<p>Cart with selected cookies</p>
<p>When we've put the cookies in the cart, we can place the order. After payment, we get a new order in the list and a cleared shopping cart.</p>
<p>We'll implement the checkout use case. You can find the rest use cases in <a href="https://github.com/bespoyasov/frontend-clean-architecture/tree/master/src/application">the source code</a>.</p>
<p>First we'll define what kind of entities, use cases and functionality in the broad sense we'll have at all. Then let's decide which layer they should belong to.</p>
<h3 id="designing-domain">Designing Domain<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#designing-domain">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#designing-domain"></a></h3>
<p>The most important thing in an application is the domain. It is where the main entities of the application and their data transformations are. I suggest that you start with the domain in order to accurately represent the domain knowledge of the app in your code.</p>
<p>The store domain may include:</p>
<ul>
<li>the data types of each entity: user, cookie, cart, and order;</li>
<li>the factories for creating each entity, or classes if you write in OOP;</li>
<li>and transformation functions for that data.</li>
</ul>
<p>The transformation functions in the domain should depend only on the rules of the domain and nothing else. Such functions would be, for example:</p>
<ul>
<li>a function for calculating the total cost;</li>
<li>user's taste preference detection</li>
<li>determining whether an item is in the shopping cart, etc.</li>
</ul>
<p><img src="/images/content/clean-architecture-on-frontend/layers-domain.png" alt="Domain entities diagram"></p>
<p>Domain entities diagram</p>
<h3 id="designing-application-layer">Designing Application Layer<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#designing-application-layer">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#designing-application-layer"></a></h3>
<p>The application layer contains the use cases. A use case always has an actor, an action, and a result.</p>
<p>In the store, we can distinguish:</p>
<ul>
<li>A product purchase scenario;</li>
<li>payment, calling third-party payment systems;</li>
<li>interaction with products and orders: updating, browsing;</li>
<li>access to pages depending on roles.</li>
</ul>
<p>Use cases are usually described in terms of the subject area. For example, the “checkout” scenario actually consists of several steps:</p>
<ul>
<li>retrieve items from the shopping cart and create a new order;</li>
<li>pay for the order;</li>
<li>notify the user if the payment fails;</li>
<li>clear the cart and show the order.</li>
</ul>
<p>The use case function will be the code that describes this scenario.</p>
<p>Also, in the application layer there are ports—interfaces for communicating with the outside world.</p>
<p><img src="/images/content/clean-architecture-on-frontend/layers-application.png" alt="Use cases and ports diagram"></p>
<p>Use cases and ports diagram</p>
<h3 id="designing-adapters-layer">Designing Adapters Layer<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#designing-adapters-layer">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#designing-adapters-layer"></a></h3>
<p>In the adapters layer, we declare adapters to external services. Adapters make incompatible APIs of third-party services compatible to our system.</p>
<p>On the frontend, adapters are usually the UI framework and the API server request module. In our case we will use:</p>
<ul>
<li>UI-framework;</li>
<li>API request module;</li>
<li>Adapter for local storage;</li>
<li>Adapters and converters of API answers to the application layer.</li>
</ul>
<p><img src="/images/content/clean-architecture-on-frontend/layers-adapters.png" alt="Adapters diagram with splitting by driving and driven adapters"></p>
<p>Adapters diagram with splitting by driving and driven adapters</p>
<p>Note that the more functionality is “service-like”, the farther away it is from the center of the diagram.</p>
<h3 id="using-mvc-analogy">Using MVC Analogy<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#using-mvc-analogy">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#using-mvc-analogy"></a></h3>
<p>Sometimes it's hard to know which layer some data belongs to. A small (and incomplete!) analogy with <a href="https://en.wikipedia.org/wiki/Model-view-controller">MVC</a> may help here:</p>
<ul>
<li>models are usually domain entities,</li>
<li>controllers are domain transformations and application layer,</li>
<li>view is driving adapters.</li>
</ul>
<p>The concepts are different in detail but quite similar, and this analogy can be used to define domain and application code.</p>
<h2 id="into-details-domain">Into Details: Domain<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#into-details-domain">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#into-details-domain"></a></h2>
<p>Once we've determined <em>what</em> entities we'll need, we can start defining <em>how</em> they behave.</p>
<p>I'll show you the code structure in <a href="https://github.com/bespoyasov/frontend-clean-architecture/">project</a> right away. For clarity, I divide the code into folders-layers.</p>
<pre><code>src/
|_domain/
  |_user.ts
  |_product.ts
  |_order.ts
  |_cart.ts
|_application/
  |_addToCart.ts
  |_authenticate.ts
  |_orderProducts.ts
  |_ports.ts
|_services/
  |_authAdapter.ts
  |_notificationAdapter.ts
  |_paymentAdapter.ts
  |_storageAdapter.ts
  |_api.ts
  |_store.tsx
|_lib/
|_ui/
</code></pre>
<p>The domain is in the <code>domain/</code> directory, the application layer is in <code>application/</code>, and the adapters are in <code>services/</code>. We will discuss alternatives to this code structure at the end.</p>
<h3 id="creating-domain-entities">Creating Domain Entities<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#creating-domain-entities">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#creating-domain-entities"></a></h3>
<p>We will have 4 modules in the domain:</p>
<ul>
<li>product;</li>
<li>user;</li>
<li>order;</li>
<li>shopping cart.</li>
</ul>
<p>The main actor is the user. We will store data about the user in the storage during the session. We want to type this data, so we will create a domain user type.</p>
<p>The user type will contain ID, name, mail and lists of preferences and allergies.</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// domain/user.ts</span>

<span class="token keyword module">export</span> <span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">UserName</span></span> <span class="token operator">=</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token keyword module">export</span> <span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">User</span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token maybe-class-name">UniqueId</span><span class="token punctuation">;</span>
  name<span class="token operator">:</span> <span class="token maybe-class-name">UserName</span><span class="token punctuation">;</span>
  email<span class="token operator">:</span> <span class="token maybe-class-name">Email</span><span class="token punctuation">;</span>
  preferences<span class="token operator">:</span> <span class="token maybe-class-name">Ingredient</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  allergies<span class="token operator">:</span> <span class="token maybe-class-name">Ingredient</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>Users will put cookies in the cart. Let's add types for the cart and the product. The item will contain ID, name, price in pennies and list of ingredients.</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// domain/product.ts</span>

<span class="token keyword module">export</span> <span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">ProductTitle</span></span> <span class="token operator">=</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token keyword module">export</span> <span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">Product</span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token maybe-class-name">UniqueId</span><span class="token punctuation">;</span>
  title<span class="token operator">:</span> <span class="token maybe-class-name">ProductTitle</span><span class="token punctuation">;</span>
  price<span class="token operator">:</span> <span class="token maybe-class-name">PriceCents</span><span class="token punctuation">;</span>
  toppings<span class="token operator">:</span> <span class="token maybe-class-name">Ingredient</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>In the shopping cart, we will only keep a list of the products that the user has put in it:</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// domain/cart.ts</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Product</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"./product"</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">Cart</span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  products<span class="token operator">:</span> <span class="token maybe-class-name">Product</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>After a successful payment an new order is created. Let's add an order entity type.</p>
<p>The order type will contain the user ID, the list of ordered products, the date and time of creation, the status and the total price for the entire order.</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// domain/order.ts</span>

<span class="token keyword module">export</span> <span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">OrderStatus</span></span> <span class="token operator">=</span> <span class="token string">"new"</span> <span class="token operator">|</span> <span class="token string">"delivery"</span> <span class="token operator">|</span> <span class="token string">"completed"</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">Order</span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  user<span class="token operator">:</span> <span class="token maybe-class-name">UniqueId</span><span class="token punctuation">;</span>
  cart<span class="token operator">:</span> <span class="token maybe-class-name">Cart</span><span class="token punctuation">;</span>
  created<span class="token operator">:</span> <span class="token maybe-class-name">DateTimeString</span><span class="token punctuation">;</span>
  status<span class="token operator">:</span> <span class="token maybe-class-name">OrderStatus</span><span class="token punctuation">;</span>
  total<span class="token operator">:</span> <span class="token maybe-class-name">PriceCents</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="checking-relationship-between-entities">Checking Relationship Between Entities<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#checking-relationship-between-entities">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#checking-relationship-between-entities"></a></h3>
<p>The benefit of designing entity types in such a way is that we can already check whether their relationship diagram corresponds to reality:</p>
<p><img src="/images/content/clean-architecture-on-frontend/interaction.png" alt="Entity Relationship Diagram"></p>
<p>Entity Relationship Diagram</p>
<p>We can see and check:</p>
<ul>
<li>if the main actor is really a user,</li>
<li>if there is enough information in the order,</li>
<li>if some entity needs to be extended,</li>
<li>if there will be problems with extensibility in the future.</li>
</ul>
<p>Also, already at this stage, types will help highlight errors with the compatibility of entities with each other and the direction of signals between them.</p>
<p>If everything meets our expectations, we can start designing domain transformations.</p>
<h3 id="creating-data-transformations">Creating Data Transformations<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#creating-data-transformations">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#creating-data-transformations"></a></h3>
<p>All sorts of things will happen to the data whose types we've just designed. We will be adding items to the cart, clearing it, updating items and user names, and so on. We will create separate functions for all these transformations.</p>
<p>For example, to determine if a user is allergic to some ingredient or preference, we can write functions <code>hasAllergy</code> and <code>hasPreference</code>:</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// domain/user.ts</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">hasAllergy</span><span class="token punctuation">(</span>user<span class="token operator">:</span> <span class="token maybe-class-name">User</span><span class="token punctuation">,</span> ingredient<span class="token operator">:</span> <span class="token maybe-class-name">Ingredient</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> user<span class="token punctuation">.</span><span class="token property-access">allergies</span><span class="token punctuation">.</span><span class="token method function property-access">includes</span><span class="token punctuation">(</span>ingredient<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">hasPreference</span><span class="token punctuation">(</span>user<span class="token operator">:</span> <span class="token maybe-class-name">User</span><span class="token punctuation">,</span> ingredient<span class="token operator">:</span> <span class="token maybe-class-name">Ingredient</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> user<span class="token punctuation">.</span><span class="token property-access">preferences</span><span class="token punctuation">.</span><span class="token method function property-access">includes</span><span class="token punctuation">(</span>ingredient<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The functions <code>addProduct</code> and <code>contains</code> are used to add items to cart and check if an item is in cart:</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// domain/cart.ts</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">addProduct</span><span class="token punctuation">(</span>cart<span class="token operator">:</span> <span class="token maybe-class-name">Cart</span><span class="token punctuation">,</span> product<span class="token operator">:</span> <span class="token maybe-class-name">Product</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Cart</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span> <span class="token spread operator">...</span>cart<span class="token punctuation">,</span> products<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token spread operator">...</span>cart<span class="token punctuation">.</span><span class="token property-access">products</span><span class="token punctuation">,</span> product<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">contains</span><span class="token punctuation">(</span>cart<span class="token operator">:</span> <span class="token maybe-class-name">Cart</span><span class="token punctuation">,</span> product<span class="token operator">:</span> <span class="token maybe-class-name">Product</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> cart<span class="token punctuation">.</span><span class="token property-access">products</span><span class="token punctuation">.</span><span class="token method function property-access">some</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> id <span class="token operator">===</span> product<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>We also need to calculate the total price of the list of products—for this we will write the function <code>totalPrice</code>. If required, we can add to this function to account for various conditions, such as promo codes or seasonal discounts.</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// domain/product.ts</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">totalPrice</span><span class="token punctuation">(</span>products<span class="token operator">:</span> <span class="token maybe-class-name">Product</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">PriceCents</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> products<span class="token punctuation">.</span><span class="token method function property-access">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>total<span class="token punctuation">,</span> <span class="token punctuation">{</span> price <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> total <span class="token operator">+</span> price<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>To allow users to create orders, we will add the function <code>createOrder</code>. It will return a new order associated with a specified user and their cart.</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// domain/order.ts</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createOrder</span><span class="token punctuation">(</span>user<span class="token operator">:</span> <span class="token maybe-class-name">User</span><span class="token punctuation">,</span> cart<span class="token operator">:</span> <span class="token maybe-class-name">Cart</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Order</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    cart<span class="token punctuation">,</span>
    user<span class="token operator">:</span> user<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">,</span>
    status<span class="token operator">:</span> <span class="token string">"new"</span><span class="token punctuation">,</span>
    created<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Date</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    total<span class="token operator">:</span> <span class="token function">totalPrice</span><span class="token punctuation">(</span>products<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Note that in every function we build the API so that <em>we</em> can comfortably transform the data. We take arguments and give the result as we want.</p>
<p>At the design stage, there are no external constraints yet. This allows us to reflect data transformations as close to the subject domain as possible. And the closer the transformations are to reality, the easier it will be to check their work.</p>
<h2 id="into-detail-shared-kernel">Into Detail: Shared Kernel<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#into-detail-shared-kernel">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#into-detail-shared-kernel"></a></h2>
<p>You may have noticed some of the types we used when describing domain types. For example, <code>Email</code>, <code>UniqueId</code> or <code>DateTimeString</code>. These are <a href="https://www.typescriptlang.org/docs/handbook/advanced-types.html#type-aliases">type-alias</a>:</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// shared-kernel.d.ts</span>

<span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">Email</span></span> <span class="token operator">=</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">UniqueId</span></span> <span class="token operator">=</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">DateTimeString</span></span> <span class="token operator">=</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">PriceCents</span></span> <span class="token operator">=</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
</code></pre>
<p>I usually use type-alias to get rid of <a href="https://refactoring.guru/smells/primitive-obsession">primitive obsession</a>.</p>
<p>I use <code>DateTimeString</code> instead of just <code>string</code>, to make it clearer what kind of string is used. The closer the type is to the subject area, the easier it will be to deal with errors when they occur.</p>
<p>The specified types are in the file <code>shared-kernel.d.ts</code>. <a href="http://ddd.fed.wiki.org/view/welcome-visitors/view/domain-driven-design/view/shared-kernel"><em>Shared kernel</em></a> is the code and the data, dependency on which doesn't increase coupling between modules. More about this concept you can find in <a href="https://herbertograca.com/2017/11/16/explicit-architecture-01-ddd-hexagonal-onion-clean-cqrs-how-i-put-it-all-together/">"DDD, Hexagonal, Onion, Clean, CQRS, ...How I put it all together"</a>.</p>
<p>In practice, the shared kernel can be explained like this. We use TypeScript, we use its standard type library, but we don't consider them as <em>dependencies</em>. This is because the modules that use them may not know anything about each other and remain decoupled.</p>
<p>Not all code can be classified as shared kernel. The main and most important limitation is that such code must be compatible with <em>any part of the system</em>. If a part of the application is written in TypeScript and another part in another language, the shared kernel may contain only code that can be used in both parts. For example, entity specifications in JSON format are fine, TypeScript helpers are not.</p>
<p>In our case, the entire application is written in TypeScript, so type-alias over built-in types can also be classified as shared kernel. Such globally available types do not increase coupling between modules and can be used in any part of the application.</p>
<h2 id="into-detail-application-layer">Into Detail: Application Layer<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#into-detail-application-layer">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#into-detail-application-layer"></a></h2>
<p>Now that we have the domain figured out, we can move on to the application layer. This layer contains <a href="https://en.wikipedia.org/wiki/Use_case">use cases</a>.</p>
<p>In the code we describe the technical details of scenarios. A use case is a description of what should happen to the data after adding an item to cart or proceeding to checkout.</p>
<p>Use cases involve interaction with the outer world, and thus, the use of external services. Interactions with the outside world are side-effects. We know that it is easier to work with and debug functions and systems without side-effects. And most of our domain functions are already written as pure functions.</p>
<p>To combine clean transformations and interaction with the impure world, we can use the application layer as an impure context.</p>
<h3 id="impure-context-for-pure-transformations">Impure Context For Pure Transformations<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#impure-context-for-pure-transformations">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#impure-context-for-pure-transformations"></a></h3>
<p>An impure context for pure transformations is a code organization in which:</p>
<ul>
<li>we first perform a side-effect to get some data;</li>
<li>then we do a pure transformation on that data;</li>
<li>and then do a side-effect again to store or pass the result.</li>
</ul>
<p>In the “Put item in cart” use case, this would look like:</p>
<ul>
<li>first, the handler would retrieve the cart state from the store;</li>
<li>then it would call the cart update function, passing the item to be added;</li>
<li>and then it would save the updated cart in the storage.</li>
</ul>
<p>The whole process is a “sandwich”: side-effect, pure function, side-effect. The main logic is reflected in data transformation, and all communication with the world is isolated in an imperative shell.</p>
<p><img src="/images/content/clean-architecture-on-frontend/impureim.png" alt="Functional architecture: side-effect, pure function, side-effect"></p>
<p>Functional architecture: side-effect, pure function, side-effect</p>
<p>Impure context is sometimes called a functional core in an imperative shell. Mark Seemann <a href="https://blog.ploeh.dk/2020/03/02/impureim-sandwich/">wrote about this in his blog</a>. This is the approach we will use when writing use case functions.</p>
<h3 id="designing-use-case">Designing Use Case<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#designing-use-case">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#designing-use-case"></a></h3>
<p>We will select and design the checkout use case. It is the most representative one because it is asynchronous and interacts with a lot of third-party services. The rest of the scenarios and the code of the whole application you can find on <a href="https://github.com/bespoyasov/frontend-clean-architecture">GitHub</a>.</p>
<p>Let's think about what we want to achieve in this use case. The user has a cart with cookies, when the user clicks the checkout button:</p>
<ul>
<li>we want to create a new order;</li>
<li>pay for it in a third-party payment system;</li>
<li>if the payment failed, notify the user about it;</li>
<li>if it passed, save the order on the server;</li>
<li>add the order to the local data store to show on the screen.</li>
</ul>
<p>In terms of API and function signature, we want to pass the user and the cart as arguments, and have the function do everything else by itself.</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">OrderProducts</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span>user<span class="token operator">:</span> <span class="token maybe-class-name">User</span><span class="token punctuation">,</span> cart<span class="token operator">:</span> <span class="token maybe-class-name">Cart</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">;</span>
</code></pre>
<p>Ideally, of course, the use case should not take two separate arguments, but a command that will encapsulate all the input data inside itself. But we don't want to bloat the amount of code, so we'll leave it that way.</p>
<h3 id="writing-application-layer-ports">Writing Application Layer Ports<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#writing-application-layer-ports">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#writing-application-layer-ports"></a></h3>
<p>Let's take a closer look at the steps of the use case: the order creation itself is a domain function. Everything else is external services that we want to use.</p>
<p>It's important to remember that it's the external services that have to adapt to our needs and not otherwise. So, in the application layer, we'll describe not only the use case itself, but also the interfaces to these external services—the ports.</p>
<p>The ports should be, first of all, convenient for our application. If the API of external services isn't compatible with our needs, we'll write an adapter.</p>
<p>Let's think of the services we will need:</p>
<ul>
<li>a payment system;</li>
<li>a service to notify users about events and errors;</li>
<li>a service to save data to the local storage.</li>
</ul>
<p><img src="/images/content/clean-architecture-on-frontend/ports.png" alt="Services we&#x27;re going to need"></p>
<p>Services we're going to need</p>
<p>Note that we are now talking about the <em>interfaces</em> of these services, not their implementation. At this stage, it is important for us to describe the required behavior, because this is the behavior we will rely on in the application layer when describing the scenario.</p>
<p>How exactly this behavior will be implemented is <em>not important</em> yet. This allows us to postpone the decision about which external services to use until the very last moment—this makes the code <a href="https://en.wikipedia.org/wiki/Coupling_%28computer_programming%29">minimally coupled</a>. We'll deal with the implementation later.</p>
<p>Also note that we <a href="https://en.wikipedia.org/wiki/Interface_segregation_principle">split the interfaces by features</a>. Everything payment-related is in one module, storage-related in another. This way it will be easier to ensure that the functionality of different third party services are not mixed up.</p>
<h3 id="payment-system-interface">Payment System Interface<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#payment-system-interface">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#payment-system-interface"></a></h3>
<p>The cookie store is a sample application, so the payment system will be very simple. It will have a <code>tryPay</code> method, which will accept the amount of money that needs to be paid, and in response will send a confirmation that everything is OK.</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// application/ports.ts</span>

<span class="token keyword module">export</span> <span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">PaymentService</span></span> <span class="token punctuation">{</span>
  <span class="token function">tryPay</span><span class="token punctuation">(</span>amount<span class="token operator">:</span> <span class="token maybe-class-name">PriceCents</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token builtin">boolean</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>We won't handle errors, because error handling is a topic for a whole separate big post 😃</p>
<p>Yes, usually the payment is done on the server, but this is a sample-example, let's do everything on the client. We could easily communicate with our API instead of directly with the payment system. This change, by the way, would only affect this use case, the rest of the code would remain untouched.</p>
<h3 id="notification-service-interface">Notification Service Interface<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#notification-service-interface">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#notification-service-interface"></a></h3>
<p>If something goes wrong, we have to tell the user about it.</p>
<p>The user can be notified in different ways. We can use the UI, we can send letters, we can user's phone to vibrate (please, don't).</p>
<p>In general, the notification service would also be better to be abstract, so that now we don't have to think about the implementation.</p>
<p>Let it take a message and <em>somehow</em> notify the user:</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// application/ports.ts</span>

<span class="token keyword module">export</span> <span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">NotificationService</span></span> <span class="token punctuation">{</span>
  <span class="token function">notify</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="local-storage-interface">Local Storage Interface<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#local-storage-interface">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#local-storage-interface"></a></h3>
<p>We will save the new order in a local repository.</p>
<p>This storage can be anything: Redux, MobX, whatever-floats-your-boat-js. The repository can be divided into micro-stores for different entities or be one big repository for all the application data. It's not important right now either, because these are implementation details.</p>
<p>I like to divide the storage interfaces into separate ones for each entity. A separate interface for the user data store, a separate one for the shopping cart, a separate one for the order store:</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// application/ports.ts</span>

<span class="token keyword module">export</span> <span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">OrdersStorageService</span></span> <span class="token punctuation">{</span>
  orders<span class="token operator">:</span> <span class="token maybe-class-name">Order</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">updateOrders</span><span class="token punctuation">(</span>orders<span class="token operator">:</span> <span class="token maybe-class-name">Order</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>In the example here I make only the order store interface, all the rest you can see in <a href="https://github.com/bespoyasov/frontend-clean-architecture/blob/master/src/application/ports.ts#L5">source code</a>.</p>
<h3 id="use-case-function">Use Case Function<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#use-case-function">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#use-case-function"></a></h3>
<p>Let's see if we can build the use case using the created interfaces and the existing domain functionality. As we described earlier, the script will consist of the following steps:</p>
<ul>
<li>verify the data;</li>
<li>create an order;</li>
<li>pay for the order;</li>
<li>notify about problems;</li>
<li>save the result.</li>
</ul>
<p><img src="/images/content/clean-architecture-on-frontend/flow.png" alt="All steps of the custom script in the diagram"></p>
<p>All steps of the custom script in the diagram</p>
<p>First, let's declare the stubs of the services we're going to use. TypeScript will swear that we haven't implemented the interfaces in the appropriate variables, but for now it doesn't matter.</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// application/orderProducts.ts</span>

<span class="token keyword">const</span> payment<span class="token operator">:</span> <span class="token maybe-class-name">PaymentService</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> notifier<span class="token operator">:</span> <span class="token maybe-class-name">NotificationService</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> orderStorage<span class="token operator">:</span> <span class="token maybe-class-name">OrdersStorageService</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>We can now use these stubs as if they were real services. We can access their fields, call their methods. This comes in handy when “translating” a use case from the business language to software language.</p>
<p>Now, create a function called <code>orderProducts</code>. Inside, the first thing we do is create a new order:</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// application/orderProducts.ts</span>
<span class="token comment">//...</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">orderProducts</span><span class="token punctuation">(</span>user<span class="token operator">:</span> <span class="token maybe-class-name">User</span><span class="token punctuation">,</span> cart<span class="token operator">:</span> <span class="token maybe-class-name">Cart</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> order <span class="token operator">=</span> <span class="token function">createOrder</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> cart<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Here we take advantage of the fact that the interface is a contract for behavior. This means that in the future the stubs will actually perform the actions we now expect:</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// application/orderProducts.ts</span>
<span class="token comment">//...</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">orderProducts</span><span class="token punctuation">(</span>user<span class="token operator">:</span> <span class="token maybe-class-name">User</span><span class="token punctuation">,</span> cart<span class="token operator">:</span> <span class="token maybe-class-name">Cart</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> order <span class="token operator">=</span> <span class="token function">createOrder</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> cart<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Try to pay for the order;</span>
  <span class="token comment">// Notify the user if something is wrong:</span>
  <span class="token keyword">const</span> paid <span class="token operator">=</span> <span class="token keyword control-flow">await</span> payment<span class="token punctuation">.</span><span class="token method function property-access">tryPay</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token property-access">total</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>paid<span class="token punctuation">)</span> <span class="token keyword control-flow">return</span> notifier<span class="token punctuation">.</span><span class="token method function property-access">notify</span><span class="token punctuation">(</span><span class="token string">"Оплата не прошла 🤷"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Save the result and clear the cart:</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> orders <span class="token punctuation">}</span> <span class="token operator">=</span> orderStorage<span class="token punctuation">;</span>
  orderStorage<span class="token punctuation">.</span><span class="token method function property-access">updateOrders</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token spread operator">...</span>orders<span class="token punctuation">,</span> order<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cartStorage<span class="token punctuation">.</span><span class="token method function property-access">emptyCart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Note that the use case does not call third-party services directly. It relies on the behavior described in the interfaces, so as long as the interface remains the same, we don't care which module implements it and how. This makes the modules replaceable.</p>
<h2 id="into-detail-adapters-layer">Into Detail: Adapters Layer<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#into-detail-adapters-layer">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#into-detail-adapters-layer"></a></h2>
<p>We have “translated” the use case into TypeScript. Now we have to check if the reality matches our needs.</p>
<p>Usually it doesn't. So we tweak the outside world to suit our needs with <a href="https://en.wikipedia.org/wiki/Adapter_pattern">adapters</a>.</p>
<h3 id="binding-ui-and-usecase">Binding UI and Usecase<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#binding-ui-and-usecase">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#binding-ui-and-usecase"></a></h3>
<p>The first adapter is a UI framework. It connects the native browser API with the application. In the case of the order creation, it is the “Checkout” button and the click handler, which will launch the use case function.</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token comment">// ui/components/Buy.tsx</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Buy</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Get access to the use case in the component:</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> orderProducts <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useOrderProducts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handleSubmit</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token operator">:</span> <span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">FormEvent</span></span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setLoading</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    e<span class="token punctuation">.</span><span class="token method function property-access">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Call the use case function:</span>
    <span class="token keyword control-flow">await</span> <span class="token function">orderProducts</span><span class="token punctuation">(</span>user<span class="token operator">!</span><span class="token punctuation">,</span> cart<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>section</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">Checkout</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>form</span> <span class="token attr-name">onSubmit</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleSubmit<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span><span class="token comment">/* ... */</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>form</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>section</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Let's provide the use case through a hook. We'll get all the services inside, and as a result, we'll return the use case function itself from the hook.</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// application/orderProducts.ts</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">useOrderProducts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> notifier <span class="token operator">=</span> <span class="token function">useNotifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> payment <span class="token operator">=</span> <span class="token function">usePayment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> orderStorage <span class="token operator">=</span> <span class="token function">useOrdersStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">orderProducts</span><span class="token punctuation">(</span>user<span class="token operator">:</span> <span class="token maybe-class-name">User</span><span class="token punctuation">,</span> cookies<span class="token operator">:</span> <span class="token maybe-class-name">Cookie</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// …</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span> orderProducts <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>We use hooks as a “crooked dependency injection”. First we use the hooks <code>useNotifier</code>, <code>usePayment</code>, <code>useOrdersStorage</code> to get the service instances, and then we use <a href="https://en.wikipedia.org/wiki/Closure_(computer_programming)">closure</a> of the <code>useOrderProducts</code> function to make them available inside the <code>orderProducts</code> function.</p>
<p>It's important to note that the use case function is still separated from the rest of the code, which is important for testing. We'll pull it out completely and make it even more testable at the end of the article, when we do the review and refactoring.</p>
<h3 id="payment-service-implementation">Payment Service Implementation<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#payment-service-implementation">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#payment-service-implementation"></a></h3>
<p>The use case uses the <code>PaymentService</code> interface. Let's implement it.</p>
<p>For payment, we will use the fake API stub. Again, we are not forced to write the whole service now, we can write it later, the main thing—to implement the specified behavior:</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// services/paymentAdapter.ts</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> fakeApi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"./api"</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">PaymentService</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"../application/ports"</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">usePayment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">PaymentService</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token function">tryPay</span><span class="token punctuation">(</span>amount<span class="token operator">:</span> <span class="token maybe-class-name">PriceCents</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token function">fakeApi</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The <code>fakeApi</code> function is a timeout which is triggered after 450ms, simulating a delayed response from the server. It returns what we pass to it as an argument.</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// services/api.ts</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">fakeApi</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">TResponse</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>response<span class="token operator">:</span> <span class="token maybe-class-name">TResponse</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">TResponse</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">res</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">450</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>We explicitly type the return value of <code>usePayment</code>. This way TypeScript will check that the function actually returns an object that contains all the methods declared in the interface.</p>
<h3 id="notification-service-implementation">Notification Service Implementation<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#notification-service-implementation">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#notification-service-implementation"></a></h3>
<p>Let the notifications be a simple <code>alert</code>. Since the code is decoupled, it won't be a problem to rewrite this service later.</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// services/notificationAdapter.ts</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">NotificationService</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"../application/ports"</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">useNotifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">NotificationService</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">notify</span><span class="token operator">:</span> <span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">alert</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="local-storage-implementation">Local Storage Implementation<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#local-storage-implementation">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#local-storage-implementation"></a></h3>
<p>Let the local storage be React.Context and hooks. We create a new context, pass the value to provider, export the provider and access the store via hooks.</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token comment">// store.tsx</span>

<span class="token keyword">const</span> <span class="token maybe-class-name">StoreContext</span> <span class="token operator">=</span> <span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">createContext</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token function-variable function">useStore</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">useContext</span><span class="token punctuation">(</span><span class="token maybe-class-name">StoreContext</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token maybe-class-name">Provider</span><span class="token operator">:</span> <span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access"><span class="token maybe-class-name">FC</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// ...Other entities...</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>orders<span class="token punctuation">,</span> setOrders<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    orders<span class="token punctuation">,</span>
    updateOrders<span class="token operator">:</span> setOrders<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token class-name">StoreContext.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span><span class="token class-name">StoreContext.Provider</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>We will write a hook for for each feature. This way we won't break <a href="https://en.wikipedia.org/wiki/Interface_segregation_principle">ISP</a>, and the stores, at least in terms of interfaces, they will be atomic.</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// services/storageAdapter.ts</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">useOrdersStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">OrdersStorageService</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token function">useStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Also, this approach will give us the ability to customize additional optimizations for each store: we can create selectors, memoization, and more.</p>
<h2 id="validate-data-flow-diagram">Validate Data Flow Diagram<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#validate-data-flow-diagram">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#validate-data-flow-diagram"></a></h2>
<p>Let's now validate how the user will communicate with the application during the created use case.</p>
<p><img src="/images/content/clean-architecture-on-frontend/final.png" alt="Use case data flow diagram"></p>
<p>Use case data flow diagram</p>
<p>The user interacts with the UI layer, which can only access the application through ports. That is, we can change the UI if we want to.</p>
<p>Use cases are handled in the application layer, which tells us exactly what external services are required. All the main logic and data is in the domain.</p>
<p>All external services are hidden in the infrastructure and are subject to our specifications. If we need to change the service of sending messages, the only thing we will have to fix in the code is an adapter for the new service.</p>
<p>This scheme makes the code replaceable, testable and extensible to changing requirements.</p>
<h2 id="what-can-be-improved">What Can Be Improved<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#what-can-be-improved">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#what-can-be-improved"></a></h2>
<p>All in all, this is enough to get you started and gain an initial understanding of the clean architecture. But I want to point out things that I have simplified to make the example easier.</p>
<p>This section is optional, but it will give an expanded understanding of what clean architecture “with no cut corners” might look like.</p>
<p>I would highlight a few things that can be done.</p>
<h3 id="use-object-instead-of-number-for-the-price">Use Object Instead of Number For the Price<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#use-object-instead-of-number-for-the-price">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#use-object-instead-of-number-for-the-price"></a></h3>
<p>You may have noticed that I use a number to describe the price. This is not a good practice.</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// shared-kernel.d.ts</span>

<span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">PriceCents</span></span> <span class="token operator">=</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
</code></pre>
<p>A number only indicates the quantity but not the currency, and a price without currency is meaningless. Ideally, price should be made as an object with two fields: value and currency.</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">Currency</span></span> <span class="token operator">=</span> <span class="token string">"RUB"</span> <span class="token operator">|</span> <span class="token string">"USD"</span> <span class="token operator">|</span> <span class="token string">"EUR"</span> <span class="token operator">|</span> <span class="token string">"SEK"</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">AmountCents</span></span> <span class="token operator">=</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">Price</span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  value<span class="token operator">:</span> <span class="token maybe-class-name">AmountCents</span><span class="token punctuation">;</span>
  currency<span class="token operator">:</span> <span class="token maybe-class-name">Currency</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>This will solve the problem of storing currencies and save a lot of effort and nerves when changing or adding currencies to the store. I didn't use this type in the examples so as not to complicate it. In the real code, however, the price would be more similar to this type.</p>
<p>Separately, it's worth mentioning the value of the price. I always keep the amount of money in the smallest fraction of the currency in circulation. For example, for the dollar it is cents.</p>
<p>Displaying the price in this way allows me not to think about division and fractional values. With money this is especially important if we want to avoid <a href="https://0.30000000000000004.com/">problems with floating point math</a>.</p>
<h3 id="split-code-by-features-not-layers">Split Code by Features, not Layers<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#split-code-by-features-not-layers">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#split-code-by-features-not-layers"></a></h3>
<p>The code can be split in folders not “by layers” but “by features”. One feature would be a piece of the pie from the schematic below.</p>
<p>This structure is even more preferable, because it allows you to deploy certain features separately, which is often useful.</p>
<p><a href="https://herbertograca.com/2017/11/16/explicit-architecture-01-ddd-hexagonal-onion-clean-cqrs-how-i-put-it-all-together/#components"><img src="/images/content/clean-architecture-on-frontend/hex-pie.png" alt="Component is a piece of a hex pie"></a></p>
<p>Component is a piece of a hex pie</p>
<p>I recommend reading about it in <a href="https://herbertograca.com/2017/11/16/explicit-architecture-01-ddd-hexagonal-onion-clean-cqrs-how-i-put-it-all-together/#components">"DDD, Hexagonal, Onion, Clean, CQRS, ... How I put it all together"</a>.</p>
<p>I also suggest to look at <a href="https://feature-sliced.design/">Feature Sliced</a>, which is conceptually very similar to component code division, but easier to understand.</p>
<h3 id="pay-attention-to-cross-component-usage">Pay Attention to Cross-Component Usage<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#pay-attention-to-cross-component-usage">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#pay-attention-to-cross-component-usage"></a></h3>
<p>If we're talking about splitting system into components, it's worth mentioning the cross-component use of code as well. Let's remember the order creation function:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Product</span><span class="token punctuation">,</span> totalPrice <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"./product"</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createOrder</span><span class="token punctuation">(</span>user<span class="token operator">:</span> <span class="token maybe-class-name">User</span><span class="token punctuation">,</span> cart<span class="token operator">:</span> <span class="token maybe-class-name">Cart</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Order</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    cart<span class="token punctuation">,</span>
    user<span class="token operator">:</span> user<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">,</span>
    status<span class="token operator">:</span> <span class="token string">"new"</span><span class="token punctuation">,</span>
    created<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Date</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    total<span class="token operator">:</span> <span class="token function">totalPrice</span><span class="token punctuation">(</span>products<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This function uses <code>totalPrice</code> from another component—the product. Such usage is fine by itself, but if we want to divide the code into independent features, we can't directly access the functionality of the other feature.</p>
<p>You can also see a way around this restriction in <a href="https://herbertograca.com/2017/11/16/explicit-architecture-01-ddd-hexagonal-onion-clean-cqrs-how-i-put-it-all-together/#components">"DDD, Hexagonal, Onion, Clean, CQRS, ... How I put it all together"</a> and <a href="https://feature-sliced.design/">Feature Sliced</a>.</p>
<h3 id="use-branded-types-not-aliases">Use Branded Types, not Aliases<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#use-branded-types-not-aliases">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#use-branded-types-not-aliases"></a></h3>
<p>For the shared kernel I used type-aliases. They are easy to operate with: you just have to create a new type and reference e.g. a string. But their disadvantage is that TypeScript has no mechanism to monitor their use and enforce it.</p>
<p>This doesn't seem to be a problem: so someone uses <code>string</code> instead of <code>DateTimeString</code>—so what? The code will compile.</p>
<p>The problem is exactly that the code will compile even though a broader type is used (in clever words <a href="https://en.wikipedia.org/wiki/Design_by_contract">precondition is weakened</a>). This first of all makes the code more fragile because it allows you to use <em>any strings</em>, not just strings of <em>special quality</em>, which can lead to errors.</p>
<p>Secondly it's confusing to read, because it creates two sources of truth. It's unclear if you really only need to use the date there, or if you can basically use any string.</p>
<p>There is a way to make TypeScript understand that we want a particular type—use <a href="https://github.com/kourge/ts-brand">branding</a>, branded types. Branding <a href="https://medium.com/@KevinBGreene/surviving-the-typescript-ecosystem-branding-and-type-tagging-6cf6e516523d">enables</a> to keep track of exactly how types are used, but makes the code a little more complicated.</p>
<h3 id="pay-attention-to-possible-dependency-in-domain">Pay Attention to Possible Dependency in Domain<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#pay-attention-to-possible-dependency-in-domain">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#pay-attention-to-possible-dependency-in-domain"></a></h3>
<p>The next thing that stings is the creation of a date in the domain in the <code>createOrder</code> function:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Product</span><span class="token punctuation">,</span> totalPrice <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"./product"</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createOrder</span><span class="token punctuation">(</span>user<span class="token operator">:</span> <span class="token maybe-class-name">User</span><span class="token punctuation">,</span> cart<span class="token operator">:</span> <span class="token maybe-class-name">Cart</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Order</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    cart<span class="token punctuation">,</span>
    user<span class="token operator">:</span> user<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">,</span>

    <span class="token comment">// This line:</span>
    created<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Date</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    status<span class="token operator">:</span> <span class="token string">"new"</span><span class="token punctuation">,</span>
    total<span class="token operator">:</span> <span class="token function">totalPrice</span><span class="token punctuation">(</span>products<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>We can suspect that <code>new Date().toISOString()</code> will be repeated quite often in the project and would like to put it in some kind of a helper:</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// lib/datetime.ts</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">currentDatetime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">DateTimeString</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Date</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>...And then use it in the domain:</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// domain/order.ts</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> currentDatetime <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"../lib/datetime"</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Product</span><span class="token punctuation">,</span> totalPrice <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"./product"</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createOrder</span><span class="token punctuation">(</span>user<span class="token operator">:</span> <span class="token maybe-class-name">User</span><span class="token punctuation">,</span> cart<span class="token operator">:</span> <span class="token maybe-class-name">Cart</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Order</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    cart<span class="token punctuation">,</span>
    user<span class="token operator">:</span> user<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">,</span>
    status<span class="token operator">:</span> <span class="token string">"new"</span><span class="token punctuation">,</span>
    created<span class="token operator">:</span> <span class="token function">currentDatetime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    total<span class="token operator">:</span> <span class="token function">totalPrice</span><span class="token punctuation">(</span>products<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>But we immediately remember that we can't depend on anything in the domain—so what should we do? It's a good idea that <code>createOrder</code> should take all the data for the order in a complete form. The date can be passed as the last argument:</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// domain/order.ts</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createOrder</span><span class="token punctuation">(</span>
  user<span class="token operator">:</span> <span class="token maybe-class-name">User</span><span class="token punctuation">,</span>
  cart<span class="token operator">:</span> <span class="token maybe-class-name">Cart</span><span class="token punctuation">,</span>
  created<span class="token operator">:</span> <span class="token maybe-class-name">DateTimeString</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Order</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    user<span class="token operator">:</span> user<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">,</span>
    products<span class="token punctuation">,</span>
    created<span class="token punctuation">,</span>
    status<span class="token operator">:</span> <span class="token string">"new"</span><span class="token punctuation">,</span>
    total<span class="token operator">:</span> <span class="token function">totalPrice</span><span class="token punctuation">(</span>products<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This also allows us not to break the dependency rule in cases where creating a date <em>depends on libraries</em>. If we create a date outside a domain function, it is likely that the date will be created inside the use case and passed as an argument:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">function</span> <span class="token function">someUserCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Use the `dateTimeSource` adapter,</span>
  <span class="token comment">// to get the current date in the desired format:</span>
  <span class="token keyword">const</span> createdOn <span class="token operator">=</span> dateTimeSource<span class="token punctuation">.</span><span class="token method function property-access">currentDatetime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Pass already created date to the domain function:</span>
  <span class="token function">createOrder</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> cart<span class="token punctuation">,</span> createdOn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This will keep the domain independent and also make it easier to test.</p>
<p>In the examples I chose not to focus on this for two reasons: it would distract from the main point, and I see nothing wrong with depending on your own helper if it uses <em>only</em> language features. Such helpers can even be considered as the shared kernel, because they only reduce code duplication.</p>
<h3 id="keep-domain-entities-and-transformations-pure">Keep Domain Entities and Transformations Pure<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#keep-domain-entities-and-transformations-pure">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#keep-domain-entities-and-transformations-pure"></a></h3>
<p>What was really not good about creating a date inside the <code>createOrder</code> function was the side-effect. The problem with side-effects is that they make the system less predictable than you'd like it to be. What helps to cope with this are <a href="https://en.wikipedia.org/wiki/Pure_function">pure</a> data transformations in the domain, that is, ones that don't produce side-effects.</p>
<p>Creating a date is a side-effect, because the result of calling <code>Date.now()</code> is different at different times. A pure function, on the other hand, with the same arguments <strong>always</strong> returns the same result.</p>
<p>I've come to the conclusion that it's better to keep the domain as clean as possible. It's easier to test, easier to port and update, and easier to read. Side-effects drastically increase the cognitive load when debugging, and the domain is not the place to keep complicated and confusing code at all.</p>
<h3 id="pay-attention-to-relationship-between-cart-and-order">Pay Attention to Relationship Between Cart and Order<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#pay-attention-to-relationship-between-cart-and-order">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#pay-attention-to-relationship-between-cart-and-order"></a></h3>
<p>In this little example, <code>Order</code> includes the <code>Cart</code>, because the cart only represents a list of products:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword module">export</span> <span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">Cart</span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  products<span class="token operator">:</span> <span class="token maybe-class-name">Product</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">Order</span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  user<span class="token operator">:</span> <span class="token maybe-class-name">UniqueId</span><span class="token punctuation">;</span>
  cart<span class="token operator">:</span> <span class="token maybe-class-name">Cart</span><span class="token punctuation">;</span>
  created<span class="token operator">:</span> <span class="token maybe-class-name">DateTimeString</span><span class="token punctuation">;</span>
  status<span class="token operator">:</span> <span class="token maybe-class-name">OrderStatus</span><span class="token punctuation">;</span>
  total<span class="token operator">:</span> <span class="token maybe-class-name">PriceCents</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>This may not work if there are additional properties in the <code>Cart</code> that have nothing to do with the <code>Order</code>. In such cases, it is better to use data projections or intermediate <a href="https://en.wikipedia.org/wiki/Data_transfer_object">DTO</a>.</p>
<p>As an option, we could use the “Product List” entity:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">ProductList</span></span> <span class="token operator">=</span> <span class="token maybe-class-name">Product</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">Cart</span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  products<span class="token operator">:</span> <span class="token maybe-class-name">ProductList</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">Order</span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  user<span class="token operator">:</span> <span class="token maybe-class-name">UniqueId</span><span class="token punctuation">;</span>
  products<span class="token operator">:</span> <span class="token maybe-class-name">ProductList</span><span class="token punctuation">;</span>
  created<span class="token operator">:</span> <span class="token maybe-class-name">DateTimeString</span><span class="token punctuation">;</span>
  status<span class="token operator">:</span> <span class="token maybe-class-name">OrderStatus</span><span class="token punctuation">;</span>
  total<span class="token operator">:</span> <span class="token maybe-class-name">PriceCents</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="make-the-user-case-more-testable">Make the user case more testable<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#make-the-user-case-more-testable">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#make-the-user-case-more-testable"></a></h3>
<p>The use case has a lot to discuss as well. Right now, the <code>orderProducts</code> function is hard to test in isolation from React—that's bad. Ideally, it should be possible to test it with minimal effort.</p>
<p>The problem with the current implementation is the hook that provides use case access to the UI:</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// application/orderProducts.ts</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">useOrderProducts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> notifier <span class="token operator">=</span> <span class="token function">useNotifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> payment <span class="token operator">=</span> <span class="token function">usePayment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> orderStorage <span class="token operator">=</span> <span class="token function">useOrdersStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> cartStorage <span class="token operator">=</span> <span class="token function">useCartStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">orderProducts</span><span class="token punctuation">(</span>user<span class="token operator">:</span> <span class="token maybe-class-name">User</span><span class="token punctuation">,</span> cart<span class="token operator">:</span> <span class="token maybe-class-name">Cart</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> order <span class="token operator">=</span> <span class="token function">createOrder</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> cart<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> paid <span class="token operator">=</span> <span class="token keyword control-flow">await</span> payment<span class="token punctuation">.</span><span class="token method function property-access">tryPay</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token property-access">total</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>paid<span class="token punctuation">)</span> <span class="token keyword control-flow">return</span> notifier<span class="token punctuation">.</span><span class="token method function property-access">notify</span><span class="token punctuation">(</span><span class="token string">"Oops! 🤷"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token punctuation">{</span> orders <span class="token punctuation">}</span> <span class="token operator">=</span> orderStorage<span class="token punctuation">;</span>
    orderStorage<span class="token punctuation">.</span><span class="token method function property-access">updateOrders</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token spread operator">...</span>orders<span class="token punctuation">,</span> order<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cartStorage<span class="token punctuation">.</span><span class="token method function property-access">emptyCart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span> orderProducts <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>In a canonical implementation, the use case function would be located outside the hook, and the services would be passed to the use case via the last argument or via a DI:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">Dependencies</span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  notifier<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">NotificationService</span><span class="token punctuation">;</span>
  payment<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">PaymentService</span><span class="token punctuation">;</span>
  orderStorage<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">OrderStorageService</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">orderProducts</span><span class="token punctuation">(</span>
  user<span class="token operator">:</span> <span class="token maybe-class-name">User</span><span class="token punctuation">,</span>
  cart<span class="token operator">:</span> <span class="token maybe-class-name">Cart</span><span class="token punctuation">,</span>
  dependencies<span class="token operator">:</span> <span class="token maybe-class-name">Dependencies</span> <span class="token operator">=</span> defaultDependencies
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> notifier<span class="token punctuation">,</span> payment<span class="token punctuation">,</span> orderStorage <span class="token punctuation">}</span> <span class="token operator">=</span> dependencies<span class="token punctuation">;</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The hook would then become an adapter:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">function</span> <span class="token function">useOrderProducts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> notifier <span class="token operator">=</span> <span class="token function">useNotifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> payment <span class="token operator">=</span> <span class="token function">usePayment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> orderStorage <span class="token operator">=</span> <span class="token function">useOrdersStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>user<span class="token operator">:</span> <span class="token maybe-class-name">User</span><span class="token punctuation">,</span> cart<span class="token operator">:</span> <span class="token maybe-class-name">Cart</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span>
    <span class="token function">orderProducts</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> cart<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      notifier<span class="token punctuation">,</span>
      payment<span class="token punctuation">,</span>
      orderStorage<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Then the hook code could be considered an adapter, and only the use case would remain in the application layer. The <code>orderProducts</code> function could be tested by passing the required service mochas as dependencies.</p>
<h3 id="configure-automatic-dependency-injection">Configure Automatic Dependency Injection<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#configure-automatic-dependency-injection">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#configure-automatic-dependency-injection"></a></h3>
<p>There, in the application layer, we now inject services by hand:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">useOrderProducts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Here we use hooks to get the instances of each service,</span>
  <span class="token comment">// which will be used inside the orderProducts use case:</span>
  <span class="token keyword">const</span> notifier <span class="token operator">=</span> <span class="token function">useNotifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> payment <span class="token operator">=</span> <span class="token function">usePayment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> orderStorage <span class="token operator">=</span> <span class="token function">useOrdersStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> cartStorage <span class="token operator">=</span> <span class="token function">useCartStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">orderProducts</span><span class="token punctuation">(</span>user<span class="token operator">:</span> <span class="token maybe-class-name">User</span><span class="token punctuation">,</span> cart<span class="token operator">:</span> <span class="token maybe-class-name">Cart</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...Inside the use case we use those services.</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span> orderProducts <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>But in general, this can be automated and done with <a href="https://bespoyasov.me/blog/di-ts-in-practice/">dependency injection</a>. We already looked at the simplest version of injection through the last argument, but you can go further and configure automatic injection.</p>
<p>In this particular application, I didn't think it made much sense to set up a DI. It would distract from the point and overcomplicate the code. And in the case of React and hooks, we can use them as a “container” that returns an implementation of the specified interface. Yes, it's manual work, but it doesn't increase the entry threshold and is quicker to read for new developers.</p>
<h2 id="what-can-be-more-complicated-in-real-project">What Can Be More Complicated in Real Project<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#what-can-be-more-complicated-in-real-project">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#what-can-be-more-complicated-in-real-project"></a></h2>
<p>The example in the post is refined and intentionally simple. It is clear that life is much more surprising and complicated than this example. So I also want to talk about common problems that can arise when working with the clean architecture.</p>
<h3 id="branching-business-logic">Branching Business Logic<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#branching-business-logic">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#branching-business-logic"></a></h3>
<p>The most important problem is the subject area that we lack knowledge about. Imagine a store has a product, a discounted product, and a write-off product. How do we properly describe these entities?</p>
<p>Should there be a “base” entity that will be expanded? How exactly should this entity be expanded? Should there be additional fields? Should these entities be mutually exclusive? How should user cases behave if there's another entity instead of a simple one? Should the duplication be reduced immediately?</p>
<p>There may be too many questions and too many answers, because neither the team nor the stakeholders know yet how the system should actually behave. If there are only assumptions, you can find yourself in an <a href="https://en.wikipedia.org/wiki/Analysis_paralysis">analysis paralysis</a>.</p>
<p>Specific solutions depend on the specific situation, I can only recommend a few general things.</p>
<p><strong>Don't use inheritance</strong>, even if it's called “extension”. Even if it looks like the interface is really inherited. Even if it looks like “well, there's clearly a hierarchy here”. Just wait.</p>
<p>Copypaste in code is not always evil, <a href="https://bespoyasov.me/blog/copy-paste/">it's a tool</a>. Make two almost identical entities, see how they behave in reality, observe them. At some point you'll notice that they've either become very different, or they really only differ in one field. It's easier to merge two similar entities into one than it is to create checks for every possible condition and variant.</p>
<p>If you still have to extend something...</p>
<p><strong>Keep in mind <a href="https://en.wikipedia.org/wiki/Covariance_and_contravariance_(computer_science)">covariance, contravariance, and invariance</a></strong> so you don't accidentally come up with more work than you should.</p>
<p><strong>Use the analogy with <a href="https://en.bem.info/">blocks and modifiers from BEM</a></strong> when choosing between different entities and extensions. It helps me a lot to determine if I have a separate entity or a “modifier-extension” the code, if I think of it in the context of BEM.</p>
<h3 id="interdependent-use-cases">Interdependent Use Cases<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#interdependent-use-cases">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#interdependent-use-cases"></a></h3>
<p>The second big problem is related use cases, where an event from one use case triggers another.</p>
<p>The only way to handle this, which I know and which helps me, is to break up the use cases into smaller, atomic use cases. They will be easier to put together.</p>
<p>In general, the problem with such scripts, is a consequence of another big problem in programming, entities composition.</p>
<p>There's <a href="https://en.wikipedia.org/wiki/Law_of_Demeter">a lot</a> already written about how to efficiently compose entities, and there's even a whole <a href="https://en.wikipedia.org/wiki/Set_theory">mathematics section</a>. We won't go far there, that's a topic for a separate post.</p>
<h2 id="conclusions">Conclusions<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#conclusions">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#conclusions"></a></h2>
<p>In this post, I've outlined and expanded a bit on my talk on the clean architecture on the frontend.</p>
<p>It's not a gold standard, but rather a compilation of experience with different projects, paradigms, and languages. I find it a convenient scheme that allows you to decouple code and make independent layers, modules, services, which not only can be deployed and published separately, but also transferred from project to project if needed.</p>
<p>We haven't touched on OOP because architecture and OOP are orthogonal. Yes, architecture talks about entity composition, but it doesn't dictate what should be the unit of composition: object or function. You can work with this in different paradigms, as we've seen in the examples.</p>
<p>As for OOP, I recently wrote a post about <a href="https://bespoyasov.me/blog/generating-trees-on-canvas-using-typescript-and-oop/">how to use the clean architecture with OOP</a>. In this post, we write a tree picture generator on canvas.</p>
<p>To see how exactly you can combine this approach with other stuff like chip slicing, hexagonal architecture, CQS and other stuff, I recommend reading <a href="https://herbertograca.com/2017/11/16/explicit-architecture-01-ddd-hexagonal-onion-clean-cqrs-how-i-put-it-all-together/">DDD, Hexagonal, Onion, Clean, CQRS, ... How I put it all together</a> and the whole series of articles from this blog. Very insightful, concise, and to the point.</p>
<h2 id="sources">Sources<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#sources">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#sources"></a></h2>
<ul>
<li><a href="https://youtu.be/ThgqBecaq_w">Public Talk about Clean Architecture on Frontend</a></li>
<li><a href="https://bespoyasov.ru/talks/podlodka-conf-clean-architecture/en.html">Slides for the Talk</a></li>
<li><a href="https://github.com/bespoyasov/frontend-clean-architecture">The source code for the application we're going to design</a></li>
<li><a href="https://bespoyasov.me/showcase/frontend-clean-architecture/">Sample of a working application</a></li>
</ul>
<h3 id="design-in-practice">Design in Practice<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#design-in-practice">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#design-in-practice"></a></h3>
<ul>
<li><a href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html">The Clean Architecture</a></li>
<li><a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller">Model-View-Controller</a></li>
<li><a href="https://herbertograca.com/2017/11/16/explicit-architecture-01-ddd-hexagonal-onion-clean-cqrs-how-i-put-it-all-together/#domain-layer">DDD, Hexagonal, Onion, Clean, CQRS, … How I put it all together</a></li>
<li><a href="https://herbertograca.com/2017/09/14/ports-adapters-architecture/">Ports &#x26; Adapters Architecture</a></li>
<li><a href="https://herbertograca.com/2018/07/07/more-than-concentric-layers/">More than Concentric Layers</a></li>
<li><a href="https://bespoyasov.me/blog/generating-trees-on-canvas-using-typescript-and-oop/">Generating Trees Using L-Systems, TypeScript, and OOP Series' Articles</a></li>
</ul>
<h3 id="system-design">System Design<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#system-design">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#system-design"></a></h3>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Domain_knowledge">Domain Knowledge</a></li>
<li><a href="https://en.wikipedia.org/wiki/Use_case">Use Case</a></li>
<li><a href="https://en.wikipedia.org/wiki/Coupling_(computer_programming)">Coupling</a> and <a href="https://en.wikipedia.org/wiki/Cohesion_(computer_science)">cohesion</a></li>
<li><a href="http://ddd.fed.wiki.org/view/welcome-visitors/view/domain-driven-design/view/shared-kernel">Shared Kernel</a></li>
<li><a href="https://en.wikipedia.org/wiki/Analysis_paralysis">Analysis Paralysis</a></li>
</ul>
<h3 id="books-about-design-and-development">Books about Design and Development<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#books-about-design-and-development">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#books-about-design-and-development"></a></h3>
<ul>
<li><a href="https://www.infoq.com/presentations/Design-Composition-Performance/">Design Composition and Performance</a></li>
<li><a href="https://bespoyasov.me/blog/clean-architecture/">Clean Architecture</a></li>
<li><a href="https://bespoyasov.me/blog/patterns-for-fault-tolerant-software/">Patterns for Fault Tolerant Software</a></li>
</ul>
<h3 id="concepts-from-typescript-c-and-other-languages">Concepts from TypeScript, C#, and Other Languages<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#concepts-from-typescript-c-and-other-languages">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#concepts-from-typescript-c-and-other-languages"></a></h3>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Protocol_(object-oriented_programming)">Interface</a></li>
<li><a href="https://en.wikipedia.org/wiki/Closure_(computer_programming)">Closure</a></li>
<li><a href="https://en.wikipedia.org/wiki/Set_theory">Set Theory</a></li>
<li><a href="https://www.typescriptlang.org/docs/handbook/advanced-types.html#type-aliases">Type Aliases</a></li>
<li><a href="https://refactoring.guru/smells/primitive-obsession">Primitive Obsession</a></li>
<li><a href="https://0.30000000000000004.com/">Floating Point Math</a></li>
<li><a href="https://github.com/kourge/ts-brand">Branded Types</a> и <a href="https://medium.com/@KevinBGreene/surviving-the-typescript-ecosystem-branding-and-type-tagging-6cf6e516523d">How to Use It</a></li>
</ul>
<h3 id="patterns-and-methodologies">Patterns and Methodologies<a href="https://bespoyasov.me/blog/clean-architecture-on-frontend/#patterns-and-methodologies">#</a><a aria-hidden="true" class="anchor-heading icon-link" href="#patterns-and-methodologies"></a></h3>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Adapter_pattern">Adapter, pattern</a></li>
<li><a href="https://en.wikipedia.org/wiki/SOLID">SOLID Principles</a></li>
<li><a href="https://blog.ploeh.dk/2020/03/02/impureim-sandwich/">Impureim Sandwich</a></li>
<li><a href="https://en.wikipedia.org/wiki/Design_by_contract">Design by Contract</a></li>
<li><a href="https://en.wikipedia.org/wiki/Covariance_and_contravariance_(computer_science)">Covariance and contravariance</a></li>
<li><a href="https://en.wikipedia.org/wiki/Law_of_Demeter">Law of Demeter</a></li>
<li><a href="https://en.bem.info/methodology/">BEM Methodology</a></li>
</ul>
<hr>
<h2 id="tags">Tags<a aria-hidden="true" class="anchor-heading icon-link" href="#tags"></a></h2>
<ol>
<li><a class="color-tag" style="--tag-color: #b66325;" href="/notes/qqlu2qbieklqf58kzwklnio">architecture</a></li>
</ol></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#whats-the-plan" title="What&#x27;s the Plan#">What&#x27;s the Plan#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#architecture-and-design" title="Architecture and Design#">Architecture and Design#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#the-clean-architecture" title="The Clean Architecture#">The Clean Architecture#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#domain-layer" title="Domain Layer#">Domain Layer#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#application-layer" title="Application Layer#">Application Layer#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#adapters-layer" title="Adapters Layer#">Adapters Layer#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#dependency-rule" title="Dependency Rule#">Dependency Rule#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#advantages-of-clean-architecture" title="Advantages of Clean Architecture#">Advantages of Clean Architecture#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#separate-domain" title="Separate domain#">Separate domain#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#independent-use-cases" title="Independent Use Cases#">Independent Use Cases#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#replaceable-third-party-services" title="Replaceable Third-Party Services#">Replaceable Third-Party Services#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#costs-of-clean-architecture" title="Costs of Clean Architecture#">Costs of Clean Architecture#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#takes-time" title="Takes Time#">Takes Time#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#sometimes-overly-verbose" title="Sometimes Overly Verbose#">Sometimes Overly Verbose#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#can-make-onboarding-more-difficult" title="Can Make Onboarding More Difficult#">Can Make Onboarding More Difficult#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#can-increase-the-amount-of-code" title="Can Increase the Amount of Code#">Can Increase the Amount of Code#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#how-to-reduce-costs" title="How to Reduce Costs#">How to Reduce Costs#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#extract-domain" title="Extract Domain#">Extract Domain#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#obey-dependency-rule" title="Obey Dependency Rule#">Obey Dependency Rule#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#designing-the-application" title="Designing the Application#">Designing the Application#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#designing-domain" title="Designing Domain#">Designing Domain#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#designing-application-layer" title="Designing Application Layer#">Designing Application Layer#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#designing-adapters-layer" title="Designing Adapters Layer#">Designing Adapters Layer#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#using-mvc-analogy" title="Using MVC Analogy#">Using MVC Analogy#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#into-details-domain" title="Into Details: Domain#">Into Details: Domain#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#creating-domain-entities" title="Creating Domain Entities#">Creating Domain Entities#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#checking-relationship-between-entities" title="Checking Relationship Between Entities#">Checking Relationship Between Entities#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#creating-data-transformations" title="Creating Data Transformations#">Creating Data Transformations#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#into-detail-shared-kernel" title="Into Detail: Shared Kernel#">Into Detail: Shared Kernel#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#into-detail-application-layer" title="Into Detail: Application Layer#">Into Detail: Application Layer#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#impure-context-for-pure-transformations" title="Impure Context For Pure Transformations#">Impure Context For Pure Transformations#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#designing-use-case" title="Designing Use Case#">Designing Use Case#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#writing-application-layer-ports" title="Writing Application Layer Ports#">Writing Application Layer Ports#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#payment-system-interface" title="Payment System Interface#">Payment System Interface#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#notification-service-interface" title="Notification Service Interface#">Notification Service Interface#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#local-storage-interface" title="Local Storage Interface#">Local Storage Interface#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#use-case-function" title="Use Case Function#">Use Case Function#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#into-detail-adapters-layer" title="Into Detail: Adapters Layer#">Into Detail: Adapters Layer#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#binding-ui-and-usecase" title="Binding UI and Usecase#">Binding UI and Usecase#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#payment-service-implementation" title="Payment Service Implementation#">Payment Service Implementation#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#notification-service-implementation" title="Notification Service Implementation#">Notification Service Implementation#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#local-storage-implementation" title="Local Storage Implementation#">Local Storage Implementation#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#validate-data-flow-diagram" title="Validate Data Flow Diagram#">Validate Data Flow Diagram#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#what-can-be-improved" title="What Can Be Improved#">What Can Be Improved#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#use-object-instead-of-number-for-the-price" title="Use Object Instead of Number For the Price#">Use Object Instead of Number For the Price#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#split-code-by-features-not-layers" title="Split Code by Features, not Layers#">Split Code by Features, not Layers#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#pay-attention-to-cross-component-usage" title="Pay Attention to Cross-Component Usage#">Pay Attention to Cross-Component Usage#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#use-branded-types-not-aliases" title="Use Branded Types, not Aliases#">Use Branded Types, not Aliases#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#pay-attention-to-possible-dependency-in-domain" title="Pay Attention to Possible Dependency in Domain#">Pay Attention to Possible Dependency in Domain#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#keep-domain-entities-and-transformations-pure" title="Keep Domain Entities and Transformations Pure#">Keep Domain Entities and Transformations Pure#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#pay-attention-to-relationship-between-cart-and-order" title="Pay Attention to Relationship Between Cart and Order#">Pay Attention to Relationship Between Cart and Order#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#make-the-user-case-more-testable" title="Make the user case more testable#">Make the user case more testable#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#configure-automatic-dependency-injection" title="Configure Automatic Dependency Injection#">Configure Automatic Dependency Injection#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#what-can-be-more-complicated-in-real-project" title="What Can Be More Complicated in Real Project#">What Can Be More Complicated in Real Project#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#branching-business-logic" title="Branching Business Logic#">Branching Business Logic#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#interdependent-use-cases" title="Interdependent Use Cases#">Interdependent Use Cases#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#conclusions" title="Conclusions#">Conclusions#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#sources" title="Sources#">Sources#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#design-in-practice" title="Design in Practice#">Design in Practice#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#system-design" title="System Design#">System Design#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#books-about-design-and-development" title="Books about Design and Development#">Books about Design and Development#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#concepts-from-typescript-c-and-other-languages" title="Concepts from TypeScript, C#, and Other Languages#">Concepts from TypeScript, C#, and Other Languages#</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#patterns-and-methodologies" title="Patterns and Methodologies#">Patterns and Methodologies#</a></div></div></div></div></div></div></div></div></div></div></div><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></main></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"3qd6qjev0hbwuzw47h96vee","title":"Clean Architecture on Frontend","desc":"","updated":1667864845015,"created":1667800165132,"tags":"architecture","custom":{},"fname":"dev.software-engineering.clean-architecture-on-frontend","type":"note","vault":{"fsPath":"vault"},"contentHash":"b0b53038134a654e9c99301a9f4f50ed","links":[{"type":"frontmatterTag","from":{"fname":"dev.software-engineering.clean-architecture-on-frontend","id":"3qd6qjev0hbwuzw47h96vee","vaultName":"vault"},"value":"tags.architecture","alias":"architecture","xvault":false,"to":{"fname":"tags.architecture"}}],"anchors":{"whats-the-plan":{"type":"header","text":"What's the Plan#","value":"whats-the-plan","line":20,"column":0,"depth":2},"architecture-and-design":{"type":"header","text":"Architecture and Design#","value":"architecture-and-design","line":40,"column":0,"depth":2},"the-clean-architecture":{"type":"header","text":"The Clean Architecture#","value":"the-clean-architecture","line":49,"column":0,"depth":2},"domain-layer":{"type":"header","text":"Domain Layer#","value":"domain-layer","line":61,"column":0,"depth":3},"application-layer":{"type":"header","text":"Application Layer#","value":"application-layer","line":71,"column":0,"depth":3},"adapters-layer":{"type":"header","text":"Adapters Layer#","value":"adapters-layer","line":87,"column":0,"depth":3},"dependency-rule":{"type":"header","text":"Dependency Rule#","value":"dependency-rule","line":104,"column":0,"depth":3},"advantages-of-clean-architecture":{"type":"header","text":"Advantages of Clean Architecture#","value":"advantages-of-clean-architecture","line":124,"column":0,"depth":2},"separate-domain":{"type":"header","text":"Separate domain#","value":"separate-domain","line":128,"column":0,"depth":3},"independent-use-cases":{"type":"header","text":"Independent Use Cases#","value":"independent-use-cases","line":136,"column":0,"depth":3},"replaceable-third-party-services":{"type":"header","text":"Replaceable Third-Party Services#","value":"replaceable-third-party-services","line":142,"column":0,"depth":3},"costs-of-clean-architecture":{"type":"header","text":"Costs of Clean Architecture#","value":"costs-of-clean-architecture","line":148,"column":0,"depth":2},"takes-time":{"type":"header","text":"Takes Time#","value":"takes-time","line":152,"column":0,"depth":3},"sometimes-overly-verbose":{"type":"header","text":"Sometimes Overly Verbose#","value":"sometimes-overly-verbose","line":158,"column":0,"depth":3},"can-make-onboarding-more-difficult":{"type":"header","text":"Can Make Onboarding More Difficult#","value":"can-make-onboarding-more-difficult","line":164,"column":0,"depth":2},"can-increase-the-amount-of-code":{"type":"header","text":"Can Increase the Amount of Code#","value":"can-increase-the-amount-of-code","line":170,"column":0,"depth":2},"how-to-reduce-costs":{"type":"header","text":"How to Reduce Costs#","value":"how-to-reduce-costs","line":180,"column":0,"depth":2},"extract-domain":{"type":"header","text":"Extract Domain#","value":"extract-domain","line":186,"column":0,"depth":3},"obey-dependency-rule":{"type":"header","text":"Obey Dependency Rule#","value":"obey-dependency-rule","line":192,"column":0,"depth":3},"designing-the-application":{"type":"header","text":"Designing the Application#","value":"designing-the-application","line":198,"column":0,"depth":2},"designing-domain":{"type":"header","text":"Designing Domain#","value":"designing-domain","line":224,"column":0,"depth":3},"designing-application-layer":{"type":"header","text":"Designing Application Layer#","value":"designing-application-layer","line":244,"column":0,"depth":3},"designing-adapters-layer":{"type":"header","text":"Designing Adapters Layer#","value":"designing-adapters-layer","line":270,"column":0,"depth":3},"using-mvc-analogy":{"type":"header","text":"Using MVC Analogy#","value":"using-mvc-analogy","line":287,"column":0,"depth":3},"into-details-domain":{"type":"header","text":"Into Details: Domain#","value":"into-details-domain","line":297,"column":0,"depth":2},"creating-domain-entities":{"type":"header","text":"Creating Domain Entities#","value":"creating-domain-entities","line":328,"column":0,"depth":3},"checking-relationship-between-entities":{"type":"header","text":"Checking Relationship Between Entities#","value":"checking-relationship-between-entities","line":398,"column":0,"depth":3},"creating-data-transformations":{"type":"header","text":"Creating Data Transformations#","value":"creating-data-transformations","line":417,"column":0,"depth":3},"into-detail-shared-kernel":{"type":"header","text":"Into Detail: Shared Kernel#","value":"into-detail-shared-kernel","line":479,"column":0,"depth":2},"into-detail-application-layer":{"type":"header","text":"Into Detail: Application Layer#","value":"into-detail-application-layer","line":504,"column":0,"depth":2},"impure-context-for-pure-transformations":{"type":"header","text":"Impure Context For Pure Transformations#","value":"impure-context-for-pure-transformations","line":514,"column":0,"depth":3},"designing-use-case":{"type":"header","text":"Designing Use Case#","value":"designing-use-case","line":536,"column":0,"depth":3},"writing-application-layer-ports":{"type":"header","text":"Writing Application Layer Ports#","value":"writing-application-layer-ports","line":556,"column":0,"depth":3},"payment-system-interface":{"type":"header","text":"Payment System Interface#","value":"payment-system-interface","line":580,"column":0,"depth":3},"notification-service-interface":{"type":"header","text":"Notification Service Interface#","value":"notification-service-interface","line":596,"column":0,"depth":3},"local-storage-interface":{"type":"header","text":"Local Storage Interface#","value":"local-storage-interface","line":614,"column":0,"depth":3},"use-case-function":{"type":"header","text":"Use Case Function#","value":"use-case-function","line":633,"column":0,"depth":3},"into-detail-adapters-layer":{"type":"header","text":"Into Detail: Adapters Layer#","value":"into-detail-adapters-layer","line":693,"column":0,"depth":2},"binding-ui-and-usecase":{"type":"header","text":"Binding UI and Usecase#","value":"binding-ui-and-usecase","line":699,"column":0,"depth":3},"payment-service-implementation":{"type":"header","text":"Payment Service Implementation#","value":"payment-service-implementation","line":750,"column":0,"depth":3},"notification-service-implementation":{"type":"header","text":"Notification Service Implementation#","value":"notification-service-implementation","line":783,"column":0,"depth":3},"local-storage-implementation":{"type":"header","text":"Local Storage Implementation#","value":"local-storage-implementation","line":799,"column":0,"depth":3},"validate-data-flow-diagram":{"type":"header","text":"Validate Data Flow Diagram#","value":"validate-data-flow-diagram","line":837,"column":0,"depth":2},"what-can-be-improved":{"type":"header","text":"What Can Be Improved#","value":"what-can-be-improved","line":853,"column":0,"depth":2},"use-object-instead-of-number-for-the-price":{"type":"header","text":"Use Object Instead of Number For the Price#","value":"use-object-instead-of-number-for-the-price","line":861,"column":0,"depth":3},"split-code-by-features-not-layers":{"type":"header","text":"Split Code by Features, not Layers#","value":"split-code-by-features-not-layers","line":889,"column":0,"depth":3},"pay-attention-to-cross-component-usage":{"type":"header","text":"Pay Attention to Cross-Component Usage#","value":"pay-attention-to-cross-component-usage","line":903,"column":0,"depth":3},"use-branded-types-not-aliases":{"type":"header","text":"Use Branded Types, not Aliases#","value":"use-branded-types-not-aliases","line":925,"column":0,"depth":3},"pay-attention-to-possible-dependency-in-domain":{"type":"header","text":"Pay Attention to Possible Dependency in Domain#","value":"pay-attention-to-possible-dependency-in-domain","line":937,"column":0,"depth":3},"keep-domain-entities-and-transformations-pure":{"type":"header","text":"Keep Domain Entities and Transformations Pure#","value":"keep-domain-entities-and-transformations-pure","line":1024,"column":0,"depth":3},"pay-attention-to-relationship-between-cart-and-order":{"type":"header","text":"Pay Attention to Relationship Between Cart and Order#","value":"pay-attention-to-relationship-between-cart-and-order","line":1032,"column":0,"depth":3},"make-the-user-case-more-testable":{"type":"header","text":"Make the user case more testable#","value":"make-the-user-case-more-testable","line":1070,"column":0,"depth":3},"configure-automatic-dependency-injection":{"type":"header","text":"Configure Automatic Dependency Injection#","value":"configure-automatic-dependency-injection","line":1139,"column":0,"depth":3},"what-can-be-more-complicated-in-real-project":{"type":"header","text":"What Can Be More Complicated in Real Project#","value":"what-can-be-more-complicated-in-real-project","line":1164,"column":0,"depth":2},"branching-business-logic":{"type":"header","text":"Branching Business Logic#","value":"branching-business-logic","line":1168,"column":0,"depth":3},"interdependent-use-cases":{"type":"header","text":"Interdependent Use Cases#","value":"interdependent-use-cases","line":1188,"column":0,"depth":3},"conclusions":{"type":"header","text":"Conclusions#","value":"conclusions","line":1198,"column":0,"depth":2},"sources":{"type":"header","text":"Sources#","value":"sources","line":1210,"column":0,"depth":2},"design-in-practice":{"type":"header","text":"Design in Practice#","value":"design-in-practice","line":1217,"column":0,"depth":3},"system-design":{"type":"header","text":"System Design#","value":"system-design","line":1226,"column":0,"depth":3},"books-about-design-and-development":{"type":"header","text":"Books about Design and Development#","value":"books-about-design-and-development","line":1234,"column":0,"depth":3},"concepts-from-typescript-c-and-other-languages":{"type":"header","text":"Concepts from TypeScript, C#, and Other Languages#","value":"concepts-from-typescript-c-and-other-languages","line":1240,"column":0,"depth":3},"patterns-and-methodologies":{"type":"header","text":"Patterns and Methodologies#","value":"patterns-and-methodologies","line":1250,"column":0,"depth":3}},"children":[],"parent":"j0N1aVKxe96dktmyADG9U","data":{}},"body":"\u003ch1 id=\"clean-architecture-on-frontend\"\u003eClean Architecture on Frontend\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#clean-architecture-on-frontend\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/\"\u003ehttps://bespoyasov.me/blog/clean-architecture-on-frontend/\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eNot very long ago I gave a talk about the clean architecture on frontend. In this post, I'm summarizing that talk and expanding it a bit with details and concepts I didn't have time to explain.\u003c/p\u003e\n\u003cp\u003eI'll put links here to all sorts of useful stuff that will come in handy as you read:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://youtu.be/ThgqBecaq_w\"\u003eThe Public Talk\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://bespoyasov.ru/talks/podlodka-conf-clean-architecture/en.html\"\u003eSlides for the Talk\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/bespoyasov/frontend-clean-architecture\"\u003eThe source code for the application we're going to design\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://bespoyasov.me/showcase/frontend-clean-architecture/\"\u003eSample of a working application\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"whats-the-plan\"\u003eWhat's the Plan\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#whats-the-plan\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#whats-the-plan\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eFirst, we'll talk about what the clean architecture is in general and get familiar with such concepts as domain, use case and application layers. Then we'll discuss how this applies to the frontend and whether it's worth it at all.\u003c/p\u003e\n\u003cp\u003eNext, we'll design the frontend for a cookie store following the rules of the clean architecture. And finally, we'll implement one of the use cases from scratch to see if it's usable.\u003c/p\u003e\n\u003cp\u003eThe store will use React as its UI framework just to show that this approach can be used with it as well. (And because the talk this post is based on was addressed to developers who already use React 😄) Although React is not necessary, you can use everything I show in this post with other UI libs or frameworks too.\u003c/p\u003e\n\u003cp\u003eThere will be a little TypeScript in the code, but only to show how to use types and interfaces to describe entities. Everything we'll look at today can be used without TypeScript, except the code won't be as expressive.\u003c/p\u003e\n\u003cp\u003eWe will hardly talk about OOP today, so this post should not cause any severe allergies. We will only mention OOP once at the end, but it won't stop us from designing an application.\u003c/p\u003e\n\u003cp\u003eAlso, we'll skip tests today because they are not the main topic of this post. I will keep in mind testability though and mention how to improve it along the way.\u003c/p\u003e\n\u003cp\u003eAnd finally, this post is mostly about you grasping the concept of clean architecture. The examples in the post are simplified, so it isn't literal instruction on how to write the code. Understand the idea and think about how you can apply these principles in your projects.\u003c/p\u003e\n\u003cp\u003eAt the end of the post, you can find a list of methodologies that are related to clean architecture and used on the frontend more widely. So you can find a best fit depending on the size of your project.\u003c/p\u003e\n\u003cp\u003eAnd now, let's dig in!\u003c/p\u003e\n\u003ch2 id=\"architecture-and-design\"\u003eArchitecture and Design\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#architecture-and-design\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#architecture-and-design\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eDesigning is fundamentally about taking things apart... in such a way that they can be put back together. ...Separating things into things that can be composed that's what design is.\u003cbr\u003e\n— Rich Hickey. \u003ca href=\"https://www.infoq.com/presentations/Design-Composition-Performance/\"\u003eDesign Composition and Performance\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eSystem design, says the quote in the epigraph, is the system separation so that it can be reassembled later. And most importantly, be assembled \u003cem\u003eeasily, without too much work\u003c/em\u003e.\u003c/p\u003e\n\u003cp\u003eI agree. But I consider another goal of an architecture to be the extensibility of the system. The demands on the program are constantly changing. We want the program to be easy to update and modify to meet new requirements. The clean architecture can help achieve this goal.\u003c/p\u003e\n\u003ch2 id=\"the-clean-architecture\"\u003eThe Clean Architecture\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#the-clean-architecture\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#the-clean-architecture\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html\"\u003eThe clean architecture\u003c/a\u003e is a way of separating responsibilities and parts of functionality according to their proximity to the application domain.\u003c/p\u003e\n\u003cp\u003eBy \u003ca href=\"https://en.wikipedia.org/wiki/Domain_knowledge\"\u003ethe domain\u003c/a\u003e, we mean the part of the real world that we model with a program. This is the data transformations that reflect transformations in the real world. For example, if we updated the name of a product, replacing the old name with the new one is a domain transformation.\u003c/p\u003e\n\u003cp\u003eThe Clean Architecture is often referred to as a three-layer architecture, because the functionality in it is divided into layers. The original post about \u003ca href=\"https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html\"\u003eThe Clean Architecture\u003c/a\u003e provides a diagram with the layers highlighted:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html\"\u003e\u003cimg src=\"/images/content/clean-architecture-on-frontend/clean-architecture-diagram.jpg\" alt=\"Layer diagram: the domain is in the center, the application layer around it, and the adapters layer on the outside\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eLayer diagram: the domain is in the center, the application layer around it, and the adapters layer on the outside\u003c/p\u003e\n\u003ch3 id=\"domain-layer\"\u003eDomain Layer\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#domain-layer\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#domain-layer\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eAt the center is \u003ca href=\"https://herbertograca.com/2017/11/16/explicit-architecture-01-ddd-hexagonal-onion-clean-cqrs-how-i-put-it-all-together/#domain-layer\"\u003ethe domain layer\u003c/a\u003e. It is the entities and data that describe the subject area of the application, as well as the code to transform that data. The domain is the core that distinguishes one application from another.\u003c/p\u003e\n\u003cp\u003eYou can think of the domain as something that won't change if we move from React to Angular, or if we change some use case. In the case of the store, these are products, orders, users, cart, and functions to update their data.\u003c/p\u003e\n\u003cp\u003eThe data structure of domain entities and the essence of their transformations are independent from the outer world. External events \u003cem\u003etrigger domain transformations\u003c/em\u003e, but \u003cem\u003edo not determine\u003c/em\u003e how they will occur.\u003c/p\u003e\n\u003cp\u003eThe function of adding an item to cart doesn't care how exactly the item was added: by the user himself through the “Buy” button or automatically with a promo code. It will in both cases accept the item and return an updated cart with the added item.\u003c/p\u003e\n\u003ch3 id=\"application-layer\"\u003eApplication Layer\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#application-layer\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#application-layer\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eAround the domain is \u003ca href=\"https://herbertograca.com/2017/11/16/explicit-architecture-01-ddd-hexagonal-onion-clean-cqrs-how-i-put-it-all-together/#application-layer\"\u003ethe application layer\u003c/a\u003e. This layer describes \u003ca href=\"https://en.wikipedia.org/wiki/Use_case\"\u003euse cases\u003c/a\u003e, i.e. user scenarios. They are responsible for what happens after some event occurs.\u003c/p\u003e\n\u003cp\u003eFor example, the “Add to cart” scenario is a use case. It describes the actions that are should be taken after the button is clicked. It's the kind of “orchestrator” that says:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ego to the server, send a request;\u003c/li\u003e\n\u003cli\u003enow perform this a domain transformation;\u003c/li\u003e\n\u003cli\u003enow redraw the UI using the response data.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eAlso, in the application layer theree are \u003ca href=\"https://herbertograca.com/2017/11/16/explicit-architecture-01-ddd-hexagonal-onion-clean-cqrs-how-i-put-it-all-together/#ports\"\u003eports\u003c/a\u003e—the specifications of how \u003cem\u003eour application wants\u003c/em\u003e the outside world to communicate with it. Usually a port is an \u003ca href=\"https://en.wikipedia.org/wiki/Interface_(computing)#Software_interfaces\"\u003einterface\u003c/a\u003e, a behavior contract.\u003c/p\u003e\n\u003cp\u003ePorts serve as a “buffer zone” between our application's wishes and the reality. Input Ports tell us how the application \u003cem\u003ewants\u003c/em\u003e to be contacted by the outside world. Output Ports say how the application \u003cem\u003eis going to\u003c/em\u003e communicate with the outside world to make it ready.\u003c/p\u003e\n\u003cp\u003eWe will look at ports in more detail later.\u003c/p\u003e\n\u003ch3 id=\"adapters-layer\"\u003eAdapters Layer\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#adapters-layer\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#adapters-layer\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eThe outermost layer contains the \u003ca href=\"https://herbertograca.com/2017/09/14/ports-adapters-architecture/\"\u003eadapters\u003c/a\u003e to external services. Adapters are needed to turn incompatible APIs of external services into those compatible with our application's wishes.\u003c/p\u003e\n\u003cp\u003eAdapters are a great way to lower the \u003ca href=\"https://en.wikipedia.org/wiki/Coupling_(computer_programming)\"\u003ecoupling\u003c/a\u003e between our code and the code of third-party services. Low coupling reduces needs to change one module when others are changed.\u003c/p\u003e\n\u003cp\u003eAdapters are often divided into:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003edriving—which \u003cem\u003esend signals to\u003c/em\u003e our application;\u003c/li\u003e\n\u003cli\u003edriven—which \u003cem\u003ereceive the signals from\u003c/em\u003e our application.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cem\u003eThe user\u003c/em\u003e interacts most often with driving adapters. For example, the UI framework's handling of a button click is the work of a driving adapter. It works with the browser API (basically a third-party service) and converts the event into a signal that our application can understand.\u003c/p\u003e\n\u003cp\u003eDriven adapters interact with the \u003cem\u003einfrastructure\u003c/em\u003e. In the frontend, most of the infrastructure is the backend server, but sometimes we may interact with some other services directly, such as a search engine.\u003c/p\u003e\n\u003cp\u003eNote that the farther we are from the center, the more “service-oriented” the code functionality is, the \u003cem\u003efarther it is from the domain knowledge\u003c/em\u003e of our application. This will be important later on, when we decide which layer any module should belong to.\u003c/p\u003e\n\u003ch3 id=\"dependency-rule\"\u003eDependency Rule\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#dependency-rule\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#dependency-rule\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eThe three-layer architecture has a dependency rule: \u003cem\u003eonly the outer layers can depend on the inner layers\u003c/em\u003e. This means that:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ethe domain must be independent;\u003c/li\u003e\n\u003cli\u003ethe application layer can depend on the domain;\u003c/li\u003e\n\u003cli\u003ethe outer layers can depend on anything.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003ca href=\"https://herbertograca.com/2017/11/16/explicit-architecture-01-ddd-hexagonal-onion-clean-cqrs-how-i-put-it-all-together/\"\u003e\u003cimg src=\"/images/content/clean-architecture-on-frontend/hex-pie.png\" alt=\"Only the outer layers can depend on the inner layers\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eOnly the outer layers can depend on the inner layers\u003c/p\u003e\n\u003cp\u003eSometimes this rule can be violated, although it is better not to abuse it. For example, it is sometimes convenient to use some “library-like” code in a domain, even though there should be no dependencies. We'll look at an example of this when we get to the source code.\u003c/p\u003e\n\u003cp\u003eAn uncontrolled direction of dependencies can lead to complicated and confusing code. For example, breaking a dependency rule can lead to:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eCyclic dependencies, where module A depends on B, B depends on C, and C depends on A.\u003c/li\u003e\n\u003cli\u003ePoor testability, where you have to simulate the whole system to test a small part.\u003c/li\u003e\n\u003cli\u003eToo high coupling, and as a consequence, brittle interaction between modules.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"advantages-of-clean-architecture\"\u003eAdvantages of Clean Architecture\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#advantages-of-clean-architecture\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#advantages-of-clean-architecture\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eNow let's talk about what this separation of code gives us. It has several advantages.\u003c/p\u003e\n\u003ch3 id=\"separate-domain\"\u003eSeparate domain\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#separate-domain\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#separate-domain\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eAll the main application functionality is \u003cem\u003eisolated and collected\u003c/em\u003e in one place—in the domain.\u003c/p\u003e\n\u003cp\u003eFunctionality in the domain is independent, which means that it is easier to test. The less dependencies the module has, the less infrastructure is needed for testing, the less mocks and stubs are needed.\u003c/p\u003e\n\u003cp\u003eA stand-alone domain is also easier to test against business expectations. This helps new developers to grasp on what the application should do. In addition, a stand-alone domain helps look for errors and inaccuracies in the “translation” from the business language to the programming language more quickly.\u003c/p\u003e\n\u003ch3 id=\"independent-use-cases\"\u003eIndependent Use Cases\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#independent-use-cases\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#independent-use-cases\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eApplication scenarios, use cases are described separately. They dictate what third-party services we will need. We \u003cem\u003eadapt the outside world\u003c/em\u003e to our needs, not the other way around. This gives us more freedom to choose third-party services. For example, we can quickly change the payment system if the current one starts charging too much.\u003c/p\u003e\n\u003cp\u003eThe use case code also becomes flat, testable and extensible. We will see this in an example later on.\u003c/p\u003e\n\u003ch3 id=\"replaceable-third-party-services\"\u003eReplaceable Third-Party Services\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#replaceable-third-party-services\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#replaceable-third-party-services\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eExternal services become replaceable because of adapters. As long as we don't change the interface, it doesn't matter which external service implements the interface.\u003c/p\u003e\n\u003cp\u003eThis way, we create a barrier to change propagation: changes in someone else's code do not directly affect our own. Adapters also \u003ca href=\"https://bespoyasov.me/blog/patterns-for-fault-tolerant-software/\"\u003elimit the propagation of bugs\u003c/a\u003e in the application runtime.\u003c/p\u003e\n\u003ch2 id=\"costs-of-clean-architecture\"\u003eCosts of Clean Architecture\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#costs-of-clean-architecture\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#costs-of-clean-architecture\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eArchitecture is first of all a tool. Like any tool, the clean architecture has its costs besides its benefits.\u003c/p\u003e\n\u003ch3 id=\"takes-time\"\u003eTakes Time\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#takes-time\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#takes-time\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eThe main cost is time. It is required not only for design, but also for implementation, because it is always easier to call a third-party service directly than to write adapters.\u003c/p\u003e\n\u003cp\u003eIt is also difficult to think through the interaction of all the modules of the system in advance, because we may not know all the requirements and constraints beforehand. When designing, we need to keep in mind how the system can change, and leave room for expansion.\u003c/p\u003e\n\u003ch3 id=\"sometimes-overly-verbose\"\u003eSometimes Overly Verbose\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#sometimes-overly-verbose\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#sometimes-overly-verbose\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eIn general, a canonical implementation of the clean architecture is not always convenient, and sometimes even harmful. If the project is small, a full implementation will be an overkill that will increase the entry threshold for newcomers.\u003c/p\u003e\n\u003cp\u003eYou may need to make design tradeoffs to stay within budget or deadline. I'll show you by example exactly what I mean by such tradeoffs.\u003c/p\u003e\n\u003ch2 id=\"can-make-onboarding-more-difficult\"\u003eCan Make Onboarding More Difficult\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#can-make-onboarding-more-difficult\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#can-make-onboarding-more-difficult\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eFull implementation of the clean architecture can make the onboarding more difficult because any tool requires the knowledge on how to use it.\u003c/p\u003e\n\u003cp\u003eIf you over-engineer at the beginning of a project, it will be harder to onboard new developers later. You have to keep this in mind and keep your code simple.\u003c/p\u003e\n\u003ch2 id=\"can-increase-the-amount-of-code\"\u003eCan Increase the Amount of Code\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#can-increase-the-amount-of-code\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#can-increase-the-amount-of-code\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eA problem specific for frontend is that the clean architecture can increase the amount of code in the final bundle. The more code we give to the browser, the more it has to download, parse and interpret.\u003c/p\u003e\n\u003cp\u003eThe amount of code will have to be watched and decisions will have to be made about where to cut corners:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003emaybe describe the use case a little simpler;\u003c/li\u003e\n\u003cli\u003emaybe access the domain functionality directly from the adapter, bypassing the use case;\u003c/li\u003e\n\u003cli\u003emaybe we'll have to tweak the code splitting, etc.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"how-to-reduce-costs\"\u003eHow to Reduce Costs\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#how-to-reduce-costs\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#how-to-reduce-costs\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eYou can reduce the amount of time and code by cutting corners and sacrificing the “cleanliness” of the architecture. I'm generally not a fan of radical approaches: if it's more pragmatic (e.g. benefits will be higher than potential costs) to break a rule, I'll break it.\u003c/p\u003e\n\u003cp\u003eSo, you can balk at some aspects of the clean architecture for a while with no problem at all. The \u003cem\u003eminimum required\u003c/em\u003e amount of resources, however, that are definitely worth devoting to are two things.\u003c/p\u003e\n\u003ch3 id=\"extract-domain\"\u003eExtract Domain\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#extract-domain\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#extract-domain\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eThe extracted domain helps to understand \u003cem\u003ewhat\u003c/em\u003e we are designing in general and how it should work. The extracted domain makes it easier for new developers to understand the application, its entities and relationships between them.\u003c/p\u003e\n\u003cp\u003eEven if we skip the other layers, it still will be easier to work and refactor with the extracted domain which is not spread over the code base. Other layers can be added as needed.\u003c/p\u003e\n\u003ch3 id=\"obey-dependency-rule\"\u003eObey Dependency Rule\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#obey-dependency-rule\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#obey-dependency-rule\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eThe second rule not to be discarded is the rule of dependencies, or rather their \u003cem\u003edirection\u003c/em\u003e. External services must adapt to our need and never otherwise.\u003c/p\u003e\n\u003cp\u003eIf you feel that you are \"fine-tuning\" your code so that it can call the search API, something is wrong. Better write an adapter before the problem spreads.\u003c/p\u003e\n\u003ch2 id=\"designing-the-application\"\u003eDesigning the Application\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#designing-the-application\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#designing-the-application\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eNow that we've talked about theory, we can get down to practice. Let's design the architecture of a \u003ca href=\"https://bespoyasov.me/showcase/frontend-clean-architecture/\"\u003ecookie store\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eThe store will sell different kinds of cookies, which may have different ingredients. Users will choose cookies and order them, and pay for the orders in a third-party payment service.\u003c/p\u003e\n\u003cp\u003eThere will be a showcase of cookies that we can buy on the home page. We will only be able to buy cookies if we are authenticated. The login button will take us to a login page where we can log in.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/content/clean-architecture-on-frontend/en/app.png\" alt=\"Store main page\"\u003e\u003c/p\u003e\n\u003cp\u003eStore main page\u003c/p\u003e\n\u003cp\u003e(Don't mind how it looks, I'm no web-designer 😄)\u003c/p\u003e\n\u003cp\u003eAfter a successful login we will be able to put some cookies in the cart.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/content/clean-architecture-on-frontend/en/app-cart.png\" alt=\"Cart with selected cookies\"\u003e\u003c/p\u003e\n\u003cp\u003eCart with selected cookies\u003c/p\u003e\n\u003cp\u003eWhen we've put the cookies in the cart, we can place the order. After payment, we get a new order in the list and a cleared shopping cart.\u003c/p\u003e\n\u003cp\u003eWe'll implement the checkout use case. You can find the rest use cases in \u003ca href=\"https://github.com/bespoyasov/frontend-clean-architecture/tree/master/src/application\"\u003ethe source code\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eFirst we'll define what kind of entities, use cases and functionality in the broad sense we'll have at all. Then let's decide which layer they should belong to.\u003c/p\u003e\n\u003ch3 id=\"designing-domain\"\u003eDesigning Domain\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#designing-domain\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#designing-domain\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eThe most important thing in an application is the domain. It is where the main entities of the application and their data transformations are. I suggest that you start with the domain in order to accurately represent the domain knowledge of the app in your code.\u003c/p\u003e\n\u003cp\u003eThe store domain may include:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ethe data types of each entity: user, cookie, cart, and order;\u003c/li\u003e\n\u003cli\u003ethe factories for creating each entity, or classes if you write in OOP;\u003c/li\u003e\n\u003cli\u003eand transformation functions for that data.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThe transformation functions in the domain should depend only on the rules of the domain and nothing else. Such functions would be, for example:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ea function for calculating the total cost;\u003c/li\u003e\n\u003cli\u003euser's taste preference detection\u003c/li\u003e\n\u003cli\u003edetermining whether an item is in the shopping cart, etc.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"/images/content/clean-architecture-on-frontend/layers-domain.png\" alt=\"Domain entities diagram\"\u003e\u003c/p\u003e\n\u003cp\u003eDomain entities diagram\u003c/p\u003e\n\u003ch3 id=\"designing-application-layer\"\u003eDesigning Application Layer\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#designing-application-layer\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#designing-application-layer\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eThe application layer contains the use cases. A use case always has an actor, an action, and a result.\u003c/p\u003e\n\u003cp\u003eIn the store, we can distinguish:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eA product purchase scenario;\u003c/li\u003e\n\u003cli\u003epayment, calling third-party payment systems;\u003c/li\u003e\n\u003cli\u003einteraction with products and orders: updating, browsing;\u003c/li\u003e\n\u003cli\u003eaccess to pages depending on roles.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eUse cases are usually described in terms of the subject area. For example, the “checkout” scenario actually consists of several steps:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eretrieve items from the shopping cart and create a new order;\u003c/li\u003e\n\u003cli\u003epay for the order;\u003c/li\u003e\n\u003cli\u003enotify the user if the payment fails;\u003c/li\u003e\n\u003cli\u003eclear the cart and show the order.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThe use case function will be the code that describes this scenario.\u003c/p\u003e\n\u003cp\u003eAlso, in the application layer there are ports—interfaces for communicating with the outside world.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/content/clean-architecture-on-frontend/layers-application.png\" alt=\"Use cases and ports diagram\"\u003e\u003c/p\u003e\n\u003cp\u003eUse cases and ports diagram\u003c/p\u003e\n\u003ch3 id=\"designing-adapters-layer\"\u003eDesigning Adapters Layer\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#designing-adapters-layer\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#designing-adapters-layer\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eIn the adapters layer, we declare adapters to external services. Adapters make incompatible APIs of third-party services compatible to our system.\u003c/p\u003e\n\u003cp\u003eOn the frontend, adapters are usually the UI framework and the API server request module. In our case we will use:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eUI-framework;\u003c/li\u003e\n\u003cli\u003eAPI request module;\u003c/li\u003e\n\u003cli\u003eAdapter for local storage;\u003c/li\u003e\n\u003cli\u003eAdapters and converters of API answers to the application layer.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"/images/content/clean-architecture-on-frontend/layers-adapters.png\" alt=\"Adapters diagram with splitting by driving and driven adapters\"\u003e\u003c/p\u003e\n\u003cp\u003eAdapters diagram with splitting by driving and driven adapters\u003c/p\u003e\n\u003cp\u003eNote that the more functionality is “service-like”, the farther away it is from the center of the diagram.\u003c/p\u003e\n\u003ch3 id=\"using-mvc-analogy\"\u003eUsing MVC Analogy\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#using-mvc-analogy\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#using-mvc-analogy\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eSometimes it's hard to know which layer some data belongs to. A small (and incomplete!) analogy with \u003ca href=\"https://en.wikipedia.org/wiki/Model-view-controller\"\u003eMVC\u003c/a\u003e may help here:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003emodels are usually domain entities,\u003c/li\u003e\n\u003cli\u003econtrollers are domain transformations and application layer,\u003c/li\u003e\n\u003cli\u003eview is driving adapters.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThe concepts are different in detail but quite similar, and this analogy can be used to define domain and application code.\u003c/p\u003e\n\u003ch2 id=\"into-details-domain\"\u003eInto Details: Domain\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#into-details-domain\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#into-details-domain\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eOnce we've determined \u003cem\u003ewhat\u003c/em\u003e entities we'll need, we can start defining \u003cem\u003ehow\u003c/em\u003e they behave.\u003c/p\u003e\n\u003cp\u003eI'll show you the code structure in \u003ca href=\"https://github.com/bespoyasov/frontend-clean-architecture/\"\u003eproject\u003c/a\u003e right away. For clarity, I divide the code into folders-layers.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003esrc/\n|_domain/\n  |_user.ts\n  |_product.ts\n  |_order.ts\n  |_cart.ts\n|_application/\n  |_addToCart.ts\n  |_authenticate.ts\n  |_orderProducts.ts\n  |_ports.ts\n|_services/\n  |_authAdapter.ts\n  |_notificationAdapter.ts\n  |_paymentAdapter.ts\n  |_storageAdapter.ts\n  |_api.ts\n  |_store.tsx\n|_lib/\n|_ui/\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe domain is in the \u003ccode\u003edomain/\u003c/code\u003e directory, the application layer is in \u003ccode\u003eapplication/\u003c/code\u003e, and the adapters are in \u003ccode\u003eservices/\u003c/code\u003e. We will discuss alternatives to this code structure at the end.\u003c/p\u003e\n\u003ch3 id=\"creating-domain-entities\"\u003eCreating Domain Entities\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#creating-domain-entities\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#creating-domain-entities\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eWe will have 4 modules in the domain:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eproduct;\u003c/li\u003e\n\u003cli\u003euser;\u003c/li\u003e\n\u003cli\u003eorder;\u003c/li\u003e\n\u003cli\u003eshopping cart.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThe main actor is the user. We will store data about the user in the storage during the session. We want to type this data, so we will create a domain user type.\u003c/p\u003e\n\u003cp\u003eThe user type will contain ID, name, mail and lists of preferences and allergies.\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token comment\"\u003e// domain/user.ts\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eUserName\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eUser\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  id\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eUniqueId\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  name\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eUserName\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  email\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eEmail\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  preferences\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eIngredient\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  allergies\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eIngredient\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eUsers will put cookies in the cart. Let's add types for the cart and the product. The item will contain ID, name, price in pennies and list of ingredients.\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token comment\"\u003e// domain/product.ts\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eProductTitle\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eProduct\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  id\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eUniqueId\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  title\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eProductTitle\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  price\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003ePriceCents\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  toppings\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eIngredient\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIn the shopping cart, we will only keep a list of the products that the user has put in it:\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token comment\"\u003e// domain/cart.ts\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eProduct\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"./product\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eCart\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  products\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eProduct\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAfter a successful payment an new order is created. Let's add an order entity type.\u003c/p\u003e\n\u003cp\u003eThe order type will contain the user ID, the list of ordered products, the date and time of creation, the status and the total price for the entire order.\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token comment\"\u003e// domain/order.ts\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eOrderStatus\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"new\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"delivery\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"completed\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eOrder\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  user\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eUniqueId\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  cart\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eCart\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  created\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eDateTimeString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  status\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eOrderStatus\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  total\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003ePriceCents\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"checking-relationship-between-entities\"\u003eChecking Relationship Between Entities\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#checking-relationship-between-entities\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#checking-relationship-between-entities\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eThe benefit of designing entity types in such a way is that we can already check whether their relationship diagram corresponds to reality:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/content/clean-architecture-on-frontend/interaction.png\" alt=\"Entity Relationship Diagram\"\u003e\u003c/p\u003e\n\u003cp\u003eEntity Relationship Diagram\u003c/p\u003e\n\u003cp\u003eWe can see and check:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eif the main actor is really a user,\u003c/li\u003e\n\u003cli\u003eif there is enough information in the order,\u003c/li\u003e\n\u003cli\u003eif some entity needs to be extended,\u003c/li\u003e\n\u003cli\u003eif there will be problems with extensibility in the future.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eAlso, already at this stage, types will help highlight errors with the compatibility of entities with each other and the direction of signals between them.\u003c/p\u003e\n\u003cp\u003eIf everything meets our expectations, we can start designing domain transformations.\u003c/p\u003e\n\u003ch3 id=\"creating-data-transformations\"\u003eCreating Data Transformations\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#creating-data-transformations\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#creating-data-transformations\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eAll sorts of things will happen to the data whose types we've just designed. We will be adding items to the cart, clearing it, updating items and user names, and so on. We will create separate functions for all these transformations.\u003c/p\u003e\n\u003cp\u003eFor example, to determine if a user is allergic to some ingredient or preference, we can write functions \u003ccode\u003ehasAllergy\u003c/code\u003e and \u003ccode\u003ehasPreference\u003c/code\u003e:\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token comment\"\u003e// domain/user.ts\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003ehasAllergy\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eUser\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e ingredient\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eIngredient\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eboolean\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e user\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eallergies\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eincludes\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eingredient\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003ehasPreference\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eUser\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e ingredient\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eIngredient\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eboolean\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e user\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003epreferences\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eincludes\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eingredient\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe functions \u003ccode\u003eaddProduct\u003c/code\u003e and \u003ccode\u003econtains\u003c/code\u003e are used to add items to cart and check if an item is in cart:\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token comment\"\u003e// domain/cart.ts\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003eaddProduct\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecart\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eCart\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e product\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eProduct\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eCart\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token spread operator\"\u003e...\u003c/span\u003ecart\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e products\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token spread operator\"\u003e...\u003c/span\u003ecart\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eproducts\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e product\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003econtains\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecart\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eCart\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e product\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eProduct\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eboolean\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e cart\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eproducts\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003esome\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e id \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e id \u003cspan class=\"token operator\"\u003e===\u003c/span\u003e product\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe also need to calculate the total price of the list of products—for this we will write the function \u003ccode\u003etotalPrice\u003c/code\u003e. If required, we can add to this function to account for various conditions, such as promo codes or seasonal discounts.\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token comment\"\u003e// domain/product.ts\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003etotalPrice\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eproducts\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eProduct\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003ePriceCents\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e products\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003ereduce\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etotal\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e price \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e total \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e price\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eTo allow users to create orders, we will add the function \u003ccode\u003ecreateOrder\u003c/code\u003e. It will return a new order associated with a specified user and their cart.\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token comment\"\u003e// domain/order.ts\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateOrder\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eUser\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e cart\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eCart\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eOrder\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    cart\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    user\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e user\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    status\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"new\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    created\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token known-class-name class-name\"\u003eDate\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003etoISOString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    total\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token function\"\u003etotalPrice\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eproducts\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNote that in every function we build the API so that \u003cem\u003ewe\u003c/em\u003e can comfortably transform the data. We take arguments and give the result as we want.\u003c/p\u003e\n\u003cp\u003eAt the design stage, there are no external constraints yet. This allows us to reflect data transformations as close to the subject domain as possible. And the closer the transformations are to reality, the easier it will be to check their work.\u003c/p\u003e\n\u003ch2 id=\"into-detail-shared-kernel\"\u003eInto Detail: Shared Kernel\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#into-detail-shared-kernel\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#into-detail-shared-kernel\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eYou may have noticed some of the types we used when describing domain types. For example, \u003ccode\u003eEmail\u003c/code\u003e, \u003ccode\u003eUniqueId\u003c/code\u003e or \u003ccode\u003eDateTimeString\u003c/code\u003e. These are \u003ca href=\"https://www.typescriptlang.org/docs/handbook/advanced-types.html#type-aliases\"\u003etype-alias\u003c/a\u003e:\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token comment\"\u003e// shared-kernel.d.ts\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eEmail\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eUniqueId\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eDateTimeString\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003ePriceCents\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eI usually use type-alias to get rid of \u003ca href=\"https://refactoring.guru/smells/primitive-obsession\"\u003eprimitive obsession\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eI use \u003ccode\u003eDateTimeString\u003c/code\u003e instead of just \u003ccode\u003estring\u003c/code\u003e, to make it clearer what kind of string is used. The closer the type is to the subject area, the easier it will be to deal with errors when they occur.\u003c/p\u003e\n\u003cp\u003eThe specified types are in the file \u003ccode\u003eshared-kernel.d.ts\u003c/code\u003e. \u003ca href=\"http://ddd.fed.wiki.org/view/welcome-visitors/view/domain-driven-design/view/shared-kernel\"\u003e\u003cem\u003eShared kernel\u003c/em\u003e\u003c/a\u003e is the code and the data, dependency on which doesn't increase coupling between modules. More about this concept you can find in \u003ca href=\"https://herbertograca.com/2017/11/16/explicit-architecture-01-ddd-hexagonal-onion-clean-cqrs-how-i-put-it-all-together/\"\u003e\"DDD, Hexagonal, Onion, Clean, CQRS, ...How I put it all together\"\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eIn practice, the shared kernel can be explained like this. We use TypeScript, we use its standard type library, but we don't consider them as \u003cem\u003edependencies\u003c/em\u003e. This is because the modules that use them may not know anything about each other and remain decoupled.\u003c/p\u003e\n\u003cp\u003eNot all code can be classified as shared kernel. The main and most important limitation is that such code must be compatible with \u003cem\u003eany part of the system\u003c/em\u003e. If a part of the application is written in TypeScript and another part in another language, the shared kernel may contain only code that can be used in both parts. For example, entity specifications in JSON format are fine, TypeScript helpers are not.\u003c/p\u003e\n\u003cp\u003eIn our case, the entire application is written in TypeScript, so type-alias over built-in types can also be classified as shared kernel. Such globally available types do not increase coupling between modules and can be used in any part of the application.\u003c/p\u003e\n\u003ch2 id=\"into-detail-application-layer\"\u003eInto Detail: Application Layer\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#into-detail-application-layer\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#into-detail-application-layer\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eNow that we have the domain figured out, we can move on to the application layer. This layer contains \u003ca href=\"https://en.wikipedia.org/wiki/Use_case\"\u003euse cases\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eIn the code we describe the technical details of scenarios. A use case is a description of what should happen to the data after adding an item to cart or proceeding to checkout.\u003c/p\u003e\n\u003cp\u003eUse cases involve interaction with the outer world, and thus, the use of external services. Interactions with the outside world are side-effects. We know that it is easier to work with and debug functions and systems without side-effects. And most of our domain functions are already written as pure functions.\u003c/p\u003e\n\u003cp\u003eTo combine clean transformations and interaction with the impure world, we can use the application layer as an impure context.\u003c/p\u003e\n\u003ch3 id=\"impure-context-for-pure-transformations\"\u003eImpure Context For Pure Transformations\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#impure-context-for-pure-transformations\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#impure-context-for-pure-transformations\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eAn impure context for pure transformations is a code organization in which:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ewe first perform a side-effect to get some data;\u003c/li\u003e\n\u003cli\u003ethen we do a pure transformation on that data;\u003c/li\u003e\n\u003cli\u003eand then do a side-effect again to store or pass the result.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eIn the “Put item in cart” use case, this would look like:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003efirst, the handler would retrieve the cart state from the store;\u003c/li\u003e\n\u003cli\u003ethen it would call the cart update function, passing the item to be added;\u003c/li\u003e\n\u003cli\u003eand then it would save the updated cart in the storage.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThe whole process is a “sandwich”: side-effect, pure function, side-effect. The main logic is reflected in data transformation, and all communication with the world is isolated in an imperative shell.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/content/clean-architecture-on-frontend/impureim.png\" alt=\"Functional architecture: side-effect, pure function, side-effect\"\u003e\u003c/p\u003e\n\u003cp\u003eFunctional architecture: side-effect, pure function, side-effect\u003c/p\u003e\n\u003cp\u003eImpure context is sometimes called a functional core in an imperative shell. Mark Seemann \u003ca href=\"https://blog.ploeh.dk/2020/03/02/impureim-sandwich/\"\u003ewrote about this in his blog\u003c/a\u003e. This is the approach we will use when writing use case functions.\u003c/p\u003e\n\u003ch3 id=\"designing-use-case\"\u003eDesigning Use Case\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#designing-use-case\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#designing-use-case\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eWe will select and design the checkout use case. It is the most representative one because it is asynchronous and interacts with a lot of third-party services. The rest of the scenarios and the code of the whole application you can find on \u003ca href=\"https://github.com/bespoyasov/frontend-clean-architecture\"\u003eGitHub\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eLet's think about what we want to achieve in this use case. The user has a cart with cookies, when the user clicks the checkout button:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ewe want to create a new order;\u003c/li\u003e\n\u003cli\u003epay for it in a third-party payment system;\u003c/li\u003e\n\u003cli\u003eif the payment failed, notify the user about it;\u003c/li\u003e\n\u003cli\u003eif it passed, save the order on the server;\u003c/li\u003e\n\u003cli\u003eadd the order to the local data store to show on the screen.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eIn terms of API and function signature, we want to pass the user and the cart as arguments, and have the function do everything else by itself.\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eOrderProducts\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eUser\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e cart\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eCart\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIdeally, of course, the use case should not take two separate arguments, but a command that will encapsulate all the input data inside itself. But we don't want to bloat the amount of code, so we'll leave it that way.\u003c/p\u003e\n\u003ch3 id=\"writing-application-layer-ports\"\u003eWriting Application Layer Ports\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#writing-application-layer-ports\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#writing-application-layer-ports\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eLet's take a closer look at the steps of the use case: the order creation itself is a domain function. Everything else is external services that we want to use.\u003c/p\u003e\n\u003cp\u003eIt's important to remember that it's the external services that have to adapt to our needs and not otherwise. So, in the application layer, we'll describe not only the use case itself, but also the interfaces to these external services—the ports.\u003c/p\u003e\n\u003cp\u003eThe ports should be, first of all, convenient for our application. If the API of external services isn't compatible with our needs, we'll write an adapter.\u003c/p\u003e\n\u003cp\u003eLet's think of the services we will need:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ea payment system;\u003c/li\u003e\n\u003cli\u003ea service to notify users about events and errors;\u003c/li\u003e\n\u003cli\u003ea service to save data to the local storage.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"/images/content/clean-architecture-on-frontend/ports.png\" alt=\"Services we\u0026#x27;re going to need\"\u003e\u003c/p\u003e\n\u003cp\u003eServices we're going to need\u003c/p\u003e\n\u003cp\u003eNote that we are now talking about the \u003cem\u003einterfaces\u003c/em\u003e of these services, not their implementation. At this stage, it is important for us to describe the required behavior, because this is the behavior we will rely on in the application layer when describing the scenario.\u003c/p\u003e\n\u003cp\u003eHow exactly this behavior will be implemented is \u003cem\u003enot important\u003c/em\u003e yet. This allows us to postpone the decision about which external services to use until the very last moment—this makes the code \u003ca href=\"https://en.wikipedia.org/wiki/Coupling_%28computer_programming%29\"\u003eminimally coupled\u003c/a\u003e. We'll deal with the implementation later.\u003c/p\u003e\n\u003cp\u003eAlso note that we \u003ca href=\"https://en.wikipedia.org/wiki/Interface_segregation_principle\"\u003esplit the interfaces by features\u003c/a\u003e. Everything payment-related is in one module, storage-related in another. This way it will be easier to ensure that the functionality of different third party services are not mixed up.\u003c/p\u003e\n\u003ch3 id=\"payment-system-interface\"\u003ePayment System Interface\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#payment-system-interface\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#payment-system-interface\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eThe cookie store is a sample application, so the payment system will be very simple. It will have a \u003ccode\u003etryPay\u003c/code\u003e method, which will accept the amount of money that needs to be paid, and in response will send a confirmation that everything is OK.\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token comment\"\u003e// application/ports.ts\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003ePaymentService\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003etryPay\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eamount\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003ePriceCents\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token builtin\"\u003eboolean\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe won't handle errors, because error handling is a topic for a whole separate big post 😃\u003c/p\u003e\n\u003cp\u003eYes, usually the payment is done on the server, but this is a sample-example, let's do everything on the client. We could easily communicate with our API instead of directly with the payment system. This change, by the way, would only affect this use case, the rest of the code would remain untouched.\u003c/p\u003e\n\u003ch3 id=\"notification-service-interface\"\u003eNotification Service Interface\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#notification-service-interface\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#notification-service-interface\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eIf something goes wrong, we have to tell the user about it.\u003c/p\u003e\n\u003cp\u003eThe user can be notified in different ways. We can use the UI, we can send letters, we can user's phone to vibrate (please, don't).\u003c/p\u003e\n\u003cp\u003eIn general, the notification service would also be better to be abstract, so that now we don't have to think about the implementation.\u003c/p\u003e\n\u003cp\u003eLet it take a message and \u003cem\u003esomehow\u003c/em\u003e notify the user:\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token comment\"\u003e// application/ports.ts\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eNotificationService\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003enotify\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emessage\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"local-storage-interface\"\u003eLocal Storage Interface\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#local-storage-interface\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#local-storage-interface\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eWe will save the new order in a local repository.\u003c/p\u003e\n\u003cp\u003eThis storage can be anything: Redux, MobX, whatever-floats-your-boat-js. The repository can be divided into micro-stores for different entities or be one big repository for all the application data. It's not important right now either, because these are implementation details.\u003c/p\u003e\n\u003cp\u003eI like to divide the storage interfaces into separate ones for each entity. A separate interface for the user data store, a separate one for the shopping cart, a separate one for the order store:\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token comment\"\u003e// application/ports.ts\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eOrdersStorageService\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  orders\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eOrder\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003eupdateOrders\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eorders\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eOrder\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIn the example here I make only the order store interface, all the rest you can see in \u003ca href=\"https://github.com/bespoyasov/frontend-clean-architecture/blob/master/src/application/ports.ts#L5\"\u003esource code\u003c/a\u003e.\u003c/p\u003e\n\u003ch3 id=\"use-case-function\"\u003eUse Case Function\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#use-case-function\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#use-case-function\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eLet's see if we can build the use case using the created interfaces and the existing domain functionality. As we described earlier, the script will consist of the following steps:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003everify the data;\u003c/li\u003e\n\u003cli\u003ecreate an order;\u003c/li\u003e\n\u003cli\u003epay for the order;\u003c/li\u003e\n\u003cli\u003enotify about problems;\u003c/li\u003e\n\u003cli\u003esave the result.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"/images/content/clean-architecture-on-frontend/flow.png\" alt=\"All steps of the custom script in the diagram\"\u003e\u003c/p\u003e\n\u003cp\u003eAll steps of the custom script in the diagram\u003c/p\u003e\n\u003cp\u003eFirst, let's declare the stubs of the services we're going to use. TypeScript will swear that we haven't implemented the interfaces in the appropriate variables, but for now it doesn't matter.\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token comment\"\u003e// application/orderProducts.ts\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e payment\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003ePaymentService\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e notifier\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eNotificationService\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e orderStorage\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eOrdersStorageService\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe can now use these stubs as if they were real services. We can access their fields, call their methods. This comes in handy when “translating” a use case from the business language to software language.\u003c/p\u003e\n\u003cp\u003eNow, create a function called \u003ccode\u003eorderProducts\u003c/code\u003e. Inside, the first thing we do is create a new order:\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token comment\"\u003e// application/orderProducts.ts\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e//...\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003eorderProducts\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eUser\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e cart\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eCart\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e order \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateOrder\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e cart\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eHere we take advantage of the fact that the interface is a contract for behavior. This means that in the future the stubs will actually perform the actions we now expect:\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token comment\"\u003e// application/orderProducts.ts\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e//...\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003eorderProducts\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eUser\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e cart\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eCart\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e order \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateOrder\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e cart\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token comment\"\u003e// Try to pay for the order;\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// Notify the user if something is wrong:\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e paid \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003eawait\u003c/span\u003e payment\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003etryPay\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eorder\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003etotal\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e!\u003c/span\u003epaid\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e notifier\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003enotify\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Оплата не прошла 🤷\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token comment\"\u003e// Save the result and clear the cart:\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e orders \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e orderStorage\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  orderStorage\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eupdateOrders\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token spread operator\"\u003e...\u003c/span\u003eorders\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e order\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  cartStorage\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eemptyCart\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNote that the use case does not call third-party services directly. It relies on the behavior described in the interfaces, so as long as the interface remains the same, we don't care which module implements it and how. This makes the modules replaceable.\u003c/p\u003e\n\u003ch2 id=\"into-detail-adapters-layer\"\u003eInto Detail: Adapters Layer\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#into-detail-adapters-layer\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#into-detail-adapters-layer\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eWe have “translated” the use case into TypeScript. Now we have to check if the reality matches our needs.\u003c/p\u003e\n\u003cp\u003eUsually it doesn't. So we tweak the outside world to suit our needs with \u003ca href=\"https://en.wikipedia.org/wiki/Adapter_pattern\"\u003eadapters\u003c/a\u003e.\u003c/p\u003e\n\u003ch3 id=\"binding-ui-and-usecase\"\u003eBinding UI and Usecase\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#binding-ui-and-usecase\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#binding-ui-and-usecase\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eThe first adapter is a UI framework. It connects the native browser API with the application. In the case of the order creation, it is the “Checkout” button and the click handler, which will launch the use case function.\u003c/p\u003e\n\u003cpre class=\"language-tsx\"\u003e\u003ccode class=\"language-tsx\"\u003e\u003cspan class=\"token comment\"\u003e// ui/components/Buy.tsx\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eBuy\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// Get access to the use case in the component:\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e orderProducts \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003euseOrderProducts\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003ehandleSubmit\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ee\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eReact\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eFormEvent\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003esetLoading\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003epreventDefault\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e// Call the use case function:\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003eawait\u003c/span\u003e \u003cspan class=\"token function\"\u003eorderProducts\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser\u003cspan class=\"token operator\"\u003e!\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e cart\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003esetLoading\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token boolean\"\u003efalse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003esection\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n      \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eh2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003eCheckout\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eh2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n      \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eform\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eonSubmit\u003c/span\u003e\u003cspan class=\"token script language-javascript\"\u003e\u003cspan class=\"token script-punctuation punctuation\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003ehandleSubmit\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token comment\"\u003e/* ... */\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eform\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n    \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003esection\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eLet's provide the use case through a hook. We'll get all the services inside, and as a result, we'll return the use case function itself from the hook.\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token comment\"\u003e// application/orderProducts.ts\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003euseOrderProducts\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e notifier \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003euseNotifier\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e payment \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eusePayment\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e orderStorage \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003euseOrdersStorage\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003eorderProducts\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eUser\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e cookies\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eCookie\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// …\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e orderProducts \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe use hooks as a “crooked dependency injection”. First we use the hooks \u003ccode\u003euseNotifier\u003c/code\u003e, \u003ccode\u003eusePayment\u003c/code\u003e, \u003ccode\u003euseOrdersStorage\u003c/code\u003e to get the service instances, and then we use \u003ca href=\"https://en.wikipedia.org/wiki/Closure_(computer_programming)\"\u003eclosure\u003c/a\u003e of the \u003ccode\u003euseOrderProducts\u003c/code\u003e function to make them available inside the \u003ccode\u003eorderProducts\u003c/code\u003e function.\u003c/p\u003e\n\u003cp\u003eIt's important to note that the use case function is still separated from the rest of the code, which is important for testing. We'll pull it out completely and make it even more testable at the end of the article, when we do the review and refactoring.\u003c/p\u003e\n\u003ch3 id=\"payment-service-implementation\"\u003ePayment Service Implementation\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#payment-service-implementation\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#payment-service-implementation\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eThe use case uses the \u003ccode\u003ePaymentService\u003c/code\u003e interface. Let's implement it.\u003c/p\u003e\n\u003cp\u003eFor payment, we will use the fake API stub. Again, we are not forced to write the whole service now, we can write it later, the main thing—to implement the specified behavior:\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token comment\"\u003e// services/paymentAdapter.ts\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e fakeApi \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"./api\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003ePaymentService\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"../application/ports\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003eusePayment\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003ePaymentService\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003etryPay\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eamount\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003ePriceCents\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token function\"\u003efakeApi\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe \u003ccode\u003efakeApi\u003c/code\u003e function is a timeout which is triggered after 450ms, simulating a delayed response from the server. It returns what we pass to it as an argument.\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token comment\"\u003e// services/api.ts\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token generic-function\"\u003e\u003cspan class=\"token function\"\u003efakeApi\u003c/span\u003e\u003cspan class=\"token generic class-name\"\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token maybe-class-name\"\u003eTResponse\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eresponse\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eTResponse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token maybe-class-name\"\u003eTResponse\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eres\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003esetTimeout\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eres\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eresponse\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e450\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe explicitly type the return value of \u003ccode\u003eusePayment\u003c/code\u003e. This way TypeScript will check that the function actually returns an object that contains all the methods declared in the interface.\u003c/p\u003e\n\u003ch3 id=\"notification-service-implementation\"\u003eNotification Service Implementation\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#notification-service-implementation\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#notification-service-implementation\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eLet the notifications be a simple \u003ccode\u003ealert\u003c/code\u003e. Since the code is decoupled, it won't be a problem to rewrite this service later.\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token comment\"\u003e// services/notificationAdapter.ts\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eNotificationService\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"../application/ports\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003euseNotifier\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eNotificationService\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token function-variable function\"\u003enotify\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emessage\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token dom variable\"\u003ewindow\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003ealert\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emessage\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"local-storage-implementation\"\u003eLocal Storage Implementation\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#local-storage-implementation\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#local-storage-implementation\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eLet the local storage be React.Context and hooks. We create a new context, pass the value to provider, export the provider and access the store via hooks.\u003c/p\u003e\n\u003cpre class=\"language-tsx\"\u003e\u003ccode class=\"language-tsx\"\u003e\u003cspan class=\"token comment\"\u003e// store.tsx\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eStoreContext\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eReact\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003ecreateContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token function-variable function\"\u003euseStore\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003euseContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token maybe-class-name\"\u003eStoreContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eProvider\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eReact\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method-variable function-variable method function property-access\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eFC\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e children \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// ...Other entities...\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003eorders\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e setOrders\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003euseState\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e value \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// ...\u003c/span\u003e\n    orders\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    updateOrders\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e setOrders\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eStoreContext.Provider\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003evalue\u003c/span\u003e\u003cspan class=\"token script language-javascript\"\u003e\u003cspan class=\"token script-punctuation punctuation\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003evalue\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003echildren\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eStoreContext.Provider\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe will write a hook for for each feature. This way we won't break \u003ca href=\"https://en.wikipedia.org/wiki/Interface_segregation_principle\"\u003eISP\u003c/a\u003e, and the stores, at least in terms of interfaces, they will be atomic.\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token comment\"\u003e// services/storageAdapter.ts\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003euseOrdersStorage\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eOrdersStorageService\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token function\"\u003euseStore\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAlso, this approach will give us the ability to customize additional optimizations for each store: we can create selectors, memoization, and more.\u003c/p\u003e\n\u003ch2 id=\"validate-data-flow-diagram\"\u003eValidate Data Flow Diagram\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#validate-data-flow-diagram\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#validate-data-flow-diagram\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eLet's now validate how the user will communicate with the application during the created use case.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/content/clean-architecture-on-frontend/final.png\" alt=\"Use case data flow diagram\"\u003e\u003c/p\u003e\n\u003cp\u003eUse case data flow diagram\u003c/p\u003e\n\u003cp\u003eThe user interacts with the UI layer, which can only access the application through ports. That is, we can change the UI if we want to.\u003c/p\u003e\n\u003cp\u003eUse cases are handled in the application layer, which tells us exactly what external services are required. All the main logic and data is in the domain.\u003c/p\u003e\n\u003cp\u003eAll external services are hidden in the infrastructure and are subject to our specifications. If we need to change the service of sending messages, the only thing we will have to fix in the code is an adapter for the new service.\u003c/p\u003e\n\u003cp\u003eThis scheme makes the code replaceable, testable and extensible to changing requirements.\u003c/p\u003e\n\u003ch2 id=\"what-can-be-improved\"\u003eWhat Can Be Improved\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#what-can-be-improved\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#what-can-be-improved\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eAll in all, this is enough to get you started and gain an initial understanding of the clean architecture. But I want to point out things that I have simplified to make the example easier.\u003c/p\u003e\n\u003cp\u003eThis section is optional, but it will give an expanded understanding of what clean architecture “with no cut corners” might look like.\u003c/p\u003e\n\u003cp\u003eI would highlight a few things that can be done.\u003c/p\u003e\n\u003ch3 id=\"use-object-instead-of-number-for-the-price\"\u003eUse Object Instead of Number For the Price\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#use-object-instead-of-number-for-the-price\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#use-object-instead-of-number-for-the-price\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eYou may have noticed that I use a number to describe the price. This is not a good practice.\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token comment\"\u003e// shared-kernel.d.ts\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003ePriceCents\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eA number only indicates the quantity but not the currency, and a price without currency is meaningless. Ideally, price should be made as an object with two fields: value and currency.\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eCurrency\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"RUB\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"USD\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"EUR\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"SEK\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eAmountCents\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003ePrice\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  value\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eAmountCents\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  currency\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eCurrency\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis will solve the problem of storing currencies and save a lot of effort and nerves when changing or adding currencies to the store. I didn't use this type in the examples so as not to complicate it. In the real code, however, the price would be more similar to this type.\u003c/p\u003e\n\u003cp\u003eSeparately, it's worth mentioning the value of the price. I always keep the amount of money in the smallest fraction of the currency in circulation. For example, for the dollar it is cents.\u003c/p\u003e\n\u003cp\u003eDisplaying the price in this way allows me not to think about division and fractional values. With money this is especially important if we want to avoid \u003ca href=\"https://0.30000000000000004.com/\"\u003eproblems with floating point math\u003c/a\u003e.\u003c/p\u003e\n\u003ch3 id=\"split-code-by-features-not-layers\"\u003eSplit Code by Features, not Layers\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#split-code-by-features-not-layers\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#split-code-by-features-not-layers\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eThe code can be split in folders not “by layers” but “by features”. One feature would be a piece of the pie from the schematic below.\u003c/p\u003e\n\u003cp\u003eThis structure is even more preferable, because it allows you to deploy certain features separately, which is often useful.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://herbertograca.com/2017/11/16/explicit-architecture-01-ddd-hexagonal-onion-clean-cqrs-how-i-put-it-all-together/#components\"\u003e\u003cimg src=\"/images/content/clean-architecture-on-frontend/hex-pie.png\" alt=\"Component is a piece of a hex pie\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eComponent is a piece of a hex pie\u003c/p\u003e\n\u003cp\u003eI recommend reading about it in \u003ca href=\"https://herbertograca.com/2017/11/16/explicit-architecture-01-ddd-hexagonal-onion-clean-cqrs-how-i-put-it-all-together/#components\"\u003e\"DDD, Hexagonal, Onion, Clean, CQRS, ... How I put it all together\"\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eI also suggest to look at \u003ca href=\"https://feature-sliced.design/\"\u003eFeature Sliced\u003c/a\u003e, which is conceptually very similar to component code division, but easier to understand.\u003c/p\u003e\n\u003ch3 id=\"pay-attention-to-cross-component-usage\"\u003ePay Attention to Cross-Component Usage\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#pay-attention-to-cross-component-usage\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#pay-attention-to-cross-component-usage\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eIf we're talking about splitting system into components, it's worth mentioning the cross-component use of code as well. Let's remember the order creation function:\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eProduct\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e totalPrice \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"./product\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateOrder\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eUser\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e cart\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eCart\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eOrder\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    cart\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    user\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e user\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    status\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"new\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    created\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token known-class-name class-name\"\u003eDate\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003etoISOString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    total\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token function\"\u003etotalPrice\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eproducts\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis function uses \u003ccode\u003etotalPrice\u003c/code\u003e from another component—the product. Such usage is fine by itself, but if we want to divide the code into independent features, we can't directly access the functionality of the other feature.\u003c/p\u003e\n\u003cp\u003eYou can also see a way around this restriction in \u003ca href=\"https://herbertograca.com/2017/11/16/explicit-architecture-01-ddd-hexagonal-onion-clean-cqrs-how-i-put-it-all-together/#components\"\u003e\"DDD, Hexagonal, Onion, Clean, CQRS, ... How I put it all together\"\u003c/a\u003e and \u003ca href=\"https://feature-sliced.design/\"\u003eFeature Sliced\u003c/a\u003e.\u003c/p\u003e\n\u003ch3 id=\"use-branded-types-not-aliases\"\u003eUse Branded Types, not Aliases\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#use-branded-types-not-aliases\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#use-branded-types-not-aliases\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eFor the shared kernel I used type-aliases. They are easy to operate with: you just have to create a new type and reference e.g. a string. But their disadvantage is that TypeScript has no mechanism to monitor their use and enforce it.\u003c/p\u003e\n\u003cp\u003eThis doesn't seem to be a problem: so someone uses \u003ccode\u003estring\u003c/code\u003e instead of \u003ccode\u003eDateTimeString\u003c/code\u003e—so what? The code will compile.\u003c/p\u003e\n\u003cp\u003eThe problem is exactly that the code will compile even though a broader type is used (in clever words \u003ca href=\"https://en.wikipedia.org/wiki/Design_by_contract\"\u003eprecondition is weakened\u003c/a\u003e). This first of all makes the code more fragile because it allows you to use \u003cem\u003eany strings\u003c/em\u003e, not just strings of \u003cem\u003especial quality\u003c/em\u003e, which can lead to errors.\u003c/p\u003e\n\u003cp\u003eSecondly it's confusing to read, because it creates two sources of truth. It's unclear if you really only need to use the date there, or if you can basically use any string.\u003c/p\u003e\n\u003cp\u003eThere is a way to make TypeScript understand that we want a particular type—use \u003ca href=\"https://github.com/kourge/ts-brand\"\u003ebranding\u003c/a\u003e, branded types. Branding \u003ca href=\"https://medium.com/@KevinBGreene/surviving-the-typescript-ecosystem-branding-and-type-tagging-6cf6e516523d\"\u003eenables\u003c/a\u003e to keep track of exactly how types are used, but makes the code a little more complicated.\u003c/p\u003e\n\u003ch3 id=\"pay-attention-to-possible-dependency-in-domain\"\u003ePay Attention to Possible Dependency in Domain\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#pay-attention-to-possible-dependency-in-domain\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#pay-attention-to-possible-dependency-in-domain\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eThe next thing that stings is the creation of a date in the domain in the \u003ccode\u003ecreateOrder\u003c/code\u003e function:\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eProduct\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e totalPrice \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"./product\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateOrder\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eUser\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e cart\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eCart\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eOrder\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    cart\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    user\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e user\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e// This line:\u003c/span\u003e\n    created\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token known-class-name class-name\"\u003eDate\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003etoISOString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\n    status\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"new\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    total\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token function\"\u003etotalPrice\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eproducts\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe can suspect that \u003ccode\u003enew Date().toISOString()\u003c/code\u003e will be repeated quite often in the project and would like to put it in some kind of a helper:\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token comment\"\u003e// lib/datetime.ts\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003ecurrentDatetime\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eDateTimeString\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token known-class-name class-name\"\u003eDate\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003etoISOString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e...And then use it in the domain:\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token comment\"\u003e// domain/order.ts\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e currentDatetime \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"../lib/datetime\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eProduct\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e totalPrice \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"./product\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateOrder\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eUser\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e cart\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eCart\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eOrder\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    cart\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    user\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e user\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    status\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"new\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    created\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token function\"\u003ecurrentDatetime\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    total\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token function\"\u003etotalPrice\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eproducts\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eBut we immediately remember that we can't depend on anything in the domain—so what should we do? It's a good idea that \u003ccode\u003ecreateOrder\u003c/code\u003e should take all the data for the order in a complete form. The date can be passed as the last argument:\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token comment\"\u003e// domain/order.ts\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateOrder\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n  user\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eUser\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  cart\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eCart\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  created\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eDateTimeString\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eOrder\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    user\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e user\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    products\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    created\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    status\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"new\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    total\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token function\"\u003etotalPrice\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eproducts\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis also allows us not to break the dependency rule in cases where creating a date \u003cem\u003edepends on libraries\u003c/em\u003e. If we create a date outside a domain function, it is likely that the date will be created inside the use case and passed as an argument:\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003esomeUserCase\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// Use the `dateTimeSource` adapter,\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// to get the current date in the desired format:\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e createdOn \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e dateTimeSource\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003ecurrentDatetime\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token comment\"\u003e// Pass already created date to the domain function:\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003ecreateOrder\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e cart\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e createdOn\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis will keep the domain independent and also make it easier to test.\u003c/p\u003e\n\u003cp\u003eIn the examples I chose not to focus on this for two reasons: it would distract from the main point, and I see nothing wrong with depending on your own helper if it uses \u003cem\u003eonly\u003c/em\u003e language features. Such helpers can even be considered as the shared kernel, because they only reduce code duplication.\u003c/p\u003e\n\u003ch3 id=\"keep-domain-entities-and-transformations-pure\"\u003eKeep Domain Entities and Transformations Pure\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#keep-domain-entities-and-transformations-pure\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#keep-domain-entities-and-transformations-pure\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eWhat was really not good about creating a date inside the \u003ccode\u003ecreateOrder\u003c/code\u003e function was the side-effect. The problem with side-effects is that they make the system less predictable than you'd like it to be. What helps to cope with this are \u003ca href=\"https://en.wikipedia.org/wiki/Pure_function\"\u003epure\u003c/a\u003e data transformations in the domain, that is, ones that don't produce side-effects.\u003c/p\u003e\n\u003cp\u003eCreating a date is a side-effect, because the result of calling \u003ccode\u003eDate.now()\u003c/code\u003e is different at different times. A pure function, on the other hand, with the same arguments \u003cstrong\u003ealways\u003c/strong\u003e returns the same result.\u003c/p\u003e\n\u003cp\u003eI've come to the conclusion that it's better to keep the domain as clean as possible. It's easier to test, easier to port and update, and easier to read. Side-effects drastically increase the cognitive load when debugging, and the domain is not the place to keep complicated and confusing code at all.\u003c/p\u003e\n\u003ch3 id=\"pay-attention-to-relationship-between-cart-and-order\"\u003ePay Attention to Relationship Between Cart and Order\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#pay-attention-to-relationship-between-cart-and-order\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#pay-attention-to-relationship-between-cart-and-order\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eIn this little example, \u003ccode\u003eOrder\u003c/code\u003e includes the \u003ccode\u003eCart\u003c/code\u003e, because the cart only represents a list of products:\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eCart\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  products\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eProduct\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eOrder\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  user\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eUniqueId\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  cart\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eCart\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  created\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eDateTimeString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  status\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eOrderStatus\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  total\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003ePriceCents\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis may not work if there are additional properties in the \u003ccode\u003eCart\u003c/code\u003e that have nothing to do with the \u003ccode\u003eOrder\u003c/code\u003e. In such cases, it is better to use data projections or intermediate \u003ca href=\"https://en.wikipedia.org/wiki/Data_transfer_object\"\u003eDTO\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eAs an option, we could use the “Product List” entity:\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eProductList\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eProduct\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eCart\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  products\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eProductList\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eOrder\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  user\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eUniqueId\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  products\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eProductList\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  created\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eDateTimeString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  status\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eOrderStatus\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  total\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003ePriceCents\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"make-the-user-case-more-testable\"\u003eMake the user case more testable\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#make-the-user-case-more-testable\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#make-the-user-case-more-testable\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eThe use case has a lot to discuss as well. Right now, the \u003ccode\u003eorderProducts\u003c/code\u003e function is hard to test in isolation from React—that's bad. Ideally, it should be possible to test it with minimal effort.\u003c/p\u003e\n\u003cp\u003eThe problem with the current implementation is the hook that provides use case access to the UI:\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token comment\"\u003e// application/orderProducts.ts\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003euseOrderProducts\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e notifier \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003euseNotifier\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e payment \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eusePayment\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e orderStorage \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003euseOrdersStorage\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e cartStorage \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003euseCartStorage\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003eorderProducts\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eUser\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e cart\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eCart\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e order \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateOrder\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e cart\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e paid \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003eawait\u003c/span\u003e payment\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003etryPay\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eorder\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003etotal\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e!\u003c/span\u003epaid\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e notifier\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003enotify\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Oops! 🤷\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e orders \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e orderStorage\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    orderStorage\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eupdateOrders\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token spread operator\"\u003e...\u003c/span\u003eorders\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e order\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    cartStorage\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eemptyCart\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e orderProducts \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIn a canonical implementation, the use case function would be located outside the hook, and the services would be passed to the use case via the last argument or via a DI:\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eDependencies\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  notifier\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eNotificationService\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  payment\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003ePaymentService\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  orderStorage\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eOrderStorageService\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003eorderProducts\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n  user\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eUser\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  cart\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eCart\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  dependencies\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eDependencies\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e defaultDependencies\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e notifier\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e payment\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e orderStorage \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e dependencies\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token comment\"\u003e// ...\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe hook would then become an adapter:\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003euseOrderProducts\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e notifier \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003euseNotifier\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e payment \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eusePayment\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e orderStorage \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003euseOrdersStorage\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eUser\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e cart\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eCart\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003eorderProducts\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e cart\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      notifier\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      payment\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      orderStorage\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThen the hook code could be considered an adapter, and only the use case would remain in the application layer. The \u003ccode\u003eorderProducts\u003c/code\u003e function could be tested by passing the required service mochas as dependencies.\u003c/p\u003e\n\u003ch3 id=\"configure-automatic-dependency-injection\"\u003eConfigure Automatic Dependency Injection\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#configure-automatic-dependency-injection\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#configure-automatic-dependency-injection\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eThere, in the application layer, we now inject services by hand:\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003euseOrderProducts\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// Here we use hooks to get the instances of each service,\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// which will be used inside the orderProducts use case:\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e notifier \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003euseNotifier\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e payment \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eusePayment\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e orderStorage \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003euseOrdersStorage\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e cartStorage \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003euseCartStorage\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003eorderProducts\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eUser\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e cart\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eCart\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// ...Inside the use case we use those services.\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e orderProducts \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eBut in general, this can be automated and done with \u003ca href=\"https://bespoyasov.me/blog/di-ts-in-practice/\"\u003edependency injection\u003c/a\u003e. We already looked at the simplest version of injection through the last argument, but you can go further and configure automatic injection.\u003c/p\u003e\n\u003cp\u003eIn this particular application, I didn't think it made much sense to set up a DI. It would distract from the point and overcomplicate the code. And in the case of React and hooks, we can use them as a “container” that returns an implementation of the specified interface. Yes, it's manual work, but it doesn't increase the entry threshold and is quicker to read for new developers.\u003c/p\u003e\n\u003ch2 id=\"what-can-be-more-complicated-in-real-project\"\u003eWhat Can Be More Complicated in Real Project\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#what-can-be-more-complicated-in-real-project\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#what-can-be-more-complicated-in-real-project\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eThe example in the post is refined and intentionally simple. It is clear that life is much more surprising and complicated than this example. So I also want to talk about common problems that can arise when working with the clean architecture.\u003c/p\u003e\n\u003ch3 id=\"branching-business-logic\"\u003eBranching Business Logic\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#branching-business-logic\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#branching-business-logic\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eThe most important problem is the subject area that we lack knowledge about. Imagine a store has a product, a discounted product, and a write-off product. How do we properly describe these entities?\u003c/p\u003e\n\u003cp\u003eShould there be a “base” entity that will be expanded? How exactly should this entity be expanded? Should there be additional fields? Should these entities be mutually exclusive? How should user cases behave if there's another entity instead of a simple one? Should the duplication be reduced immediately?\u003c/p\u003e\n\u003cp\u003eThere may be too many questions and too many answers, because neither the team nor the stakeholders know yet how the system should actually behave. If there are only assumptions, you can find yourself in an \u003ca href=\"https://en.wikipedia.org/wiki/Analysis_paralysis\"\u003eanalysis paralysis\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eSpecific solutions depend on the specific situation, I can only recommend a few general things.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eDon't use inheritance\u003c/strong\u003e, even if it's called “extension”. Even if it looks like the interface is really inherited. Even if it looks like “well, there's clearly a hierarchy here”. Just wait.\u003c/p\u003e\n\u003cp\u003eCopypaste in code is not always evil, \u003ca href=\"https://bespoyasov.me/blog/copy-paste/\"\u003eit's a tool\u003c/a\u003e. Make two almost identical entities, see how they behave in reality, observe them. At some point you'll notice that they've either become very different, or they really only differ in one field. It's easier to merge two similar entities into one than it is to create checks for every possible condition and variant.\u003c/p\u003e\n\u003cp\u003eIf you still have to extend something...\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eKeep in mind \u003ca href=\"https://en.wikipedia.org/wiki/Covariance_and_contravariance_(computer_science)\"\u003ecovariance, contravariance, and invariance\u003c/a\u003e\u003c/strong\u003e so you don't accidentally come up with more work than you should.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eUse the analogy with \u003ca href=\"https://en.bem.info/\"\u003eblocks and modifiers from BEM\u003c/a\u003e\u003c/strong\u003e when choosing between different entities and extensions. It helps me a lot to determine if I have a separate entity or a “modifier-extension” the code, if I think of it in the context of BEM.\u003c/p\u003e\n\u003ch3 id=\"interdependent-use-cases\"\u003eInterdependent Use Cases\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#interdependent-use-cases\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#interdependent-use-cases\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eThe second big problem is related use cases, where an event from one use case triggers another.\u003c/p\u003e\n\u003cp\u003eThe only way to handle this, which I know and which helps me, is to break up the use cases into smaller, atomic use cases. They will be easier to put together.\u003c/p\u003e\n\u003cp\u003eIn general, the problem with such scripts, is a consequence of another big problem in programming, entities composition.\u003c/p\u003e\n\u003cp\u003eThere's \u003ca href=\"https://en.wikipedia.org/wiki/Law_of_Demeter\"\u003ea lot\u003c/a\u003e already written about how to efficiently compose entities, and there's even a whole \u003ca href=\"https://en.wikipedia.org/wiki/Set_theory\"\u003emathematics section\u003c/a\u003e. We won't go far there, that's a topic for a separate post.\u003c/p\u003e\n\u003ch2 id=\"conclusions\"\u003eConclusions\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#conclusions\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#conclusions\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eIn this post, I've outlined and expanded a bit on my talk on the clean architecture on the frontend.\u003c/p\u003e\n\u003cp\u003eIt's not a gold standard, but rather a compilation of experience with different projects, paradigms, and languages. I find it a convenient scheme that allows you to decouple code and make independent layers, modules, services, which not only can be deployed and published separately, but also transferred from project to project if needed.\u003c/p\u003e\n\u003cp\u003eWe haven't touched on OOP because architecture and OOP are orthogonal. Yes, architecture talks about entity composition, but it doesn't dictate what should be the unit of composition: object or function. You can work with this in different paradigms, as we've seen in the examples.\u003c/p\u003e\n\u003cp\u003eAs for OOP, I recently wrote a post about \u003ca href=\"https://bespoyasov.me/blog/generating-trees-on-canvas-using-typescript-and-oop/\"\u003ehow to use the clean architecture with OOP\u003c/a\u003e. In this post, we write a tree picture generator on canvas.\u003c/p\u003e\n\u003cp\u003eTo see how exactly you can combine this approach with other stuff like chip slicing, hexagonal architecture, CQS and other stuff, I recommend reading \u003ca href=\"https://herbertograca.com/2017/11/16/explicit-architecture-01-ddd-hexagonal-onion-clean-cqrs-how-i-put-it-all-together/\"\u003eDDD, Hexagonal, Onion, Clean, CQRS, ... How I put it all together\u003c/a\u003e and the whole series of articles from this blog. Very insightful, concise, and to the point.\u003c/p\u003e\n\u003ch2 id=\"sources\"\u003eSources\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#sources\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#sources\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://youtu.be/ThgqBecaq_w\"\u003ePublic Talk about Clean Architecture on Frontend\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://bespoyasov.ru/talks/podlodka-conf-clean-architecture/en.html\"\u003eSlides for the Talk\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/bespoyasov/frontend-clean-architecture\"\u003eThe source code for the application we're going to design\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://bespoyasov.me/showcase/frontend-clean-architecture/\"\u003eSample of a working application\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"design-in-practice\"\u003eDesign in Practice\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#design-in-practice\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#design-in-practice\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html\"\u003eThe Clean Architecture\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller\"\u003eModel-View-Controller\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://herbertograca.com/2017/11/16/explicit-architecture-01-ddd-hexagonal-onion-clean-cqrs-how-i-put-it-all-together/#domain-layer\"\u003eDDD, Hexagonal, Onion, Clean, CQRS, … How I put it all together\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://herbertograca.com/2017/09/14/ports-adapters-architecture/\"\u003ePorts \u0026#x26; Adapters Architecture\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://herbertograca.com/2018/07/07/more-than-concentric-layers/\"\u003eMore than Concentric Layers\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://bespoyasov.me/blog/generating-trees-on-canvas-using-typescript-and-oop/\"\u003eGenerating Trees Using L-Systems, TypeScript, and OOP Series' Articles\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"system-design\"\u003eSystem Design\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#system-design\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#system-design\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://en.wikipedia.org/wiki/Domain_knowledge\"\u003eDomain Knowledge\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://en.wikipedia.org/wiki/Use_case\"\u003eUse Case\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://en.wikipedia.org/wiki/Coupling_(computer_programming)\"\u003eCoupling\u003c/a\u003e and \u003ca href=\"https://en.wikipedia.org/wiki/Cohesion_(computer_science)\"\u003ecohesion\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://ddd.fed.wiki.org/view/welcome-visitors/view/domain-driven-design/view/shared-kernel\"\u003eShared Kernel\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://en.wikipedia.org/wiki/Analysis_paralysis\"\u003eAnalysis Paralysis\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"books-about-design-and-development\"\u003eBooks about Design and Development\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#books-about-design-and-development\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#books-about-design-and-development\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.infoq.com/presentations/Design-Composition-Performance/\"\u003eDesign Composition and Performance\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://bespoyasov.me/blog/clean-architecture/\"\u003eClean Architecture\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://bespoyasov.me/blog/patterns-for-fault-tolerant-software/\"\u003ePatterns for Fault Tolerant Software\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"concepts-from-typescript-c-and-other-languages\"\u003eConcepts from TypeScript, C#, and Other Languages\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#concepts-from-typescript-c-and-other-languages\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#concepts-from-typescript-c-and-other-languages\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://en.wikipedia.org/wiki/Protocol_(object-oriented_programming)\"\u003eInterface\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://en.wikipedia.org/wiki/Closure_(computer_programming)\"\u003eClosure\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://en.wikipedia.org/wiki/Set_theory\"\u003eSet Theory\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.typescriptlang.org/docs/handbook/advanced-types.html#type-aliases\"\u003eType Aliases\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://refactoring.guru/smells/primitive-obsession\"\u003ePrimitive Obsession\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://0.30000000000000004.com/\"\u003eFloating Point Math\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/kourge/ts-brand\"\u003eBranded Types\u003c/a\u003e и \u003ca href=\"https://medium.com/@KevinBGreene/surviving-the-typescript-ecosystem-branding-and-type-tagging-6cf6e516523d\"\u003eHow to Use It\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"patterns-and-methodologies\"\u003ePatterns and Methodologies\u003ca href=\"https://bespoyasov.me/blog/clean-architecture-on-frontend/#patterns-and-methodologies\"\u003e#\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#patterns-and-methodologies\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://en.wikipedia.org/wiki/Adapter_pattern\"\u003eAdapter, pattern\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://en.wikipedia.org/wiki/SOLID\"\u003eSOLID Principles\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://blog.ploeh.dk/2020/03/02/impureim-sandwich/\"\u003eImpureim Sandwich\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://en.wikipedia.org/wiki/Design_by_contract\"\u003eDesign by Contract\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://en.wikipedia.org/wiki/Covariance_and_contravariance_(computer_science)\"\u003eCovariance and contravariance\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://en.wikipedia.org/wiki/Law_of_Demeter\"\u003eLaw of Demeter\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://en.bem.info/methodology/\"\u003eBEM Methodology\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"tags\"\u003eTags\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#tags\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca class=\"color-tag\" style=\"--tag-color: #b66325;\" href=\"/notes/qqlu2qbieklqf58kzwklnio\"\u003earchitecture\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e","noteIndex":{"id":"Iy0MoL0KnL55Br3AfTS2C","title":"Luke","desc":"","updated":1761796791487,"created":1644449449778,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":"vault"},"contentHash":"4e745570ca97988a0362cb939b760952","links":[{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"life-tips","position":{"start":{"line":41,"column":5,"offset":2603},"end":{"line":41,"column":29,"offset":2627},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"life-tips","anchorHeader":"wodenokoto"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"journal.what-i-read-in.2025","alias":"What I read in 2025","position":{"start":{"line":70,"column":3,"offset":4333},"end":{"line":70,"column":54,"offset":4384},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"journal.what-i-read-in.2025"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"journal.what-i-read-in.2024","alias":"2024","position":{"start":{"line":71,"column":5,"offset":4389},"end":{"line":71,"column":41,"offset":4425},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"journal.what-i-read-in.2024"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"journal.what-i-read-in.2023","alias":"2023","position":{"start":{"line":72,"column":5,"offset":4430},"end":{"line":72,"column":41,"offset":4466},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"journal.what-i-read-in.2023"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"journal.what-i-read-in.2022","alias":"2022","position":{"start":{"line":73,"column":5,"offset":4471},"end":{"line":73,"column":41,"offset":4507},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"journal.what-i-read-in.2022"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"journal.what-i-struggled-brag-in","position":{"start":{"line":79,"column":3,"offset":4643},"end":{"line":79,"column":39,"offset":4679},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"journal.what-i-struggled-brag-in"}}],"anchors":{"what-i-read-in-past":{"type":"header","text":"What I read in past","value":"what-i-read-in-past","line":74,"column":0,"depth":2}},"children":["zd4mq442jike0pr0wba1u3m","6hzeqsofq67gdk88flxlkhp","778ijii93yu5uwnrwmn5zi4","g1fngdjl25nes6fs3lip602","ZbdkdApFqLdks4Moq92R9","uoc5hhki3o4py15cesddu8q","9qf7j06jtdkm6rnx9ymvwb0","5zn10cvj7ajy2gh2is5nqmg","4qo9ma0z0yu1czns6pxl7y5","ok0e729ho7o09xetujkxc0m","GR5x8HnNFEN6fU2UBSEIK","yirtnlj8q24yutcf3ss1xqy","eq0wc6t7wl2wv221yb68ro4","7x2fnv4j6gxts08qk0jguny","ettkt3iClONnxpbGwBVLl","7l4knev6v613tbuoskvmbdg","hvh5bud6yp7dc89tuh95tr9","4fvoqrplw0cweo554usbjos","f8qsfql0a9v8thpeo82udfa","1swsbrhqi9jk41v9eodyi5q","SQqYupi6EFddTerBA8RRD","hjNeNc1F2JUh0lTWanH4h","qf0l4wbrc9jgooyzexmbq5v","uur1lkol353z9vfeqb3n5bv","cd9n1czq3ursgkby985wkmm","k1sr43vwnfqztwc0s43pkcf","wfde75rhdvq2yfa2zy2q6rv","rjcmdv60jokmbw6zoq8u2ef","ujapvww8o6v3kpmlhtryq4k","pkwewou9d5e8ystswn1j2b4"],"parent":null,"data":{},"body":"\nHi there 👋. I'm a Front-end developer.\n\n---\n\n- 단순함과 꾸준함은 가장 쉬우면서도 지키기 어려운 원칙.\n\n- 🥱 -\u003e 🤔💡🌱 - [On The Death of Daydreaming](https://www.afterbabel.com/p/on-the-death-of-daydreaming)\n  - boredom -\u003e easy fun -\u003e art -\u003e profit?\n\n\u003e I've often described my motivation for building software to others using imagery: I like to go find a secluded beach, build a large, magnificent sand castle, and then walk away. Will anyone notice? Probably not. Will the waves eventually destroy it? Yep. Did I still get immense satisfaction? Absolutely. - [aliasxneo](https://news.ycombinator.com/item?id=41497113)\n\n\u003e We love to see the process, not just the result. The imperfections in your work can be beautiful if they show your struggle for perfection, not a lack of care. - [ralphammer](https://ralphammer.com/is-perfection-boring/)\n\n\u003e Simplicity, even if it sacrifices some ideal functionality has better survival characteristics than the-right-thing. - [The Rise of Worse is Better](https://www.dreamsongs.com/RiseOfWorseIsBetter.html)\n\n\u003e [Roberto Blake was talking about making 100 crappy videos](https://www.youtube.com/watch?v=OnUBaQ1Sp_E) to get better over time. Putting in the reps and improving a little bit each time.\n\u003e\n\u003e Putting in the work without expecting any external reward at first (eg views, followers, likes, etc) will pay off in the long run. - [100 Scrappy Things](https://www.florin-pop.com/blog/100-scrappy-things/)\n\n\u003e Make the difficult habitual, the habitual easy, and the easy beautiful. - [Constantin S. Stanislavski](https://www.goodreads.com/quotes/7102271-make-the-difficult-habitual-the-habitual-easy-and-the-easy)\n\n\u003e A good match is a **structured** dance, where players aim to **score** while they are following well-defined **rules**. This **freedom within a structure** is what makes it fun. - [ralphammer](https://ralphammer.com/how-to-get-started/)\n\n- [Pivot Points](https://longform.asmartbear.com/pivot-points/)\n\n  - non-judgmental aspects of personality that can be strengths in some contexts and weaknesses in others\n  - Pivot Points are fixed in the short term\n\n- [Hedged Bets](https://longform.asmartbear.com/predict-the-future/#hedged-bets)\n  - trading slightly less maximum upside for predictable, net-positive outcomes.\n\n\u003e “Motivation often comes after starting, not before. Action produces momentum.”\n\u003e [When you start a new habit, it should take less than two minutes to do.](https://jamesclear.com/how-to-stop-procrastinating)\n\u003e\n\u003e - James Clear\n\n\u003e Focus is more about **not** keeping busy when you need to wait for something.  \n\u003e Eat the boredom for a minute.\n\u003e\n\u003e - [[life-tips#wodenokoto]]\n\n\u003e [4 minutes run hard enough to push heart rate to 90%, 3 minutes recover, repeat 4 times](https://news.ycombinator.com/item?id=34213181)\n\u003e\n\u003e - https://www.ntnu.edu/cerg/advice\n\u003e - [Get running with Couch to 5K](https://www.nhs.uk/live-well/exercise/running-and-aerobic-exercises/get-running-with-couch-to-5k/)\n\n\u003e [recommended routine - bodyweightfitness](https://www.reddit.com/r/bodyweightfitness/wiki/kb/recommended_routine/) - I Don't Have This Much Time!\n\u003e\n\u003e - Don't workout at all (saves anywhere from 20 to 60 minutes, but really, really, really, really, really, really, really, really, really not recommended)\n\n\u003e 도무지 읽히지 않는 책 앞에서 내가 택한 방법은 펼쳐진 페이지 앞에서 멍때리기이다. 다르게 표현하면 이렇다. 펼쳐진 두 페이지 앞에서 오래 머물기.\n\u003e\n\u003e 책을 펼쳐놓는 것으로 충분하다. 읽지 못해도 좋다. 매일 정해진 진도를 나가야 하는 학교 수업이 아니니까. 하지만 읽지 않아도 괜찮다고 해서 펼쳐두지조차 않으면 곤란하다. 가능한 한 자주 책을 펼쳐두도록 하자. 전혀 읽지 않고 멍하니 바라보고 있다가 다시 덮게 되더라도\n\u003e\n\u003e - 막막한 독서. 시로군. P.10~13\n\n\u003e I think it should be everyone's primary focus to sleep well, drink water, get outside, get active, and eat generally decently. I hate to say it, but if you're not eating a good amount of vegetables and fruit, decent protein, sleep, etc, no amount of XYZ will catch up to that detriment. - [CE02](https://news.ycombinator.com/item?id=35056071)\n\n\u003e My real battle is doing good versus doing nothing. - [Deirdre Sullivan](https://www.npr.org/2005/08/08/4785079/always-go-to-the-funeral)\n\n[Kind Engineering](https://kind.engineering/) - How To Engineer Kindness\n\n\u003e Sometimes magic is just someone spending more time on something than anyone else might reasonably expect. - [Teller](https://www.goodreads.com/quotes/6641527-sometimes-magic-is-just-someone-spending-more-time-on-something)\n\n---\n\n## What I read in past\n\n- [[What I read in 2025|journal.what-i-read-in.2025]]\n  - [[2024|journal.what-i-read-in.2024]]\n  - [[2023|journal.what-i-read-in.2023]]\n  - [[2022|journal.what-i-read-in.2022]]\n- 📝 [Gists](https://gist.github.com/Luke-SNAW)\n- 📜 [Journals](https://luke-snaw.github.io/Luke-SNAW__netlify-CMS.github.io/)\n\n---\n\n- [[journal.what-i-struggled-brag-in]]\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":true,"vaultSelectionModeOnCreate":"smart","leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2}},"randomNote":{},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":"vault"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link","taskCompleteStatus":["done","x"]},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"enableUserTags":false,"enableHashTags":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"enableEditorDecorations":true,"maxPreviewsCached":10,"maxNoteLength":204800,"dendronVersion":"0.115.0","enableFullHierarchyNoteTitle":false,"enablePersistentHistory":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false,"enableFrontmatterTags":true,"enableHashesForFMTags":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Luke SNAW","description":"Personal knowledge space"},"github":{"enableEditLink":false,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"searchMode":"lookup","siteUrl":"https://luke-snaw.github.io/","duplicateNoteBehavior":{"action":"useVault","payload":["vault"]},"siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"3qd6qjev0hbwuzw47h96vee"},"buildId":"vOE8u-mg___OsOsz4tjEg","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>