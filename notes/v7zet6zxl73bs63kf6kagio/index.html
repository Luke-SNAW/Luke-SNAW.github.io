<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" href="/favicon.ico"/><title>Making Sense of React Server Components</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Personal knowledge space"/><meta property="og:title" content="Making Sense of React Server Components"/><meta property="og:description" content="Personal knowledge space"/><meta property="og:url" content="https://luke-snaw.github.io//notes/v7zet6zxl73bs63kf6kagio/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="9/21/2023"/><meta property="article:modified_time" content="9/21/2023"/><link rel="canonical" href="https://luke-snaw.github.io//notes/v7zet6zxl73bs63kf6kagio/"/><meta name="next-head-count" content="14"/><link rel="preload" href="/_next/static/css/8e7b7e4bce421c0a.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8e7b7e4bce421c0a.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-3d209faeb64f2f97.js" defer=""></script><script src="/_next/static/chunks/framework-28c999baf2863c3d.js" defer=""></script><script src="/_next/static/chunks/main-104451f3d1a5c4bc.js" defer=""></script><script src="/_next/static/chunks/pages/_app-9d8e0603730b15a3.js" defer=""></script><script src="/_next/static/chunks/935-4dee79e80b8641c6.js" defer=""></script><script src="/_next/static/chunks/6-50972def09142ee2.js" defer=""></script><script src="/_next/static/chunks/pages/notes/%5Bid%5D-78d472fa3b924116.js" defer=""></script><script src="/_next/static/vOE8u-mg___OsOsz4tjEg/_buildManifest.js" defer=""></script><script src="/_next/static/vOE8u-mg___OsOsz4tjEg/_ssgManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div style="display:flex" class="ant-col ant-col-xs-20 ant-col-sm-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"><div class="ant-select ant-select-lg ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-show-search" style="width:100%"><div class="ant-select-selector"><span class="ant-select-selection-search"><input type="search" autoComplete="off" class="ant-select-selection-search-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span><span class="ant-select-selection-placeholder">For full text search please use the &#x27;?&#x27; prefix. e.g. ? Onboarding</span></div></div></div><div style="display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout" style="margin-top:64px;display:flex;flex-direction:row"><div class="site-layout-sidebar" style="flex:0 0 auto;width:calc(max((100% - 992px) / 2, 0px) + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);background-color:transparent;flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></div><main class="ant-layout-content side-layout-main" style="max-width:1200px;min-width:0;display:block"><div style="padding:0 24px"><div class="main-content" role="main"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h1 id="making-sense-of-react-server-components">Making Sense of React Server Components<a aria-hidden="true" class="anchor-heading icon-link" href="#making-sense-of-react-server-components"></a></h1>
<blockquote>
<p><a href="https://www.joshwcomeau.com/react/server-components/">https://www.joshwcomeau.com/react/server-components/</a></p>
</blockquote>
<p>So, here's something that makes me feel old: React celebrated its 10th birthday this year!</p>
<p>In the decade since React was first introduced to a bewildered dev community, it’s gone through several evolutions. The React team has not been shy when it comes to radical changes: if they discover a better solution to a problem, they'll run with it.</p>
<p>A couple of months ago, the React team unveiled <em>React Server Components,</em> the latest paradigm shift. For the first time ever, React components can run exclusively on the server.</p>
<p>There's been <em>so much friggin’ confusion</em> about this online. Lots of folks have lots of questions around what this is, how it works, what the benefits are, and how it fits together with things like Server Side Rendering.</p>
<p>I've been doing a lot of experimentation with React Server Components, and I've answered a lot of my own questions. I have to admit, I'm <em>way</em> more excited about this stuff than I expected to be. <em>It's really cool!</em></p>
<p>So, my goal today is to help demystify this stuff for you, to answer a lot of the questions you might have about React Server Components!</p>
<blockquote>
<p><strong>Intended audience</strong></p>
<p>This tutorial is written primarily for developers who are already using React, and who are curious about React Server Components. You don't need to be a React expert, but it will likely be pretty confusing if you're just getting started with React.</p>
</blockquote>
<h2 id="a-quick-primer-on-server-side-rendering"><a href="https://www.joshwcomeau.com/react/server-components/#a-quick-primer-on-server-side-rendering-1">A quick primer on Server Side Rendering</a><a aria-hidden="true" class="anchor-heading icon-link" href="#a-quick-primer-on-server-side-rendering"></a></h2>
<p>To put React Server Components in context, it's helpful to understand how Server Side Rendering (SSR) works. If you're already familiar with SSR, feel free to skip to the next heading!</p>
<p>When I first started using React in 2015, most React setups used a “client-side” rendering strategy. The user would receive an HTML file that looked like this:</p>
<pre class="language-html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&#x3C;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>html</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/js/bundle.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>script</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>html</span><span class="token punctuation">></span></span>
</code></pre>
<p>That <code>bundle.js</code> script includes everything we need to mount and run the application, including React, other third-party dependencies, and all of the code we've written.</p>
<p>Once the JS has been downloaded and parsed, React springs into action, conjuring all of the DOM nodes for our entire application, and housing it in that empty <code>&#x3C;div id="root"></code>.</p>
<p>The problem with this approach is that it takes time to do all of that work. <strong>And while it's all happening, the user is staring at a blank white screen.</strong> This problem tends to get worse over time: every new feature we ship adds more kilobytes to our JavaScript bundle, prolonging the amount of time that the user has to sit and wait.*</p>
<p>Server Side Rendering was designed to improve this experience. Instead of sending an empty HTML file, the server will render our application to <em>generate</em> the actual HTML. The user receives a fully-formed HTML document.</p>
<p>That HTML file will still include the <code>&#x3C;script></code> tag, since we still need React to run on the client, to handle any interactivity. But we configure React to work a little bit differently in-browser: instead of conjuring all of the DOM nodes from scratch, it instead <em>adopts</em> the existing HTML. This process is known as <em>hydration.</em></p>
<p>I like the way React core team member Dan Abramov explains this:</p>
<blockquote>
<p>Hydration is like watering the “dry” HTML with the “water” of interactivity and event handlers.</p>
</blockquote>
<p>Once the JS bundle has been downloaded, React will quickly run through our entire application, building up a virtual sketch of the UI, and “fitting” it to the real DOM, attaching event handlers, firing off any effects, and so on.</p>
<p>And so, that's SSR in a nutshell. A server generates the initial HTML so that users don't have to stare at an empty white page while the JS bundles are downloaded and parsed. Client-side React then picks up where server-side React left off, adopting the DOM and sprinkling in the interactivity.</p>
<blockquote>
<p><strong>An umbrella term</strong></p>
<p>When we talk about Server Side Rendering, we typically imagine a flow that looks like this:</p>
<ol>
<li>User visits <em>myWebsite.com</em>.</li>
<li>A Node.js server receives the request, and immediately renders the React application, generating the HTML.</li>
<li>That freshly-baked HTML is sent to the client.</li>
</ol>
<p>This is <em>one</em> possible way to implement Server Side Rendering, but it's not the only one. Another option is to generate the HTML when we <em>build the application.</em></p>
<p>Typically, React applications need to be <em>compiled</em>, transforming JSX into plain ol’ JavaScript, and bundling all of our modules. What if, during that same process, we “pre-rendered” all of the HTML for all of our different routes?</p>
<p>This is commonly known as <em>static site generation (SSG)</em>. It's a sub-variant of Server Side Rendering.</p>
<p>The way I see it, “Server Side Rendering” is an umbrella term that includes several different rendering strategies. They all have one thing in common: the initial render happens in a server runtime like Node.js, using the <code>ReactDOMServer</code> APIs. It doesn't actually matter <em>when</em> this happens, whether it's on-demand or at compile-time. Either way, it's Server Side Rendering.</p>
</blockquote>
<h2 id="bouncing-back-and-forth"><a href="https://www.joshwcomeau.com/react/server-components/#bouncing-back-and-forth-2">Bouncing back and forth</a><a aria-hidden="true" class="anchor-heading icon-link" href="#bouncing-back-and-forth"></a></h2>
<p>Let's talk about data-fetching in React. Typically, we've had two separate applications that communicate over the network:</p>
<ul>
<li>A client-side React app</li>
<li>A server-side REST API</li>
</ul>
<p>Using something like React Query or SWR or Apollo, the client would make a network request to the back-end, which would then grab the data from the database and send it back over the network.</p>
<p>We can visualize this flow using a graph:</p>
<blockquote>
<p>chart</p>
</blockquote>
<p>This is a data visualization which shows a sequence of events between client and server. Each event is represented here as a list item.</p>
<ol>
<li>Response from server. Duration: 4 units of time.</li>
<li>"Download JavaScript" on client. Duration: 7 units of time.</li>
<li>"Render Shell" on client. Duration: 6 units of time.</li>
<li>Request to server. Duration: 4 units of time.</li>
<li>"Database Query" on server. Duration: 5 units of time.</li>
<li>Response from server. Duration: 4 units of time.</li>
<li>"Render Content" on client. Duration: 5 units of time.</li>
</ol>
<blockquote>
<p><strong>A note about these graphs</strong></p>
<p>This blog post includes several of these “network request graphs”. They're designed to visualize how data moves between client (browser) and server (back-end API), across several different rendering strategies.</p>
<p>The numbers along the bottom represent an imaginary made-up time unit. They're not minutes or seconds. <strong>In reality, the numbers vary wildly, based on a ton of different factors.</strong> These graphs are meant to give you a high-level understanding of the concepts, they're not modeling any real data.</p>
</blockquote>
<p>This first graph shows the flow using a Client Side Rendering (CSR) strategy. It starts with the client receiving an HTML file. This file doesn't have any content, but it does have one or more <code>&#x3C;script></code> tags.</p>
<p>Once the JS has been downloaded and parsed, our React app will boot up, creating a bunch of DOM nodes and populating the UI. At first, though, we don't have any of the actual <em>data</em>, so we can only render the shell (the header, the footer, the general layout) with a loading state.</p>
<p>You've probably seen this sort of pattern a lot. For example, UberEats starts by rendering a shell while it fetches the data it needs to populate the actual restaurants:</p>
<blockquote>
<p>skeleton UI</p>
</blockquote>
<p>The user will see this loading state until the network request resolves and React re-renders, replacing the loading UI with the real content.</p>
<p><strong>Let's look at another way we could architect this.</strong> This next graph keeps the same general data-fetching pattern, but uses <em>Server</em> Side Rendering instead of Client Side Rendering:</p>
<blockquote>
<p>chart</p>
</blockquote>
<p>This is a data visualization which shows a sequence of events between client and server. Each event is represented here as a list item.</p>
<ol>
<li>"Render Shell" on server. Duration: 3 units of time.</li>
<li>Response from server. Duration: 4 units of time.</li>
<li>"Download JavaScript" on client. Duration: 7 units of time.</li>
<li>"Hydrate" on client. Duration: 3 units of time.</li>
<li>Request to server. Duration: 4 units of time.</li>
<li>"Database Query" on server. Duration: 5 units of time.</li>
<li>Response from server. Duration: 4 units of time.</li>
<li>"Render Content" on client. Duration: 5 units of time.</li>
</ol>
<p>In this new flow, we perform the first render on the server. This means that the user receives an HTML file that isn't totally empty.</p>
<p>This is an improvement — a shell is better than a blank white page — but ultimately, it doesn't really move the needle in a significant way. The user isn't visiting our app to see a loading screen, they're visiting to see the <em>content</em> (restaurants, hotel listings, search results, messages, whatever).</p>
<p>To really get a sense of the differences in user experience, let's add some web performance metrics to our graphs. <strong>Toggle between these two flows, and notice what happens to the flags:</strong></p>
<p>Client Side Rendering</p>
<blockquote>
<p>interactive chart</p>
</blockquote>
<p>This is a data visualization which shows a sequence of events between client and server. Each event is represented here as a list item.</p>
<ol>
<li>Response from server. Duration: 4 units of time.</li>
<li>"Download JavaScript" on client. Duration: 7 units of time.</li>
<li>"Render Shell" on client. Duration: 6 units of time.</li>
<li>Request to server. Duration: 4 units of time.</li>
<li>"Database Query" on server. Duration: 5 units of time.</li>
<li>Response from server. Duration: 4 units of time.</li>
<li>"Render Content" on client. Duration: 5 units of time.</li>
</ol>
<p>Each of these flags represents a commonly-used web performance metric. Here's the breakdown:</p>
<ol>
<li><strong>First Paint</strong> — The user is no longer staring at a blank white screen. The general layout has been rendered, but the content is still missing. This is sometimes called FCP (First Contentful Paint).</li>
<li><strong>Page Interactive</strong> — React has been downloaded, and our application has been rendered/hydrated. Interactive elements are now fully responsive. This is sometimes called TTI (Time To Interactive).</li>
<li><strong>Content Paint</strong> — The page now includes the stuff the user cares about. We've pulled the data from the database and rendered it in the UI. This is sometimes called LCP (Largest Contentful Paint).</li>
</ol>
<p>By doing the initial render on the server, we're able to get that initial “shell” drawn more quickly. This can make the loading experience feel a bit faster, since it provides a sense of progress, that things are happening.</p>
<p>And, in some situations, this <em>will</em> be a meaningful improvement. For example, maybe the user is only waiting for the header to load so that they can click a navigation link.</p>
<p><strong>But doesn't this flow feel a bit silly?</strong> When I look at the SSR graph, I can't help but notice that the request <em>starts</em> on the server. Instead of requiring a second round-trip network request, why don't we do the database work <em>during that initial request?</em></p>
<p>In order words, <strong>why not do something like this?</strong></p>
<blockquote>
<p>chart</p>
</blockquote>
<p>This is a data visualization which shows a sequence of events between client and server. Each event is represented here as a list item.</p>
<ol>
<li>"Database Query" on server. Duration: 5 units of time.</li>
<li>"Render App" on server. Duration: 6 units of time.</li>
<li>Response from server. Duration: 4 units of time.</li>
<li>"Download JavaScript" on client. Duration: 7 units of time.</li>
<li>"Hydrate" on client. Duration: 3 units of time.</li>
</ol>
<p>Instead of bouncing back and forth between the client and server, we do our database query as part of the initial request, sending the fully-populated UI straight to the user.</p>
<p>But hm, how exactly would we do this?</p>
<p>In order for this to work, we'd need to be able to give React a chunk of code that it runs <em>exclusively</em> on the server, to do the database query. But that hasn't been an option with React… even with Server Side Rendering, all of our components render on <em>both</em> the server and the client.</p>
<p><strong>The ecosystem has come up with lots of solutions to this problem.</strong> Meta-frameworks? like Next.js and Gatsby have created their own way to run code exclusively on the server.</p>
<p>For example, here's what this looked like using Next.js (using the legacy “Pages” router):</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token keyword module">import</span> <span class="token imports">db</span> <span class="token keyword module">from</span> <span class="token string">"imaginary-db"</span>
<span class="token comment">// This code only runs on the server:</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getServerSideProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> link <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token string">"root"</span><span class="token punctuation">,</span> <span class="token string">"passw0rd"</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword control-flow">await</span> db<span class="token punctuation">.</span><span class="token method function property-access">query</span><span class="token punctuation">(</span>link<span class="token punctuation">,</span> <span class="token string">"SELECT * FROM products"</span><span class="token punctuation">)</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    props<span class="token operator">:</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// This code runs on the server + on the client</span>
<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Homepage</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">Trending Products</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>data<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>article</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>h2</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">description</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>article</span><span class="token punctuation">></span></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>Let's break this down:</strong> when the server receives a request, the <code>getServerSideProps</code> function is called. It returns a <code>props</code> object. Those props are then funneled into the component, which is rendered first on the server, and then hydrated on the client.</p>
<p>The clever thing here is that <code>getServerSideProps</code> doesn't re-run on the client. In fact, this function isn't even included in our JavaScript bundles!</p>
<p>This approach was <em>super</em> ahead of its time. Honestly, it's pretty friggin’ great. But there <em>are</em> some downsides with this:</p>
<ol>
<li>This strategy only works at the route level, for components at the very top of the tree. We can't do this in any component.</li>
<li>Each meta-framework came up with its own approach. Next.js has one approach, Gatsby has another, Remix has yet another. It hasn't been standardized.</li>
<li>All of our React components will <em>always</em> hydrate on the client, even when there's no need for them to do so.</li>
</ol>
<p>For years, the React team has been quietly tinkering on this problem, trying to come up with an official way to solve this problem. Their solution is called <strong>React Server Components.</strong></p>
<h2 id="introduction-to-react-server-components"><a href="https://www.joshwcomeau.com/react/server-components/#introduction-to-react-server-components-3">Introduction to React Server Components</a><a aria-hidden="true" class="anchor-heading icon-link" href="#introduction-to-react-server-components"></a></h2>
<p>At a high level, <em>React Server Components</em> is the name for a brand-new paradigm. In this new world, we can create components that run <em>exclusively on the server</em>. This allows us to do things like write database queries right inside our React components!</p>
<p>Here's a quick example of a “Server Component”:</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token keyword module">import</span> <span class="token imports">db</span> <span class="token keyword module">from</span> <span class="token string">"imaginary-db"</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Homepage</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> link <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token string">"root"</span><span class="token punctuation">,</span> <span class="token string">"passw0rd"</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword control-flow">await</span> db<span class="token punctuation">.</span><span class="token method function property-access">query</span><span class="token punctuation">(</span>link<span class="token punctuation">,</span> <span class="token string">"SELECT * FROM products"</span><span class="token punctuation">)</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">Trending Products</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>data<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>article</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>h2</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">description</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>article</span><span class="token punctuation">></span></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token maybe-class-name">Homepage</span>
</code></pre>
<p>As someone who has been using React for many years, this code looked <em>absolutely wild</em> to me at first. 😅</p>
<p>“But wait!”, my instincts screamed. “Function components can't be asynchronous! And we're not allowed to have side effects directly in the render like that!”</p>
<p><strong>The key thing to understand is this:</strong> Server Components never re-render. They run <em>once</em> on the server to generate the UI. The rendered value is sent to the client and locked in place. As far as React is concerned, this output is immutable, and will never change.*</p>
<p>This means that a <em>big chunk</em> of React's API is incompatible with Server Components. For example, we can't use state, because state can change, but Server Components can't re-render. And we can't use effects because effects only run <em>after</em> the render, on the client, and Server Components never make it to the client.</p>
<p>It also means that we have a bit more flexibility when it comes to the rules. For example, in traditional React, we need to put side effects inside a <code>useEffect</code> callback or an event handler or something, so that they don't repeat on every render. But if the component only runs <em>once</em>, we don't have to worry about that!</p>
<p>Server Components <em>themselves</em> are surprisingly straightforward, but the “React Server Components” paradigm is significantly more complex. This is because we <em>still have</em> regular ol’ components, and the way they fit together can be pretty confusing.</p>
<p>In this new paradigm, the “traditional” React components we're familiar with are called <em>Client Components</em>. I'll be honest, I don't love this name. 😅</p>
<p>The name “Client Component” implies that these components <em>only</em> render on the client, but that's not actually true. <strong>Client Components render on both the client <em>and</em> the server.</strong></p>
<p>I know that all this terminology is pretty confusing, so here's how I'd summarize it:</p>
<ul>
<li><em>React Server Components</em> is the name for this new paradigm.</li>
<li>In this new paradigm, the “standard” React components we know and love have been rebranded as <em>Client Components</em>. It's a new name for an old thing.</li>
<li>This new paradigm introduces a new type of component, <em>Server Components</em>. These new components render exclusively on the server. Their code isn't included in the JS bundle, and so they never hydrate or re-render.</li>
</ul>
<blockquote>
<p><strong>React Server Components vs. Server Side Rendering</strong></p>
<p>Let's clear up another common bit of confusion: React Server Components is <em>not</em> a replacement for Server Side Rendering. You shouldn't think of React Server Components as “SSR version 2.0”.</p>
<p>Instead, I like to think of it as two separate puzzle pieces that snap together perfectly, two flavors that complement each other.</p>
<p>We still rely on Server Side Rendering to generate the initial HTML. React Server Components builds on top of that, allowing us to omit certain components from the client-side JavaScript bundle, ensuring they only run on the server.</p>
<p>In fact, it's even possible to use React Server Components <em>without</em> Server Side Rendering, though in practice, you'll get better results if you use them together. The React team has built a <a href="https://github.com/reactjs/server-components-demo">minimal RSC demo</a> without SSR, if you'd like to see an example.</p>
</blockquote>
<h3 id="compatible-environments"><a href="https://www.joshwcomeau.com/react/server-components/#compatible-environments-4">Compatible Environments</a><a aria-hidden="true" class="anchor-heading icon-link" href="#compatible-environments"></a></h3>
<p>So, typically, when a new React feature comes out, we can start using it in our existing projects by bumping our React dependency to the latest version. A quick <code>npm install react@latest</code> and we're off to the races.</p>
<p>Unfortunately, React Server Components doesn't work like that.</p>
<p>My understanding is that React Server Components needs to be tightly integrated with a bunch of stuff outside of React, things like the bundler, the server, and the router.</p>
<p>As I write this, there's only one way to start using React Server Components, and that's with Next.js 13.4+, using their brand-new re-architected “App Router”.</p>
<p>Hopefully in the future, more React-based frameworks will start to incorporate React Server Components. It feels awkward that a core React feature is only available in one particular tool! The React docs has a <a href="https://react.dev/learn/start-a-new-react-project#bleeding-edge-react-frameworks">“Bleeding-edge frameworks” section</a> where they list the frameworks that support React Server Components; I plan on checking this page from time to time, to see if any new options become available.</p>
<h3 id="specifying-client-components"><a href="https://www.joshwcomeau.com/react/server-components/#specifying-client-components-5">Specifying client components</a><a aria-hidden="true" class="anchor-heading icon-link" href="#specifying-client-components"></a></h3>
<p>In this new “React Server Components” paradigm, <strong>all components are assumed to be Server Components by default.</strong> We have to “opt in” for Client Components.</p>
<p>We do this by specifying a brand-new <em>directive</em>:</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token string">"use client"</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">React</span></span> <span class="token keyword module">from</span> <span class="token string">"react"</span>
<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Counter</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">Current value: </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>button</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token maybe-class-name">Counter</span>
</code></pre>
<p>That standalone string at the top, <code>'use client'</code>, is how we signal to React that the component(s) in this file are Client Components, that they should be included in our JS bundles so that they can re-render on the client.</p>
<p>This might <em>seem</em> like an incredibly odd way to specify the type of component we're creating, but there is a precedent for this sort of thing: the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Strict_mode">"use strict"</a> directive that opts into “Strict Mode” in JavaScript.</p>
<p>We don't specify the <code>'use server'</code> directive in our Server Components; in the React Server Components paradigm, components are treated as Server Components by default. In fact, <code>'use server'</code> is used for Server Actions, a totally different feature that is beyond the scope of this blog post.</p>
<blockquote>
<p><strong>Which components should be Client Components?</strong></p>
<p>You might be wondering: how should I decide whether a given component should be a Server Component or a Client Component?</p>
<p>As a general rule, if a component <em>can</em> be a Server Component, it <em>should</em> be a Server Component. Server Components tend to be simpler and easier to reason about. There's also a performance benefit: because Server Components don't run on the client, their code isn't included in our JavaScript bundles. One of the benefits of the React Server Components paradigm is that it has the potential to improve the <em>Page Interactive</em> (TTI) metric.</p>
<p>That said, we also shouldn't make it our mission to eradicate as many Client Components as possible! We shouldn't try to optimize for the smallest # of Client Components. It's worth remembering that until now, <em>every</em> React component in every React app has been a Client Component.</p>
<p>As you start working with React Server Components, you'll likely discover that this is pretty intuitive. Some of our components will need to run on the client, because they use state variables or effects. You can slap a <code>'use client'</code> directive on those components. Otherwise, you can leave them as Server Components.</p>
</blockquote>
<h2 id="boundaries"><a href="https://www.joshwcomeau.com/react/server-components/#boundaries-6">Boundaries</a><a aria-hidden="true" class="anchor-heading icon-link" href="#boundaries"></a></h2>
<p>One of the first questions I had when I was getting familiar with React Server Components was this: <em>what happens when the props change?</em></p>
<p>For example, suppose we had a Server Component like this:</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">HitCounter</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> hits <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">Number of hits: </span><span class="token punctuation">{</span>hits<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
<span class="token punctuation">}</span>
</code></pre>
<p>Let's suppose that in the initial Server Side Render, <code>hits</code> was equal to <code>0</code>. This component, then, will produce the following markup:</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span><span class="token punctuation">></span></span>Number of hits: 0<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
</code></pre>
<p>But what happens if the value of <code>hits</code> changes? Suppose it's a state variable, and it changes from <code>0</code> to <code>1</code>. <code>HitCounter</code> would need to re-render, but it <em>can't</em> re-render, because it's a Server Component!</p>
<p><strong>The thing is, Server Components don't really make sense in isolation.</strong> We have to zoom out, to take a more holistic view, to consider the structure of our application.</p>
<p>Let's say we have the following component tree:</p>
<blockquote>
<p>tree diagram</p>
</blockquote>
<p>If all of these components are Server Components, then it all makes sense. None of the props will ever change, because none of the components will ever re-render.</p>
<p>But let's suppose that <code>Article</code> component owns the <code>hits</code> state variable. In order to use state, we need to convert it to a Client Component:</p>
<blockquote>
<p>tree diagram</p>
</blockquote>
<p>Do you see the issue here? When <code>Article</code> re-renders, any owned components will <em>also</em> re-render, including <code>HitCounter</code> and <code>Discussion</code>. If these are Server Components, though, they <em>can't</em> re-render.</p>
<p>In order to prevent this impossible situation, the React team added a rule: <strong>Client Components can only import other Client Components.</strong> That <code>'use client'</code> directive means that these instances of <code>HitCounter</code> and <code>Discussion</code> will need to become Client Components.</p>
<p>One of the biggest “ah-ha” moments I had with React Server Components was the realization that this new paradigm is all about creating <em>client boundaries</em>. Here's what winds up happening, in practice:</p>
<blockquote>
<p>tree diagram of client boundary</p>
</blockquote>
<p>When we add the <code>'use client'</code> directive to the <code>Article</code> component, we create a “client boundary”. All of the components within this boundary are <em>implicitly</em> converted to Client Components. Even though components like <code>HitCounter</code> don't have the <code>'use client'</code> directive, they'll still hydrate/render on the client in this particular situation.*</p>
<p>This means we don't have to add <code>'use client'</code> to every single file that needs to run on the client. In practice, we only need to add it when we're creating new client boundaries.</p>
<h3 id="workarounds"><a href="https://www.joshwcomeau.com/react/server-components/#workarounds-7">Workarounds</a><a aria-hidden="true" class="anchor-heading icon-link" href="#workarounds"></a></h3>
<p>When I first learned that Client Components can't render Server Components, it felt pretty restrictive to me. What if I need to use state high up in the application? Does that mean <em>everything</em> needs to become a Client Component??</p>
<p>It turns out that in many cases, we can work around this limitation by restructuring our application so that the <em>owner</em> changes.</p>
<p>This is a tricky thing to explain, so let's use an example:</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token string">"use client"</span>
<span class="token keyword module">import</span> <span class="token punctuation">{</span> <span class="token constant">DARK_COLORS</span><span class="token punctuation">,</span> <span class="token constant">LIGHT_COLORS</span> <span class="token punctuation">}</span> <span class="token keyword module">from</span> <span class="token string">"@/constants.js"</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Header</span></span> <span class="token keyword module">from</span> <span class="token string">"./Header"</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">MainContent</span></span> <span class="token keyword module">from</span> <span class="token string">"./MainContent"</span>
<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Homepage</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>colorTheme<span class="token punctuation">,</span> setColorTheme<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">useState</span><span class="token punctuation">(</span><span class="token string">"light"</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> colorVariables <span class="token operator">=</span> colorTheme <span class="token operator">===</span> <span class="token string">"light"</span> <span class="token operator">?</span> <span class="token constant">LIGHT_COLORS</span> <span class="token operator">:</span> <span class="token constant">DARK_COLORS</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>body</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>colorVariables<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token class-name">Header</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token class-name">MainContent</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>body</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>In this setup, we need to use React state to allow users to flip between dark mode / light mode. This needs to happen high up in the application tree, so that we can apply our CSS variable tokens to the <code>&#x3C;body></code> tag.</p>
<p>In order to use state, we need to make <code>Homepage</code> a Client Component. And since this is the top of our application, it means that all of the other components — <code>Header</code> and <code>MainContent</code> — will implicitly become Client Components too.</p>
<p>To fix this, let's pluck the color-management stuff into its own component, moved to its own file:</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token comment">// /components/ColorProvider.js</span>
<span class="token string">"use client"</span>
<span class="token keyword module">import</span> <span class="token punctuation">{</span> <span class="token constant">DARK_COLORS</span><span class="token punctuation">,</span> <span class="token constant">LIGHT_COLORS</span> <span class="token punctuation">}</span> <span class="token keyword module">from</span> <span class="token string">"@/constants.js"</span>
<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ColorProvider</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>colorTheme<span class="token punctuation">,</span> setColorTheme<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">useState</span><span class="token punctuation">(</span><span class="token string">"light"</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> colorVariables <span class="token operator">=</span> colorTheme <span class="token operator">===</span> <span class="token string">"light"</span> <span class="token operator">?</span> <span class="token constant">LIGHT_COLORS</span> <span class="token operator">:</span> <span class="token constant">DARK_COLORS</span>
  <span class="token keyword control-flow">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>body</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>colorVariables<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>body</span><span class="token punctuation">></span></span>
<span class="token punctuation">}</span>
</code></pre>
<p>Back in <code>Homepage</code>, we use this new component like so:</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token comment">// /components/Homepage.js</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Header</span></span> <span class="token keyword module">from</span> <span class="token string">"./Header"</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">MainContent</span></span> <span class="token keyword module">from</span> <span class="token string">"./MainContent"</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">ColorProvider</span></span> <span class="token keyword module">from</span> <span class="token string">"./ColorProvider"</span>
<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Homepage</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token class-name">ColorProvider</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token class-name">Header</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token class-name">MainContent</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span><span class="token class-name">ColorProvider</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>We can remove the <code>'use client'</code> directive from <code>Homepage</code> because it no longer uses state, or any other client-side React features. This means that <code>Header</code> and <code>MainContent</code> won't be implicitly converted to Client Components anymore!</p>
<p><strong>But wait a second.</strong> <code>ColorProvider</code>, a Client Component, is a <em>parent</em> to <code>Header</code> and <code>MainContent</code>. Either way, it's still higher in the tree, right?</p>
<p>When it comes to client boundaries, though, the parent/child relationship doesn't matter. <code>Homepage</code> is the one importing and rendering <code>Header</code> and <code>MainContent</code>. This means that <code>Homepage</code> decides <em>what the props are</em> for these components.</p>
<p>Remember, the problem we're trying to solve is that Server Components can't re-render, and so they can't be given new values for any of their props. With this new setup, <code>Homepage</code> decides what the props are for <code>Header</code> and <code>MainContent</code>, and since <code>Homepage</code> is a Server Component, there's no problem.</p>
<p><strong>This is brain-bending stuff.</strong> Even after years of React experience, I still find this very confusing 😅. It took a fair bit of practice to develop an intuition for this.</p>
<p>To be more precise, the <code>'use client'</code> directive works at the file / module level. Any modules <em>imported</em> in a Client Component file must be Client Components as well. When the bundler bundles up our code, it'll follow these imports, after all!</p>
<blockquote>
<p><strong>Changing the color theme?</strong></p>
<p>In my example above, you might have noticed that there's no way to change the color theme. <code>setColorTheme</code> is never called.</p>
<p>I wanted to keep things as minimal as possible, and so I left some stuff out. A full example would use React context to make the setter function available to any descendants. As long as the component that consumes the context is a Client Component, everything works great!</p>
</blockquote>
<h2 id="peeking-under-the-hood"><a href="https://www.joshwcomeau.com/react/server-components/#peeking-under-the-hood-8">Peeking under the hood</a><a aria-hidden="true" class="anchor-heading icon-link" href="#peeking-under-the-hood"></a></h2>
<p>Let's look at this at a bit of a lower level. When we use a Server Component, what does the output look like? What actually gets generated?</p>
<p>Let's start with a super-simple React application:</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Homepage</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Hello world!</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>p</span><span class="token punctuation">></span></span>
<span class="token punctuation">}</span>
</code></pre>
<p>In the React Server Components paradigm, all components are Server Components by default. Since we haven't explicitly marked this component as a Client Component (or rendered it within a client boundary), it'll only render on the server.</p>
<p>When we visit this app in the browser, we'll receive an HTML document which looks something like this:</p>
<pre class="language-html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&#x3C;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>html</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>p</span><span class="token punctuation">></span></span>Hello world!<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>p</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/js/bundle.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>script</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
      self<span class="token punctuation">.</span><span class="token property-access">__next</span><span class="token punctuation">[</span><span class="token string">"$Homepage-1"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">"p"</span><span class="token punctuation">,</span>
        props<span class="token operator">:</span> <span class="token keyword null nil">null</span><span class="token punctuation">,</span>
        children<span class="token operator">:</span> <span class="token string">"Hello world!"</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>script</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>html</span><span class="token punctuation">></span></span>
</code></pre>
<blockquote>
<p><strong>Some liberties taken</strong></p>
<p>To make it easier to understand, I've taken the liberty of restructuring things here. For example, the true JS generated in an RSC context uses stringified JSON arrays, as an optimization to reduce the file size of this HTML document.</p>
<p>I've also stripped out all non-critical parts of the HTML (like the <code>&#x3C;head></code>).</p>
</blockquote>
<p>We see that our HTML document includes the UI generated by our React application, the “Hello world!” paragraph. This is thanks to Server Side Rendering, and isn't directly attributable to React Server Components.</p>
<p>Below that, we have a <code>&#x3C;script></code> tag that loads up our JS bundle. This bundle includes the dependencies like React, as well as any Client Components used in our application. And since our <code>Homepage</code> component is a Server Component, the code for that component is <em>not</em> included in this bundle.</p>
<p>Finally, we have a second <code>&#x3C;script></code> tag with some inline JS:</p>
<pre class="language-js"><code class="language-js">self<span class="token punctuation">.</span><span class="token property-access">__next</span><span class="token punctuation">[</span><span class="token string">"$Homepage-1"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">"p"</span><span class="token punctuation">,</span>
  props<span class="token operator">:</span> <span class="token keyword null nil">null</span><span class="token punctuation">,</span>
  children<span class="token operator">:</span> <span class="token string">"Hello world!"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This is the really interesting bit. Essentially, what we're doing here is telling React “Hey, so I know you're missing the <code>Homepage</code> component code, but don't worry: here's what it rendered”.</p>
<p>Typically, when React hydrates on the client, it speed-renders all of the components, building up a virtual representation of the application. It can't do that for Server Components, because the code isn't included in the JS bundle.</p>
<p>And so, we send along the rendered value, the virtual representation that was generated by the server. When React loads on the client, it re-uses that description instead of re-generating it.</p>
<p>This is what allows that <code>ColorProvider</code> example above to work. The output from <code>Header</code> and <code>MainContent</code> is passed into the <code>ColorProvider</code> component through the <code>children</code> prop. <code>ColorProvider</code> can re-render as much as it wants, but this data is static, locked in by the server.</p>
<p>If you're curious to see <em>true</em> representations of how Server Components are serialized and sent over the network, check out the <a href="https://www.alvar.dev/blog/creating-devtools-for-react-server-components">RSC Devtools</a> by developer Alvar Lagerlöf.</p>
<blockquote>
<p><strong>Server Components don't require a server</strong></p>
<p>Earlier in this post, I mentioned that Server Side Rendering is an “umbrella term” for lots of different rendering strategies, including:</p>
<ul>
<li>Static: the HTML is generated when the application is built, during the deploy process.</li>
<li>Dynamic: the HTML is generated “on-demand”, when the page is requested by the user.</li>
</ul>
<p><strong>React Server Components is compatible with either of these rendering strategies.</strong> When our Server Components are rendered in the Node.js runtime, the JavaScript objects they return will be created. That can happen either on-demand or during the build.</p>
<p>This means that it's possible to use React Server Components without a server! We can generate a bunch of static HTML files and host them wherever we want. In fact, this is what happens <em>by default</em> in the Next.js App Router. Unless we really need things to happen “on-demand”, all of this work happens ahead of time, during the build.</p>
</blockquote>
<blockquote>
<p><strong>No React at all?</strong></p>
<p>You might be wondering: if we don't include any Client Components in our application, do we actually need to download React at all? Can we use React Server Components to build a <em>truly</em> static no-JS website?</p>
<p>The thing is, React Server Components is available exclusively within the Next.js framework, and that framework has a bunch of code that needs to run on the client, to manage things like routing.</p>
<p>Counter-intuitively, though, this actually tends to produce a <em>better</em> user experience; Next's router, for example, will process link clicks <em>faster</em> than a typical <code>&#x3C;a></code> tag, since it doesn't have to load a whole new HTML document.</p>
<p>A well-structured Next.js application will still work while the JS is downloading, but it'll be even faster/better once the JS loads.</p>
</blockquote>
<h2 id="advantages"><a href="https://www.joshwcomeau.com/react/server-components/#advantages-9">Advantages</a><a aria-hidden="true" class="anchor-heading icon-link" href="#advantages"></a></h2>
<p>React Server Components is the first “official” way to run server-exclusive code in React. As I mentioned earlier, though, this isn't <em>really</em> a new thing in the broader React ecosystem; we've been able to run server-exclusive code in Next.js since 2016!</p>
<p>The big difference is that we've never before had a way to run server-exclusive code <em>inside our components.</em></p>
<p>The most obvious benefit is performance. Server Components don't get included in our JS bundles, which reduces the amount of JavaScript that needs to be downloaded, and the number of components that need to be hydrated:</p>
<blockquote>
<p>chart of Legacy Next.js (pre-RSC) and Modern Next.js (with RSC)</p>
</blockquote>
<p>This is a data visualization which shows a sequence of events between client and server. Each event is represented here as a list item.</p>
<ol>
<li>"Database Query" on server. Duration: 5 units of time.</li>
<li>"Render App" on server. Duration: 6 units of time.</li>
<li>Response from server. Duration: 4 units of time.</li>
<li>"Download JavaScript" on client. Duration: 7 units of time.</li>
<li>"Hydrate" on client. Duration: 3 units of time.</li>
</ol>
<p>This is maybe the least exciting thing to me, though. Honestly, most Next.js apps are <em>already</em> fast enough when it comes to “Page Interactive” timing.</p>
<p>If you follow semantic HTML principles, most of your app should work even before React has hydrated. Links can be followed, forms can be submitted, accordions can be expanded and collapsed (using <code>&#x3C;details></code> and <code>&#x3C;summary></code>). For most projects, it's fine if it takes a few seconds for React to hydrate.</p>
<p><strong>But here's something I find really cool:</strong> we no longer have to make the same compromises, in terms of features vs. bundle size!</p>
<p>For example, most technical blogs require some sort of syntax highlighting library. On this blog, I use Prism. The code snippets look like this:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">exampleJavaScriptFunction</span><span class="token punctuation">(</span><span class="token parameter">param</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token string">"Hello world!"</span>
<span class="token punctuation">}</span>
</code></pre>
<p>A proper syntax-highlighting library, with support for all popular programming languages, would be several megabytes, far too large to stick in a JS bundle. As a result, we have to make compromises, trimming out languages and features that aren't mission-critical.</p>
<p>But, suppose we do the syntax highlighting <em>in a Server Component.</em> In that case, none of the library code would actually be included in our JS bundles. As a result, we wouldn't have to make any compromises, we could use all of the bells and whistles.</p>
<p>This is the big idea behind <a href="https://bright.codehike.org/">Bright</a>, a modern syntax-highlighting package designed to work with React Server Components.</p>
<p><a href="/images/server-components/bright.png">image of React server component for syntax highlighting</a></p>
<p>This is the sort of thing that gets me excited about React Server Components. Things that would be too cost-prohibitive to include in a JS bundle can now run on the server <em>for free,</em> adding zero kilobytes to our bundles, and producing an even better user experience.</p>
<p>It's not just about performance and UX either. After working with RSC for a while, I've come to really appreciate how easy-breezy Server Components are. We never have to worry about dependency arrays, stale closures, memoization, or any of the other complex stuff caused by <em>things changing.</em></p>
<p>Ultimately, it's still very early days. React Server Components only emerged from beta a couple of months ago! I'm really excited to see how things evolve over the next couple of years, as the community continues to innovate new solutions like Bright, taking advantage of this new paradigm. It's an exciting time to be a React developer!</p>
<h2 id="the-full-picture"><a href="https://www.joshwcomeau.com/react/server-components/#the-full-picture-10">The full picture</a><a aria-hidden="true" class="anchor-heading icon-link" href="#the-full-picture"></a></h2>
<p>React Server Components is an exciting development, but it's actually only one part of the “Modern React” puzzle.</p>
<p>Things get <em>really</em> interesting when we combine React Server Components with Suspense and the new Streaming SSR architecture. It allows us to do <em>wild</em> stuff like this:</p>
<blockquote>
<p>chart</p>
</blockquote>
<p>This is a data visualization which shows a sequence of events between client and server. Each event is represented here as a list item.</p>
<ol>
<li>"Render Shell" on server. Duration: 3 units of time.</li>
<li>Response from server. Duration: 3 units of time.</li>
<li>"Database Query" on server. Duration: 8 units of time.</li>
<li>"Render Content" on server. Duration: 3 units of time.</li>
<li>Response from server. Duration: 4 units of time.</li>
<li>"Download JS" on client. Duration: 5 units of time.</li>
<li>"Hydrate" on client. Duration: 2 units of time.</li>
<li>"Hydrate" on client. Duration: 2 units of time.</li>
</ol>
<p>It's beyond the scope of this tutorial, but you can learn more about this architecture <a href="https://github.com/reactwg/react-18/discussions/37">on Github</a>.</p>
<p>It's also something we explore in depth in my brand-new course, <a href="https://joyofreact.com/">The Joy of React</a>. I'd love to tell you a little bit more about it, if that's alright! ❤️</p>
<p>The Joy of React is a beginner-friendly interactive course, designed to help you build an intuition for how React works. We start at the very beginning (no prior React experience required), and work our way through some of the most notoriously-tricky aspects of React.</p>
<p>This course has been my full-time focus for almost two years now, and it includes all of the most important stuff I've learned about React in over 8 years of experience.</p>
<p>There's so much good stuff I'd love to tell you about. In addition to React itself, and all the bleeding-edge stuff we've alluded to in this blog post, you'll learn about my favourite parts of the React ecosystem. For example, you'll learn how to do next-level layout animations like this, using Framer Motion:</p>
<p>You can learn more about the course, and discover the joy of building with React:</p>
<ul>
<li><a href="https://joyofreact.com/">The Joy of React</a></li>
</ul>
<hr>
<p>React Server Components is a significant paradigm shift. Personally, I'm <em>super</em> keen to see how things develop over the next couple of years, as the ecosystem builds more tools like Bright that takes advantage of Server Components.</p>
<p>I have the feeling that building in React is about to get even cooler. 😄</p></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#a-quick-primer-on-server-side-rendering" title="A quick primer on Server Side Rendering">A quick primer on Server Side Rendering</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#bouncing-back-and-forth" title="Bouncing back and forth">Bouncing back and forth</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#introduction-to-react-server-components" title="Introduction to React Server Components">Introduction to React Server Components</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#compatible-environments" title="Compatible Environments">Compatible Environments</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#specifying-client-components" title="Specifying client components">Specifying client components</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#boundaries" title="Boundaries">Boundaries</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#workarounds" title="Workarounds">Workarounds</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#peeking-under-the-hood" title="Peeking under the hood">Peeking under the hood</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#advantages" title="Advantages">Advantages</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#the-full-picture" title="The full picture">The full picture</a></div></div></div></div></div></div></div></div></div></div></div><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></main></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"v7zet6zxl73bs63kf6kagio","title":"Making Sense of React Server Components","desc":"","updated":1695272995260,"created":1695271524035,"custom":{},"fname":"dev.javascript.react.server-components","type":"note","vault":{"fsPath":"vault"},"contentHash":"fa3fe8d43066a2e1f7976baff241f37e","links":[],"anchors":{"a-quick-primer-on-server-side-rendering":{"type":"header","text":"A quick primer on Server Side Rendering","value":"a-quick-primer-on-server-side-rendering","line":26,"column":0,"depth":2},"bouncing-back-and-forth":{"type":"header","text":"Bouncing back and forth","value":"bouncing-back-and-forth","line":76,"column":0,"depth":2},"introduction-to-react-server-components":{"type":"header","text":"Introduction to React Server Components","value":"introduction-to-react-server-components","line":222,"column":0,"depth":2},"compatible-environments":{"type":"header","text":"Compatible Environments","value":"compatible-environments","line":280,"column":0,"depth":3},"specifying-client-components":{"type":"header","text":"Specifying client components","value":"specifying-client-components","line":292,"column":0,"depth":3},"boundaries":{"type":"header","text":"Boundaries","value":"boundaries","line":326,"column":0,"depth":2},"workarounds":{"type":"header","text":"Workarounds","value":"workarounds","line":370,"column":0,"depth":3},"peeking-under-the-hood":{"type":"header","text":"Peeking under the hood","value":"peeking-under-the-hood","line":447,"column":0,"depth":2},"advantages":{"type":"header","text":"Advantages","value":"advantages","line":531,"column":0,"depth":2},"the-full-picture":{"type":"header","text":"The full picture","value":"the-full-picture","line":577,"column":0,"depth":2}},"children":[],"parent":"0gqmdqmd5rylcs3ljzwsww4","data":{}},"body":"\u003ch1 id=\"making-sense-of-react-server-components\"\u003eMaking Sense of React Server Components\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#making-sense-of-react-server-components\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://www.joshwcomeau.com/react/server-components/\"\u003ehttps://www.joshwcomeau.com/react/server-components/\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eSo, here's something that makes me feel old: React celebrated its 10th birthday this year!\u003c/p\u003e\n\u003cp\u003eIn the decade since React was first introduced to a bewildered dev community, it’s gone through several evolutions. The React team has not been shy when it comes to radical changes: if they discover a better solution to a problem, they'll run with it.\u003c/p\u003e\n\u003cp\u003eA couple of months ago, the React team unveiled \u003cem\u003eReact Server Components,\u003c/em\u003e the latest paradigm shift. For the first time ever, React components can run exclusively on the server.\u003c/p\u003e\n\u003cp\u003eThere's been \u003cem\u003eso much friggin’ confusion\u003c/em\u003e about this online. Lots of folks have lots of questions around what this is, how it works, what the benefits are, and how it fits together with things like Server Side Rendering.\u003c/p\u003e\n\u003cp\u003eI've been doing a lot of experimentation with React Server Components, and I've answered a lot of my own questions. I have to admit, I'm \u003cem\u003eway\u003c/em\u003e more excited about this stuff than I expected to be. \u003cem\u003eIt's really cool!\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003eSo, my goal today is to help demystify this stuff for you, to answer a lot of the questions you might have about React Server Components!\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eIntended audience\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eThis tutorial is written primarily for developers who are already using React, and who are curious about React Server Components. You don't need to be a React expert, but it will likely be pretty confusing if you're just getting started with React.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"a-quick-primer-on-server-side-rendering\"\u003e\u003ca href=\"https://www.joshwcomeau.com/react/server-components/#a-quick-primer-on-server-side-rendering-1\"\u003eA quick primer on Server Side Rendering\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#a-quick-primer-on-server-side-rendering\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eTo put React Server Components in context, it's helpful to understand how Server Side Rendering (SSR) works. If you're already familiar with SSR, feel free to skip to the next heading!\u003c/p\u003e\n\u003cp\u003eWhen I first started using React in 2015, most React setups used a “client-side” rendering strategy. The user would receive an HTML file that looked like this:\u003c/p\u003e\n\u003cpre class=\"language-html\"\u003e\u003ccode class=\"language-html\"\u003e\u003cspan class=\"token doctype\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;!\u003c/span\u003e\u003cspan class=\"token doctype-tag\"\u003eDOCTYPE\u003c/span\u003e \u003cspan class=\"token name\"\u003ehtml\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ehtml\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ebody\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ediv\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eid\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eroot\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003ediv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003escript\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003esrc\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e/static/js/bundle.js\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token script\"\u003e\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003escript\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003ebody\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003ehtml\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThat \u003ccode\u003ebundle.js\u003c/code\u003e script includes everything we need to mount and run the application, including React, other third-party dependencies, and all of the code we've written.\u003c/p\u003e\n\u003cp\u003eOnce the JS has been downloaded and parsed, React springs into action, conjuring all of the DOM nodes for our entire application, and housing it in that empty \u003ccode\u003e\u0026#x3C;div id=\"root\"\u003e\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eThe problem with this approach is that it takes time to do all of that work. \u003cstrong\u003eAnd while it's all happening, the user is staring at a blank white screen.\u003c/strong\u003e This problem tends to get worse over time: every new feature we ship adds more kilobytes to our JavaScript bundle, prolonging the amount of time that the user has to sit and wait.*\u003c/p\u003e\n\u003cp\u003eServer Side Rendering was designed to improve this experience. Instead of sending an empty HTML file, the server will render our application to \u003cem\u003egenerate\u003c/em\u003e the actual HTML. The user receives a fully-formed HTML document.\u003c/p\u003e\n\u003cp\u003eThat HTML file will still include the \u003ccode\u003e\u0026#x3C;script\u003e\u003c/code\u003e tag, since we still need React to run on the client, to handle any interactivity. But we configure React to work a little bit differently in-browser: instead of conjuring all of the DOM nodes from scratch, it instead \u003cem\u003eadopts\u003c/em\u003e the existing HTML. This process is known as \u003cem\u003ehydration.\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003eI like the way React core team member Dan Abramov explains this:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eHydration is like watering the “dry” HTML with the “water” of interactivity and event handlers.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eOnce the JS bundle has been downloaded, React will quickly run through our entire application, building up a virtual sketch of the UI, and “fitting” it to the real DOM, attaching event handlers, firing off any effects, and so on.\u003c/p\u003e\n\u003cp\u003eAnd so, that's SSR in a nutshell. A server generates the initial HTML so that users don't have to stare at an empty white page while the JS bundles are downloaded and parsed. Client-side React then picks up where server-side React left off, adopting the DOM and sprinkling in the interactivity.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eAn umbrella term\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eWhen we talk about Server Side Rendering, we typically imagine a flow that looks like this:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eUser visits \u003cem\u003emyWebsite.com\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eA Node.js server receives the request, and immediately renders the React application, generating the HTML.\u003c/li\u003e\n\u003cli\u003eThat freshly-baked HTML is sent to the client.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eThis is \u003cem\u003eone\u003c/em\u003e possible way to implement Server Side Rendering, but it's not the only one. Another option is to generate the HTML when we \u003cem\u003ebuild the application.\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003eTypically, React applications need to be \u003cem\u003ecompiled\u003c/em\u003e, transforming JSX into plain ol’ JavaScript, and bundling all of our modules. What if, during that same process, we “pre-rendered” all of the HTML for all of our different routes?\u003c/p\u003e\n\u003cp\u003eThis is commonly known as \u003cem\u003estatic site generation (SSG)\u003c/em\u003e. It's a sub-variant of Server Side Rendering.\u003c/p\u003e\n\u003cp\u003eThe way I see it, “Server Side Rendering” is an umbrella term that includes several different rendering strategies. They all have one thing in common: the initial render happens in a server runtime like Node.js, using the \u003ccode\u003eReactDOMServer\u003c/code\u003e APIs. It doesn't actually matter \u003cem\u003ewhen\u003c/em\u003e this happens, whether it's on-demand or at compile-time. Either way, it's Server Side Rendering.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"bouncing-back-and-forth\"\u003e\u003ca href=\"https://www.joshwcomeau.com/react/server-components/#bouncing-back-and-forth-2\"\u003eBouncing back and forth\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#bouncing-back-and-forth\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eLet's talk about data-fetching in React. Typically, we've had two separate applications that communicate over the network:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eA client-side React app\u003c/li\u003e\n\u003cli\u003eA server-side REST API\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eUsing something like React Query or SWR or Apollo, the client would make a network request to the back-end, which would then grab the data from the database and send it back over the network.\u003c/p\u003e\n\u003cp\u003eWe can visualize this flow using a graph:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003echart\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eThis is a data visualization which shows a sequence of events between client and server. Each event is represented here as a list item.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eResponse from server. Duration: 4 units of time.\u003c/li\u003e\n\u003cli\u003e\"Download JavaScript\" on client. Duration: 7 units of time.\u003c/li\u003e\n\u003cli\u003e\"Render Shell\" on client. Duration: 6 units of time.\u003c/li\u003e\n\u003cli\u003eRequest to server. Duration: 4 units of time.\u003c/li\u003e\n\u003cli\u003e\"Database Query\" on server. Duration: 5 units of time.\u003c/li\u003e\n\u003cli\u003eResponse from server. Duration: 4 units of time.\u003c/li\u003e\n\u003cli\u003e\"Render Content\" on client. Duration: 5 units of time.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eA note about these graphs\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eThis blog post includes several of these “network request graphs”. They're designed to visualize how data moves between client (browser) and server (back-end API), across several different rendering strategies.\u003c/p\u003e\n\u003cp\u003eThe numbers along the bottom represent an imaginary made-up time unit. They're not minutes or seconds. \u003cstrong\u003eIn reality, the numbers vary wildly, based on a ton of different factors.\u003c/strong\u003e These graphs are meant to give you a high-level understanding of the concepts, they're not modeling any real data.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eThis first graph shows the flow using a Client Side Rendering (CSR) strategy. It starts with the client receiving an HTML file. This file doesn't have any content, but it does have one or more \u003ccode\u003e\u0026#x3C;script\u003e\u003c/code\u003e tags.\u003c/p\u003e\n\u003cp\u003eOnce the JS has been downloaded and parsed, our React app will boot up, creating a bunch of DOM nodes and populating the UI. At first, though, we don't have any of the actual \u003cem\u003edata\u003c/em\u003e, so we can only render the shell (the header, the footer, the general layout) with a loading state.\u003c/p\u003e\n\u003cp\u003eYou've probably seen this sort of pattern a lot. For example, UberEats starts by rendering a shell while it fetches the data it needs to populate the actual restaurants:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eskeleton UI\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eThe user will see this loading state until the network request resolves and React re-renders, replacing the loading UI with the real content.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eLet's look at another way we could architect this.\u003c/strong\u003e This next graph keeps the same general data-fetching pattern, but uses \u003cem\u003eServer\u003c/em\u003e Side Rendering instead of Client Side Rendering:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003echart\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eThis is a data visualization which shows a sequence of events between client and server. Each event is represented here as a list item.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\"Render Shell\" on server. Duration: 3 units of time.\u003c/li\u003e\n\u003cli\u003eResponse from server. Duration: 4 units of time.\u003c/li\u003e\n\u003cli\u003e\"Download JavaScript\" on client. Duration: 7 units of time.\u003c/li\u003e\n\u003cli\u003e\"Hydrate\" on client. Duration: 3 units of time.\u003c/li\u003e\n\u003cli\u003eRequest to server. Duration: 4 units of time.\u003c/li\u003e\n\u003cli\u003e\"Database Query\" on server. Duration: 5 units of time.\u003c/li\u003e\n\u003cli\u003eResponse from server. Duration: 4 units of time.\u003c/li\u003e\n\u003cli\u003e\"Render Content\" on client. Duration: 5 units of time.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eIn this new flow, we perform the first render on the server. This means that the user receives an HTML file that isn't totally empty.\u003c/p\u003e\n\u003cp\u003eThis is an improvement — a shell is better than a blank white page — but ultimately, it doesn't really move the needle in a significant way. The user isn't visiting our app to see a loading screen, they're visiting to see the \u003cem\u003econtent\u003c/em\u003e (restaurants, hotel listings, search results, messages, whatever).\u003c/p\u003e\n\u003cp\u003eTo really get a sense of the differences in user experience, let's add some web performance metrics to our graphs. \u003cstrong\u003eToggle between these two flows, and notice what happens to the flags:\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eClient Side Rendering\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003einteractive chart\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eThis is a data visualization which shows a sequence of events between client and server. Each event is represented here as a list item.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eResponse from server. Duration: 4 units of time.\u003c/li\u003e\n\u003cli\u003e\"Download JavaScript\" on client. Duration: 7 units of time.\u003c/li\u003e\n\u003cli\u003e\"Render Shell\" on client. Duration: 6 units of time.\u003c/li\u003e\n\u003cli\u003eRequest to server. Duration: 4 units of time.\u003c/li\u003e\n\u003cli\u003e\"Database Query\" on server. Duration: 5 units of time.\u003c/li\u003e\n\u003cli\u003eResponse from server. Duration: 4 units of time.\u003c/li\u003e\n\u003cli\u003e\"Render Content\" on client. Duration: 5 units of time.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eEach of these flags represents a commonly-used web performance metric. Here's the breakdown:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003eFirst Paint\u003c/strong\u003e — The user is no longer staring at a blank white screen. The general layout has been rendered, but the content is still missing. This is sometimes called FCP (First Contentful Paint).\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003ePage Interactive\u003c/strong\u003e — React has been downloaded, and our application has been rendered/hydrated. Interactive elements are now fully responsive. This is sometimes called TTI (Time To Interactive).\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eContent Paint\u003c/strong\u003e — The page now includes the stuff the user cares about. We've pulled the data from the database and rendered it in the UI. This is sometimes called LCP (Largest Contentful Paint).\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eBy doing the initial render on the server, we're able to get that initial “shell” drawn more quickly. This can make the loading experience feel a bit faster, since it provides a sense of progress, that things are happening.\u003c/p\u003e\n\u003cp\u003eAnd, in some situations, this \u003cem\u003ewill\u003c/em\u003e be a meaningful improvement. For example, maybe the user is only waiting for the header to load so that they can click a navigation link.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eBut doesn't this flow feel a bit silly?\u003c/strong\u003e When I look at the SSR graph, I can't help but notice that the request \u003cem\u003estarts\u003c/em\u003e on the server. Instead of requiring a second round-trip network request, why don't we do the database work \u003cem\u003eduring that initial request?\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003eIn order words, \u003cstrong\u003ewhy not do something like this?\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003echart\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eThis is a data visualization which shows a sequence of events between client and server. Each event is represented here as a list item.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\"Database Query\" on server. Duration: 5 units of time.\u003c/li\u003e\n\u003cli\u003e\"Render App\" on server. Duration: 6 units of time.\u003c/li\u003e\n\u003cli\u003eResponse from server. Duration: 4 units of time.\u003c/li\u003e\n\u003cli\u003e\"Download JavaScript\" on client. Duration: 7 units of time.\u003c/li\u003e\n\u003cli\u003e\"Hydrate\" on client. Duration: 3 units of time.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eInstead of bouncing back and forth between the client and server, we do our database query as part of the initial request, sending the fully-populated UI straight to the user.\u003c/p\u003e\n\u003cp\u003eBut hm, how exactly would we do this?\u003c/p\u003e\n\u003cp\u003eIn order for this to work, we'd need to be able to give React a chunk of code that it runs \u003cem\u003eexclusively\u003c/em\u003e on the server, to do the database query. But that hasn't been an option with React… even with Server Side Rendering, all of our components render on \u003cem\u003eboth\u003c/em\u003e the server and the client.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eThe ecosystem has come up with lots of solutions to this problem.\u003c/strong\u003e Meta-frameworks? like Next.js and Gatsby have created their own way to run code exclusively on the server.\u003c/p\u003e\n\u003cp\u003eFor example, here's what this looked like using Next.js (using the legacy “Pages” router):\u003c/p\u003e\n\u003cpre class=\"language-jsx\"\u003e\u003ccode class=\"language-jsx\"\u003e\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003edb\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"imaginary-db\"\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// This code only runs on the server:\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003egetServerSideProps\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e link \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e db\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003econnect\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"localhost\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"root\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"passw0rd\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e data \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003eawait\u003c/span\u003e db\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003equery\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003elink\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"SELECT * FROM products\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    props\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e data \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// This code runs on the server + on the client\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003edefault\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eHomepage\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e data \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n      \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eh1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003eTrending Products\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eh1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n      \u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003eitem\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003earticle\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ekey\u003c/span\u003e\u003cspan class=\"token script language-javascript\"\u003e\u003cspan class=\"token script-punctuation punctuation\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003eitem\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n          \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eh2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003eitem\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003etitle\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eh2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n          \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ep\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003eitem\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003edescription\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003ep\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n        \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003earticle\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n    \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eLet's break this down:\u003c/strong\u003e when the server receives a request, the \u003ccode\u003egetServerSideProps\u003c/code\u003e function is called. It returns a \u003ccode\u003eprops\u003c/code\u003e object. Those props are then funneled into the component, which is rendered first on the server, and then hydrated on the client.\u003c/p\u003e\n\u003cp\u003eThe clever thing here is that \u003ccode\u003egetServerSideProps\u003c/code\u003e doesn't re-run on the client. In fact, this function isn't even included in our JavaScript bundles!\u003c/p\u003e\n\u003cp\u003eThis approach was \u003cem\u003esuper\u003c/em\u003e ahead of its time. Honestly, it's pretty friggin’ great. But there \u003cem\u003eare\u003c/em\u003e some downsides with this:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eThis strategy only works at the route level, for components at the very top of the tree. We can't do this in any component.\u003c/li\u003e\n\u003cli\u003eEach meta-framework came up with its own approach. Next.js has one approach, Gatsby has another, Remix has yet another. It hasn't been standardized.\u003c/li\u003e\n\u003cli\u003eAll of our React components will \u003cem\u003ealways\u003c/em\u003e hydrate on the client, even when there's no need for them to do so.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eFor years, the React team has been quietly tinkering on this problem, trying to come up with an official way to solve this problem. Their solution is called \u003cstrong\u003eReact Server Components.\u003c/strong\u003e\u003c/p\u003e\n\u003ch2 id=\"introduction-to-react-server-components\"\u003e\u003ca href=\"https://www.joshwcomeau.com/react/server-components/#introduction-to-react-server-components-3\"\u003eIntroduction to React Server Components\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#introduction-to-react-server-components\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eAt a high level, \u003cem\u003eReact Server Components\u003c/em\u003e is the name for a brand-new paradigm. In this new world, we can create components that run \u003cem\u003eexclusively on the server\u003c/em\u003e. This allows us to do things like write database queries right inside our React components!\u003c/p\u003e\n\u003cp\u003eHere's a quick example of a “Server Component”:\u003c/p\u003e\n\u003cpre class=\"language-jsx\"\u003e\u003ccode class=\"language-jsx\"\u003e\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003edb\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"imaginary-db\"\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eHomepage\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e link \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e db\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003econnect\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"localhost\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"root\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"passw0rd\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e data \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003eawait\u003c/span\u003e db\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003equery\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003elink\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"SELECT * FROM products\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n      \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eh1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003eTrending Products\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eh1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n      \u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003eitem\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003earticle\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ekey\u003c/span\u003e\u003cspan class=\"token script language-javascript\"\u003e\u003cspan class=\"token script-punctuation punctuation\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003eitem\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n          \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eh2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003eitem\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003etitle\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eh2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n          \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ep\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003eitem\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003edescription\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003ep\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n        \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003earticle\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n    \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003edefault\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eHomepage\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAs someone who has been using React for many years, this code looked \u003cem\u003eabsolutely wild\u003c/em\u003e to me at first. 😅\u003c/p\u003e\n\u003cp\u003e“But wait!”, my instincts screamed. “Function components can't be asynchronous! And we're not allowed to have side effects directly in the render like that!”\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eThe key thing to understand is this:\u003c/strong\u003e Server Components never re-render. They run \u003cem\u003eonce\u003c/em\u003e on the server to generate the UI. The rendered value is sent to the client and locked in place. As far as React is concerned, this output is immutable, and will never change.*\u003c/p\u003e\n\u003cp\u003eThis means that a \u003cem\u003ebig chunk\u003c/em\u003e of React's API is incompatible with Server Components. For example, we can't use state, because state can change, but Server Components can't re-render. And we can't use effects because effects only run \u003cem\u003eafter\u003c/em\u003e the render, on the client, and Server Components never make it to the client.\u003c/p\u003e\n\u003cp\u003eIt also means that we have a bit more flexibility when it comes to the rules. For example, in traditional React, we need to put side effects inside a \u003ccode\u003euseEffect\u003c/code\u003e callback or an event handler or something, so that they don't repeat on every render. But if the component only runs \u003cem\u003eonce\u003c/em\u003e, we don't have to worry about that!\u003c/p\u003e\n\u003cp\u003eServer Components \u003cem\u003ethemselves\u003c/em\u003e are surprisingly straightforward, but the “React Server Components” paradigm is significantly more complex. This is because we \u003cem\u003estill have\u003c/em\u003e regular ol’ components, and the way they fit together can be pretty confusing.\u003c/p\u003e\n\u003cp\u003eIn this new paradigm, the “traditional” React components we're familiar with are called \u003cem\u003eClient Components\u003c/em\u003e. I'll be honest, I don't love this name. 😅\u003c/p\u003e\n\u003cp\u003eThe name “Client Component” implies that these components \u003cem\u003eonly\u003c/em\u003e render on the client, but that's not actually true. \u003cstrong\u003eClient Components render on both the client \u003cem\u003eand\u003c/em\u003e the server.\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eI know that all this terminology is pretty confusing, so here's how I'd summarize it:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cem\u003eReact Server Components\u003c/em\u003e is the name for this new paradigm.\u003c/li\u003e\n\u003cli\u003eIn this new paradigm, the “standard” React components we know and love have been rebranded as \u003cem\u003eClient Components\u003c/em\u003e. It's a new name for an old thing.\u003c/li\u003e\n\u003cli\u003eThis new paradigm introduces a new type of component, \u003cem\u003eServer Components\u003c/em\u003e. These new components render exclusively on the server. Their code isn't included in the JS bundle, and so they never hydrate or re-render.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eReact Server Components vs. Server Side Rendering\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eLet's clear up another common bit of confusion: React Server Components is \u003cem\u003enot\u003c/em\u003e a replacement for Server Side Rendering. You shouldn't think of React Server Components as “SSR version 2.0”.\u003c/p\u003e\n\u003cp\u003eInstead, I like to think of it as two separate puzzle pieces that snap together perfectly, two flavors that complement each other.\u003c/p\u003e\n\u003cp\u003eWe still rely on Server Side Rendering to generate the initial HTML. React Server Components builds on top of that, allowing us to omit certain components from the client-side JavaScript bundle, ensuring they only run on the server.\u003c/p\u003e\n\u003cp\u003eIn fact, it's even possible to use React Server Components \u003cem\u003ewithout\u003c/em\u003e Server Side Rendering, though in practice, you'll get better results if you use them together. The React team has built a \u003ca href=\"https://github.com/reactjs/server-components-demo\"\u003eminimal RSC demo\u003c/a\u003e without SSR, if you'd like to see an example.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"compatible-environments\"\u003e\u003ca href=\"https://www.joshwcomeau.com/react/server-components/#compatible-environments-4\"\u003eCompatible Environments\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#compatible-environments\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eSo, typically, when a new React feature comes out, we can start using it in our existing projects by bumping our React dependency to the latest version. A quick \u003ccode\u003enpm install react@latest\u003c/code\u003e and we're off to the races.\u003c/p\u003e\n\u003cp\u003eUnfortunately, React Server Components doesn't work like that.\u003c/p\u003e\n\u003cp\u003eMy understanding is that React Server Components needs to be tightly integrated with a bunch of stuff outside of React, things like the bundler, the server, and the router.\u003c/p\u003e\n\u003cp\u003eAs I write this, there's only one way to start using React Server Components, and that's with Next.js 13.4+, using their brand-new re-architected “App Router”.\u003c/p\u003e\n\u003cp\u003eHopefully in the future, more React-based frameworks will start to incorporate React Server Components. It feels awkward that a core React feature is only available in one particular tool! The React docs has a \u003ca href=\"https://react.dev/learn/start-a-new-react-project#bleeding-edge-react-frameworks\"\u003e“Bleeding-edge frameworks” section\u003c/a\u003e where they list the frameworks that support React Server Components; I plan on checking this page from time to time, to see if any new options become available.\u003c/p\u003e\n\u003ch3 id=\"specifying-client-components\"\u003e\u003ca href=\"https://www.joshwcomeau.com/react/server-components/#specifying-client-components-5\"\u003eSpecifying client components\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#specifying-client-components\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eIn this new “React Server Components” paradigm, \u003cstrong\u003eall components are assumed to be Server Components by default.\u003c/strong\u003e We have to “opt in” for Client Components.\u003c/p\u003e\n\u003cp\u003eWe do this by specifying a brand-new \u003cem\u003edirective\u003c/em\u003e:\u003c/p\u003e\n\u003cpre class=\"language-jsx\"\u003e\u003ccode class=\"language-jsx\"\u003e\u003cspan class=\"token string\"\u003e\"use client\"\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eReact\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"react\"\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eCounter\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ecount\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e setCount\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eReact\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003euseState\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ebutton\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eonClick\u003c/span\u003e\u003cspan class=\"token script language-javascript\"\u003e\u003cspan class=\"token script-punctuation punctuation\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003esetCount\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecount \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003eCurrent value: \u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003ecount\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003ebutton\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003edefault\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eCounter\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThat standalone string at the top, \u003ccode\u003e'use client'\u003c/code\u003e, is how we signal to React that the component(s) in this file are Client Components, that they should be included in our JS bundles so that they can re-render on the client.\u003c/p\u003e\n\u003cp\u003eThis might \u003cem\u003eseem\u003c/em\u003e like an incredibly odd way to specify the type of component we're creating, but there is a precedent for this sort of thing: the \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Strict_mode\"\u003e\"use strict\"\u003c/a\u003e directive that opts into “Strict Mode” in JavaScript.\u003c/p\u003e\n\u003cp\u003eWe don't specify the \u003ccode\u003e'use server'\u003c/code\u003e directive in our Server Components; in the React Server Components paradigm, components are treated as Server Components by default. In fact, \u003ccode\u003e'use server'\u003c/code\u003e is used for Server Actions, a totally different feature that is beyond the scope of this blog post.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eWhich components should be Client Components?\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eYou might be wondering: how should I decide whether a given component should be a Server Component or a Client Component?\u003c/p\u003e\n\u003cp\u003eAs a general rule, if a component \u003cem\u003ecan\u003c/em\u003e be a Server Component, it \u003cem\u003eshould\u003c/em\u003e be a Server Component. Server Components tend to be simpler and easier to reason about. There's also a performance benefit: because Server Components don't run on the client, their code isn't included in our JavaScript bundles. One of the benefits of the React Server Components paradigm is that it has the potential to improve the \u003cem\u003ePage Interactive\u003c/em\u003e (TTI) metric.\u003c/p\u003e\n\u003cp\u003eThat said, we also shouldn't make it our mission to eradicate as many Client Components as possible! We shouldn't try to optimize for the smallest # of Client Components. It's worth remembering that until now, \u003cem\u003eevery\u003c/em\u003e React component in every React app has been a Client Component.\u003c/p\u003e\n\u003cp\u003eAs you start working with React Server Components, you'll likely discover that this is pretty intuitive. Some of our components will need to run on the client, because they use state variables or effects. You can slap a \u003ccode\u003e'use client'\u003c/code\u003e directive on those components. Otherwise, you can leave them as Server Components.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"boundaries\"\u003e\u003ca href=\"https://www.joshwcomeau.com/react/server-components/#boundaries-6\"\u003eBoundaries\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#boundaries\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eOne of the first questions I had when I was getting familiar with React Server Components was this: \u003cem\u003ewhat happens when the props change?\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003eFor example, suppose we had a Server Component like this:\u003c/p\u003e\n\u003cpre class=\"language-jsx\"\u003e\u003ccode class=\"language-jsx\"\u003e\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eHitCounter\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e hits \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ediv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003eNumber of hits: \u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003ehits\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003ediv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eLet's suppose that in the initial Server Side Render, \u003ccode\u003ehits\u003c/code\u003e was equal to \u003ccode\u003e0\u003c/code\u003e. This component, then, will produce the following markup:\u003c/p\u003e\n\u003cpre class=\"language-html\"\u003e\u003ccode class=\"language-html\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ediv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003eNumber of hits: 0\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003ediv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eBut what happens if the value of \u003ccode\u003ehits\u003c/code\u003e changes? Suppose it's a state variable, and it changes from \u003ccode\u003e0\u003c/code\u003e to \u003ccode\u003e1\u003c/code\u003e. \u003ccode\u003eHitCounter\u003c/code\u003e would need to re-render, but it \u003cem\u003ecan't\u003c/em\u003e re-render, because it's a Server Component!\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eThe thing is, Server Components don't really make sense in isolation.\u003c/strong\u003e We have to zoom out, to take a more holistic view, to consider the structure of our application.\u003c/p\u003e\n\u003cp\u003eLet's say we have the following component tree:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003etree diagram\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eIf all of these components are Server Components, then it all makes sense. None of the props will ever change, because none of the components will ever re-render.\u003c/p\u003e\n\u003cp\u003eBut let's suppose that \u003ccode\u003eArticle\u003c/code\u003e component owns the \u003ccode\u003ehits\u003c/code\u003e state variable. In order to use state, we need to convert it to a Client Component:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003etree diagram\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eDo you see the issue here? When \u003ccode\u003eArticle\u003c/code\u003e re-renders, any owned components will \u003cem\u003ealso\u003c/em\u003e re-render, including \u003ccode\u003eHitCounter\u003c/code\u003e and \u003ccode\u003eDiscussion\u003c/code\u003e. If these are Server Components, though, they \u003cem\u003ecan't\u003c/em\u003e re-render.\u003c/p\u003e\n\u003cp\u003eIn order to prevent this impossible situation, the React team added a rule: \u003cstrong\u003eClient Components can only import other Client Components.\u003c/strong\u003e That \u003ccode\u003e'use client'\u003c/code\u003e directive means that these instances of \u003ccode\u003eHitCounter\u003c/code\u003e and \u003ccode\u003eDiscussion\u003c/code\u003e will need to become Client Components.\u003c/p\u003e\n\u003cp\u003eOne of the biggest “ah-ha” moments I had with React Server Components was the realization that this new paradigm is all about creating \u003cem\u003eclient boundaries\u003c/em\u003e. Here's what winds up happening, in practice:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003etree diagram of client boundary\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eWhen we add the \u003ccode\u003e'use client'\u003c/code\u003e directive to the \u003ccode\u003eArticle\u003c/code\u003e component, we create a “client boundary”. All of the components within this boundary are \u003cem\u003eimplicitly\u003c/em\u003e converted to Client Components. Even though components like \u003ccode\u003eHitCounter\u003c/code\u003e don't have the \u003ccode\u003e'use client'\u003c/code\u003e directive, they'll still hydrate/render on the client in this particular situation.*\u003c/p\u003e\n\u003cp\u003eThis means we don't have to add \u003ccode\u003e'use client'\u003c/code\u003e to every single file that needs to run on the client. In practice, we only need to add it when we're creating new client boundaries.\u003c/p\u003e\n\u003ch3 id=\"workarounds\"\u003e\u003ca href=\"https://www.joshwcomeau.com/react/server-components/#workarounds-7\"\u003eWorkarounds\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#workarounds\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eWhen I first learned that Client Components can't render Server Components, it felt pretty restrictive to me. What if I need to use state high up in the application? Does that mean \u003cem\u003eeverything\u003c/em\u003e needs to become a Client Component??\u003c/p\u003e\n\u003cp\u003eIt turns out that in many cases, we can work around this limitation by restructuring our application so that the \u003cem\u003eowner\u003c/em\u003e changes.\u003c/p\u003e\n\u003cp\u003eThis is a tricky thing to explain, so let's use an example:\u003c/p\u003e\n\u003cpre class=\"language-jsx\"\u003e\u003ccode class=\"language-jsx\"\u003e\u003cspan class=\"token string\"\u003e\"use client\"\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token constant\"\u003eDARK_COLORS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant\"\u003eLIGHT_COLORS\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"@/constants.js\"\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eHeader\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"./Header\"\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eMainContent\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"./MainContent\"\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eHomepage\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ecolorTheme\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e setColorTheme\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eReact\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003euseState\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"light\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e colorVariables \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e colorTheme \u003cspan class=\"token operator\"\u003e===\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"light\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e?\u003c/span\u003e \u003cspan class=\"token constant\"\u003eLIGHT_COLORS\u003c/span\u003e \u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token constant\"\u003eDARK_COLORS\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ebody\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003estyle\u003c/span\u003e\u003cspan class=\"token script language-javascript\"\u003e\u003cspan class=\"token script-punctuation punctuation\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003ecolorVariables\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n      \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eHeader\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n      \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eMainContent\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n    \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003ebody\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIn this setup, we need to use React state to allow users to flip between dark mode / light mode. This needs to happen high up in the application tree, so that we can apply our CSS variable tokens to the \u003ccode\u003e\u0026#x3C;body\u003e\u003c/code\u003e tag.\u003c/p\u003e\n\u003cp\u003eIn order to use state, we need to make \u003ccode\u003eHomepage\u003c/code\u003e a Client Component. And since this is the top of our application, it means that all of the other components — \u003ccode\u003eHeader\u003c/code\u003e and \u003ccode\u003eMainContent\u003c/code\u003e — will implicitly become Client Components too.\u003c/p\u003e\n\u003cp\u003eTo fix this, let's pluck the color-management stuff into its own component, moved to its own file:\u003c/p\u003e\n\u003cpre class=\"language-jsx\"\u003e\u003ccode class=\"language-jsx\"\u003e\u003cspan class=\"token comment\"\u003e// /components/ColorProvider.js\u003c/span\u003e\n\u003cspan class=\"token string\"\u003e\"use client\"\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token constant\"\u003eDARK_COLORS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant\"\u003eLIGHT_COLORS\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"@/constants.js\"\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eColorProvider\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e children \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ecolorTheme\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e setColorTheme\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eReact\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003euseState\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"light\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e colorVariables \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e colorTheme \u003cspan class=\"token operator\"\u003e===\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"light\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e?\u003c/span\u003e \u003cspan class=\"token constant\"\u003eLIGHT_COLORS\u003c/span\u003e \u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token constant\"\u003eDARK_COLORS\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ebody\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003estyle\u003c/span\u003e\u003cspan class=\"token script language-javascript\"\u003e\u003cspan class=\"token script-punctuation punctuation\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003ecolorVariables\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003echildren\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003ebody\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eBack in \u003ccode\u003eHomepage\u003c/code\u003e, we use this new component like so:\u003c/p\u003e\n\u003cpre class=\"language-jsx\"\u003e\u003ccode class=\"language-jsx\"\u003e\u003cspan class=\"token comment\"\u003e// /components/Homepage.js\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eHeader\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"./Header\"\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eMainContent\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"./MainContent\"\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eColorProvider\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"./ColorProvider\"\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eHomepage\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eColorProvider\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n      \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eHeader\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n      \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eMainContent\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n    \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eColorProvider\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe can remove the \u003ccode\u003e'use client'\u003c/code\u003e directive from \u003ccode\u003eHomepage\u003c/code\u003e because it no longer uses state, or any other client-side React features. This means that \u003ccode\u003eHeader\u003c/code\u003e and \u003ccode\u003eMainContent\u003c/code\u003e won't be implicitly converted to Client Components anymore!\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eBut wait a second.\u003c/strong\u003e \u003ccode\u003eColorProvider\u003c/code\u003e, a Client Component, is a \u003cem\u003eparent\u003c/em\u003e to \u003ccode\u003eHeader\u003c/code\u003e and \u003ccode\u003eMainContent\u003c/code\u003e. Either way, it's still higher in the tree, right?\u003c/p\u003e\n\u003cp\u003eWhen it comes to client boundaries, though, the parent/child relationship doesn't matter. \u003ccode\u003eHomepage\u003c/code\u003e is the one importing and rendering \u003ccode\u003eHeader\u003c/code\u003e and \u003ccode\u003eMainContent\u003c/code\u003e. This means that \u003ccode\u003eHomepage\u003c/code\u003e decides \u003cem\u003ewhat the props are\u003c/em\u003e for these components.\u003c/p\u003e\n\u003cp\u003eRemember, the problem we're trying to solve is that Server Components can't re-render, and so they can't be given new values for any of their props. With this new setup, \u003ccode\u003eHomepage\u003c/code\u003e decides what the props are for \u003ccode\u003eHeader\u003c/code\u003e and \u003ccode\u003eMainContent\u003c/code\u003e, and since \u003ccode\u003eHomepage\u003c/code\u003e is a Server Component, there's no problem.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eThis is brain-bending stuff.\u003c/strong\u003e Even after years of React experience, I still find this very confusing 😅. It took a fair bit of practice to develop an intuition for this.\u003c/p\u003e\n\u003cp\u003eTo be more precise, the \u003ccode\u003e'use client'\u003c/code\u003e directive works at the file / module level. Any modules \u003cem\u003eimported\u003c/em\u003e in a Client Component file must be Client Components as well. When the bundler bundles up our code, it'll follow these imports, after all!\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eChanging the color theme?\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eIn my example above, you might have noticed that there's no way to change the color theme. \u003ccode\u003esetColorTheme\u003c/code\u003e is never called.\u003c/p\u003e\n\u003cp\u003eI wanted to keep things as minimal as possible, and so I left some stuff out. A full example would use React context to make the setter function available to any descendants. As long as the component that consumes the context is a Client Component, everything works great!\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"peeking-under-the-hood\"\u003e\u003ca href=\"https://www.joshwcomeau.com/react/server-components/#peeking-under-the-hood-8\"\u003ePeeking under the hood\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#peeking-under-the-hood\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eLet's look at this at a bit of a lower level. When we use a Server Component, what does the output look like? What actually gets generated?\u003c/p\u003e\n\u003cp\u003eLet's start with a super-simple React application:\u003c/p\u003e\n\u003cpre class=\"language-jsx\"\u003e\u003ccode class=\"language-jsx\"\u003e\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eHomepage\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ep\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003eHello world!\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003ep\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIn the React Server Components paradigm, all components are Server Components by default. Since we haven't explicitly marked this component as a Client Component (or rendered it within a client boundary), it'll only render on the server.\u003c/p\u003e\n\u003cp\u003eWhen we visit this app in the browser, we'll receive an HTML document which looks something like this:\u003c/p\u003e\n\u003cpre class=\"language-html\"\u003e\u003ccode class=\"language-html\"\u003e\u003cspan class=\"token doctype\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;!\u003c/span\u003e\u003cspan class=\"token doctype-tag\"\u003eDOCTYPE\u003c/span\u003e \u003cspan class=\"token name\"\u003ehtml\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ehtml\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ebody\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ep\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003eHello world!\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003ep\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003escript\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003esrc\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e/static/js/bundle.js\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token script\"\u003e\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003escript\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003escript\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token script\"\u003e\u003cspan class=\"token language-javascript\"\u003e\n      self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003e__next\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"$Homepage-1\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        type\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"p\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        props\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword null nil\"\u003enull\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        children\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Hello world!\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003escript\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003ebody\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003ehtml\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eSome liberties taken\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eTo make it easier to understand, I've taken the liberty of restructuring things here. For example, the true JS generated in an RSC context uses stringified JSON arrays, as an optimization to reduce the file size of this HTML document.\u003c/p\u003e\n\u003cp\u003eI've also stripped out all non-critical parts of the HTML (like the \u003ccode\u003e\u0026#x3C;head\u003e\u003c/code\u003e).\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eWe see that our HTML document includes the UI generated by our React application, the “Hello world!” paragraph. This is thanks to Server Side Rendering, and isn't directly attributable to React Server Components.\u003c/p\u003e\n\u003cp\u003eBelow that, we have a \u003ccode\u003e\u0026#x3C;script\u003e\u003c/code\u003e tag that loads up our JS bundle. This bundle includes the dependencies like React, as well as any Client Components used in our application. And since our \u003ccode\u003eHomepage\u003c/code\u003e component is a Server Component, the code for that component is \u003cem\u003enot\u003c/em\u003e included in this bundle.\u003c/p\u003e\n\u003cp\u003eFinally, we have a second \u003ccode\u003e\u0026#x3C;script\u003e\u003c/code\u003e tag with some inline JS:\u003c/p\u003e\n\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003e__next\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"$Homepage-1\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  type\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"p\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  props\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword null nil\"\u003enull\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  children\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Hello world!\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis is the really interesting bit. Essentially, what we're doing here is telling React “Hey, so I know you're missing the \u003ccode\u003eHomepage\u003c/code\u003e component code, but don't worry: here's what it rendered”.\u003c/p\u003e\n\u003cp\u003eTypically, when React hydrates on the client, it speed-renders all of the components, building up a virtual representation of the application. It can't do that for Server Components, because the code isn't included in the JS bundle.\u003c/p\u003e\n\u003cp\u003eAnd so, we send along the rendered value, the virtual representation that was generated by the server. When React loads on the client, it re-uses that description instead of re-generating it.\u003c/p\u003e\n\u003cp\u003eThis is what allows that \u003ccode\u003eColorProvider\u003c/code\u003e example above to work. The output from \u003ccode\u003eHeader\u003c/code\u003e and \u003ccode\u003eMainContent\u003c/code\u003e is passed into the \u003ccode\u003eColorProvider\u003c/code\u003e component through the \u003ccode\u003echildren\u003c/code\u003e prop. \u003ccode\u003eColorProvider\u003c/code\u003e can re-render as much as it wants, but this data is static, locked in by the server.\u003c/p\u003e\n\u003cp\u003eIf you're curious to see \u003cem\u003etrue\u003c/em\u003e representations of how Server Components are serialized and sent over the network, check out the \u003ca href=\"https://www.alvar.dev/blog/creating-devtools-for-react-server-components\"\u003eRSC Devtools\u003c/a\u003e by developer Alvar Lagerlöf.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eServer Components don't require a server\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eEarlier in this post, I mentioned that Server Side Rendering is an “umbrella term” for lots of different rendering strategies, including:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eStatic: the HTML is generated when the application is built, during the deploy process.\u003c/li\u003e\n\u003cli\u003eDynamic: the HTML is generated “on-demand”, when the page is requested by the user.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eReact Server Components is compatible with either of these rendering strategies.\u003c/strong\u003e When our Server Components are rendered in the Node.js runtime, the JavaScript objects they return will be created. That can happen either on-demand or during the build.\u003c/p\u003e\n\u003cp\u003eThis means that it's possible to use React Server Components without a server! We can generate a bunch of static HTML files and host them wherever we want. In fact, this is what happens \u003cem\u003eby default\u003c/em\u003e in the Next.js App Router. Unless we really need things to happen “on-demand”, all of this work happens ahead of time, during the build.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eNo React at all?\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eYou might be wondering: if we don't include any Client Components in our application, do we actually need to download React at all? Can we use React Server Components to build a \u003cem\u003etruly\u003c/em\u003e static no-JS website?\u003c/p\u003e\n\u003cp\u003eThe thing is, React Server Components is available exclusively within the Next.js framework, and that framework has a bunch of code that needs to run on the client, to manage things like routing.\u003c/p\u003e\n\u003cp\u003eCounter-intuitively, though, this actually tends to produce a \u003cem\u003ebetter\u003c/em\u003e user experience; Next's router, for example, will process link clicks \u003cem\u003efaster\u003c/em\u003e than a typical \u003ccode\u003e\u0026#x3C;a\u003e\u003c/code\u003e tag, since it doesn't have to load a whole new HTML document.\u003c/p\u003e\n\u003cp\u003eA well-structured Next.js application will still work while the JS is downloading, but it'll be even faster/better once the JS loads.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"advantages\"\u003e\u003ca href=\"https://www.joshwcomeau.com/react/server-components/#advantages-9\"\u003eAdvantages\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#advantages\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eReact Server Components is the first “official” way to run server-exclusive code in React. As I mentioned earlier, though, this isn't \u003cem\u003ereally\u003c/em\u003e a new thing in the broader React ecosystem; we've been able to run server-exclusive code in Next.js since 2016!\u003c/p\u003e\n\u003cp\u003eThe big difference is that we've never before had a way to run server-exclusive code \u003cem\u003einside our components.\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003eThe most obvious benefit is performance. Server Components don't get included in our JS bundles, which reduces the amount of JavaScript that needs to be downloaded, and the number of components that need to be hydrated:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003echart of Legacy Next.js (pre-RSC) and Modern Next.js (with RSC)\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eThis is a data visualization which shows a sequence of events between client and server. Each event is represented here as a list item.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\"Database Query\" on server. Duration: 5 units of time.\u003c/li\u003e\n\u003cli\u003e\"Render App\" on server. Duration: 6 units of time.\u003c/li\u003e\n\u003cli\u003eResponse from server. Duration: 4 units of time.\u003c/li\u003e\n\u003cli\u003e\"Download JavaScript\" on client. Duration: 7 units of time.\u003c/li\u003e\n\u003cli\u003e\"Hydrate\" on client. Duration: 3 units of time.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eThis is maybe the least exciting thing to me, though. Honestly, most Next.js apps are \u003cem\u003ealready\u003c/em\u003e fast enough when it comes to “Page Interactive” timing.\u003c/p\u003e\n\u003cp\u003eIf you follow semantic HTML principles, most of your app should work even before React has hydrated. Links can be followed, forms can be submitted, accordions can be expanded and collapsed (using \u003ccode\u003e\u0026#x3C;details\u003e\u003c/code\u003e and \u003ccode\u003e\u0026#x3C;summary\u003e\u003c/code\u003e). For most projects, it's fine if it takes a few seconds for React to hydrate.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eBut here's something I find really cool:\u003c/strong\u003e we no longer have to make the same compromises, in terms of features vs. bundle size!\u003c/p\u003e\n\u003cp\u003eFor example, most technical blogs require some sort of syntax highlighting library. On this blog, I use Prism. The code snippets look like this:\u003c/p\u003e\n\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003eexampleJavaScriptFunction\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003eparam\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Hello world!\"\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eA proper syntax-highlighting library, with support for all popular programming languages, would be several megabytes, far too large to stick in a JS bundle. As a result, we have to make compromises, trimming out languages and features that aren't mission-critical.\u003c/p\u003e\n\u003cp\u003eBut, suppose we do the syntax highlighting \u003cem\u003ein a Server Component.\u003c/em\u003e In that case, none of the library code would actually be included in our JS bundles. As a result, we wouldn't have to make any compromises, we could use all of the bells and whistles.\u003c/p\u003e\n\u003cp\u003eThis is the big idea behind \u003ca href=\"https://bright.codehike.org/\"\u003eBright\u003c/a\u003e, a modern syntax-highlighting package designed to work with React Server Components.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"/images/server-components/bright.png\"\u003eimage of React server component for syntax highlighting\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eThis is the sort of thing that gets me excited about React Server Components. Things that would be too cost-prohibitive to include in a JS bundle can now run on the server \u003cem\u003efor free,\u003c/em\u003e adding zero kilobytes to our bundles, and producing an even better user experience.\u003c/p\u003e\n\u003cp\u003eIt's not just about performance and UX either. After working with RSC for a while, I've come to really appreciate how easy-breezy Server Components are. We never have to worry about dependency arrays, stale closures, memoization, or any of the other complex stuff caused by \u003cem\u003ethings changing.\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003eUltimately, it's still very early days. React Server Components only emerged from beta a couple of months ago! I'm really excited to see how things evolve over the next couple of years, as the community continues to innovate new solutions like Bright, taking advantage of this new paradigm. It's an exciting time to be a React developer!\u003c/p\u003e\n\u003ch2 id=\"the-full-picture\"\u003e\u003ca href=\"https://www.joshwcomeau.com/react/server-components/#the-full-picture-10\"\u003eThe full picture\u003c/a\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#the-full-picture\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eReact Server Components is an exciting development, but it's actually only one part of the “Modern React” puzzle.\u003c/p\u003e\n\u003cp\u003eThings get \u003cem\u003ereally\u003c/em\u003e interesting when we combine React Server Components with Suspense and the new Streaming SSR architecture. It allows us to do \u003cem\u003ewild\u003c/em\u003e stuff like this:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003echart\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eThis is a data visualization which shows a sequence of events between client and server. Each event is represented here as a list item.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\"Render Shell\" on server. Duration: 3 units of time.\u003c/li\u003e\n\u003cli\u003eResponse from server. Duration: 3 units of time.\u003c/li\u003e\n\u003cli\u003e\"Database Query\" on server. Duration: 8 units of time.\u003c/li\u003e\n\u003cli\u003e\"Render Content\" on server. Duration: 3 units of time.\u003c/li\u003e\n\u003cli\u003eResponse from server. Duration: 4 units of time.\u003c/li\u003e\n\u003cli\u003e\"Download JS\" on client. Duration: 5 units of time.\u003c/li\u003e\n\u003cli\u003e\"Hydrate\" on client. Duration: 2 units of time.\u003c/li\u003e\n\u003cli\u003e\"Hydrate\" on client. Duration: 2 units of time.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eIt's beyond the scope of this tutorial, but you can learn more about this architecture \u003ca href=\"https://github.com/reactwg/react-18/discussions/37\"\u003eon Github\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eIt's also something we explore in depth in my brand-new course, \u003ca href=\"https://joyofreact.com/\"\u003eThe Joy of React\u003c/a\u003e. I'd love to tell you a little bit more about it, if that's alright! ❤️\u003c/p\u003e\n\u003cp\u003eThe Joy of React is a beginner-friendly interactive course, designed to help you build an intuition for how React works. We start at the very beginning (no prior React experience required), and work our way through some of the most notoriously-tricky aspects of React.\u003c/p\u003e\n\u003cp\u003eThis course has been my full-time focus for almost two years now, and it includes all of the most important stuff I've learned about React in over 8 years of experience.\u003c/p\u003e\n\u003cp\u003eThere's so much good stuff I'd love to tell you about. In addition to React itself, and all the bleeding-edge stuff we've alluded to in this blog post, you'll learn about my favourite parts of the React ecosystem. For example, you'll learn how to do next-level layout animations like this, using Framer Motion:\u003c/p\u003e\n\u003cp\u003eYou can learn more about the course, and discover the joy of building with React:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://joyofreact.com/\"\u003eThe Joy of React\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003eReact Server Components is a significant paradigm shift. Personally, I'm \u003cem\u003esuper\u003c/em\u003e keen to see how things develop over the next couple of years, as the ecosystem builds more tools like Bright that takes advantage of Server Components.\u003c/p\u003e\n\u003cp\u003eI have the feeling that building in React is about to get even cooler. 😄\u003c/p\u003e","noteIndex":{"id":"Iy0MoL0KnL55Br3AfTS2C","title":"Luke","desc":"","updated":1761796791487,"created":1644449449778,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":"vault"},"contentHash":"4e745570ca97988a0362cb939b760952","links":[{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"life-tips","position":{"start":{"line":41,"column":5,"offset":2603},"end":{"line":41,"column":29,"offset":2627},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"life-tips","anchorHeader":"wodenokoto"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"journal.what-i-read-in.2025","alias":"What I read in 2025","position":{"start":{"line":70,"column":3,"offset":4333},"end":{"line":70,"column":54,"offset":4384},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"journal.what-i-read-in.2025"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"journal.what-i-read-in.2024","alias":"2024","position":{"start":{"line":71,"column":5,"offset":4389},"end":{"line":71,"column":41,"offset":4425},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"journal.what-i-read-in.2024"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"journal.what-i-read-in.2023","alias":"2023","position":{"start":{"line":72,"column":5,"offset":4430},"end":{"line":72,"column":41,"offset":4466},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"journal.what-i-read-in.2023"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"journal.what-i-read-in.2022","alias":"2022","position":{"start":{"line":73,"column":5,"offset":4471},"end":{"line":73,"column":41,"offset":4507},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"journal.what-i-read-in.2022"}},{"type":"wiki","from":{"fname":"root","id":"Iy0MoL0KnL55Br3AfTS2C","vaultName":"vault"},"value":"journal.what-i-struggled-brag-in","position":{"start":{"line":79,"column":3,"offset":4643},"end":{"line":79,"column":39,"offset":4679},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"journal.what-i-struggled-brag-in"}}],"anchors":{"what-i-read-in-past":{"type":"header","text":"What I read in past","value":"what-i-read-in-past","line":74,"column":0,"depth":2}},"children":["zd4mq442jike0pr0wba1u3m","6hzeqsofq67gdk88flxlkhp","778ijii93yu5uwnrwmn5zi4","g1fngdjl25nes6fs3lip602","ZbdkdApFqLdks4Moq92R9","uoc5hhki3o4py15cesddu8q","9qf7j06jtdkm6rnx9ymvwb0","5zn10cvj7ajy2gh2is5nqmg","4qo9ma0z0yu1czns6pxl7y5","ok0e729ho7o09xetujkxc0m","GR5x8HnNFEN6fU2UBSEIK","yirtnlj8q24yutcf3ss1xqy","eq0wc6t7wl2wv221yb68ro4","7x2fnv4j6gxts08qk0jguny","ettkt3iClONnxpbGwBVLl","7l4knev6v613tbuoskvmbdg","hvh5bud6yp7dc89tuh95tr9","4fvoqrplw0cweo554usbjos","f8qsfql0a9v8thpeo82udfa","1swsbrhqi9jk41v9eodyi5q","SQqYupi6EFddTerBA8RRD","hjNeNc1F2JUh0lTWanH4h","qf0l4wbrc9jgooyzexmbq5v","uur1lkol353z9vfeqb3n5bv","cd9n1czq3ursgkby985wkmm","k1sr43vwnfqztwc0s43pkcf","wfde75rhdvq2yfa2zy2q6rv","rjcmdv60jokmbw6zoq8u2ef","ujapvww8o6v3kpmlhtryq4k","pkwewou9d5e8ystswn1j2b4"],"parent":null,"data":{},"body":"\nHi there 👋. I'm a Front-end developer.\n\n---\n\n- 단순함과 꾸준함은 가장 쉬우면서도 지키기 어려운 원칙.\n\n- 🥱 -\u003e 🤔💡🌱 - [On The Death of Daydreaming](https://www.afterbabel.com/p/on-the-death-of-daydreaming)\n  - boredom -\u003e easy fun -\u003e art -\u003e profit?\n\n\u003e I've often described my motivation for building software to others using imagery: I like to go find a secluded beach, build a large, magnificent sand castle, and then walk away. Will anyone notice? Probably not. Will the waves eventually destroy it? Yep. Did I still get immense satisfaction? Absolutely. - [aliasxneo](https://news.ycombinator.com/item?id=41497113)\n\n\u003e We love to see the process, not just the result. The imperfections in your work can be beautiful if they show your struggle for perfection, not a lack of care. - [ralphammer](https://ralphammer.com/is-perfection-boring/)\n\n\u003e Simplicity, even if it sacrifices some ideal functionality has better survival characteristics than the-right-thing. - [The Rise of Worse is Better](https://www.dreamsongs.com/RiseOfWorseIsBetter.html)\n\n\u003e [Roberto Blake was talking about making 100 crappy videos](https://www.youtube.com/watch?v=OnUBaQ1Sp_E) to get better over time. Putting in the reps and improving a little bit each time.\n\u003e\n\u003e Putting in the work without expecting any external reward at first (eg views, followers, likes, etc) will pay off in the long run. - [100 Scrappy Things](https://www.florin-pop.com/blog/100-scrappy-things/)\n\n\u003e Make the difficult habitual, the habitual easy, and the easy beautiful. - [Constantin S. Stanislavski](https://www.goodreads.com/quotes/7102271-make-the-difficult-habitual-the-habitual-easy-and-the-easy)\n\n\u003e A good match is a **structured** dance, where players aim to **score** while they are following well-defined **rules**. This **freedom within a structure** is what makes it fun. - [ralphammer](https://ralphammer.com/how-to-get-started/)\n\n- [Pivot Points](https://longform.asmartbear.com/pivot-points/)\n\n  - non-judgmental aspects of personality that can be strengths in some contexts and weaknesses in others\n  - Pivot Points are fixed in the short term\n\n- [Hedged Bets](https://longform.asmartbear.com/predict-the-future/#hedged-bets)\n  - trading slightly less maximum upside for predictable, net-positive outcomes.\n\n\u003e “Motivation often comes after starting, not before. Action produces momentum.”\n\u003e [When you start a new habit, it should take less than two minutes to do.](https://jamesclear.com/how-to-stop-procrastinating)\n\u003e\n\u003e - James Clear\n\n\u003e Focus is more about **not** keeping busy when you need to wait for something.  \n\u003e Eat the boredom for a minute.\n\u003e\n\u003e - [[life-tips#wodenokoto]]\n\n\u003e [4 minutes run hard enough to push heart rate to 90%, 3 minutes recover, repeat 4 times](https://news.ycombinator.com/item?id=34213181)\n\u003e\n\u003e - https://www.ntnu.edu/cerg/advice\n\u003e - [Get running with Couch to 5K](https://www.nhs.uk/live-well/exercise/running-and-aerobic-exercises/get-running-with-couch-to-5k/)\n\n\u003e [recommended routine - bodyweightfitness](https://www.reddit.com/r/bodyweightfitness/wiki/kb/recommended_routine/) - I Don't Have This Much Time!\n\u003e\n\u003e - Don't workout at all (saves anywhere from 20 to 60 minutes, but really, really, really, really, really, really, really, really, really not recommended)\n\n\u003e 도무지 읽히지 않는 책 앞에서 내가 택한 방법은 펼쳐진 페이지 앞에서 멍때리기이다. 다르게 표현하면 이렇다. 펼쳐진 두 페이지 앞에서 오래 머물기.\n\u003e\n\u003e 책을 펼쳐놓는 것으로 충분하다. 읽지 못해도 좋다. 매일 정해진 진도를 나가야 하는 학교 수업이 아니니까. 하지만 읽지 않아도 괜찮다고 해서 펼쳐두지조차 않으면 곤란하다. 가능한 한 자주 책을 펼쳐두도록 하자. 전혀 읽지 않고 멍하니 바라보고 있다가 다시 덮게 되더라도\n\u003e\n\u003e - 막막한 독서. 시로군. P.10~13\n\n\u003e I think it should be everyone's primary focus to sleep well, drink water, get outside, get active, and eat generally decently. I hate to say it, but if you're not eating a good amount of vegetables and fruit, decent protein, sleep, etc, no amount of XYZ will catch up to that detriment. - [CE02](https://news.ycombinator.com/item?id=35056071)\n\n\u003e My real battle is doing good versus doing nothing. - [Deirdre Sullivan](https://www.npr.org/2005/08/08/4785079/always-go-to-the-funeral)\n\n[Kind Engineering](https://kind.engineering/) - How To Engineer Kindness\n\n\u003e Sometimes magic is just someone spending more time on something than anyone else might reasonably expect. - [Teller](https://www.goodreads.com/quotes/6641527-sometimes-magic-is-just-someone-spending-more-time-on-something)\n\n---\n\n## What I read in past\n\n- [[What I read in 2025|journal.what-i-read-in.2025]]\n  - [[2024|journal.what-i-read-in.2024]]\n  - [[2023|journal.what-i-read-in.2023]]\n  - [[2022|journal.what-i-read-in.2022]]\n- 📝 [Gists](https://gist.github.com/Luke-SNAW)\n- 📜 [Journals](https://luke-snaw.github.io/Luke-SNAW__netlify-CMS.github.io/)\n\n---\n\n- [[journal.what-i-struggled-brag-in]]\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":true,"vaultSelectionModeOnCreate":"smart","leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2}},"randomNote":{},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":"vault"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link","taskCompleteStatus":["done","x"]},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"enableUserTags":false,"enableHashTags":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"enableEditorDecorations":true,"maxPreviewsCached":10,"maxNoteLength":204800,"dendronVersion":"0.115.0","enableFullHierarchyNoteTitle":false,"enablePersistentHistory":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false,"enableFrontmatterTags":true,"enableHashesForFMTags":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Luke SNAW","description":"Personal knowledge space"},"github":{"enableEditLink":false,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"searchMode":"lookup","siteUrl":"https://luke-snaw.github.io/","duplicateNoteBehavior":{"action":"useVault","payload":["vault"]},"siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"v7zet6zxl73bs63kf6kagio"},"buildId":"vOE8u-mg___OsOsz4tjEg","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>